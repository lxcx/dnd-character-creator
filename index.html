<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D 5E NPC Generator</title>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- D&D Style Fonts -->
    <link href="https://db.onlinewebfonts.com/c/c391b9f3d65d9f9e311c80d964b696e1?family=Nodesto+Caps+Condensed" rel="stylesheet">
    <link href="https://db.onlinewebfonts.com/c/b9b59f3d31d975e265c5ed4c5433326f?family=Bookinsanity" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Bookinsanity', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #7a200d 0%, #3e0c02 100%);
            min-height: 100vh;
            padding: 20px;
        }

        h1, h2, h3, .section-title, .npc-name, .stat-label {
            font-family: 'Nodesto Caps Condensed', 'Segoe UI', Tahoma, sans-serif;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-family: 'Nodesto Caps Condensed', serif;
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            letter-spacing: 2px;
        }

        header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        @media (max-width: 968px) {
            .content {
                grid-template-columns: 1fr;
            }
        }

        .form-section, .result-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95em;
        }

        select, input {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
            background: white;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #58180d;
            box-shadow: 0 0 0 3px rgba(88, 24, 13, 0.1);
        }

        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #7a200d 0%, #3e0c02 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(88, 24, 13, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .npc-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #58180d;
        }

        .npc-header {
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .npc-name {
            font-family: 'Nodesto Caps Condensed', serif;
            font-size: 2.2em;
            color: #58180d;
            margin-bottom: 5px;
            letter-spacing: 1px;
        }

        .npc-basics {
            color: #6c757d;
            font-size: 1.1em;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 8px;
            text-align: center;
            min-width: 90px;
        }

        .stat-label {
            font-family: 'Nodesto Caps Condensed', serif;
            font-size: 0.95em;
            color: #58180d;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: 700;
            color: #2c3e50;
        }

        .stat-value.editable {
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.2s;
            display: inline-block;
            position: relative;
        }

        .stat-value.editable:hover {
            background-color: #e8f4ff;
        }

        .stat-value.editable::after {
            position: absolute;
            margin-left: 2px;
            font-size: 0.5em;
        }

        /* Hide number input spinners */
        .stat-input::-webkit-outer-spin-button,
        .stat-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .stat-input {
            -moz-appearance: textfield;
        }

        .stat-modifier {
            font-size: 0.9em;
            color: #58180d;
            font-weight: 600;
        }

        .section-title {
            font-family: 'Nodesto Caps Condensed', serif;
            font-size: 1.4em;
            font-weight: 600;
            color: #58180d;
            margin: 20px 0 10px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #c9ad6a;
            letter-spacing: 1px;
        }

        .info-item {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .info-label {
            font-weight: 600;
            color: #495057;
            margin-right: 8px;
        }

        .skills-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .skill-tag {
            background: #e9ecef;
            color: #6c757d;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
        }

        .skill-tag.proficient {
            background: #58180d;
            color: white;
        }

        .skill-modifier {
            opacity: 0.85;
            font-weight: 600;
            margin-left: 2px;
            font-weight: 500;
        }

        .traits-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .trait-tag {
            background: linear-gradient(135deg, #c9ad6a 0%, #a08050 100%);
            color: #3e0c02;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .features-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .feature-tag {
            background: linear-gradient(135deg, #58180d 0%, #7a200d 100%);
            color: #fdf1dc;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
            cursor: help;
        }

        .feature-tag:hover {
            transform: scale(1.02);
            box-shadow: 0 2px 8px rgba(88, 24, 13, 0.3);
        }

        .feature-level {
            opacity: 0.8;
            font-size: 0.85em;
        }

        /* Spell Styles */
        .spells-section {
            margin-top: 20px;
        }

        .spell-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
            padding: 10px 15px;
            background: linear-gradient(135deg, #fdf1dc 0%, #e0c9a0 100%);
            border-radius: 8px;
            border: 1px solid #c9ad6a;
        }

        .spell-stat {
            font-size: 0.9em;
        }

        .spell-stat-label {
            font-weight: 600;
            color: #58180d;
        }

        .spell-slots-display {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .spell-slot-badge {
            background: linear-gradient(135deg, #58180d 0%, #7a200d 100%);
            color: #fdf1dc;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .spell-slot-badge.empty {
            background: #6c757d;
            opacity: 0.5;
        }

        .spells-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }

        .spell-tag {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
            cursor: help;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .spell-tag:hover {
            transform: scale(1.02);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .spell-tag.cantrip {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
        }

        .spell-tag.level-1 {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
            color: white;
        }

        .spell-tag.level-2 {
            background: linear-gradient(135deg, #17a2b8 0%, #117a8b 100%);
            color: white;
        }

        .spell-tag.level-3 {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
        }

        .spell-tag.level-4 {
            background: linear-gradient(135deg, #6f42c1 0%, #59359a 100%);
            color: white;
        }

        .spell-tag.level-5 {
            background: linear-gradient(135deg, #dc3545 0%, #bd2130 100%);
            color: white;
        }

        .spell-tag.level-6,
        .spell-tag.level-7,
        .spell-tag.level-8,
        .spell-tag.level-9 {
            background: linear-gradient(135deg, #fd7e14 0%, #e55a00 100%);
            color: white;
        }

        .spell-level-label {
            opacity: 0.85;
            font-size: 0.85em;
            margin-left: 3px;
        }

        .spell-section-title {
            font-size: 0.9em;
            font-weight: 600;
            color: #58180d;
            margin: 10px 0 5px 0;
            border-bottom: 1px solid #c9ad6a;
            padding-bottom: 3px;
        }

        /* Weapon Styles */
        .weapons-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }

        .weapon-card {
            background: linear-gradient(135deg, #fdf1dc 0%, #e0c9a0 100%);
            border: 1px solid #c9ad6a;
            border-radius: 8px;
            padding: 10px 12px;
            cursor: help;
        }

        .weapon-card:hover {
            box-shadow: 0 2px 8px rgba(88, 24, 13, 0.2);
        }

        .weapon-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .weapon-name {
            font-weight: 600;
            color: #58180d;
            font-size: 1em;
        }

        .weapon-type {
            font-size: 0.75em;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .weapon-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            font-size: 0.9em;
        }

        .weapon-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .weapon-stat-label {
            color: #6c757d;
            font-size: 0.85em;
        }

        .weapon-stat-value {
            font-weight: 600;
            color: #3e0c02;
        }

        .weapon-properties {
            margin-top: 5px;
            font-size: 0.8em;
            color: #6c757d;
            font-style: italic;
        }

        .weapon-card-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #c9ad6a;
        }

        .weapon-action-btn {
            padding: 4px 8px;
            font-size: 0.75em;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .weapon-action-btn.modifier {
            background: #007bff;
            color: white;
        }

        .weapon-action-btn.modifier:hover {
            background: #0056b3;
        }

        .weapon-action-btn.remove {
            background: #dc3545;
            color: white;
        }

        .weapon-action-btn.remove:hover {
            background: #bd2130;
        }

        .weapon-modifier-badge {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
            margin-left: 5px;
        }

        .weapon-add-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .weapon-add-btn {
            flex: 1;
            padding: 8px 12px;
            font-size: 0.85em;
            border: 2px dashed #c9ad6a;
            background: transparent;
            color: #58180d;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .weapon-add-btn:hover {
            background: #fdf1dc;
            border-color: #58180d;
        }

        .weapon-add-btn i {
            margin-right: 5px;
        }

        /* Weapon Modal Styles */
        .weapon-modal-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .weapon-modal-filter {
            padding: 6px 12px;
            border: 1px solid #c9ad6a;
            background: white;
            border-radius: 4px;
            font-size: 0.85em;
            cursor: pointer;
        }

        .weapon-modal-filter:focus {
            outline: none;
            border-color: #58180d;
        }

        .weapon-modal-search {
            flex: 1;
            min-width: 150px;
        }

        .weapon-modal-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid #e0c9a0;
            border-radius: 6px;
            margin-bottom: 8px;
            background: #fdf1dc;
            cursor: pointer;
            transition: all 0.2s;
        }

        .weapon-modal-item:hover {
            background: #e0c9a0;
            border-color: #c9ad6a;
        }

        .weapon-modal-item.selected {
            background: #c9ad6a;
            border-color: #58180d;
        }

        .weapon-modal-item-info {
            flex: 1;
        }

        .weapon-modal-item-name {
            font-weight: 600;
            color: #58180d;
        }

        .weapon-modal-item-details {
            font-size: 0.8em;
            color: #6c757d;
        }

        .weapon-modal-item-stats {
            text-align: right;
            font-size: 0.85em;
        }

        .custom-weapon-form {
            padding: 15px;
            background: #fdf1dc;
            border-radius: 8px;
            margin-top: 10px;
        }

        .custom-weapon-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .custom-weapon-field {
            flex: 1;
            min-width: 100px;
        }

        .custom-weapon-field label {
            display: block;
            font-size: 0.8em;
            color: #58180d;
            margin-bottom: 3px;
        }

        .custom-weapon-field input,
        .custom-weapon-field select {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #c9ad6a;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .hidden {
            display: none;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }

        .race-description {
            margin-top: 10px;
            padding: 12px;
            background: #fdf1dc;
            border-left: 4px solid #58180d;
            border-radius: 6px;
            font-size: 0.9em;
            line-height: 1.5;
            color: #2c3e50;
            transition: all 0.3s ease;
        }

        .race-description.hidden {
            display: none;
        }

        .race-description strong {
            color: #58180d;
            display: block;
            margin-bottom: 5px;
            font-size: 1em;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-row .form-group {
            margin-bottom: 0;
        }

        @media (max-width: 500px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .class-description {
            margin-top: 10px;
            padding: 12px;
            background: #fdf1dc;
            border-left: 4px solid #58180d;
            border-radius: 6px;
            font-size: 0.9em;
            line-height: 1.5;
            color: #2c3e50;
            transition: all 0.3s ease;
        }

        .class-description.hidden {
            display: none;
        }

        .occupation-description {
            margin-top: 10px;
            padding: 12px;
            background: #e8f8e8;
            border-left: 4px solid #28a745;
            border-radius: 6px;
            font-size: 0.9em;
            line-height: 1.5;
            color: #2c3e50;
            transition: all 0.3s ease;
        }

        .occupation-description.hidden {
            display: none;
        }

        /* Class level and multiclass styles */
        .class-level-row {
            display: flex;
            gap: 8px;
        }

        .class-level-row select:first-child {
            flex: 1;
        }

        .level-select {
            width: 85px !important;
            min-width: 85px;
            flex-shrink: 0;
        }

        .subclass-select {
            width: 100%;
        }

        .multiclass-section {
            margin: 15px 0;
            padding: 15px;
            background: #f8f4fc;
            border-radius: 8px;
            border: 2px dashed #c9b8db;
        }

        .multiclass-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
        }

        .multiclass-row select:first-child {
            flex: 1;
            min-width: 120px;
        }

        .multiclass-row .level-select {
            width: 90px;
            min-width: 90px;
            flex-shrink: 0;
        }
        
        .multiclass-row .subclass-select {
            width: 100%;
            margin-top: 4px;
        }

        .remove-multiclass-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            width: 32px;
            height: 32px;
            padding: 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
        }

        .remove-multiclass-btn:hover {
            background: #c82333;
            transform: none;
            box-shadow: none;
        }

        .add-multiclass-btn {
            background: white;
            color: #58180d;
            border: 2px solid #58180d;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            width: auto;
        }

        .add-multiclass-btn:hover {
            background: #58180d;
            color: white;
            transform: none;
            box-shadow: none;
        }

        .level-badge {
            background: #58180d;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
            margin-left: 8px;
            white-space: nowrap;
        }

        /* Inline class editor */
        .inline-class-editor {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 10px;
            background: #f8f4fc;
            border-radius: 8px;
            margin: -5px;
        }

        .inline-class-row {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .inline-class-select {
            flex: 1;
            padding: 6px 10px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 0.9em;
        }

        .inline-level-select {
            width: 85px;
            min-width: 85px;
            padding: 6px 10px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 0.9em;
        }

        .inline-subclass-select {
            flex: 1;
            padding: 6px 10px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 0.85em;
            max-width: 200px;
        }

        .inline-remove-class {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            width: 32px;
            height: 32px;
            padding: 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85em;
        }

        .inline-remove-class:hover {
            background: #c82333;
            transform: none;
            box-shadow: none;
        }

        .inline-class-actions {
            display: flex;
            gap: 8px;
            margin-top: 5px;
        }

        .inline-add-class {
            background: white;
            color: #58180d;
            border: 2px solid #58180d;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            width: auto;
        }

        .inline-add-class:hover {
            background: #58180d;
            color: white;
            transform: none;
            box-shadow: none;
        }

        .inline-save-class {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            width: auto;
        }

        .inline-save-class:hover {
            background: #218838;
            transform: none;
            box-shadow: none;
        }

        /* Lock button styles */
        .lockable-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .lockable-content {
            flex: 1;
        }

        .lock-btn {
            background: white;
            border: 2px solid #58180d;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.2s;
            width: auto;
            min-width: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #58180d;
        }

        .lock-btn:hover {
            background: #f0f0ff;
            border-color: #5a6fd6;
            color: #5a6fd6;
            transform: none;
            box-shadow: none;
        }

        .lock-btn.locked {
            background: #58180d;
            border-color: #58180d;
            color: white;
        }

        .lock-btn.locked:hover {
            background: #5a6fd6;
            border-color: #5a6fd6;
        }

        /* Result section header with regenerate button */
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .result-header h2 {
            margin: 0;
            color: #2c3e50;
        }

        .regenerate-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            width: auto;
        }

        .regenerate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
        }

        /* Portrait section */
        .portrait-section {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        .portrait-container {
            width: 100%;
            max-width: 400px;
            margin: 15px auto;
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .portrait-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            color: #adb5bd;
        }

        .portrait-placeholder i {
            font-size: 5em;
        }

        .portrait-placeholder span {
            font-size: 0.95em;
        }

        .portrait-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .portrait-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            color: #58180d;
        }

        .portrait-loading i {
            font-size: 3em;
        }

        .portrait-loading span {
            font-size: 0.95em;
        }

        .portrait-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .generate-portrait-btn {
            background: linear-gradient(135deg, #58180d 0%, #7a200d 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .generate-portrait-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(88, 24, 13, 0.4);
        }

        .generate-portrait-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .view-prompt-btn {
            background: white;
            color: #58180d;
            border: 2px solid #58180d;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .view-prompt-btn:hover {
            background: #58180d;
            color: white;
            transform: none;
            box-shadow: none;
        }

        /* Export section */
        .export-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        .export-pdf-btn {
            width: 100%;
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .export-pdf-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
        }

        /* Portrait prompt modal */
        .prompt-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .prompt-modal-overlay.active {
            display: flex;
        }

        .prompt-modal-content {
            background: white;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .prompt-modal-header {
            background: linear-gradient(135deg, #58180d 0%, #7a200d 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .prompt-modal-header h3 {
            margin: 0;
            font-size: 1.2em;
        }

        .prompt-modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            opacity: 0.8;
            width: auto;
        }

        .prompt-modal-close:hover {
            opacity: 1;
            transform: none;
            box-shadow: none;
        }

        .prompt-modal-body {
            padding: 20px;
        }

        .prompt-textarea {
            width: 100%;
            min-height: 200px;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.95em;
            line-height: 1.5;
            resize: vertical;
            box-sizing: border-box;
        }

        .prompt-textarea:focus {
            outline: none;
            border-color: #58180d;
        }

        .prompt-modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: flex-end;
        }

        .copy-prompt-btn {
            background: linear-gradient(135deg, #7a200d 0%, #3e0c02 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            width: auto;
        }

        .copy-prompt-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(88, 24, 13, 0.4);
        }

        .copy-prompt-btn.copied {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        /* NPC card field rows */
        .npc-field-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .npc-field-content {
            flex: 1;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }

        .npc-field-label {
            font-weight: 600;
            color: #495057;
            margin-right: 8px;
        }

        .npc-field-value {
            color: #2c3e50;
        }

        .npc-header-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .npc-name-section {
            flex: 1;
        }

        /* Stats grid with lock */
        .stats-section {
            position: relative;
        }

        .stats-lock-row {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
        }

        /* Disabled form elements */
        .form-group.disabled select,
        .form-group.disabled input {
            background: #e9ecef !important;
            color: #6c757d !important;
            cursor: not-allowed !important;
            pointer-events: none;
            opacity: 0.7;
        }

        .form-group.disabled label {
            color: #adb5bd;
        }

        .form-group.disabled {
            position: relative;
        }

        .form-group.disabled::after {
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            content: '\f023';  /* fa-lock */
            position: absolute;
            right: 15px;
            top: 38px;
            font-size: 0.9em;
            opacity: 0.6;
            color: #6c757d;
        }

        .form-row .form-group.disabled::after {
            right: 12px;
        }

        /* Skills and equipment with lock */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header .section-title {
            margin: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .section-with-lock .section-title {
            margin: 20px 0 10px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #e9ecef;
        }

        /* Editable field styles */
        .editable {
            cursor: pointer;
            transition: background-color 0.2s;
            border-radius: 4px;
            padding: 2px 6px;
            margin: -2px -6px;
        }

        .editable:hover {
            background-color: #e8f4f8;
        }

        .editable::after {
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            content: '\f303';  /* fa-pencil */
            font-size: 0.7em;
            margin-left: 6px;
            opacity: 0;
            transition: opacity 0.2s;
            color: #58180d;
        }

        .editable:hover::after {
            opacity: 1;
        }

        /* Inline text editing */
        .inline-edit-input {
            font-family: inherit;
            font-size: inherit;
            padding: 4px 8px;
            border: 2px solid #58180d;
            border-radius: 6px;
            outline: none;
            width: 100%;
            box-sizing: border-box;
        }

        .inline-edit-textarea {
            font-family: inherit;
            font-size: inherit;
            padding: 8px;
            border: 2px solid #58180d;
            border-radius: 6px;
            outline: none;
            width: 100%;
            min-height: 100px;
            resize: vertical;
            box-sizing: border-box;
        }

        /* Inline dropdown */
        .inline-edit-select {
            font-family: inherit;
            font-size: inherit;
            padding: 4px 8px;
            border: 2px solid #58180d;
            border-radius: 6px;
            outline: none;
            background: white;
            cursor: pointer;
            min-width: 150px;
        }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 25px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transform: translateY(-20px);
            transition: transform 0.3s;
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .skill-count-warning {
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .skill-count-warning.ok {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .skill-count-warning.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }

        .skill-count-warning.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .skill-count-warning i {
            font-size: 1.1em;
        }

        .modal-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #6c757d;
            padding: 0;
            width: auto;
            line-height: 1;
        }

        .modal-close:hover {
            color: #2c3e50;
            transform: none;
            box-shadow: none;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-option {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            margin: 5px 0;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-option:hover {
            border-color: #58180d;
            background: #fdf1dc;
        }

        .modal-option.selected {
            border-color: #58180d;
            background: #58180d;
            color: white;
        }

        .modal-option-checkbox {
            margin-right: 12px;
            font-size: 1.1em;
        }

        .modal-option.selected .modal-option-checkbox::before {
            content: '\f00c';  /* fa-check */
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
        }

        .modal-option:not(.selected) .modal-option-checkbox::before {
            content: '\f0c8';  /* fa-square (regular) */
            font-family: "Font Awesome 6 Free";
            font-weight: 400;
        }

        .modal-option.locked {
            cursor: not-allowed;
            opacity: 0.85;
        }

        /* Spell Modal Styles */
        .spell-modal-level-header {
            font-weight: 600;
            color: #58180d;
            padding: 10px 0 5px 0;
            margin-top: 10px;
            border-bottom: 2px solid #c9ad6a;
            font-size: 1em;
        }

        .spell-modal-level-header:first-child {
            margin-top: 0;
        }

        .spell-school {
            font-size: 0.8em;
            color: #6c757d;
            margin-left: auto;
            font-style: italic;
            text-transform: capitalize;
        }

        .spell-count-ok {
            color: #28a745;
        }

        .spell-count-over {
            color: #dc3545;
            font-weight: bold;
        }

        .modal-option.locked.selected {
            background: #7a200d;
            border-color: #7a200d;
        }

        .modal-option.locked:hover {
            border-color: #7a200d;
            background: #7a200d;
            color: white;
        }

        .modal-option.locked i.fa-lock {
            margin-left: auto;
            font-size: 0.85em;
            opacity: 0.7;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding-top: 15px;
            border-top: 2px solid #e9ecef;
        }

        .modal-btn {
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: auto;
        }

        .modal-btn-cancel {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            color: #495057;
        }

        .modal-btn-cancel:hover {
            background: #e9ecef;
            transform: none;
            box-shadow: none;
        }

        .modal-btn-save {
            background: #58180d;
            border: 2px solid #58180d;
            color: white;
        }

        .modal-btn-save:hover {
            background: #5a6fd6;
            border-color: #5a6fd6;
            transform: none;
            box-shadow: none;
        }

        /* Custom item input in modal */
        .modal-custom-input {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }

        .modal-custom-input input {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
        }

        .modal-custom-input button {
            padding: 8px 15px;
            background: #28a745;
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            width: auto;
        }

        .modal-custom-input button:hover {
            background: #218838;
            transform: none;
            box-shadow: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fa-solid fa-dice-d20"></i> D&D 5E NPC Generator</h1>
            <p>Create unique non-player characters for your campaign</p>
        </header>

        <div class="content">
            <div class="form-section">
                <h2 style="margin-bottom: 20px; color: #2c3e50;"><i class="fa-solid fa-sliders"></i> Generator Options</h2>
                
                <!-- Row 1: Race & Gender -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="race">Race</label>
                        <select id="race" onchange="showRaceDescription()">
                            <option value="random">Random</option>
                            <option value="aarakocra">Aarakocra</option>
                            <option value="aasimar">Aasimar</option>
                            <option value="astral elf">Astral Elf</option>
                            <option value="autognome">Autognome</option>
                            <option value="bugbear">Bugbear</option>
                            <option value="centaur">Centaur</option>
                            <option value="changeling">Changeling</option>
                            <option value="deep gnome">Deep Gnome</option>
                            <option value="dhampir">Dhampir</option>
                            <option value="duergar">Duergar</option>
                            <option value="dragonborn">Dragonborn</option>
                            <option value="dwarf">Dwarf</option>
                            <option value="eladrin">Eladrin</option>
                            <option value="elf">Elf</option>
                            <option value="fairy">Fairy</option>
                            <option value="firbolg">Firbolg</option>
                            <option value="genasi">Genasi</option>
                            <option value="giff">Giff</option>
                            <option value="githyanki">Githyanki</option>
                            <option value="githzerai">Githzerai</option>
                            <option value="gnome">Gnome</option>
                            <option value="goblin">Goblin</option>
                            <option value="goliath">Goliath</option>
                            <option value="grung">Grung</option>
                            <option value="hadozee">Hadozee</option>
                            <option value="half-elf">Half-Elf</option>
                            <option value="half-orc">Half-Orc</option>
                            <option value="halfling">Halfling</option>
                            <option value="harengon">Harengon</option>
                            <option value="hexblood">Hexblood</option>
                            <option value="hobgoblin">Hobgoblin</option>
                            <option value="human">Human</option>
                            <option value="kalashtar">Kalashtar</option>
                            <option value="kender">Kender</option>
                            <option value="kenku">Kenku</option>
                            <option value="kobold">Kobold</option>
                            <option value="leonin">Leonin</option>
                            <option value="lizardfolk">Lizardfolk</option>
                            <option value="locathah">Locathah</option>
                            <option value="loxodon">Loxodon</option>
                            <option value="minotaur">Minotaur</option>
                            <option value="orc">Orc</option>
                            <option value="owlin">Owlin</option>
                            <option value="plasmoid">Plasmoid</option>
                            <option value="reborn">Reborn</option>
                            <option value="satyr">Satyr</option>
                            <option value="sea elf">Sea Elf</option>
                            <option value="shadar-kai">Shadar-kai</option>
                            <option value="shifter">Shifter</option>
                            <option value="simic hybrid">Simic Hybrid</option>
                            <option value="tabaxi">Tabaxi</option>
                            <option value="thri-kreen">Thri-kreen</option>
                            <option value="tiefling">Tiefling</option>
                            <option value="tortle">Tortle</option>
                            <option value="triton">Triton</option>
                            <option value="vedalken">Vedalken</option>
                            <option value="verdan">Verdan</option>
                            <option value="warforged">Warforged</option>
                            <option value="yuan-ti">Yuan-ti</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="gender">Gender</label>
                        <select id="gender">
                            <option value="random">Random</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="non-binary">Non-Binary</option>
                        </select>
                    </div>
                </div>
                <div id="raceDescription" class="race-description hidden"></div>

                <!-- Row 2: Occupation -->
                <!-- Class Section -->
                <div class="form-group">
                    <label for="npcClass">Class</label>
                    <div class="class-level-row">
                        <select id="npcClass" onchange="onClassChange()">
                            <option value="commoner" selected>Commoner</option>
                            <option value="random">Random Adventurer</option>
                            <option value="artificer">Artificer</option>
                            <option value="barbarian">Barbarian</option>
                            <option value="bard">Bard</option>
                            <option value="cleric">Cleric</option>
                            <option value="druid">Druid</option>
                            <option value="fighter">Fighter</option>
                            <option value="monk">Monk</option>
                            <option value="paladin">Paladin</option>
                            <option value="ranger">Ranger</option>
                            <option value="rogue">Rogue</option>
                            <option value="sorcerer">Sorcerer</option>
                            <option value="warlock">Warlock</option>
                            <option value="wizard">Wizard</option>
                        </select>
                        <select id="npcClassLevel" class="level-select" style="display: none;" onchange="onLevelChange()">
                            <option value="1">Lvl 1</option>
                            <option value="2">Lvl 2</option>
                            <option value="3">Lvl 3</option>
                            <option value="4">Lvl 4</option>
                            <option value="5">Lvl 5</option>
                            <option value="6">Lvl 6</option>
                            <option value="7">Lvl 7</option>
                            <option value="8">Lvl 8</option>
                            <option value="9">Lvl 9</option>
                            <option value="10">Lvl 10</option>
                            <option value="11">Lvl 11</option>
                            <option value="12">Lvl 12</option>
                            <option value="13">Lvl 13</option>
                            <option value="14">Lvl 14</option>
                            <option value="15">Lvl 15</option>
                            <option value="16">Lvl 16</option>
                            <option value="17">Lvl 17</option>
                            <option value="18">Lvl 18</option>
                            <option value="19">Lvl 19</option>
                            <option value="20">Lvl 20</option>
                        </select>
                    </div>
                    <select id="npcSubclass" class="subclass-select" style="display: none; margin-top: 8px;">
                        <option value="random">Random Subclass</option>
                    </select>
                    <select id="occupation" class="subclass-select" style="margin-top: 8px;" onchange="showOccupationDescription()">
                        <option value="random">Random Occupation</option>
                        <optgroup label="Trades & Crafts">
                            <option value="blacksmith">Blacksmith</option>
                            <option value="carpenter">Carpenter</option>
                            <option value="mason">Mason</option>
                            <option value="potter">Potter</option>
                            <option value="weaver">Weaver</option>
                            <option value="tailor">Tailor</option>
                            <option value="cobbler">Cobbler</option>
                            <option value="tanner">Tanner</option>
                            <option value="jeweler">Jeweler</option>
                            <option value="glassblower">Glassblower</option>
                        </optgroup>
                        <optgroup label="Food & Drink">
                            <option value="baker">Baker</option>
                            <option value="butcher">Butcher</option>
                            <option value="brewer">Brewer</option>
                            <option value="cook">Cook</option>
                            <option value="innkeeper">Innkeeper</option>
                            <option value="vintner">Vintner</option>
                        </optgroup>
                        <optgroup label="Agriculture & Nature">
                            <option value="farmer">Farmer</option>
                            <option value="shepherd">Shepherd</option>
                            <option value="fisherman">Fisherman</option>
                            <option value="hunter">Hunter</option>
                            <option value="trapper">Trapper</option>
                            <option value="woodcutter">Woodcutter</option>
                            <option value="herbalist">Herbalist</option>
                            <option value="beekeeper">Beekeeper</option>
                            <option value="miller">Miller</option>
                        </optgroup>
                        <optgroup label="Commerce">
                            <option value="merchant">Merchant</option>
                            <option value="peddler">Peddler</option>
                            <option value="shopkeeper">Shopkeeper</option>
                            <option value="banker">Banker</option>
                            <option value="trader">Trader</option>
                        </optgroup>
                        <optgroup label="Service">
                            <option value="servant">Servant</option>
                            <option value="stablehand">Stablehand</option>
                            <option value="barkeep">Barkeep</option>
                            <option value="courier">Courier</option>
                            <option value="gravedigger">Gravedigger</option>
                        </optgroup>
                        <optgroup label="Scholarly">
                            <option value="scholar">Scholar</option>
                            <option value="scribe">Scribe</option>
                            <option value="librarian">Librarian</option>
                            <option value="tutor">Tutor</option>
                            <option value="cartographer">Cartographer</option>
                        </optgroup>
                        <optgroup label="Religious">
                            <option value="acolyte">Acolyte</option>
                            <option value="priest">Priest</option>
                            <option value="monk_civilian">Monk (Religious)</option>
                            <option value="gravewarden">Gravewarden</option>
                        </optgroup>
                        <optgroup label="Entertainment">
                            <option value="entertainer">Entertainer</option>
                            <option value="musician">Musician</option>
                            <option value="actor">Actor</option>
                            <option value="jester">Jester</option>
                            <option value="storyteller">Storyteller</option>
                        </optgroup>
                        <optgroup label="Medical">
                            <option value="healer">Healer</option>
                            <option value="midwife">Midwife</option>
                            <option value="apothecary">Apothecary</option>
                        </optgroup>
                        <optgroup label="Military & Guard">
                            <option value="soldier">Soldier</option>
                            <option value="guard">Guard</option>
                            <option value="watchman">Watchman</option>
                            <option value="bouncer">Bouncer</option>
                        </optgroup>
                        <optgroup label="Maritime">
                            <option value="sailor">Sailor</option>
                            <option value="dockworker">Dockworker</option>
                            <option value="shipwright">Shipwright</option>
                        </optgroup>
                        <optgroup label="Nobility & Governance">
                            <option value="noble">Noble</option>
                            <option value="advisor">Advisor</option>
                            <option value="herald">Herald</option>
                            <option value="diplomat">Diplomat</option>
                            <option value="tax_collector">Tax Collector</option>
                        </optgroup>
                        <optgroup label="Criminal">
                            <option value="pickpocket">Pickpocket</option>
                            <option value="smuggler">Smuggler</option>
                            <option value="fence">Fence</option>
                            <option value="beggar">Beggar</option>
                        </optgroup>
                        <optgroup label="Labor">
                            <option value="miner">Miner</option>
                            <option value="ratcatcher">Ratcatcher</option>
                            <option value="lamplighter">Lamplighter</option>
                            <option value="chimneysweep">Chimney Sweep</option>
                        </optgroup>
                    </select>
                </div>
                <div id="occupationDescription" class="occupation-description hidden"></div>
                <div id="classDescription" class="class-description hidden"></div>
                
                <!-- Multiclass Section -->
                <div id="multiclassSection" class="multiclass-section" style="display: none;">
                    <div id="multiclassContainer"></div>
                    <button type="button" class="add-multiclass-btn" onclick="addMulticlass()">
                        <i class="fa-solid fa-plus"></i> Add Class
                    </button>
                </div>

                <!-- Row 3: Age & Alignment -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="age">Age Category</label>
                        <select id="age">
                            <option value="random">Random</option>
                            <option value="infant">Infant</option>
                            <option value="child">Child</option>
                            <option value="young-adult">Young Adult</option>
                            <option value="adult">Adult</option>
                            <option value="mature">Mature</option>
                            <option value="elderly">Elderly</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="alignment">Alignment</label>
                        <select id="alignment">
                            <option value="random">Random</option>
                            <option value="lawful good">Lawful Good</option>
                            <option value="neutral good">Neutral Good</option>
                            <option value="chaotic good">Chaotic Good</option>
                            <option value="lawful neutral">Lawful Neutral</option>
                            <option value="true neutral">True Neutral</option>
                            <option value="chaotic neutral">Chaotic Neutral</option>
                            <option value="lawful evil">Lawful Evil</option>
                            <option value="neutral evil">Neutral Evil</option>
                            <option value="chaotic evil">Chaotic Evil</option>
                        </select>
                    </div>
                </div>

                <button onclick="generateNPC()"><i class="fa-solid fa-wand-magic-sparkles"></i> Generate NPC</button>
            </div>

            <div class="result-section">
                <div class="result-header">
                    <h2><i class="fa-solid fa-user"></i> Generated NPC</h2>
                    <button class="regenerate-btn" onclick="regenerateNPC()" id="regenerateBtn" style="display: none;">
                        <i class="fa-solid fa-arrows-rotate"></i> Regenerate
                    </button>
                </div>
                <div id="npcResult" class="hidden">
                    <!-- NPC will be displayed here -->
                </div>
                <div id="placeholder" style="text-align: center; color: #6c757d; padding: 40px;">
                    <p style="font-size: 1.2em;">Fill out the form and click "Generate NPC" to create a character</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // D&D 5E Data
        const races = {
            aarakocra: { abilityBonus: { dex: 2, wis: 1 }, speed: 25, size: 'Medium', lifespan: 30, languages: ['Common', 'Aarakocra', 'Auran'], traits: ['Flight (50 ft)', 'Talons (1d4 slashing)'], senses: [], description: 'Bird-like humanoids with wings, known for their connection to the Elemental Plane of Air. They value freedom and the open sky.' },
            aasimar: { abilityBonus: { cha: 2 }, speed: 30, size: 'Medium', lifespan: 160, languages: ['Common', 'Celestial'], traits: ['Darkvision 60 ft', 'Celestial Resistance (necrotic, radiant)', 'Healing Hands', 'Light Bearer'], senses: ['Darkvision 60 ft'], description: 'Descendants of celestials, aasimar are touched by divine power. They often feel a calling to do good in the world.' },
            'astral elf': { abilityBonus: {}, speed: 30, size: 'Medium', lifespan: 750, languages: ['Common', 'Elvish'], traits: ['Darkvision 60 ft', 'Fey Ancestry', 'Keen Senses', 'Trance', 'Astral Fire', 'Starlight Step'], senses: ['Darkvision 60 ft'], description: 'Elves who have adapted to life in the Astral Plane. They are contemplative and have a deep connection to the stars and cosmic forces.' },
            autognome: { abilityBonus: {}, speed: 30, size: 'Small', lifespan: 500, languages: ['Common', 'Gnomish'], traits: ['Armored Casing', 'Built for Success', 'Mechanical Nature', 'Sentry\'s Rest', 'Specialized Design'], senses: [], description: 'Mechanical gnomes created by the tinker gnomes. They are curious constructs with a drive to learn and explore.' },
            bugbear: { abilityBonus: { str: 2, dex: 1 }, speed: 30, size: 'Medium', lifespan: 80, languages: ['Common', 'Goblin'], traits: ['Darkvision 60 ft', 'Long-Limbed', 'Powerful Build', 'Sneaky', 'Surprise Attack'], senses: ['Darkvision 60 ft'], description: 'Large, hairy goblinoids known for their stealth and surprise attacks. They are often misunderstood but value strength and cunning.' },
            centaur: { abilityBonus: { str: 2, wis: 1 }, speed: 40, size: 'Medium', lifespan: 100, languages: ['Common', 'Sylvan'], traits: ['Fey', 'Charge', 'Hooves (1d4+STR)', 'Equine Build'], senses: [], description: 'Half-human, half-horse beings with a strong connection to nature. They are proud warriors and protectors of the wild.' },
            changeling: { abilityBonus: { cha: 2, any: 1 }, speed: 30, size: 'Medium', lifespan: 100, languages: ['Common', 'Two others'], traits: ['Shapechanger', 'Changeling Instincts'], senses: [], description: 'Shape-shifters who can alter their appearance at will. They are masters of disguise and often struggle with identity.' },
            'deep gnome': { abilityBonus: { dex: 1, int: 2 }, speed: 25, size: 'Small', lifespan: 250, languages: ['Common', 'Gnomish', 'Undercommon'], traits: ['Superior Darkvision 120 ft', 'Gnome Cunning', 'Stone Camouflage'], senses: ['Superior Darkvision 120 ft'], description: 'Also known as svirfneblin, these gnomes dwell deep underground. They are suspicious of outsiders but fiercely loyal to their communities.' },
            dhampir: { abilityBonus: {}, speed: 35, size: 'Medium', lifespan: 100, languages: ['Common', 'One other'], traits: ['Darkvision 60 ft', 'Deathless Nature', 'Spider Climb', 'Vampiric Bite'], senses: ['Darkvision 60 ft'], description: 'Half-vampires who walk between the living and undead. They possess some vampiric traits but maintain their humanity.' },
            dragonborn: { abilityBonus: { str: 2, cha: 1 }, speed: 30, size: 'Medium', lifespan: 80, languages: ['Common', 'Draconic'], traits: ['Breath Weapon', 'Damage Resistance (draconic ancestry)'], senses: [], description: 'Draconic humanoids with a proud heritage. They value honor, strength, and the legacy of their dragon ancestors.' },
            dwarf: { abilityBonus: { con: 2 }, speed: 25, size: 'Medium', lifespan: 350, languages: ['Common', 'Dwarvish'], traits: ['Darkvision 60 ft', 'Dwarven Resilience (poison resistance)', 'Stonecunning', 'Tool Proficiency'], senses: ['Darkvision 60 ft'], description: 'Stout, hardy folk known for their craftsmanship and love of stone. They are loyal, traditional, and value family and clan above all.' },
            duergar: { abilityBonus: { str: 1, con: 2 }, speed: 25, size: 'Medium', lifespan: 350, languages: ['Common', 'Dwarvish', 'Undercommon'], traits: ['Superior Darkvision 120 ft', 'Dwarven Resilience', 'Duergar Magic (Enlarge/Invisibility)', 'Sunlight Sensitivity'], senses: ['Superior Darkvision 120 ft'], description: 'Gray dwarves who dwell in the Underdark. They are grim, suspicious, and possess innate psionic abilities. They value hard work and resilience.' },
            eladrin: { abilityBonus: { dex: 2, cha: 1 }, speed: 30, size: 'Medium', lifespan: 750, languages: ['Common', 'Elvish'], traits: ['Darkvision 60 ft', 'Fey Ancestry', 'Fey Step (teleport 30 ft)', 'Trance'], senses: ['Darkvision 60 ft'], description: 'Fey elves native to the Feywild whose appearance changes with their emotional state. They embody the seasons and are deeply connected to nature magic.' },
            elf: { abilityBonus: { dex: 2 }, speed: 30, size: 'Medium', lifespan: 750, languages: ['Common', 'Elvish'], traits: ['Darkvision 60 ft', 'Fey Ancestry', 'Keen Senses', 'Trance'], senses: ['Darkvision 60 ft'], description: 'Graceful, long-lived beings with a deep connection to nature and magic. They value beauty, art, and the preservation of ancient traditions.' },
            fairy: { abilityBonus: {}, speed: 30, size: 'Small', lifespan: 100, languages: ['Common', 'Sylvan'], traits: ['Flight (equal to speed)', 'Fairy Magic (Druidcraft, Faerie Fire, Enlarge/Reduce)'], senses: [], description: 'Small, magical beings from the Feywild. They are playful, mischievous, and have an innate connection to nature magic.' },
            firbolg: { abilityBonus: { str: 1, wis: 2 }, speed: 30, size: 'Medium', lifespan: 500, languages: ['Common', 'Elvish', 'Giant'], traits: ['Firbolg Magic (Detect Magic, Disguise Self)', 'Hidden Step (invisibility)', 'Powerful Build', 'Speech of Beast and Leaf'], senses: [], description: 'Gentle giants who are guardians of the natural world. They are peaceful, reclusive, and have strong druidic traditions.' },
            genasi: { abilityBonus: { con: 2 }, speed: 30, size: 'Medium', lifespan: 120, languages: ['Common', 'Primordial'], traits: ['Elemental Heritage (varies by subrace)'], senses: [], description: 'Planetouched beings with elemental heritage. They manifest traits of air, earth, fire, or water, reflecting their elemental nature.' },
            giff: { abilityBonus: { str: 2 }, speed: 30, size: 'Medium', lifespan: 100, languages: ['Common'], traits: ['Astral Spark', 'Firearms Mastery', 'Hippo Build'], senses: [], description: 'Hippo-like humanoids known for their military discipline and love of explosions. They are honorable warriors with a strict code.' },
            githyanki: { abilityBonus: { str: 2, int: 1 }, speed: 30, size: 'Medium', lifespan: 100, languages: ['Common', 'Gith'], traits: ['Githyanki Psionics (Mage Hand, Jump, Misty Step)', 'Martial Prodigy'], senses: [], description: 'Fierce warriors from the Astral Plane who ride red dragons and hate mind flayers. They are aggressive, proud, and value martial prowess.' },
            githzerai: { abilityBonus: { wis: 2, int: 1 }, speed: 30, size: 'Medium', lifespan: 100, languages: ['Common', 'Gith'], traits: ['Githzerai Psionics (Mage Hand, Shield, Detect Thoughts)', 'Mental Discipline'], senses: [], description: 'Contemplative monastics from the plane of Limbo. They are disciplined, philosophical, and use mental focus to shape chaos itself.' },
            gnome: { abilityBonus: { int: 2 }, speed: 25, size: 'Small', lifespan: 500, languages: ['Common', 'Gnomish'], traits: ['Darkvision 60 ft', 'Gnome Cunning (advantage vs magic INT/WIS/CHA saves)'], senses: ['Darkvision 60 ft'], description: 'Curious, inventive small folk with a love of knowledge and tinkering. They are cheerful, optimistic, and fascinated by the world around them.' },
            goblin: { abilityBonus: { dex: 2, con: 1 }, speed: 30, size: 'Small', lifespan: 60, languages: ['Common', 'Goblin'], traits: ['Darkvision 60 ft', 'Fury of the Small', 'Nimble Escape'], senses: ['Darkvision 60 ft'], description: 'Small, clever humanoids known for their adaptability and survival instincts. They are often underestimated but resourceful.' },
            goliath: { abilityBonus: { str: 2, con: 1 }, speed: 30, size: 'Medium', lifespan: 80, languages: ['Common', 'Giant'], traits: ['Natural Athlete', 'Stone\'s Endurance', 'Powerful Build', 'Mountain Born'], senses: [], description: 'Mountain-dwelling giants who value strength and competition. They live in harsh environments and test themselves against nature.' },
            grung: { abilityBonus: { dex: 2, con: 1 }, speed: 25, size: 'Small', lifespan: 50, languages: ['Grung'], traits: ['Arboreal Alertness', 'Amphibious', 'Poison Immunity', 'Poisonous Skin', 'Standing Leap'], senses: [], description: 'Poisonous frog-like humanoids with a rigid caste system based on skin color. They are territorial and communicate through croaks and songs.' },
            hadozee: { abilityBonus: { dex: 2, wis: 1 }, speed: 30, size: 'Medium', lifespan: 100, languages: ['Common'], traits: ['Dexterous Feet', 'Glide', 'Hadozee Resilience'], senses: [], description: 'Monkey-like humanoids with gliding membranes. They are agile, curious, and excel at navigating vertical environments.' },
            'half-elf': { abilityBonus: { cha: 2, any: 1 }, speed: 30, size: 'Medium', lifespan: 180, languages: ['Common', 'Elvish', 'One other'], traits: ['Darkvision 60 ft', 'Fey Ancestry', 'Skill Versatility (two skills)'], senses: ['Darkvision 60 ft'], description: 'Children of humans and elves, combining the best of both worlds. They are charismatic, adaptable, and often feel caught between two cultures.' },
            'half-orc': { abilityBonus: { str: 2, con: 1 }, speed: 30, size: 'Medium', lifespan: 75, languages: ['Common', 'Orc'], traits: ['Darkvision 60 ft', 'Menacing', 'Relentless Endurance', 'Savage Attacks'], senses: ['Darkvision 60 ft'], description: 'Children of humans and orcs, known for their strength and endurance. They often struggle with their dual heritage and prove their worth through deeds.' },
            halfling: { abilityBonus: { dex: 2 }, speed: 25, size: 'Small', lifespan: 150, languages: ['Common', 'Halfling'], traits: ['Lucky (reroll 1s)', 'Brave', 'Halfling Nimbleness'], senses: [], description: 'Small, cheerful folk who value comfort, community, and good food. They are brave despite their size and have a natural luck about them.' },
            harengon: { abilityBonus: {}, speed: 30, size: 'Small', lifespan: 100, languages: ['Common'], traits: ['Hare-Trigger (bonus to initiative)', 'Leporine Senses', 'Lucky Footwork', 'Rabbit Hop'], senses: [], description: 'Rabbit-like humanoids from the Feywild. They are quick, alert, and have a strong connection to luck and the seasons.' },
            hexblood: { abilityBonus: {}, speed: 30, size: 'Medium', lifespan: 100, languages: ['Common', 'One other'], traits: ['Darkvision 60 ft', 'Eerie Token', 'Hex Magic (Disguise Self, Hex)'], senses: ['Darkvision 60 ft'], description: 'Beings touched by hags and dark fey magic. They carry a curse or blessing that connects them to the darker side of the Feywild.' },
            hobgoblin: { abilityBonus: { con: 2, int: 1 }, speed: 30, size: 'Medium', lifespan: 100, languages: ['Common', 'Goblin'], traits: ['Darkvision 60 ft', 'Fey Ancestry', 'Fortune from the Many', 'Martial Training'], senses: ['Darkvision 60 ft'], description: 'Disciplined, militaristic goblinoids who value order and hierarchy. They are organized warriors with a strong sense of honor and duty.' },
            human: { abilityBonus: { any: 1 }, speed: 30, size: 'Medium', lifespan: 100, languages: ['Common', 'One other'], traits: ['Extra Language', 'Extra Skill'], senses: [], description: 'The most adaptable and ambitious of the common races. Humans are diverse, driven, and their short lives push them to achieve greatness quickly.' },
            kalashtar: { abilityBonus: { wis: 1, cha: 1 }, speed: 30, size: 'Medium', lifespan: 100, languages: ['Common', 'Quori', 'One other'], traits: ['Dual Mind (advantage on WIS saves)', 'Mental Discipline', 'Mind Link (telepathy)', 'Severed from Dreams'], senses: [], description: 'Beings bonded with spirits from the plane of dreams. They are empathetic, telepathic, and dedicated to fighting nightmares and evil.' },
            kender: { abilityBonus: { dex: 2, cha: 1 }, speed: 30, size: 'Small', lifespan: 100, languages: ['Common', 'Kenderspeak'], traits: ['Fearless', 'Kender Ace (sleight of hand proficiency)', 'Taunt'], senses: [], description: 'Curious, fearless halfling-like folk from Krynn. They are immune to fear, compulsively curious, and have a habit of "borrowing" interesting items they find.' },
            kenku: { abilityBonus: { dex: 2, wis: 1 }, speed: 30, size: 'Medium', lifespan: 60, languages: ['Common', 'Auran'], traits: ['Expert Duplication', 'Kenku Training', 'Mimicry'], senses: [], description: 'Crow-like humanoids cursed to only communicate through mimicry. They are creative, resourceful, and excel at forgery and deception.' },
            kobold: { abilityBonus: { dex: 2, str: -2 }, speed: 30, size: 'Small', lifespan: 120, languages: ['Common', 'Draconic'], traits: ['Darkvision 60 ft', 'Draconic Cry', 'Kobold Legacy', 'Sunlight Sensitivity'], senses: ['Darkvision 60 ft'], description: 'Small, reptilian humanoids known for their cunning and pack tactics. They are industrious, loyal to their tribes, and surprisingly brave.' },
            leonin: { abilityBonus: { str: 2, con: 1 }, speed: 35, size: 'Medium', lifespan: 80, languages: ['Common', 'Leonin'], traits: ['Darkvision 60 ft', 'Claws (1d4 slashing)', 'Hunter\'s Instincts', 'Daunting Roar'], senses: ['Darkvision 60 ft'], description: 'Lion-like humanoids who value pride, honor, and strength. They are noble warriors with a strong sense of personal and family honor.' },
            lizardfolk: { abilityBonus: { con: 2, wis: 1 }, speed: 30, size: 'Medium', lifespan: 60, languages: ['Common', 'Draconic'], traits: ['Bite (1d6 piercing)', 'Cunning Artisan', 'Hold Breath (15 min)', 'Hunter\'s Lore', 'Natural Armor (13+DEX)'], senses: [], description: 'Reptilian humanoids with a pragmatic, survival-focused worldview. They are emotionless, practical, and see the world in terms of predator and prey.' },
            locathah: { abilityBonus: { str: 2, dex: 1 }, speed: 30, size: 'Medium', lifespan: 80, languages: ['Common', 'Aquan'], traits: ['Natural Armor (12+DEX)', 'Observant & Athletic', 'Leviathan Will', 'Limited Amphibiousness'], senses: [], description: 'Peaceful fish-like humanoids who live in underwater communities. They are resilient, having survived enslavement, and value freedom and cooperation.' },
            loxodon: { abilityBonus: { con: 2, wis: 1 }, speed: 30, size: 'Medium', lifespan: 450, languages: ['Common', 'Loxodon'], traits: ['Powerful Build', 'Loxodon Serenity (charm/fear advantage)', 'Natural Armor (12+CON)', 'Trunk', 'Keen Smell'], senses: [], description: 'Elephant-like humanoids known for their wisdom and patience. They are calm, thoughtful, and have excellent memories and strong family bonds.' },
            minotaur: { abilityBonus: { str: 2, con: 1 }, speed: 30, size: 'Medium', lifespan: 150, languages: ['Common', 'Minotaur'], traits: ['Horns (1d6 piercing)', 'Goring Rush', 'Hammering Horns', 'Labyrinthine Recall'], senses: [], description: 'Bull-like humanoids known for their strength and ferocity. They are proud warriors who value honor, strength, and proving themselves in combat.' },
            orc: { abilityBonus: { str: 2, con: 1 }, speed: 30, size: 'Medium', lifespan: 75, languages: ['Common', 'Orc'], traits: ['Darkvision 60 ft', 'Aggressive', 'Powerful Build', 'Primal Intuition'], senses: ['Darkvision 60 ft'], description: 'Strong, aggressive humanoids often seen as monsters. They value strength, honor their ancestors, and are more complex than many believe.' },
            owlin: { abilityBonus: {}, speed: 30, size: 'Medium', lifespan: 100, languages: ['Common'], traits: ['Darkvision 120 ft', 'Flight (equal to speed)', 'Silent Feathers (Stealth proficiency)'], senses: ['Darkvision 120 ft'], description: 'Owl-like humanoids with the ability to fly. They are wise, observant, and have excellent night vision and stealth capabilities.' },
            plasmoid: { abilityBonus: {}, speed: 30, size: 'Medium', lifespan: 100, languages: ['Common'], traits: ['Amorphous', 'Darkvision 60 ft', 'Hold Breath (1 hour)', 'Natural Resilience (acid/poison)', 'Shape Self'], senses: ['Darkvision 60 ft'], description: 'Amorphous beings made of living ooze. They are flexible, adaptable, and can squeeze through tight spaces with ease.' },
            reborn: { abilityBonus: {}, speed: 30, size: 'Medium', lifespan: 100, languages: ['Common', 'One other'], traits: ['Ancestral Legacy', 'Deathless Nature', 'Knowledge from a Past Life'], senses: [], description: 'Beings who have returned from death, whether through magic, undeath, or other means. They exist between life and death, often with fragmented memories.' },
            satyr: { abilityBonus: { cha: 2, any: 1 }, speed: 35, size: 'Medium', lifespan: 100, languages: ['Common', 'Sylvan'], traits: ['Fey', 'Magic Resistance', 'Mirthful Leaps', 'Reveler (Performance/Persuasion)'], senses: [], description: 'Fey creatures with goat-like features who love music, revelry, and freedom. They are hedonistic, charming, and have a strong connection to nature.' },
            'sea elf': { abilityBonus: { dex: 2, con: 1 }, speed: 30, size: 'Medium', lifespan: 750, languages: ['Common', 'Elvish', 'Aquan'], traits: ['Darkvision 60 ft', 'Fey Ancestry', 'Keen Senses', 'Trance', 'Child of the Sea (swim 30 ft, water breathing)', 'Friend of the Sea'], senses: ['Darkvision 60 ft'], description: 'Elves who dwell beneath the waves, adapted to underwater life. They are graceful swimmers who protect the ocean depths and have an affinity for sea creatures.' },
            'shadar-kai': { abilityBonus: { dex: 2, con: 1 }, speed: 30, size: 'Medium', lifespan: 750, languages: ['Common', 'Elvish'], traits: ['Darkvision 60 ft', 'Fey Ancestry', 'Blessing of the Raven Queen (teleport+resistance)', 'Trance'], senses: ['Darkvision 60 ft'], description: 'Elves bound to the Shadowfell and the Raven Queen. They are grim, fatalistic, and use pain to feel alive in their dreary realm.' },
            shifter: { abilityBonus: {}, speed: 30, size: 'Medium', lifespan: 100, languages: ['Common'], traits: ['Darkvision 60 ft', 'Shifting (bonus action transformation)'], senses: ['Darkvision 60 ft'], description: 'Humanoids with a bestial aspect who can briefly transform. They are in touch with their animal nature and excel at survival and tracking.' },
            'simic hybrid': { abilityBonus: { con: 2, any: 1 }, speed: 30, size: 'Medium', lifespan: 100, languages: ['Common', 'Elvish or Vedalken'], traits: ['Darkvision 60 ft', 'Animal Enhancement (choice of adaptation)'], senses: ['Darkvision 60 ft'], description: 'Beings created through magical experimentation, combining humanoid and animal traits. They are adaptable and often seek to improve themselves.' },
            tabaxi: { abilityBonus: { dex: 2, cha: 1 }, speed: 30, size: 'Medium', lifespan: 100, languages: ['Common', 'One other'], traits: ['Darkvision 60 ft', 'Feline Agility', 'Cat\'s Claws (1d4 slashing, climb 20 ft)', 'Cat\'s Talent'], senses: ['Darkvision 60 ft'], description: 'Cat-like humanoids driven by curiosity. They are agile, charming, and often wander in search of interesting stories and experiences.' },
            'thri-kreen': { abilityBonus: {}, speed: 30, size: 'Medium', lifespan: 30, languages: ['Common', 'Thri-kreen'], traits: ['Darkvision 60 ft', 'Chameleon Carapace', 'Secondary Arms', 'Sleepless', 'Thri-kreen Telepathy'], senses: ['Darkvision 60 ft'], description: 'Insectoid humanoids with multiple arms and a hive mind connection. They are alien in thought, value the group over the individual, and are excellent hunters.' },
            tiefling: { abilityBonus: { cha: 2, int: 1 }, speed: 30, size: 'Medium', lifespan: 100, languages: ['Common', 'Infernal'], traits: ['Darkvision 60 ft', 'Hellish Resistance (fire)', 'Infernal Legacy (Thaumaturgy, Hellish Rebuke, Darkness)'], senses: ['Darkvision 60 ft'], description: 'Humanoids with infernal heritage, marked by horns, tails, and other devilish features. They face prejudice but are often charismatic and determined.' },
            tortle: { abilityBonus: { str: 2, wis: 1 }, speed: 30, size: 'Medium', lifespan: 50, languages: ['Common', 'Aquan'], traits: ['Claws (1d4 slashing)', 'Hold Breath (1 hour)', 'Natural Armor (AC 17)', 'Shell Defense'], senses: [], description: 'Turtle-like humanoids with natural armor shells. They are peaceful wanderers who spend their lives exploring and collecting experiences.' },
            triton: { abilityBonus: { str: 1, con: 1, cha: 1 }, speed: 30, size: 'Medium', lifespan: 200, languages: ['Common', 'Primordial'], traits: ['Amphibious', 'Control Air and Water (spells)', 'Darkvision 60 ft', 'Emissary of the Sea', 'Guardian of the Depths'], senses: ['Darkvision 60 ft'], description: 'Aquatic humanoids from the depths of the ocean. They are guardians of the sea, proud of their heritage, and protectors of marine life.' },
            vedalken: { abilityBonus: { int: 2, wis: 1 }, speed: 30, size: 'Medium', lifespan: 500, languages: ['Common', 'Vedalken', 'One other'], traits: ['Vedalken Dispassion (saves vs WIS/CHA)', 'Tireless Precision', 'Partially Amphibious'], senses: [], description: 'Blue-skinned humanoids known for their logical thinking and pursuit of perfection. They are methodical, patient, and value knowledge above all.' },
            verdan: { abilityBonus: { con: 1, cha: 2 }, speed: 30, size: 'Small', lifespan: 200, languages: ['Common', 'Goblin', 'One other'], traits: ['Black Blood Healing', 'Limited Telepathy', 'Persuasive', 'Telepathic Insight'], senses: [], description: 'Goblinoid beings transformed by chaos magic. They are curious, adaptable, and continue to physically change throughout their lives.' },
            warforged: { abilityBonus: { con: 2, any: 1 }, speed: 30, size: 'Medium', lifespan: 1000, languages: ['Common', 'One other'], traits: ['Constructed Resilience', 'Sentry\'s Rest', 'Integrated Protection (+1 AC)', 'Specialized Design'], senses: [], description: 'Living constructs created for war but now seeking purpose. They are durable, logical, and struggle with questions of identity and free will.' },
            'yuan-ti': { abilityBonus: { cha: 2, int: 1 }, speed: 30, size: 'Medium', lifespan: 100, languages: ['Common', 'Abyssal', 'Draconic'], traits: ['Darkvision 60 ft', 'Magic Resistance', 'Poison Immunity', 'Innate Spellcasting (Poison Spray, Animal Friendship, Suggestion)'], senses: ['Darkvision 60 ft'], description: 'Serpentine humanoids with a cold, calculating nature. They are manipulative, intelligent, and have a strong connection to dark magic and serpents.' }
        };

        // D&D 5e Character Classes (affects stats and combat abilities)
        // Armor: { name, baseAC, addDex, maxDex (null = unlimited), special (for unarmored defense) }
        const classes = {
            commoner: { 
                primaryStat: 'none', secondaryStat: 'none', dumpStat: 'none', 
                hitDie: 'd4', 
                savingThrows: [], 
                skills: [],
                skillChoices: 0,
                armor: { name: 'Clothes', baseAC: 10, addDex: true, maxDex: null },
                description: 'An ordinary person without adventurer training'
            },
            artificer: { 
                primaryStat: 'int', secondaryStat: 'con', dumpStat: 'str', 
                hitDie: 'd8', 
                savingThrows: ['con', 'int'], 
                skills: ['Arcana', 'Investigation'],
                skillChoices: 2,
                armor: { name: 'Studded Leather', baseAC: 12, addDex: true, maxDex: null },
                description: 'A master of magical invention'
            },
            barbarian: { 
                primaryStat: 'str', secondaryStat: 'con', dumpStat: 'int', 
                hitDie: 'd12', 
                savingThrows: ['str', 'con'], 
                skills: ['Athletics', 'Intimidation'],
                skillChoices: 2,
                armor: { name: 'Unarmored Defense', baseAC: 10, addDex: true, maxDex: null, special: 'barbarian' },
                description: 'A fierce warrior of primitive background'
            },
            bard: { 
                primaryStat: 'cha', secondaryStat: 'dex', dumpStat: 'str', 
                hitDie: 'd8', 
                savingThrows: ['dex', 'cha'], 
                skills: ['Performance', 'Persuasion', 'Deception'],
                skillChoices: 3,
                armor: { name: 'Leather Armor', baseAC: 11, addDex: true, maxDex: null },
                description: 'An inspiring magician whose power echoes the music of creation'
            },
            cleric: { 
                primaryStat: 'wis', secondaryStat: 'con', dumpStat: 'dex', 
                hitDie: 'd8', 
                savingThrows: ['wis', 'cha'], 
                skills: ['Religion', 'Insight', 'Medicine'],
                skillChoices: 2,
                armor: { name: 'Scale Mail', baseAC: 14, addDex: true, maxDex: 2 },
                description: 'A priestly champion who wields divine magic'
            },
            druid: { 
                primaryStat: 'wis', secondaryStat: 'con', dumpStat: 'str', 
                hitDie: 'd8', 
                savingThrows: ['int', 'wis'], 
                skills: ['Nature', 'Survival', 'Animal Handling'],
                skillChoices: 2,
                armor: { name: 'Leather Armor', baseAC: 11, addDex: true, maxDex: null },
                description: 'A priest of the Old Faith, wielding nature\'s power'
            },
            fighter: { 
                primaryStat: 'str', secondaryStat: 'con', dumpStat: 'int', 
                hitDie: 'd10', 
                savingThrows: ['str', 'con'], 
                skills: ['Athletics', 'Perception'],
                skillChoices: 2,
                armor: { name: 'Chain Mail', baseAC: 16, addDex: false, maxDex: 0 },
                description: 'A master of martial combat'
            },
            monk: { 
                primaryStat: 'dex', secondaryStat: 'wis', dumpStat: 'str', 
                hitDie: 'd8', 
                savingThrows: ['str', 'dex'], 
                skills: ['Acrobatics', 'Stealth'],
                skillChoices: 2,
                armor: { name: 'Unarmored Defense', baseAC: 10, addDex: true, maxDex: null, special: 'monk' },
                description: 'A master of martial arts, harnessing body and soul'
            },
            paladin: { 
                primaryStat: 'str', secondaryStat: 'cha', dumpStat: 'int', 
                hitDie: 'd10', 
                savingThrows: ['wis', 'cha'], 
                skills: ['Athletics', 'Religion'],
                skillChoices: 2,
                armor: { name: 'Chain Mail', baseAC: 16, addDex: false, maxDex: 0 },
                description: 'A holy warrior bound to a sacred oath'
            },
            ranger: { 
                primaryStat: 'dex', secondaryStat: 'wis', dumpStat: 'cha', 
                hitDie: 'd10', 
                savingThrows: ['str', 'dex'], 
                skills: ['Survival', 'Nature', 'Animal Handling'],
                skillChoices: 3,
                armor: { name: 'Scale Mail', baseAC: 14, addDex: true, maxDex: 2 },
                description: 'A warrior who combats threats on civilization\'s edge'
            },
            rogue: { 
                primaryStat: 'dex', secondaryStat: 'int', dumpStat: 'str', 
                hitDie: 'd8', 
                savingThrows: ['dex', 'int'], 
                skills: ['Stealth', 'Sleight of Hand', 'Acrobatics'],
                skillChoices: 4,
                armor: { name: 'Leather Armor', baseAC: 11, addDex: true, maxDex: null },
                description: 'A scoundrel who uses stealth and trickery'
            },
            sorcerer: { 
                primaryStat: 'cha', secondaryStat: 'con', dumpStat: 'str', 
                hitDie: 'd6', 
                savingThrows: ['con', 'cha'], 
                skills: ['Arcana', 'Persuasion'],
                skillChoices: 2,
                armor: { name: 'Unarmored', baseAC: 10, addDex: true, maxDex: null },
                description: 'A spellcaster who draws on inherent magic'
            },
            warlock: { 
                primaryStat: 'cha', secondaryStat: 'con', dumpStat: 'str', 
                hitDie: 'd8', 
                savingThrows: ['wis', 'cha'], 
                skills: ['Arcana', 'Deception'],
                skillChoices: 2,
                armor: { name: 'Leather Armor', baseAC: 11, addDex: true, maxDex: null },
                description: 'A wielder of magic derived from a bargain with an extraplanar entity'
            },
            wizard: { 
                primaryStat: 'int', secondaryStat: 'con', dumpStat: 'str', 
                hitDie: 'd6',
                skillChoices: 2, 
                savingThrows: ['int', 'wis'], 
                skills: ['Arcana', 'Investigation'],
                armor: { name: 'Unarmored', baseAC: 10, addDex: true, maxDex: null },
                description: 'A scholarly magic-user capable of manipulating reality'
            }
        };

        // Subclasses by Class (All pre-2024 5e books: PHB, DMG, SCAG, XGtE, TCoE, FToD, VRGtR, EGtW, GGtR)
        const subclasses = {
            barbarian: {
                level: 3,
                name: 'Primal Path',
                options: [
                    { id: 'berserker', name: 'Path of the Berserker', source: 'PHB', description: 'For some barbarians, rage is a means to an endthat end being violence. The Path of the Berserker is a path of untrammeled fury, slick with blood.', backstoryHook: 'who has embraced the Path of the Berserker, channeling pure, unrelenting fury in battle' },
                    { id: 'totem-warrior', name: 'Path of the Totem Warrior', source: 'PHB', description: 'The Path of the Totem Warrior is a spiritual journey, as the barbarian accepts a spirit animal as guide, protector, and inspiration.', backstoryHook: 'who walks the Path of the Totem Warrior, guided by a powerful spirit animal' },
                    { id: 'ancestral-guardian', name: 'Path of the Ancestral Guardian', source: 'XGtE', description: 'Some barbarians hail from cultures that revere their ancestors. These paths teach the barbarian to contact the spirits of the dead.', backstoryHook: 'who follows the Path of the Ancestral Guardian, protected by the spirits of fallen warriors' },
                    { id: 'storm-herald', name: 'Path of the Storm Herald', source: 'XGtE', description: 'Typical barbarians harbor a fury that dwells within. Their rage grants them superior strength. But some have a rage that burns so hot it is linked to elemental storms.', backstoryHook: 'who embodies the Path of the Storm Herald, wielding the fury of elemental storms' },
                    { id: 'zealot', name: 'Path of the Zealot', source: 'XGtE', description: 'Some deities inspire their followers to pitch themselves into a ferocious battle fury. These barbarians are zealotswarriors who channel their rage into powerful displays of divine power.', backstoryHook: 'who has chosen the Path of the Zealot, a divine warrior whose rage is blessed by the gods' },
                    { id: 'battlerager', name: 'Path of the Battlerager', source: 'SCAG', description: 'Known as Kuldjargh (literally "axe idiot") in Dwarvish, battleragers are dwarf followers of the gods of war who specialize in wearing bulky, spiked armor.', backstoryHook: 'who follows the Path of the Battlerager, a fearsome warrior clad in spiked armor' },
                    { id: 'beast', name: 'Path of the Beast', source: 'TCoE', description: 'These barbarians have been so touched by the wilds that when they rage, they transform, revealing the bestial power within.', backstoryHook: 'who walks the Path of the Beast, transforming into a primal predator when enraged' },
                    { id: 'wild-magic', name: 'Path of Wild Magic', source: 'TCoE', description: 'Many places in the multiverse abound with beauty, intense emotion, and rampant magic; the Feywild, the Upper Planes, and other realms of supernatural power radiate with such forces and can profoundly influence people.', backstoryHook: 'who channels the Path of Wild Magic, their rage erupting with unpredictable arcane surges' }
                ]
            },
            bard: {
                level: 3,
                name: 'Bard College',
                options: [
                    { id: 'lore', name: 'College of Lore', source: 'PHB', description: 'Bards of the College of Lore know something about most things, collecting bits of knowledge from sources as diverse as scholarly tomes and peasant tales.', backstoryHook: 'who studied at the College of Lore, amassing knowledge from countless sources' },
                    { id: 'valor', name: 'College of Valor', source: 'PHB', description: 'Bards of the College of Valor are daring skalds whose tales keep alive the memory of the great heroes of the past.', backstoryHook: 'who trained at the College of Valor, inspiring others with tales of heroic deeds' },
                    { id: 'glamour', name: 'College of Glamour', source: 'XGtE', description: 'The College of Glamour is the home of bards who mastered their craft in the vibrant realm of the Feywild.', backstoryHook: 'who learned the ways of the College of Glamour, touched by the magic of the Feywild' },
                    { id: 'swords', name: 'College of Swords', source: 'XGtE', description: 'Bards of the College of Swords are called blades, and they entertain through daring feats of weapon prowess.', backstoryHook: 'who joined the College of Swords, mastering both blade and bardic magic' },
                    { id: 'whispers', name: 'College of Whispers', source: 'XGtE', description: 'Most folk are happy to welcome a bard into their midst. Bards of the College of Whispers use this to their advantage.', backstoryHook: 'who belongs to the secretive College of Whispers, a master of manipulation and secrets' },
                    { id: 'creation', name: 'College of Creation', source: 'TCoE', description: 'Bards believe the cosmos is a work of artthe creation of the first combiningdragons and gods. The College of Creation draws on that creative primordial to animate song.', backstoryHook: 'who joined the College of Creation, shaping reality through the song of creation itself' },
                    { id: 'eloquence', name: 'College of Eloquence', source: 'TCoE', description: 'Adherents of the College of Eloquence master the art of oratory. They use their gift of persuasion for good or ill.', backstoryHook: 'who perfected their craft at the College of Eloquence, whose words can sway hearts and minds' },
                    { id: 'spirits', name: 'College of Spirits', source: 'VRGtR', description: 'Bards of the College of Spirits seek tales with inherent powerbe they legends, histories, or fictionsand bring their subjects to life.', backstoryHook: 'who communes with the College of Spirits, channeling tales of the dead through sance and story' }
                ]
            },
            cleric: {
                level: 1,
                name: 'Divine Domain',
                options: [
                    { id: 'knowledge', name: 'Knowledge Domain', source: 'PHB', description: 'The gods of knowledge value learning and understanding above all.', backstoryHook: 'who serves a deity of the Knowledge Domain, seeking wisdom and truth' },
                    { id: 'life', name: 'Life Domain', source: 'PHB', description: 'The Life domain focuses on the vibrant positive energyone of the fundamental forces of the universethat sustains all life.', backstoryHook: 'who channels the Life Domain, dedicated to healing and preserving life' },
                    { id: 'light', name: 'Light Domain', source: 'PHB', description: 'Gods of light promote the ideals of rebirth and renewal, truth, vigilance, and beauty.', backstoryHook: 'who wields the power of the Light Domain, a beacon against darkness' },
                    { id: 'nature', name: 'Nature Domain', source: 'PHB', description: 'Gods of nature are as varied as the natural world itself, from inscrutable gods of the deep forests to friendly deities associated with particular springs and groves.', backstoryHook: 'who serves the Nature Domain, protecting the wild places of the world' },
                    { id: 'tempest', name: 'Tempest Domain', source: 'PHB', description: 'Gods whose portfolios include the Tempest domain govern storms, sea, and sky.', backstoryHook: 'who commands the Tempest Domain, wielding the fury of storms' },
                    { id: 'trickery', name: 'Trickery Domain', source: 'PHB', description: 'Gods of trickery are mischief-makers and instigators who stand as a constant challenge to the accepted order.', backstoryHook: 'who serves the Trickery Domain, a cunning agent of mischief and deception' },
                    { id: 'war', name: 'War Domain', source: 'PHB', description: 'War has many manifestations. It can make heroes of ordinary people. It can be desperate and horrific.', backstoryHook: 'who embodies the War Domain, a holy warrior blessed in battle' },
                    { id: 'death', name: 'Death Domain', source: 'DMG', description: 'The Death domain is concerned with the forces that cause death, as well as the negative energy that gives rise to undead creatures.', backstoryHook: 'who wields the Death Domain, commanding the power over life and death' },
                    { id: 'arcana', name: 'Arcana Domain', source: 'SCAG', description: 'Magic is an energy that suffuses the multiverse. Gods of the Arcana domain know the secrets and potential of magic intimately.', backstoryHook: 'who serves the Arcana Domain, bridging divine power and arcane secrets' },
                    { id: 'forge', name: 'Forge Domain', source: 'XGtE', description: 'The gods of the forge are patrons of artisans who work with metal, from a humble blacksmith to a mighty dwarven weaponsmith.', backstoryHook: 'who serves the Forge Domain, blessed with the divine art of creation' },
                    { id: 'grave', name: 'Grave Domain', source: 'XGtE', description: 'Gods of the grave watch over the line between life and death.', backstoryHook: 'who serves the Grave Domain, guarding the boundary between life and death' },
                    { id: 'order', name: 'Order Domain', source: 'TCoE', description: 'The Order domain represents discipline, as well as devotion to a society or an institution, whether that institution is combative or governmental.', backstoryHook: 'who serves the Order Domain, upholding law and structure through divine mandate' },
                    { id: 'peace', name: 'Peace Domain', source: 'TCoE', description: 'The balm of peace thrives at the heart of healthy communities, between friendly nations, and in the souls of the kindhearted.', backstoryHook: 'who embodies the Peace Domain, fostering harmony and bonds between all peoples' },
                    { id: 'twilight', name: 'Twilight Domain', source: 'TCoE', description: 'The twilit transition from light into darkness often brings calm and even joy, as the day\'s labors end and the hours of rest begin.', backstoryHook: 'who serves the Twilight Domain, a guardian who brings comfort in the darkness' }
                ]
            },
            druid: {
                level: 2,
                name: 'Druid Circle',
                options: [
                    { id: 'land', name: 'Circle of the Land', source: 'PHB', description: 'The Circle of the Land is made up of mystics and sages who safeguard ancient knowledge and rites through a vast oral tradition.', backstoryHook: 'who belongs to the Circle of the Land, drawing power from the natural terrain' },
                    { id: 'moon', name: 'Circle of the Moon', source: 'PHB', description: 'Druids of the Circle of the Moon are fierce guardians of the wilds. Their order gathers under the full moon to share news and trade warnings.', backstoryHook: 'who follows the Circle of the Moon, a powerful shapechanger' },
                    { id: 'dreams', name: 'Circle of Dreams', source: 'XGtE', description: 'Druids who are members of the Circle of Dreams hail from regions that have strong ties to the Feywild.', backstoryHook: 'who joined the Circle of Dreams, connected to the mystical Feywild' },
                    { id: 'shepherd', name: 'Circle of the Shepherd', source: 'XGtE', description: 'Druids of the Circle of the Shepherd commune with the spirits of nature, especially the spirits of beasts and the fey.', backstoryHook: 'who follows the Circle of the Shepherd, a guardian of beasts and nature spirits' },
                    { id: 'spores', name: 'Circle of Spores', source: 'TCoE', description: 'Druids of the Circle of Spores find beauty in decay. They see within mold and other fungi the ability to transform lifeless material into abundant life.', backstoryHook: 'who embraces the Circle of Spores, finding power in decay and the cycle of life and death' },
                    { id: 'stars', name: 'Circle of Stars', source: 'TCoE', description: 'The Circle of Stars allows druids to draw on the power of starlight. These druids have tracked heavenly patterns since time immemorial.', backstoryHook: 'who follows the Circle of Stars, reading the constellations and channeling their cosmic power' },
                    { id: 'wildfire', name: 'Circle of Wildfire', source: 'TCoE', description: 'Druids within the Circle of Wildfire understand that destruction is sometimes the precursor of creation.', backstoryHook: 'who joined the Circle of Wildfire, wielding cleansing flames that bring renewal' }
                ]
            },
            fighter: {
                level: 3,
                name: 'Martial Archetype',
                options: [
                    { id: 'champion', name: 'Champion', source: 'PHB', description: 'The archetypal Champion focuses on the development of raw physical power honed to deadly perfection.', backstoryHook: 'who embodies the Champion archetype, a master of physical combat' },
                    { id: 'battle-master', name: 'Battle Master', source: 'PHB', description: 'Those who emulate the archetypal Battle Master employ martial techniques passed down through generations.', backstoryHook: 'who trained as a Battle Master, wielding superior combat maneuvers' },
                    { id: 'eldritch-knight', name: 'Eldritch Knight', source: 'PHB', description: 'The archetypal Eldritch Knight combines the martial mastery common to all fighters with a careful study of magic.', backstoryHook: 'who became an Eldritch Knight, blending martial prowess with arcane magic' },
                    { id: 'purple-dragon-knight', name: 'Purple Dragon Knight', source: 'SCAG', description: 'Purple Dragon Knights are warriors who hail from the kingdom of Cormyr. Pledged to protect the crown.', backstoryHook: 'who serves as a Purple Dragon Knight, inspiring allies through noble leadership' },
                    { id: 'arcane-archer', name: 'Arcane Archer', source: 'XGtE', description: 'An Arcane Archer studies a unique elven method of archery that weaves magic into attacks.', backstoryHook: 'who trained as an Arcane Archer, infusing arrows with magical power' },
                    { id: 'cavalier', name: 'Cavalier', source: 'XGtE', description: 'The archetypal Cavalier excels at mounted combat. Usually born among the nobility.', backstoryHook: 'who trained as a Cavalier, a noble defender and master of mounted combat' },
                    { id: 'samurai', name: 'Samurai', source: 'XGtE', description: 'The Samurai is a fighter who draws on an implacable fighting spirit to overcome enemies.', backstoryHook: 'who follows the way of the Samurai, fighting with unshakeable resolve' },
                    { id: 'psi-warrior', name: 'Psi Warrior', source: 'TCoE', description: 'Awake to the psionic power within, a Psi Warrior is a fighter who augments their physical might with psi-infused weapon strikes, telekinetic lashes, and barriers of mental force.', backstoryHook: 'who awakened as a Psi Warrior, augmenting combat prowess with psionic power' },
                    { id: 'rune-knight', name: 'Rune Knight', source: 'TCoE', description: 'Rune Knights enhance their martial prowess using the supernatural power of runes, an ancient practice that originated with giants.', backstoryHook: 'who became a Rune Knight, inscribing giant runes to enhance their martial abilities' },
                    { id: 'echo-knight', name: 'Echo Knight', source: 'EGtW', description: 'A mysterious and feared frontline warrior, the Echo Knight has mastered the art of using dunamis to summon the fading shades of unrealized timelines.', backstoryHook: 'who trained as an Echo Knight, summoning shadowy echoes from alternate timelines' }
                ]
            },
            monk: {
                level: 3,
                name: 'Monastic Tradition',
                options: [
                    { id: 'open-hand', name: 'Way of the Open Hand', source: 'PHB', description: 'Monks of the Way of the Open Hand are the ultimate masters of martial arts combat, whether armed or unarmed.', backstoryHook: 'who follows the Way of the Open Hand, a master of unarmed combat' },
                    { id: 'shadow', name: 'Way of Shadow', source: 'PHB', description: 'Monks of the Way of Shadow follow a tradition that values stealth and subterfuge.', backstoryHook: 'who walks the Way of Shadow, a deadly warrior of stealth and darkness' },
                    { id: 'four-elements', name: 'Way of the Four Elements', source: 'PHB', description: 'You follow a monastic tradition that teaches you to harness the elements.', backstoryHook: 'who practices the Way of the Four Elements, commanding elemental forces' },
                    { id: 'long-death', name: 'Way of the Long Death', source: 'SCAG', description: 'Monks of the Way of the Long Death are obsessed with the meaning and mechanics of dying.', backstoryHook: 'who studies the Way of the Long Death, drawing power from the essence of mortality' },
                    { id: 'sun-soul', name: 'Way of the Sun Soul', source: 'SCAG/XGtE', description: 'Monks of the Way of the Sun Soul learn to channel their own life energy into searing bolts of light.', backstoryHook: 'who follows the Way of the Sun Soul, radiating inner light as a weapon' },
                    { id: 'drunken-master', name: 'Way of the Drunken Master', source: 'XGtE', description: 'The Way of the Drunken Master teaches its students to move with the jerky, unpredictable movements of a drunkard.', backstoryHook: 'who practices the Way of the Drunken Master, using deceptive, unpredictable movements' },
                    { id: 'kensei', name: 'Way of the Kensei', source: 'XGtE', description: 'Monks of the Way of the Kensei train relentlessly with their weapons, to the point where the weapon becomes an extension of the body.', backstoryHook: 'who follows the Way of the Kensei, achieving perfect unity with their chosen weapons' },
                    { id: 'mercy', name: 'Way of Mercy', source: 'TCoE', description: 'Monks of the Way of Mercy learn to manipulate the life force of others to bring aid to those in need. They are wandering physicians to the poor and hurt.', backstoryHook: 'who follows the Way of Mercy, a healer whose hands can both mend and harm' },
                    { id: 'astral-self', name: 'Way of the Astral Self', source: 'TCoE', description: 'A monk who follows the Way of the Astral Self believes their body is an illusion. They see their ki as a connection to their astral self, a multilimbed spectral form.', backstoryHook: 'who practices the Way of the Astral Self, manifesting their true spiritual form in combat' },
                    { id: 'ascendant-dragon', name: 'Way of the Ascendant Dragon', source: 'FToD', description: 'The fundamental teaching of this tradition holds that by emulating dragons, a monk becomes a more integrated part of the world and its magic.', backstoryHook: 'who follows the Way of the Ascendant Dragon, channeling draconic power through their ki' }
                ]
            },
            paladin: {
                level: 3,
                name: 'Sacred Oath',
                options: [
                    { id: 'devotion', name: 'Oath of Devotion', source: 'PHB', description: 'The Oath of Devotion binds a paladin to the loftiest ideals of justice, virtue, and order.', backstoryHook: 'who swore the Oath of Devotion, embodying justice, virtue, and honor' },
                    { id: 'ancients', name: 'Oath of the Ancients', source: 'PHB', description: 'The Oath of the Ancients is as old as the race of elves and the rituals of the druids.', backstoryHook: 'who took the Oath of the Ancients, a guardian of light and life itself' },
                    { id: 'vengeance', name: 'Oath of Vengeance', source: 'PHB', description: 'The Oath of Vengeance is a solemn commitment to punish those who have committed a grievous sin.', backstoryHook: 'who swore the Oath of Vengeance, relentlessly hunting those who commit great evil' },
                    { id: 'oathbreaker', name: 'Oathbreaker', source: 'DMG', description: 'An oathbreaker is a paladin who breaks their sacred oaths to pursue some dark ambition or serve an evil power.', backstoryHook: 'who became an Oathbreaker, having forsaken their sacred vows for darker purposes' },
                    { id: 'crown', name: 'Oath of the Crown', source: 'SCAG', description: 'The Oath of the Crown is sworn to the ideals of civilization, be it the spirit of a nation, fealty to a sovereign, or service to a deity of law.', backstoryHook: 'who swore the Oath of the Crown, devoted to law and civilization' },
                    { id: 'conquest', name: 'Oath of Conquest', source: 'XGtE', description: 'The Oath of Conquest calls to paladins who seek glory in battle and the subjugation of their enemies.', backstoryHook: 'who took the Oath of Conquest, seeking to crush all who oppose them' },
                    { id: 'redemption', name: 'Oath of Redemption', source: 'XGtE', description: 'The Oath of Redemption sets a paladin on a difficult path, one that requires a paladin to use violence only as a last resort.', backstoryHook: 'who follows the Oath of Redemption, believing in peace and the redemption of the wicked' },
                    { id: 'glory', name: 'Oath of Glory', source: 'TCoE', description: 'Paladins who take the Oath of Glory believe they and their companions are destined to achieve glory through deeds of heroism.', backstoryHook: 'who swore the Oath of Glory, striving for legendary heroic deeds' },
                    { id: 'watchers', name: 'Oath of the Watchers', source: 'TCoE', description: 'The Oath of the Watchers binds paladins to protect mortal realms from the predations of extraplanar creatures.', backstoryHook: 'who took the Oath of the Watchers, an eternal sentinel against extraplanar threats' }
                ]
            },
            ranger: {
                level: 3,
                name: 'Ranger Archetype',
                options: [
                    { id: 'hunter', name: 'Hunter', source: 'PHB', description: 'Emulating the Hunter archetype means accepting your place as a bulwark between civilization and the terrors of the wilderness.', backstoryHook: 'who became a Hunter, a stalwart protector against the monsters of the wild' },
                    { id: 'beast-master', name: 'Beast Master', source: 'PHB', description: 'The Beast Master archetype embodies a friendship between the civilized races and the beasts of the world.', backstoryHook: 'who bonded as a Beast Master, forming a deep connection with an animal companion' },
                    { id: 'gloom-stalker', name: 'Gloom Stalker', source: 'XGtE', description: 'Gloom Stalkers are at home in the darkest places: deep under the earth, in gloomy alleyways, in primeval forests.', backstoryHook: 'who became a Gloom Stalker, hunting in the darkest places of the world' },
                    { id: 'horizon-walker', name: 'Horizon Walker', source: 'XGtE', description: 'Horizon Walkers guard the world against threats that originate from other planes or that seek to ravage the mortal realm with otherworldly magic.', backstoryHook: 'who trained as a Horizon Walker, guarding against extraplanar threats' },
                    { id: 'monster-slayer', name: 'Monster Slayer', source: 'XGtE', description: 'You have dedicated yourself to hunting down creatures of the night and wielders of grim magic.', backstoryHook: 'who became a Monster Slayer, dedicated to hunting supernatural threats' },
                    { id: 'fey-wanderer', name: 'Fey Wanderer', source: 'TCoE', description: 'A fey mystique surrounds you, thanks to the boon of an archfey, the shining fruit you ate, or some other bytes of planar magic.', backstoryHook: 'who became a Fey Wanderer, touched by the whimsical magic of the Feywild' },
                    { id: 'swarmkeeper', name: 'Swarmkeeper', source: 'TCoE', description: 'Feeling a deep connection to the environment around them, some rangers reach out through their magical connection to the world and bond with a swarm of nature spirits.', backstoryHook: 'who bonded as a Swarmkeeper, commanding a swarm of nature spirits' },
                    { id: 'drakewarden', name: 'Drakewarden', source: 'FToD', description: 'Drakewardens are rangers who use their magical connection with nature to form an enduring bond with a minor dragon, a drake.', backstoryHook: 'who became a Drakewarden, forming a bond with a draconic companion' }
                ]
            },
            rogue: {
                level: 3,
                name: 'Roguish Archetype',
                options: [
                    { id: 'thief', name: 'Thief', source: 'PHB', description: 'You hone your skills in the larcenous arts. Burglars, bandits, cutpurses, and other criminals typically follow this archetype.', backstoryHook: 'who perfected the art of the Thief, a master of stealth and larceny' },
                    { id: 'assassin', name: 'Assassin', source: 'PHB', description: 'You focus your training on the grim art of death. Those who adhere to this archetype are diverse.', backstoryHook: 'who trained as an Assassin, a deadly dealer of death from the shadows' },
                    { id: 'arcane-trickster', name: 'Arcane Trickster', source: 'PHB', description: 'Some rogues enhance their fine-honed skills of stealth and agility with magic.', backstoryHook: 'who became an Arcane Trickster, blending roguish skills with illusion magic' },
                    { id: 'mastermind', name: 'Mastermind', source: 'SCAG/XGtE', description: 'Your focus is on people and on the influence and secrets they have.', backstoryHook: 'who operates as a Mastermind, a brilliant tactician and manipulator' },
                    { id: 'swashbuckler', name: 'Swashbuckler', source: 'SCAG/XGtE', description: 'You focus your training on the art of the blade, relying on speed, elegance, and charm.', backstoryHook: 'who lives as a Swashbuckler, a dashing duelist with charm and panache' },
                    { id: 'inquisitive', name: 'Inquisitive', source: 'XGtE', description: 'As an Inquisitive, you excel at rooting out secrets and unraveling mysteries.', backstoryHook: 'who works as an Inquisitive, a detective who uncovers hidden truths' },
                    { id: 'scout', name: 'Scout', source: 'XGtE', description: 'You are skilled in stealth and surviving far from the streets of a city, allowing you to scout ahead of your companions.', backstoryHook: 'who serves as a Scout, an expert survivalist and pathfinder' },
                    { id: 'phantom', name: 'Phantom', source: 'TCoE', description: 'Many rogues walk a fine line between life and death, risking their own lives and taking the lives of others. While adventuring on that line, some rogues discover a mystical connection to death itself.', backstoryHook: 'who became a Phantom, walking the line between life and death with ghostly powers' },
                    { id: 'soulknife', name: 'Soulknife', source: 'TCoE', description: 'Most assassins strike with physical weapons, and many burglars and spies use thieves\' tools to infiltrate secure locations. In contrast, a Soulknife strikes and infiltrates with the mind.', backstoryHook: 'who manifested as a Soulknife, wielding blades of pure psychic energy' }
                ]
            },
            sorcerer: {
                level: 1,
                name: 'Sorcerous Origin',
                options: [
                    { id: 'draconic', name: 'Draconic Bloodline', source: 'PHB', description: 'Your innate magic comes from draconic magic that was mingled with your blood or that of your ancestors.', backstoryHook: 'whose power stems from a Draconic Bloodline, with dragon magic flowing through their veins' },
                    { id: 'wild', name: 'Wild Magic', source: 'PHB', description: 'Your innate magic comes from the wild forces of chaos that underlie the order of creation.', backstoryHook: 'who channels Wild Magic, their power unpredictable and chaotic' },
                    { id: 'storm', name: 'Storm Sorcery', source: 'SCAG/XGtE', description: 'Your innate magic comes from the power of elemental air. Perhaps you were born during a howling gale.', backstoryHook: 'who wields Storm Sorcery, born of wind and thunder' },
                    { id: 'divine-soul', name: 'Divine Soul', source: 'XGtE', description: 'Sometimes the spark of magic that fuels a sorcerer comes from a divine source.', backstoryHook: 'who possesses a Divine Soul, blessed with celestial or fiendish power' },
                    { id: 'shadow', name: 'Shadow Magic', source: 'XGtE', description: 'You are a creature of shadow, for your innate magic comes from the Shadowfell itself.', backstoryHook: 'who draws upon Shadow Magic, touched by the darkness of the Shadowfell' },
                    { id: 'aberrant-mind', name: 'Aberrant Mind', source: 'TCoE', description: 'An alien influence has wrapped its tendrils around your mind, giving you psionic power. You can now touch other minds with that power and alter the world around you.', backstoryHook: 'whose Aberrant Mind grants psionic powers from an alien influence' },
                    { id: 'clockwork-soul', name: 'Clockwork Soul', source: 'TCoE', description: 'The cosmic force of order has suffused you with magic. That power arises from Mechanus or a realm where all is in ordered perfection.', backstoryHook: 'whose Clockwork Soul channels the perfect order of Mechanus' }
                ]
            },
            warlock: {
                level: 1,
                name: 'Otherworldly Patron',
                options: [
                    { id: 'archfey', name: 'The Archfey', source: 'PHB', description: 'Your patron is a lord or lady of the fey, a creature of legend who holds secrets that were forgotten before the mortal races were born.', backstoryHook: 'who made a pact with the Archfey, a powerful lord of the Feywild' },
                    { id: 'fiend', name: 'The Fiend', source: 'PHB', description: 'You have made a pact with a fiend from the lower planes of existence, a being whose aims are evil.', backstoryHook: 'who bargained with a Fiend from the lower planes for dark power' },
                    { id: 'great-old-one', name: 'The Great Old One', source: 'PHB', description: 'Your patron is a mysterious entity whose nature is utterly foreign to the fabric of reality.', backstoryHook: 'who contacted the Great Old One, gaining eldritch knowledge from beyond reality' },
                    { id: 'undying', name: 'The Undying', source: 'SCAG', description: 'Death holds no sway over your patron, who has unlocked the secrets of everlasting life.', backstoryHook: 'who serves the Undying, a deathless being who has conquered mortality' },
                    { id: 'celestial', name: 'The Celestial', source: 'XGtE', description: 'Your patron is a powerful being of the Upper Planes. You have bound yourself to an ancient empyrean.', backstoryHook: 'who formed a pact with the Celestial, a being of radiant good' },
                    { id: 'hexblade', name: 'The Hexblade', source: 'XGtE', description: 'You have made your pact with a mysterious entity from the Shadowfella force that manifests in sentient magic weapons.', backstoryHook: 'who is bound to the Hexblade, wielding a weapon of shadow and curse' },
                    { id: 'fathomless', name: 'The Fathomless', source: 'TCoE', description: 'You have plunged into a pact with the deeps. An entity of the ocean, the Elemental Plane of Water, or another otherworldly sea now allows you to draw on its thalassic power.', backstoryHook: 'who made a pact with the Fathomless, drawing power from the crushing depths' },
                    { id: 'genie', name: 'The Genie', source: 'TCoE', description: 'You have made a pact with one of the rarest kinds of genie, a noble genie. Such entities rule vast fiefs on the Elemental Planes.', backstoryHook: 'who bargained with a Genie, a noble elemental lord of great power' },
                    { id: 'undead', name: 'The Undead', source: 'VRGtR', description: 'You\'ve made a pact with a deathless being, a creature that defies the cycle and seeks to extend its dread dominion.', backstoryHook: 'who serves the Undead, a terrifying deathless patron beyond the grave' }
                ]
            },
            wizard: {
                level: 2,
                name: 'Arcane Tradition',
                options: [
                    { id: 'abjuration', name: 'School of Abjuration', source: 'PHB', description: 'The School of Abjuration emphasizes magic that blocks, banishes, or protects.', backstoryHook: 'who specializes in the School of Abjuration, mastering protective magic' },
                    { id: 'conjuration', name: 'School of Conjuration', source: 'PHB', description: 'As a conjurer, you favor spells that produce objects and creatures out of thin air.', backstoryHook: 'who studies the School of Conjuration, summoning objects and creatures from nothing' },
                    { id: 'divination', name: 'School of Divination', source: 'PHB', description: 'The counsel of a diviner is sought by royalty and commoners alike, for all seek a clearer understanding of the past, present, and future.', backstoryHook: 'who practices the School of Divination, glimpsing the threads of fate' },
                    { id: 'enchantment', name: 'School of Enchantment', source: 'PHB', description: 'As a member of the School of Enchantment, you have honed your ability to magically entrance and beguile other people and monsters.', backstoryHook: 'who masters the School of Enchantment, bending minds to their will' },
                    { id: 'evocation', name: 'School of Evocation', source: 'PHB', description: 'You focus your study on magic that creates powerful elemental effects such as bitter cold, searing flame, rolling thunder.', backstoryHook: 'who specializes in the School of Evocation, wielding devastating elemental magic' },
                    { id: 'illusion', name: 'School of Illusion', source: 'PHB', description: 'You focus your studies on magic that dazzles the senses, befuddles the mind, and tricks even the wisest folk.', backstoryHook: 'who practices the School of Illusion, weaving deceptions that seem utterly real' },
                    { id: 'necromancy', name: 'School of Necromancy', source: 'PHB', description: 'The School of Necromancy explores the cosmic forces of life, death, and undeath.', backstoryHook: 'who delves into the School of Necromancy, commanding the forces of life and death' },
                    { id: 'transmutation', name: 'School of Transmutation', source: 'PHB', description: 'You are a student of spells that modify energy and matter. To you, the world is not a fixed thing.', backstoryHook: 'who studies the School of Transmutation, reshaping matter and energy at will' },
                    { id: 'bladesinging', name: 'Bladesinging', source: 'TCoE', description: 'Bladesingers master a tradition of wizardry that incorporates swordplay and dance, originally created by elves.', backstoryHook: 'who learned Bladesinging, an elven art blending swordplay with wizardry' },
                    { id: 'war-magic', name: 'War Magic', source: 'XGtE', description: 'A variety of arcane colleges specialize in training wizards for war. The tradition of War Magic blends principles of evocation and abjuration.', backstoryHook: 'who trained in War Magic, a battle wizard of formidable power' },
                    { id: 'order-of-scribes', name: 'Order of Scribes', source: 'TCoE', description: 'Magic of the bookthat is what many folk call wizardry. The Order of Scribes is a tradition where wizards tap into the power of their spellbooks.', backstoryHook: 'who joined the Order of Scribes, whose spellbook has become a sentient magical companion' },
                    { id: 'chronurgy', name: 'Chronurgy Magic', source: 'EGtW', description: 'Focusing on the manipulation of time, those who follow the Chronurgy tradition learn to alter the pace of reality to their liking.', backstoryHook: 'who mastered Chronurgy Magic, bending the flow of time itself' },
                    { id: 'graviturgy', name: 'Graviturgy Magic', source: 'EGtW', description: 'Understanding and mastering the forces that draw bodies of matter together or push them apart, graviturgists can bend the fabric of space.', backstoryHook: 'who specializes in Graviturgy Magic, manipulating gravity and the fabric of space' }
                ]
            },
            commoner: null
        };

        // Class Features by Level
        const classFeatures = {
            barbarian: [
                { level: 1, name: 'Rage', description: 'In battle, you fight with primal ferocity. On your turn, you can enter a rage as a bonus action. While raging, you gain advantage on Strength checks and saving throws, bonus rage damage on melee attacks, and resistance to bludgeoning, piercing, and slashing damage.' },
                { level: 1, name: 'Unarmored Defense', description: 'While not wearing armor, your AC equals 10 + your Dexterity modifier + your Constitution modifier. You can use a shield and still gain this benefit.' },
                { level: 2, name: 'Reckless Attack', description: 'You can throw aside all concern for defense to attack with fierce desperation. When you make your first attack on your turn, you can decide to attack recklessly, giving you advantage on melee weapon attack rolls using Strength during this turn, but attack rolls against you have advantage until your next turn.' },
                { level: 2, name: 'Danger Sense', description: 'You gain an uncanny sense of when things nearby aren\'t as they should be. You have advantage on Dexterity saving throws against effects you can see, such as traps and spells.' },
                { level: 3, name: 'Primal Path', description: 'You choose a path that shapes the nature of your rage: Path of the Berserker, Path of the Totem Warrior, or another.' },
                { level: 4, name: 'Ability Score Improvement', description: 'You can increase one ability score by 2, or two ability scores by 1. Alternatively, you can take a feat.' },
                { level: 5, name: 'Extra Attack', description: 'You can attack twice, instead of once, whenever you take the Attack action on your turn.' },
                { level: 5, name: 'Fast Movement', description: 'Your speed increases by 10 feet while you aren\'t wearing heavy armor.' },
                { level: 7, name: 'Feral Instinct', description: 'Your instincts are so honed that you have advantage on initiative rolls. Additionally, if you are surprised at the beginning of combat and aren\'t incapacitated, you can act normally on your first turn if you enter your rage before doing anything else.' },
                { level: 9, name: 'Brutal Critical', description: 'You can roll one additional weapon damage die when determining the extra damage for a critical hit with a melee attack.' },
                { level: 11, name: 'Relentless Rage', description: 'Your rage can keep you fighting despite grievous wounds. If you drop to 0 hit points while raging and don\'t die outright, you can make a DC 10 Constitution saving throw. If you succeed, you drop to 1 hit point instead.' },
                { level: 15, name: 'Persistent Rage', description: 'Your rage is so fierce that it ends early only if you fall unconscious or if you choose to end it.' },
                { level: 18, name: 'Indomitable Might', description: 'If your total for a Strength check is less than your Strength score, you can use that score in place of the total.' },
                { level: 20, name: 'Primal Champion', description: 'You embody the power of the wilds. Your Strength and Constitution scores increase by 4. Your maximum for those scores is now 24.' }
            ],
            bard: [
                { level: 1, name: 'Spellcasting', description: 'You have learned to untangle and reshape the fabric of reality in harmony with your wishes and music. Your spells are part of your vast repertoire.' },
                { level: 1, name: 'Bardic Inspiration', description: 'You can inspire others through stirring words or music. Use a bonus action to give one creature within 60 feet a Bardic Inspiration die (d6). Once within 10 minutes, the creature can roll the die and add it to one ability check, attack roll, or saving throw.' },
                { level: 2, name: 'Jack of All Trades', description: 'You can add half your proficiency bonus, rounded down, to any ability check you make that doesn\'t already include your proficiency bonus.' },
                { level: 2, name: 'Song of Rest', description: 'You can use soothing music or oration to help revitalize your wounded allies during a short rest. If you or any friendly creatures regain hit points at the end of the short rest by spending Hit Dice, each of those creatures regains an extra 1d6 hit points.' },
                { level: 3, name: 'Bard College', description: 'You delve into the advanced techniques of a bard college of your choice: College of Lore, College of Valor, or another.' },
                { level: 3, name: 'Expertise', description: 'Choose two of your skill proficiencies. Your proficiency bonus is doubled for any ability check you make that uses either of the chosen proficiencies.' },
                { level: 5, name: 'Font of Inspiration', description: 'You regain all of your expended uses of Bardic Inspiration when you finish a short or long rest.' },
                { level: 6, name: 'Countercharm', description: 'You gain the ability to use musical notes or words of power to disrupt mind-influencing effects. As an action, you can start a performance that grants you and friendly creatures within 30 feet advantage on saving throws against being frightened or charmed.' },
                { level: 10, name: 'Magical Secrets', description: 'You have plundered magical knowledge from a wide spectrum of disciplines. Choose two spells from any classes, including this one. A spell you choose must be of a level you can cast.' },
                { level: 20, name: 'Superior Inspiration', description: 'When you roll initiative and have no uses of Bardic Inspiration left, you regain one use.' }
            ],
            cleric: [
                { level: 1, name: 'Spellcasting', description: 'As a conduit for divine power, you can cast cleric spells. Wisdom is your spellcasting ability.' },
                { level: 1, name: 'Divine Domain', description: 'Choose one domain related to your deity: Knowledge, Life, Light, Nature, Tempest, Trickery, War, or another. Your domain grants you domain spells and other features.' },
                { level: 2, name: 'Channel Divinity', description: 'You gain the ability to channel divine energy directly from your deity, using that energy to fuel magical effects. You start with Turn Undead and one effect determined by your domain.' },
                { level: 2, name: 'Turn Undead', description: 'As an action, you present your holy symbol and speak a prayer censuring the undead. Each undead within 30 feet that can see or hear you must make a Wisdom saving throw or be turned for 1 minute.' },
                { level: 5, name: 'Destroy Undead', description: 'When an undead fails its saving throw against your Turn Undead feature, the creature is instantly destroyed if its challenge rating is at or below a certain threshold (CR 1/2 at 5th level).' },
                { level: 10, name: 'Divine Intervention', description: 'You can call on your deity to intervene on your behalf. As an action, describe the assistance you seek, and roll percentile dice. If you roll a number equal to or lower than your cleric level, your deity intervenes.' },
                { level: 20, name: 'Divine Intervention Improvement', description: 'Your call for intervention succeeds automatically, no roll required.' }
            ],
            druid: [
                { level: 1, name: 'Druidic', description: 'You know Druidic, the secret language of druids. You can speak the language and use it to leave hidden messages.' },
                { level: 1, name: 'Spellcasting', description: 'Drawing on the divine essence of nature itself, you can cast spells to shape that essence to your will. Wisdom is your spellcasting ability.' },
                { level: 2, name: 'Wild Shape', description: 'You can use your action to magically assume the shape of a beast that you have seen before. You can use this feature twice, regaining expended uses when you finish a short or long rest.' },
                { level: 2, name: 'Druid Circle', description: 'You choose to identify with a circle of druids: Circle of the Land, Circle of the Moon, or another.' },
                { level: 18, name: 'Timeless Body', description: 'The primal magic you wield causes you to age more slowly. For every 10 years that pass, your body ages only 1 year.' },
                { level: 18, name: 'Beast Spells', description: 'You can cast many of your druid spells in any shape you assume using Wild Shape.' },
                { level: 20, name: 'Archdruid', description: 'You can use your Wild Shape an unlimited number of times. Additionally, you can ignore the verbal and somatic components of your druid spells.' }
            ],
            fighter: [
                { level: 1, name: 'Fighting Style', description: 'You adopt a particular style of fighting as your specialty: Archery, Defense, Dueling, Great Weapon Fighting, Protection, or Two-Weapon Fighting.' },
                { level: 1, name: 'Second Wind', description: 'You have a limited well of stamina. On your turn, you can use a bonus action to regain hit points equal to 1d10 + your fighter level. Once you use this feature, you must finish a short or long rest before you can use it again.' },
                { level: 2, name: 'Action Surge', description: 'You can push yourself beyond your normal limits for a moment. On your turn, you can take one additional action. Once you use this feature, you must finish a short or long rest before you can use it again.' },
                { level: 3, name: 'Martial Archetype', description: 'You choose an archetype that you strive to emulate: Champion, Battle Master, Eldritch Knight, or another.' },
                { level: 5, name: 'Extra Attack', description: 'You can attack twice, instead of once, whenever you take the Attack action on your turn. The number of attacks increases to three at 11th level and four at 20th level.' },
                { level: 9, name: 'Indomitable', description: 'You can reroll a saving throw that you fail. If you do so, you must use the new roll. You can use this feature once, increasing to twice at 13th level and three times at 17th level.' },
                { level: 11, name: 'Extra Attack (2)', description: 'You can attack three times whenever you take the Attack action on your turn.' },
                { level: 20, name: 'Extra Attack (3)', description: 'You can attack four times whenever you take the Attack action on your turn.' }
            ],
            monk: [
                { level: 1, name: 'Unarmored Defense', description: 'While you are wearing no armor and not wielding a shield, your AC equals 10 + your Dexterity modifier + your Wisdom modifier.' },
                { level: 1, name: 'Martial Arts', description: 'Your practice of martial arts gives you mastery of combat styles that use unarmed strikes and monk weapons. You can use Dexterity instead of Strength for attack and damage rolls, use a d4 for damage (increasing at higher levels), and make an unarmed strike as a bonus action.' },
                { level: 2, name: 'Ki', description: 'Your training allows you to harness the mystic energy of ki. You have ki points equal to your monk level, which fuel features like Flurry of Blows, Patient Defense, and Step of the Wind.' },
                { level: 2, name: 'Unarmored Movement', description: 'Your speed increases by 10 feet while you are not wearing armor or wielding a shield. This bonus increases as you gain monk levels.' },
                { level: 3, name: 'Monastic Tradition', description: 'You commit yourself to a monastic tradition: Way of the Open Hand, Way of Shadow, Way of the Four Elements, or another.' },
                { level: 3, name: 'Deflect Missiles', description: 'You can use your reaction to deflect or catch a missile when you are hit by a ranged weapon attack. You reduce the damage by 1d10 + your Dexterity modifier + your monk level.' },
                { level: 4, name: 'Slow Fall', description: 'You can use your reaction to reduce any falling damage you take by an amount equal to five times your monk level.' },
                { level: 5, name: 'Extra Attack', description: 'You can attack twice, instead of once, whenever you take the Attack action on your turn.' },
                { level: 5, name: 'Stunning Strike', description: 'You can interfere with the flow of ki in an opponent\'s body. When you hit another creature with a melee weapon attack, you can spend 1 ki point to attempt a stunning strike. The target must succeed on a Constitution saving throw or be stunned until the end of your next turn.' },
                { level: 6, name: 'Ki-Empowered Strikes', description: 'Your unarmed strikes count as magical for the purpose of overcoming resistance and immunity to nonmagical attacks and damage.' },
                { level: 7, name: 'Evasion', description: 'When you are subjected to an effect that allows you to make a Dexterity saving throw to take only half damage, you instead take no damage if you succeed, and only half damage if you fail.' },
                { level: 7, name: 'Stillness of Mind', description: 'You can use your action to end one effect on yourself that is causing you to be charmed or frightened.' },
                { level: 10, name: 'Purity of Body', description: 'Your mastery of the ki flowing through you makes you immune to disease and poison.' },
                { level: 13, name: 'Tongue of the Sun and Moon', description: 'You learn to touch the ki of other minds so that you understand all spoken languages. Moreover, any creature that can understand a language can understand what you say.' },
                { level: 14, name: 'Diamond Soul', description: 'Your mastery of ki grants you proficiency in all saving throws. Additionally, whenever you make a saving throw and fail, you can spend 1 ki point to reroll it.' },
                { level: 15, name: 'Timeless Body', description: 'Your ki sustains you so that you suffer none of the frailty of old age, and you can\'t be aged magically. You can still die of old age. You also no longer need food or water.' },
                { level: 18, name: 'Empty Body', description: 'You can use your action to spend 4 ki points to become invisible for 1 minute. During that time, you have resistance to all damage but force damage.' },
                { level: 20, name: 'Perfect Self', description: 'When you roll for initiative and have no ki points remaining, you regain 4 ki points.' }
            ],
            paladin: [
                { level: 1, name: 'Divine Sense', description: 'As an action, you can detect the presence of any celestial, fiend, or undead within 60 feet, as well as any place or object that has been consecrated or desecrated.' },
                { level: 1, name: 'Lay on Hands', description: 'Your blessed touch can heal wounds. You have a pool of healing power that replenishes after a long rest. With that pool, you can restore a total number of hit points equal to your paladin level  5.' },
                { level: 2, name: 'Fighting Style', description: 'You adopt a style of fighting as your specialty: Defense, Dueling, Great Weapon Fighting, or Protection.' },
                { level: 2, name: 'Spellcasting', description: 'You have learned to draw on divine magic through meditation and prayer to cast spells. Charisma is your spellcasting ability.' },
                { level: 2, name: 'Divine Smite', description: 'When you hit a creature with a melee weapon attack, you can expend one spell slot to deal radiant damage to the target, in addition to the weapon\'s damage. The extra damage is 2d8 for a 1st-level slot, plus 1d8 for each spell level higher than 1st.' },
                { level: 3, name: 'Divine Health', description: 'The divine magic flowing through you makes you immune to disease.' },
                { level: 3, name: 'Sacred Oath', description: 'You swear the oath that binds you as a paladin forever: Oath of Devotion, Oath of the Ancients, Oath of Vengeance, or another.' },
                { level: 5, name: 'Extra Attack', description: 'You can attack twice, instead of once, whenever you take the Attack action on your turn.' },
                { level: 6, name: 'Aura of Protection', description: 'Whenever you or a friendly creature within 10 feet of you must make a saving throw, the creature gains a bonus to the saving throw equal to your Charisma modifier (minimum +1).' },
                { level: 10, name: 'Aura of Courage', description: 'You and friendly creatures within 10 feet of you can\'t be frightened while you are conscious.' },
                { level: 11, name: 'Improved Divine Smite', description: 'Whenever you hit a creature with a melee weapon, the creature takes an extra 1d8 radiant damage.' },
                { level: 14, name: 'Cleansing Touch', description: 'You can use your action to end one spell on yourself or on one willing creature that you touch. You can use this feature a number of times equal to your Charisma modifier.' },
                { level: 18, name: 'Aura Improvements', description: 'Your auras now extend to 30 feet.' }
            ],
            ranger: [
                { level: 1, name: 'Favored Enemy', description: 'You have significant experience studying, tracking, hunting, and even talking to a certain type of enemy. Choose a type of favored enemy. You have advantage on Wisdom (Survival) checks to track your favored enemies, as well as on Intelligence checks to recall information about them.' },
                { level: 1, name: 'Natural Explorer', description: 'You are particularly familiar with one type of natural environment and are adept at traveling and surviving in such regions.' },
                { level: 2, name: 'Fighting Style', description: 'You adopt a particular style of fighting as your specialty: Archery, Defense, Dueling, or Two-Weapon Fighting.' },
                { level: 2, name: 'Spellcasting', description: 'You have learned to use the magical essence of nature to cast spells. Wisdom is your spellcasting ability.' },
                { level: 3, name: 'Ranger Archetype', description: 'You choose an archetype that you strive to emulate: Hunter, Beast Master, or another.' },
                { level: 3, name: 'Primeval Awareness', description: 'You can use your action and expend one ranger spell slot to focus your awareness on the region around you. For 1 minute per level of the spell slot, you can sense whether certain creature types are present within 1 mile.' },
                { level: 5, name: 'Extra Attack', description: 'You can attack twice, instead of once, whenever you take the Attack action on your turn.' },
                { level: 8, name: 'Land\'s Stride', description: 'Moving through nonmagical difficult terrain costs you no extra movement. You can also pass through nonmagical plants without being slowed by them and without taking damage from them.' },
                { level: 10, name: 'Hide in Plain Sight', description: 'You can spend 1 minute creating camouflage for yourself. You must have access to fresh mud, dirt, plants, soot, and other naturally occurring materials with which to create your camouflage.' },
                { level: 14, name: 'Vanish', description: 'You can use the Hide action as a bonus action on your turn. Also, you can\'t be tracked by nonmagical means, unless you choose to leave a trail.' },
                { level: 18, name: 'Feral Senses', description: 'You gain preternatural senses that help you fight creatures you can\'t see. When you attack a creature you can\'t see, your inability to see it doesn\'t impose disadvantage on your attack rolls against it.' },
                { level: 20, name: 'Foe Slayer', description: 'You become an unparalleled hunter of your enemies. Once on each of your turns, you can add your Wisdom modifier to the attack roll or damage roll of an attack you make against one of your favored enemies.' }
            ],
            rogue: [
                { level: 1, name: 'Expertise', description: 'Choose two of your skill proficiencies, or one of your skill proficiencies and your proficiency with thieves\' tools. Your proficiency bonus is doubled for any ability check you make that uses either of the chosen proficiencies.' },
                { level: 1, name: 'Sneak Attack', description: 'You know how to strike subtly and exploit a foe\'s distraction. Once per turn, you can deal an extra 1d6 damage to one creature you hit with an attack if you have advantage on the attack roll. The attack must use a finesse or a ranged weapon.' },
                { level: 1, name: 'Thieves\' Cant', description: 'During your rogue training you learned thieves\' cant, a secret mix of dialect, jargon, and code that allows you to hide messages in seemingly normal conversation.' },
                { level: 2, name: 'Cunning Action', description: 'Your quick thinking and agility allow you to move and act quickly. You can take a bonus action on each of your turns in combat to take the Dash, Disengage, or Hide action.' },
                { level: 3, name: 'Roguish Archetype', description: 'You choose an archetype that you emulate: Thief, Assassin, Arcane Trickster, or another.' },
                { level: 5, name: 'Uncanny Dodge', description: 'When an attacker that you can see hits you with an attack, you can use your reaction to halve the attack\'s damage against you.' },
                { level: 7, name: 'Evasion', description: 'When you are subjected to an effect that allows you to make a Dexterity saving throw to take only half damage, you instead take no damage if you succeed, and only half damage if you fail.' },
                { level: 11, name: 'Reliable Talent', description: 'You have refined your chosen skills until they approach perfection. Whenever you make an ability check that lets you add your proficiency bonus, you can treat a d20 roll of 9 or lower as a 10.' },
                { level: 14, name: 'Blindsense', description: 'If you are able to hear, you are aware of the location of any hidden or invisible creature within 10 feet of you.' },
                { level: 15, name: 'Slippery Mind', description: 'You have acquired greater mental strength. You gain proficiency in Wisdom saving throws.' },
                { level: 18, name: 'Elusive', description: 'You are so evasive that attackers rarely gain the upper hand against you. No attack roll has advantage against you while you aren\'t incapacitated.' },
                { level: 20, name: 'Stroke of Luck', description: 'You have an uncanny knack for succeeding when you need to. If your attack misses a target within range, you can turn the miss into a hit. Alternatively, if you fail an ability check, you can treat the d20 roll as a 20.' }
            ],
            sorcerer: [
                { level: 1, name: 'Spellcasting', description: 'An event in your past, or in the life of a parent or ancestor, left an indelible mark on you, infusing you with arcane magic. Charisma is your spellcasting ability.' },
                { level: 1, name: 'Sorcerous Origin', description: 'Choose a sorcerous origin, which describes the source of your innate magical power: Draconic Bloodline, Wild Magic, or another.' },
                { level: 2, name: 'Font of Magic', description: 'You tap into a deep wellspring of magic within yourself. You have sorcery points equal to your sorcerer level, which you can use to create spell slots or fuel Metamagic.' },
                { level: 3, name: 'Metamagic', description: 'You gain the ability to twist your spells to suit your needs. You gain two Metamagic options of your choice: Careful Spell, Distant Spell, Empowered Spell, Extended Spell, Heightened Spell, Quickened Spell, Subtle Spell, or Twinned Spell.' },
                { level: 20, name: 'Sorcerous Restoration', description: 'You regain 4 expended sorcery points whenever you finish a short rest.' }
            ],
            warlock: [
                { level: 1, name: 'Otherworldly Patron', description: 'You have struck a bargain with an otherworldly being of your choice: the Archfey, the Fiend, the Great Old One, or another.' },
                { level: 1, name: 'Pact Magic', description: 'Your arcane research and the magic bestowed on you by your patron have given you facility with spells. You know two cantrips and have spell slots that recover on a short rest.' },
                { level: 2, name: 'Eldritch Invocations', description: 'In your study of occult lore, you have unearthed eldritch invocations, fragments of forbidden knowledge that imbue you with an abiding magical ability.' },
                { level: 3, name: 'Pact Boon', description: 'Your otherworldly patron bestows a gift upon you: Pact of the Chain (familiar), Pact of the Blade (weapon), or Pact of the Tome (Book of Shadows).' },
                { level: 11, name: 'Mystic Arcanum', description: 'Your patron bestows upon you a magical secret called an arcanum. Choose one 6th-level spell from the warlock spell list as this arcanum. You can cast it once without expending a spell slot.' },
                { level: 20, name: 'Eldritch Master', description: 'You can draw on your inner reserve of mystical power while entreating your patron to regain expended spell slots. You can spend 1 minute entreating your patron for aid to regain all your expended spell slots from your Pact Magic feature.' }
            ],
            wizard: [
                { level: 1, name: 'Spellcasting', description: 'As a student of arcane magic, you have a spellbook containing spells that show the first glimmerings of your true power. Intelligence is your spellcasting ability.' },
                { level: 1, name: 'Arcane Recovery', description: 'You have learned to regain some of your magical energy by studying your spellbook. Once per day when you finish a short rest, you can choose expended spell slots to recover.' },
                { level: 2, name: 'Arcane Tradition', description: 'You choose an arcane tradition, shaping your practice of magic through one of eight schools: Abjuration, Conjuration, Divination, Enchantment, Evocation, Illusion, Necromancy, or Transmutation.' },
                { level: 18, name: 'Spell Mastery', description: 'You have achieved such mastery over certain spells that you can cast them at will. Choose a 1st-level wizard spell and a 2nd-level wizard spell. You can cast those spells at their lowest level without expending a spell slot.' },
                { level: 20, name: 'Signature Spells', description: 'You gain mastery over two powerful spells and can cast them with little effort. Choose two 3rd-level wizard spells in your spellbook as your signature spells. You always have these spells prepared and can cast each of them once at 3rd level without expending a spell slot.' }
            ],
            commoner: []
        };

        // Civilian occupations/jobs (affects backstory and roleplay, not combat)
        const occupations = {
            // Special
            infant: { category: 'special', skills: [], equipment: ['Swaddling clothes', 'Rattle'], description: 'A baby, too young for any profession' },
            adventurer: { category: 'special', skills: [], equipment: [], description: 'A professional adventurer, explorer, or hero-for-hire' },
            
            // Trades & Crafts
            blacksmith: { category: 'trade', skills: ['Athletics'], equipment: ['Leather apron', 'Smith\'s tools', 'Hammer'], description: 'Forges metal into tools, weapons, and armor' },
            carpenter: { category: 'trade', skills: ['Athletics'], equipment: ['Carpenter\'s tools', 'Saw', 'Hammer'], description: 'Builds and repairs wooden structures' },
            mason: { category: 'trade', skills: ['Athletics'], equipment: ['Mason\'s tools', 'Chisel', 'Hammer'], description: 'Works with stone for buildings and monuments' },
            potter: { category: 'trade', skills: ['Sleight of Hand'], equipment: ['Potter\'s tools', 'Clay', 'Kiln access'], description: 'Creates ceramic vessels and artwork' },
            weaver: { category: 'trade', skills: ['Sleight of Hand'], equipment: ['Weaver\'s tools', 'Loom', 'Thread'], description: 'Creates cloth and textiles' },
            tailor: { category: 'trade', skills: ['Sleight of Hand'], equipment: ['Sewing kit', 'Fabric', 'Scissors'], description: 'Makes and repairs clothing' },
            cobbler: { category: 'trade', skills: ['Sleight of Hand'], equipment: ['Cobbler\'s tools', 'Leather', 'Awl'], description: 'Makes and repairs footwear' },
            tanner: { category: 'trade', skills: ['Nature'], equipment: ['Leatherworker\'s tools', 'Hides', 'Tanning rack'], description: 'Processes animal hides into leather' },
            jeweler: { category: 'trade', skills: ['Sleight of Hand', 'Perception'], equipment: ['Jeweler\'s tools', 'Gems', 'Magnifying glass'], description: 'Crafts jewelry and works with precious metals' },
            glassblower: { category: 'trade', skills: ['Sleight of Hand'], equipment: ['Glassblower\'s tools', 'Glass rods', 'Blowpipe'], description: 'Creates glass objects and windows' },
            
            // Food & Drink
            baker: { category: 'food', skills: ['Survival'], equipment: ['Cook\'s utensils', 'Flour sack', 'Rolling pin'], description: 'Bakes bread, pastries, and other goods' },
            butcher: { category: 'food', skills: ['Survival'], equipment: ['Butcher\'s tools', 'Cleaver', 'Meat hooks'], description: 'Prepares and sells meat' },
            brewer: { category: 'food', skills: ['Nature', 'Survival'], equipment: ['Brewer\'s supplies', 'Barrel', 'Mug'], description: 'Crafts ales, beers, and other beverages' },
            cook: { category: 'food', skills: ['Survival'], equipment: ['Cook\'s utensils', 'Spices', 'Pots'], description: 'Prepares food for establishments or households' },
            innkeeper: { category: 'food', skills: ['Persuasion', 'Insight'], equipment: ['Common clothes', 'Inn key', 'Ledger'], description: 'Runs a tavern or inn' },
            vintner: { category: 'food', skills: ['Nature'], equipment: ['Brewer\'s supplies', 'Wine bottles', 'Corker'], description: 'Produces wine from grapes' },
            
            // Agriculture & Nature
            farmer: { category: 'agriculture', skills: ['Animal Handling', 'Nature'], equipment: ['Simple clothes', 'Hoe', 'Seed pouch'], description: 'Grows crops and tends fields' },
            shepherd: { category: 'agriculture', skills: ['Animal Handling'], equipment: ['Simple clothes', 'Crook', 'Whistle'], description: 'Tends flocks of sheep or goats' },
            fisherman: { category: 'agriculture', skills: ['Survival', 'Nature'], equipment: ['Fishing tackle', 'Net', 'Boat access'], description: 'Catches fish and seafood' },
            hunter: { category: 'agriculture', skills: ['Survival', 'Stealth', 'Nature'], equipment: ['Hunting trap', 'Bow', 'Skinning knife'], description: 'Hunts game for food and pelts' },
            trapper: { category: 'agriculture', skills: ['Survival', 'Nature'], equipment: ['Hunting trap', 'Snares', 'Pelts'], description: 'Catches animals for fur trade' },
            woodcutter: { category: 'agriculture', skills: ['Athletics', 'Survival'], equipment: ['Axe', 'Rope', 'Work gloves'], description: 'Fells trees and prepares lumber' },
            herbalist: { category: 'agriculture', skills: ['Nature', 'Medicine'], equipment: ['Herbalism kit', 'Pouches', 'Mortar and pestle'], description: 'Gathers and prepares medicinal plants' },
            beekeeper: { category: 'agriculture', skills: ['Animal Handling', 'Nature'], equipment: ['Beekeeper\'s suit', 'Smoker', 'Honey jars'], description: 'Tends bee colonies for honey and wax' },
            miller: { category: 'agriculture', skills: ['Athletics'], equipment: ['Work clothes', 'Grain sacks', 'Mill access'], description: 'Grinds grain into flour' },
            
            // Commerce & Trade
            merchant: { category: 'commerce', skills: ['Persuasion', 'Insight'], equipment: ['Fine clothes', 'Merchant\'s scale', 'Coin purse'], description: 'Buys and sells goods' },
            peddler: { category: 'commerce', skills: ['Persuasion'], equipment: ['Pack', 'Various small wares', 'Walking stick'], description: 'Travels selling small goods' },
            shopkeeper: { category: 'commerce', skills: ['Persuasion', 'Insight'], equipment: ['Common clothes', 'Keys', 'Ledger'], description: 'Runs a general store' },
            banker: { category: 'commerce', skills: ['Insight', 'Investigation'], equipment: ['Fine clothes', 'Strongbox key', 'Ledger'], description: 'Handles money lending and exchange' },
            trader: { category: 'commerce', skills: ['Persuasion', 'Survival'], equipment: ['Traveler\'s clothes', 'Trade goods', 'Maps'], description: 'Deals in goods between settlements' },
            
            // Service & Hospitality
            servant: { category: 'service', skills: ['Insight', 'Perception'], equipment: ['Livery', 'Cleaning supplies', 'Keys'], description: 'Works in a household' },
            stablehand: { category: 'service', skills: ['Animal Handling'], equipment: ['Work clothes', 'Pitchfork', 'Brushes'], description: 'Cares for horses and stables' },
            barkeep: { category: 'service', skills: ['Persuasion', 'Insight'], equipment: ['Common clothes', 'Tankard', 'Bar towel'], description: 'Serves drinks at a tavern' },
            courier: { category: 'service', skills: ['Athletics', 'Survival'], equipment: ['Traveler\'s clothes', 'Satchel', 'Sealed letters'], description: 'Delivers messages and packages' },
            gravedigger: { category: 'service', skills: ['Athletics'], equipment: ['Shovel', 'Lantern', 'Work clothes'], description: 'Buries the dead' },
            
            // Scholarly & Learned
            scholar: { category: 'scholarly', skills: ['Arcana', 'History', 'Investigation'], equipment: ['Scholar\'s robes', 'Books', 'Ink and quill'], description: 'Studies academic subjects' },
            scribe: { category: 'scholarly', skills: ['History'], equipment: ['Calligrapher\'s supplies', 'Parchment', 'Ink'], description: 'Copies documents and records' },
            librarian: { category: 'scholarly', skills: ['History', 'Investigation'], equipment: ['Robes', 'Reading glasses', 'Catalog'], description: 'Maintains a collection of books' },
            tutor: { category: 'scholarly', skills: ['History', 'Persuasion'], equipment: ['Books', 'Slate', 'Chalk'], description: 'Teaches students privately' },
            cartographer: { category: 'scholarly', skills: ['Survival', 'History'], equipment: ['Cartographer\'s tools', 'Maps', 'Compass'], description: 'Creates and copies maps' },
            
            // Religious
            acolyte: { category: 'religious', skills: ['Religion', 'Insight'], equipment: ['Holy symbol', 'Robes', 'Candles'], description: 'Serves at a temple' },
            priest: { category: 'religious', skills: ['Religion', 'Insight', 'Medicine'], equipment: ['Holy symbol', 'Robes', 'Prayer book'], description: 'Leads religious services' },
            monk_civilian: { category: 'religious', skills: ['Religion', 'Insight'], equipment: ['Simple robes', 'Prayer beads', 'Holy text'], description: 'Lives a contemplative religious life' },
            gravewarden: { category: 'religious', skills: ['Religion'], equipment: ['Holy symbol', 'Lantern', 'Shovel'], description: 'Protects burial grounds' },
            
            // Entertainment
            entertainer: { category: 'entertainment', skills: ['Performance', 'Acrobatics'], equipment: ['Costume', 'Props', 'Instrument'], description: 'Performs for audiences' },
            musician: { category: 'entertainment', skills: ['Performance'], equipment: ['Musical instrument', 'Sheet music', 'Entertainer\'s pack'], description: 'Plays music professionally' },
            actor: { category: 'entertainment', skills: ['Performance', 'Deception'], equipment: ['Costume', 'Makeup kit', 'Script'], description: 'Performs in plays' },
            jester: { category: 'entertainment', skills: ['Performance', 'Acrobatics'], equipment: ['Motley outfit', 'Juggling balls', 'Bells'], description: 'Entertains through comedy and antics' },
            storyteller: { category: 'entertainment', skills: ['Performance', 'History'], equipment: ['Common clothes', 'Story collection', 'Prop items'], description: 'Shares tales and legends' },
            
            // Medical
            healer: { category: 'medical', skills: ['Medicine'], equipment: ['Healer\'s kit', 'Bandages', 'Herbs'], description: 'Treats injuries and illness' },
            midwife: { category: 'medical', skills: ['Medicine', 'Insight'], equipment: ['Healer\'s kit', 'Clean linens', 'Herbs'], description: 'Assists with childbirth' },
            apothecary: { category: 'medical', skills: ['Medicine', 'Nature'], equipment: ['Alchemist\'s supplies', 'Vials', 'Herbs'], description: 'Prepares medicines and remedies' },
            
            // Military & Guard
            soldier: { category: 'military', skills: ['Athletics', 'Intimidation'], equipment: ['Uniform', 'Weapon', 'Shield'], description: 'Serves in an army' },
            guard: { category: 'military', skills: ['Athletics', 'Perception'], equipment: ['Leather armor', 'Spear', 'Shield'], description: 'Protects a location or person' },
            watchman: { category: 'military', skills: ['Perception', 'Investigation'], equipment: ['Uniform', 'Lantern', 'Whistle'], description: 'Patrols and keeps order' },
            bouncer: { category: 'military', skills: ['Athletics', 'Intimidation'], equipment: ['Common clothes', 'Club', 'Tough demeanor'], description: 'Maintains order at establishments' },
            
            // Maritime
            sailor: { category: 'maritime', skills: ['Athletics', 'Perception'], equipment: ['Common clothes', 'Rope', 'Knife'], description: 'Works on ships' },
            dockworker: { category: 'maritime', skills: ['Athletics'], equipment: ['Work clothes', 'Hook', 'Rope'], description: 'Loads and unloads ships' },
            shipwright: { category: 'maritime', skills: ['Athletics'], equipment: ['Carpenter\'s tools', 'Rope', 'Tar bucket'], description: 'Builds and repairs ships' },
            
            // Nobility & Governance
            noble: { category: 'nobility', skills: ['History', 'Persuasion'], equipment: ['Fine clothes', 'Signet ring', 'Scroll of pedigree'], description: 'Born to aristocratic privilege' },
            advisor: { category: 'nobility', skills: ['Insight', 'Persuasion', 'History'], equipment: ['Fine clothes', 'Documents', 'Seal'], description: 'Counsels those in power' },
            herald: { category: 'nobility', skills: ['History', 'Performance'], equipment: ['Tabard', 'Horn', 'Proclamation scroll'], description: 'Makes official announcements' },
            diplomat: { category: 'nobility', skills: ['Persuasion', 'Insight', 'History'], equipment: ['Fine clothes', 'Diplomatic papers', 'Gift'], description: 'Negotiates between powers' },
            tax_collector: { category: 'nobility', skills: ['Intimidation', 'Investigation'], equipment: ['Official badge', 'Ledger', 'Lockbox'], description: 'Collects taxes for authorities' },
            
            // Criminal (for interesting NPCs)
            pickpocket: { category: 'criminal', skills: ['Sleight of Hand', 'Stealth'], equipment: ['Dark clothes', 'Small knife', 'Hidden pockets'], description: 'Steals from the unwary' },
            smuggler: { category: 'criminal', skills: ['Deception', 'Stealth'], equipment: ['Dark clothes', 'Hidden compartments', 'Contacts'], description: 'Moves illegal goods' },
            fence: { category: 'criminal', skills: ['Deception', 'Insight'], equipment: ['Common clothes', 'Hidden stash', 'Contacts'], description: 'Buys and sells stolen goods' },
            beggar: { category: 'criminal', skills: ['Insight', 'Performance'], equipment: ['Ragged clothes', 'Bowl', 'Sad story'], description: 'Survives on charity' },
            
            // Miscellaneous
            miner: { category: 'labor', skills: ['Athletics'], equipment: ['Work clothes', 'Pickaxe', 'Lantern'], description: 'Extracts ore from the earth' },
            ratcatcher: { category: 'labor', skills: ['Animal Handling', 'Survival'], equipment: ['Traps', 'Terrier', 'Pole'], description: 'Controls vermin populations' },
            lamplighter: { category: 'labor', skills: ['Athletics'], equipment: ['Ladder', 'Long pole', 'Oil'], description: 'Lights and maintains street lamps' },
            chimneysweep: { category: 'labor', skills: ['Athletics', 'Acrobatics'], equipment: ['Brushes', 'Rope', 'Soot-covered clothes'], description: 'Cleans chimneys' }
        };

        // Race-specific names from Xanathar's Guide to Everything
        const raceNames = {
            'dragonborn': {
                female: ['Akra', 'Aasathra', 'Antrara', 'Arava', 'Biri', 'Blendaeth', 'Burana', 'Chassath', 'Daar', 'Dentratha', 'Doudra', 'Driindar', 'Eggren', 'Farideh', 'Findex', 'Furrele', 'Gesrethe', 'Gilkass', 'Harann', 'Havilar', 'Hethress', 'Hillanot', 'Jaxi', 'Jezean', 'Jheri', 'Kadana', 'Kava', 'Korinn', 'Megren', 'Mijira', 'Mishann', 'Nala', 'Nuthra', 'Perra', 'Pogranix', 'Pyxrin', 'Quespa', 'Raiann', 'Rezena', 'Ruloth', 'Saphara', 'Savaran', 'Sora', 'Surina', 'Synthrin', 'Tatyan', 'Thava', 'Uadjit', 'Vezera', 'Zykroff'],
                male: ['Adrex', 'Arjhan', 'Azzakh', 'Baradad', 'Bharash', 'Bidreked', 'Dadalan', 'Dazzazn', 'Direcris', 'Donaar', 'Fax', 'Gargax', 'Ghesh', 'Gorbundus', 'Greethen', 'Heskan', 'Hirrathak', 'Ildrex', 'Kaladan', 'Kerkad', 'Kiirith', 'Kriv', 'Maagog', 'Medrash', 'Mehen', 'Mozikth', 'Mreksh', 'Mugrunden', 'Nadarr', 'Nithther', 'Norkruuth', 'Nykkan', 'Pandjed', 'Patrin', 'Pijjik', 'Quarethon', 'Rathkran', 'Rhogar', 'Rivaan', 'Sethrekar', 'Shamash', 'Shedinn', 'Srorthen', 'Tarhun', 'Torinn', 'Trynnicus', 'Valorean', 'Vrondiss', 'Zedaar'],
                clan: ['Akambherylliax', 'Argenthrixus', 'Baharoosh', 'Beryntolthropal', 'Bhenkumbyrznaax', 'Caavylteradyn', 'Chumbyxirinnish', 'Clethtinthiallor', 'Daardendrian', 'Delmirev', 'Dhyrktelonis', 'Ebynichtomonis', 'Esstyrlynn', 'Fharngnarthnost', 'Ghaallixirn', 'Grrrmmballhyst', 'Gygazzylyshrift', 'Hashphronyxadyn', 'Hshhsstoroth', 'Imbixtellrhyst', 'Jerynomonis', 'Jharthraxyn', 'Kerrhylon', 'Kimbatuul', 'Lhamboldennish', 'Linxakasendalor', 'Mohradyllion', 'Mystan', 'Nemmonis', 'Norixius', 'Ophinshtalajiir', 'Orexijandilin', 'Pfaphnyrennish', 'Phrahdrandon', 'Pyraxtallinost', 'Qyxpahrgh', 'Raghthroknaar', 'Shestendeliath', 'Skaarzborroosh', 'Sumnarghthrysh', 'Tiammanthyllish', 'Turnuroth', 'Umbyrphrael', 'Vangdondalor', 'Verthisathurgiesh', 'Wivvyrholdalphiax', 'Wystongjiir', 'Xephyrbahnor', 'Yarjerit', 'Zzzxaaxthroth']
            },
            'dwarf': {
                female: ['Anbera', 'Artin', 'Audhild', 'Balifra', 'Barbena', 'Bardryn', 'Bolhild', 'Dagnal', 'Dariff', 'Delre', 'Diesa', 'Eldeth', 'Eridred', 'Falkrunn', 'Fallthra', 'Finellen', 'Gillydd', 'Gunnloda', 'Gurdis', 'Helgret', 'Helja', 'Hlin', 'Ilde', 'Jarana', 'Kathra', 'Kilia', 'Kristryd', 'Liftrasa', 'Marastyr', 'Mardred', 'Morana', 'Nalaed', 'Nora', 'Nurkara', 'Oriff', 'Ovina', 'Riswynn', 'Sannl', 'Therlin', 'Thodris', 'Torbera', 'Tordrid', 'Torgga', 'Urshar', 'Valida', 'Vistra', 'Vonana', 'Werydd', 'Whurdred', 'Yurgunn'],
                male: ['Adrik', 'Alberich', 'Baern', 'Barendd', 'Beloril', 'Brottor', 'Dain', 'Dalgal', 'Darrak', 'Delg', 'Duergath', 'Dworic', 'Eberk', 'Einkil', 'Elaim', 'Erias', 'Fallond', 'Fargrim', 'Gardain', 'Gilthur', 'Gimgen', 'Gimurt', 'Harbek', 'Kildrak', 'Kilvar', 'Morgran', 'Morkral', 'Nalral', 'Nordak', 'Nuraval', 'Oloric', 'Olunt', 'Orsik', 'Oskar', 'Rangrim', 'Reirak', 'Rurik', 'Taklinn', 'Thoradin', 'Thorin', 'Thradal', 'Tordek', 'Traubon', 'Travok', 'Ulfgar', 'Uraim', 'Veit', 'Vonbin', 'Vondal', 'Whurbin'],
                clan: ['Aranore', 'Balderk', 'Battlehammer', 'Bigtoe', 'Bloodkith', 'Bofdann', 'Brawnanvil', 'Brazzik', 'Broodfist', 'Burrowfound', 'Caebrek', 'Daerdahk', 'Dankil', 'Daraln', 'Deepdelver', 'Durthane', 'Eversharp', 'Fallack', 'Fireforge', 'Foamtankard', 'Frostbeard', 'Glanhig', 'Goblinbane', 'Goldfinder', 'Gorunn', 'Graybeard', 'Hammerstone', 'Helcral', 'Holderhek', 'Ironfist', 'Loderr', 'Lutgehr', 'Morigak', 'Orcfoe', 'Rakankrak', 'Ruby-Eye', 'Rumnaheim', 'Silveraxe', 'Silverstone', 'Steelfist', 'Stoutale', 'Strakeln', 'Strongheart', 'Thrahak', 'Torevir', 'Torunn', 'Trollbleeder', 'Trueanvil', 'Trueblood', 'Ungart']
            },
            'elf': {
                female: ['Adrie', 'Althaea', 'Anastrianna', 'Andraste', 'Antinua', 'Arara', 'Baelitae', 'Bethrynna', 'Birel', 'Caelynn', 'Chaedi', 'Claira', 'Dara', 'Drusilia', 'Elama', 'Enna', 'Farael', 'Felosial', 'Hatae', 'Ielenia', 'Ilanis', 'Irann', 'Jarsali', 'Jelenneth', 'Keyleth', 'Leshanna', 'Lia', 'Maiathah', 'Malquis', 'Meriele', 'Mialee', 'Myathethil', 'Naivara', 'Quelenna', 'Quillathe', 'Ridaro', 'Sariel', 'Shanairla', 'Shava', 'Silaqui', 'Sumnes', 'Theirastra', 'Thiala', 'Tiaathque', 'Traulam', 'Vadania', 'Valianthe', 'Vaina', 'Xanaphia'],
                male: ['Adran', 'Aelar', 'Aerdeth', 'Ahvain', 'Aramil', 'Arannis', 'Aust', 'Azaki', 'Beiro', 'Berrian', 'Caeldrim', 'Carrie', 'Dayereth', 'Dreali', 'Efferil', 'Eiravel', 'Enialis', 'Erdan', 'Erevan', 'Fivin', 'Galinndan', 'Gennal', 'Hadarai', 'Halimath', 'Himo', 'Immeral', 'Ivellios', 'Ko rfel', 'Lamlis', 'Laucian', 'Lucan', 'Mindartis', 'Naal', 'Paelias', 'Peren', 'Quarion', 'Raer', 'Riardon', 'Rolen', 'Soveliss', 'Syllin', 'Thamior', 'Tharivol', 'There', 'Theriatis', 'Thervan', 'Uthemar', 'Vannath', 'Varis'],
                family: ['Aloro', 'Amakiir', 'Amastacia', 'Ariessus', 'Arnuanna', 'Berevan', 'Caerdonel', 'Caphaxath', 'Casilltenirra', 'Cithreth', 'Dalanthan', 'Eathalena', 'Erenaeth', 'Ethanasath', 'Fasharash', 'Firahel', 'Floshem', 'Galanodel', 'Goltorah', 'Hanali', 'Holimion', 'Horineth', 'Iathrana', 'Ilphelkiir', 'Iranapha', 'Koehlanna', 'Lathalas', 'Liadon', 'Meliamne', 'Mellerelel', 'Mystralath', 'Nailo', 'Netyoive', 'Ofandrus', 'Ostoroth', 'Othronus', 'Qualanthri', 'Raethran', 'Rothenel', 'Selevarun', 'Siannodel', 'Suithrasas', 'Sylvaranth', 'Teinithra', 'Tiltathana', 'Wasanthi', 'Withrethin', 'Xiloscient', 'Xistsrith', 'Yaeldrin']
            },
            'gnome': {
                female: ['Abalaba', 'Bimpnottin', 'Breena', 'Buvvie', 'Callybon', 'Caramip', 'Carlin', 'Cumpen', 'Dalaba', 'Donella', 'Duvamil', 'Ella', 'Ellyjoybell', 'Ellywick', 'Enidda', 'Lilli', 'Loopmottin', 'Lorilla', 'Luthra', 'Mardnab', 'Meena', 'Menny', 'Mumpena', 'Nissa', 'Numba', 'Nyx', 'Oda', 'Oppah', 'Orla', 'Panana', 'Pyntle', 'Quilla', 'Ranala', 'Reddlepop', 'Roywyn', 'Salanop', 'Shamil', 'Siffress', 'Symma', 'Tana', 'Tenena', 'Tervaround', 'Tippletoe', 'Ulla', 'Unvera', 'Veloptima', 'Virra', 'Waywocket', 'Yebe', 'Zanna'],
                male: ['Alston', 'Alvyn', 'Anverth', 'Arumawann', 'Bilbron', 'Boddynock', 'Broce', 'Burgell', 'Cockaby', 'Crampernap', 'Dabbledob', 'Delebean', 'Dimble', 'Eberdeb', 'Eldon', 'Erky', 'Fabien', 'Fibblestib', 'Fonkin', 'Frouse', 'Frug', 'Gerbo', 'Gimble', 'Glim', 'Igden', 'Jabbie', 'Jebeddo', 'Kellen', 'Kipper', 'Namfoodle', 'Oppleby', 'Orryn', 'Paggen', 'Pallabar', 'Pog', 'Qualen', 'Ribbles', 'Rimple', 'Roondar', 'Sapply', 'Seebo', 'Senteq', 'Sindri', 'Umpen', 'Warryn', 'Wiggens', 'Wobbles', 'Wrenn', 'Zaffrab', 'Zook'],
                clan: ['Albaratie', 'Bafflestone', 'Beren', 'Boondiggles', 'Cobblelob', 'Daergel', 'Dunben', 'Fabblestabble', 'Fapplestamp', 'Fiddlefen', 'Folkor', 'Garrick', 'Gimlen', 'Glittergem', 'Gobblefirn', 'Gummen', 'Horcusporcus', 'Humblebumple', 'Ironhide', 'Leffery', 'Lingenhall', 'Loofollue', 'Maekkelferce', 'Miggledy', 'Munggen', 'Murnig', 'Musgraben', 'Nackle', 'Ningel', 'Nopenstallen', 'Nucklestamp', 'Offund', 'Oomtrowl', 'Pilwicken', 'Pingun', 'Quillsharpener', 'Raulnor', 'Reese', 'Rofferton', 'Scheppen', 'Shadowcloak', 'Silverthread', 'Sympony', 'Tarkelby', 'Timbers', 'Turen', 'Umbodoben', 'Waggletop', 'Welber', 'Wildwander']
            },
            'halfling': {
                female: ['Alain', 'Andry', 'Anne', 'Bella', 'Blossom', 'Bree', 'Callie', 'Chenna', 'Cora', 'Dee', 'Dell', 'Eida', 'Eran', 'Euphemia', 'Georgina', 'Gynnie', 'Harriet', 'Jasmine', 'Jillian', 'Jo', 'Kithri', 'Lavinia', 'Lidda', 'Maegan', 'Marigold', 'Merla', 'Myria', 'Nedda', 'Nikki', 'Nora', 'Olivia', 'Paela', 'Pearl', 'Pennie', 'Philomena', 'Portia', 'Robbie', 'Rose', 'Sarai', 'Seraphina', 'Shaena', 'Stacee', 'Tawna', 'Thea', 'Trym', 'Tyna', 'Vani', 'Verna', 'Wella', 'Willow'],
                male: ['Alton', 'Ander', 'Bernie', 'Bobbin', 'Cade', 'Callus', 'Corrin', 'Dannad', 'Danniel', 'Eddie', 'Egart', 'Eldon', 'Errich', 'Fildo', 'Finnan', 'Franklin', 'Garret', 'Garth', 'Gilbert', 'Gob', 'Harol', 'Igor', 'Jasper', 'Keith', 'Kevin', 'Lazam', 'Lerry', 'Lindal', 'Lyle', 'Merrie', 'Mican', 'Milo', 'Morrin', 'Nebin', 'Nevil', 'Osborn', 'Ostran', 'Oswalt', 'Perrin', 'Poppy', 'Reed', 'Roscoe', 'Sam', 'Shardon', 'Tye', 'Ulmo', 'Wellby', 'Wendel', 'Wenner', 'Wes'],
                family: ['Appleblossom', 'Bigheart', 'Brightmoon', 'Brushgather', 'Cherrycheeks', 'Copperkettle', 'Deephollow', 'Elderberry', 'Fastfoot', 'Fatrabbit', 'Glenfellow', 'Goldfound', 'Goodbarrel', 'Goodearth', 'Greenbottle', 'Greenleaf', 'High-hill', 'Hilltopple', 'Hogcollar', 'Honeypot', 'Jamjar', 'Kettlewhistle', 'Leagallow', 'Littlefoot', 'Nimblefingers', 'Porridgepot', 'Quickstep', 'Reedfellow', 'Shadowquick', 'Silvereyes', 'Smoothhands', 'Stonebridge', 'Stoutbridge', 'Stoutman', 'Strongbones', 'Sunmeadow', 'Swiftwhistle', 'Tallfellow', 'Tealeaf', 'TellPenny', 'Thistletop', 'Thorngage', 'Tosscobble', 'Underbough', 'Underfoot', 'Warmwater', 'Whispermouse', 'Wildcloak', 'Wildheart', 'Wiseacre']
            },
            'half-orc': {
                female: ['Arha', 'Baggi', 'Bendoo', 'Bilga', 'Brakka', 'Creega', 'Drenna', 'Ekk', 'Emen', 'Engong', 'Fistula', 'Gaaki', 'Gorga', 'Grai', 'Greeba', 'Grigi', 'Gynk', 'Hrathy', 'Huru', 'Ilga', 'Kabbarg', 'Kansif', 'Lagazi', 'Lezre', 'Murgen', 'Murook', 'Myev', 'Nagrette', 'Neega', 'Nella', 'Nogu', 'Oolah', 'Ootah', 'Ovak', 'Ownka', 'Puyet', 'Reeza', 'Shautha', 'Silgre', 'Sutha', 'Tagga', 'Tawar', 'Tomph', 'Ubada', 'Vanchu', 'Vola', 'Volen', 'Vorka', 'Yevelda', 'Zagga'],
                male: ['Argran', 'Braak', 'Brug', 'Cagak', 'Dench', 'Dorn', 'Dren', 'Druuk', 'Feng', 'Gell', 'Gnarsh', 'Grumbar', 'Gubrash', 'Hagren', 'Henk', 'Hogar', 'Holg', 'Imsh', 'Karash', 'Karg', 'Keth', 'Koragd', 'Krusk', 'Lhur', 'Mhurren', 'Mord', 'Morg', 'Nil', 'Nybarg', 'Odorr', 'Ohr', 'Rendar', 'Resh', 'Ront', 'Rrath', 'Shagrat', 'Shump', 'Tanglar', 'Tarak', 'Thar', 'Thokk', 'Trag', 'Ugarth', 'Varg', 'Vilberg', 'Yurk', 'Zed']
            },
            'tiefling': {
                female: ['Afbis', 'Agneborys', 'Anicria', 'Aracyra', 'Ariadani', 'Belgoria', 'Brigrea', 'Crelaia', 'Dahiri', 'Dikaria', 'Dorki', 'Ealies', 'Frilista', 'Griloth', 'Hislypsis', 'Inlyvia', 'Inimaia', 'Kalmeia', 'Lenarei', 'Levmin', 'Lilnirith', 'Marnise', 'Mispione', 'Mithpunith', 'Naqine', 'Natrali', 'Nerissa', 'Nethseis', 'Nithsolis', 'Orispira', 'Pestari', 'Phetish', 'Quuphis', 'Rivari', 'Rovine', 'Sawala', 'Sarwure', 'Seirixibis', 'Shaxori', 'Valyis', 'Velyola', 'Yaza', 'Yorazes'],
                male: ['Aetadius', 'Akakas', 'Amakos', 'Aranchar', 'Andcis', 'Arcius', 'Arkdos', 'Baremon', 'Carchar', 'Casil', 'Damilius', 'Dharlech', 'Eblius', 'Eklyre', 'Ermarir', 'Garmenos', 'Guimeros', 'Guemir', 'Hormong', 'Iamos', 'Kamus', 'Kainon', 'Karrai', 'Kilrakas', 'Kosrakir', 'Ky reus', 'Lokrias', 'Malrius', 'Maleron', 'Mavros', 'Merus', 'Morrut', 'Nephshoon', 'Ozthor', 'Ralthos', 'Rethus', 'Rolthus', 'Salvenom', 'Shavir', 'Sirvius', 'Skaxes', 'Thexik', 'Thy xikas', 'Thyne xire', 'Urxius', 'Urixus', 'Valzer', 'Xarzer', 'Zarzire', 'Zherzire', 'Zorzire'],
                virtue: ['Achievement', 'Adventure', 'Aid', 'Ambition', 'Anguish', 'Art', 'Ashes', 'Atonement', 'Awe', 'Bliss', 'Bright', 'Carrion', 'Carrior', 'Chant', 'Cheer', 'Cherish', 'Closed', 'Comfort', 'Compassion', 'Confidence', 'Content', 'Courage', 'Creed', 'Cunning', 'Darkness', 'Death', 'Debauchery', 'Deceit', 'Delight', 'Desire', 'Despair', 'Devotion', 'Dexterity', 'Different', 'Doom', 'Doubt', 'Dread', 'Ecstasy', 'End', 'Enduring', 'Ennui', 'Entropy', 'Essential', 'Esteem', 'Eternal', 'Euphoria', 'Excellence', 'Exceptional', 'Exciting', 'Expert', 'Expertise', 'Expressive', 'Extreme', 'Faith', 'Fear', 'Flawed', 'Free', 'Freedom', 'Fresh', 'Gentle', 'Gladness', 'Glee', 'Gloom', 'Glory', 'Gluttony', 'Grief', 'Happiness', 'Happy', 'Harmony', 'Hate', 'Hatred', 'Hero', 'Hope', 'Horror', 'Hunt', 'Hymn', 'Ideal', 'Ignominy', 'Immortal', 'Innovation', 'Interesting', 'Journey', 'Joy', 'Laughter', 'Life', 'Light', 'Love', 'Loyal', 'Lust', 'Mantra', 'Master', 'Mastery', 'Mayhem', 'Misery', 'Mockery', 'Murder', 'Muse', 'Music', 'Mystery', 'Normal', 'Nowhere', 'Odd', 'Open', 'Optimal', 'Pain', 'Panic', 'Passion', 'Perfect', 'Piety', 'Pleasure', 'Poetry', 'Possession', 'Promise', 'Psalm', 'Pure', 'Quest', 'Random', 'Rare', 'Recovery', 'Redemption', 'Regular', 'Relentless', 'Respect', 'Reverence', 'Revulsion', 'Sadness', 'Sanctity', 'Silence', 'Skilled', 'Sly', 'Song', 'Sorrow', 'Suffering', 'Temerity', 'Terror', 'Timeless', 'Torment', 'Tragedy', 'Trickery', 'Trouble', 'Trust', 'Truth', 'Uncommon', 'Unlocked', 'Vice', 'Virtue', 'Void', 'Voyage', 'Weary', 'Winning', 'Wit', 'Woe']
            },
            'human': {
                // Use generic fantasy names for humans
                female: ['Adelaide', 'Agatha', 'Agnes', 'Alice', 'Aline', 'Anne', 'Avelina', 'Avice', 'Beatrice', 'Cecily', 'Egelina', 'Eleanor', 'Ella', 'Elizabeth', 'Eloise', 'Elysande', 'Emeny', 'Emma', 'Emmeline', 'Ermina', 'Eva', 'Galiena', 'Geva', 'Giselle', 'Griselda', 'Hadwisa', 'Helen', 'Herleva', 'Hugolina', 'Ida', 'Isabella', 'Jacoba', 'Jane', 'Joan', 'Juliana', 'Katherine', 'Margery', 'Mary', 'Matilda', 'Maynild', 'Millicent', 'Oriela', 'Rohesia', 'Rosalind', 'Rosamund', 'Sarah', 'Susannah', 'Sybil', 'Williamina', 'Yvonne'],
                male: ['Adam', 'Adelard', 'Aldous', 'Anselm', 'Arnold', 'Bernard', 'Bertram', 'Charles', 'Clerebold', 'Conrad', 'Diggory', 'Drogo', 'Everard', 'Frederick', 'Geoffrey', 'Gerald', 'Gilbert', 'Godfrey', 'Gunter', 'Guy', 'Henry', 'Heward', 'Hubert', 'Hugh', 'Jocelyn', 'John', 'Lance', 'Manfred', 'Miles', 'Nicholas', 'Norman', 'Odo', 'Percival', 'Peter', 'Ralf', 'Randall', 'Raymond', 'Reynard', 'Richard', 'Robert', 'Roger', 'Roland', 'Rolf', 'Simon', 'Theobald', 'Theodoric', 'Thomas', 'Timm', 'William', 'Wymar']
            },
            'giff': {
                female: ['Abagail', 'Adelaide', 'Brigid', 'Charlotte', 'Clarinda', 'Elizabeth', 'Elmira', 'Fredonia', 'Esther', 'Gertrude', 'Guinevere', 'Hermione', 'Margaret', 'Martha', 'Sophronia', 'Tabitha', 'Winifred'],
                male: ['Alford', 'Algernon', 'Alpheus', 'Alphonse', 'Bertram', 'Benedict', 'Cornelius', 'Delmer', 'Ebenezer', 'Ernest', 'Eustace', 'Gideon', 'Hibbard', 'Jack', 'Jeremiah', 'Methuselah', 'Theodore', 'Percival', 'Rhys', 'Rufus', 'Zebulon'],
                clan: ['Ainesly', 'Brownrigg', 'Byron', 'Cholmondeley', 'Cromwell', 'Cumberbatch', 'Darcy', 'Eastaughffe', 'Finlayson', 'Gladstone', 'Grenville', 'Harding', 'Leicester', 'Osborne', 'Pickering', 'Pinkerton', 'Quince', 'Schuyler']
            },
            'deep gnome': {
                male: ['Belwar', 'Brickers', 'Durthmeck', 'Firble', 'Krieger', 'Kronthud', 'Schneltheck', 'Schnicktick', 'Thulwar', 'Walschud'],
                female: ['Beliss', 'Durthee', 'Firbell', 'Krickee', 'Lulthiss', 'Nalvarti', 'Schnella', 'Thulbel', 'Wiramee', 'Jalless'],
                clan: ['Crystalfist', 'Gemcutter', 'Ironfoot', 'Rockheart', 'Stoneshaper', 'Deepdelver', 'Cavecrawler', 'Underdark', 'Darkearth', 'Shadowgem']
            },
            'duergar': {
                male: ['Brandus', 'Balduhr', 'Rotbrek', 'Thodren', 'Kramtharm', 'Grenmar', 'Melmus', 'Gulgurn', 'Kardren', 'Vonrig', 'Murmus', 'Umbek', 'Hjoldahr', 'Bharmir', 'Belnar', 'Thermond', 'Harmus', 'Baernik', 'Bromrig', 'Dalgran'],
                female: ['Brolnyss', 'Marmyl', 'Tyshwin', 'Jentyn', 'Nyssyl', 'Ellyl', 'Tysria', 'Arlin', 'Bellin', 'Misnia', 'Lesnyss', 'Lyswynn', 'Karmyla', 'Gemmyla', 'Torwaen', 'Daerma', 'Mysvia', 'Nysrin', 'Sarwyn', 'Arva'],
                clan: ['Ashboot', 'Fireheart', 'Boldrunner', 'Bronzechain', 'Steelbattle', 'Barrenrock', 'Shadowflow', 'Wrathpast', 'Grimtamer', 'Stoutpride', 'Earthbelt', 'Starkreach', 'Brokenhelm', 'Grimdrum', 'Doomgrace', 'Steelrunner', 'Mindstorm', 'Flamemantle', 'Bonebrand', 'Stonehand']
            },
            'eladrin': {
                male: ['Yandarai', 'Dameral', 'Uricorin', 'Cruerta', 'Vethoros', 'Kuoneiros', 'Quamil', 'Fararis', 'Lantihr', 'Relurian', 'Elrozion', 'Imoros', 'Zendan', 'Galgeon', 'Zenlias', 'Zorworn', 'Branreth', 'Immeral', 'Harian', 'Sovekris'],
                female: ['Faerynna', 'Anthaea', 'Fanparys', 'Cylsanna', 'Urasys', 'Irediel', 'Yllatora', 'Magzane', 'Faeshana', 'Eilvara', 'Fanlyn', 'Ricelle', 'Faetora', 'Quevyre', 'Qithaea', 'Weszora', 'Nerizane', 'Kairaste', 'Qiglyn', 'Quesanna']
            },
            'githyanki': {
                male: ['Dak', 'Elirdain', 'Gaath', 'Gish', 'Kar', 'Kith', 'Lyk', 'Quith', 'Ris', 'Saarth', 'Traaka', 'Vargas', 'Vlaakith', 'Vrag', 'Xaan', 'Yrlrix', 'Zak', 'Zetch', 'Zith'],
                female: ['Aayla', 'Daar', 'Erivess', 'Fenelzi', 'Gish', 'Jenvree', 'Kel', 'Liss', 'Menyar', 'Paryl', 'Quorel', 'Sirruth', 'Tenyss', 'Ustil', 'Yenvil', 'Zar'],
                clan: ['Creche', 'Gish', 'Mlar', 'Sarth', 'Varith', 'Vlaak', 'Xaal', 'Yath', 'Zith', 'Kaal']
            },
            'githzerai': {
                male: ['Dak', 'Durth', 'Ferzth', 'Greth', 'Hurm', 'Kalla', 'Marak', 'Orrath', 'Shrak', 'Thran', 'Urth', 'Viran', 'Xanith', 'Yurk', 'Zetch'],
                female: ['Adaka', 'Arwya', 'Dhara', 'Ezhelya', 'Immilena', 'Izera', 'Lirayis', 'Meirra', 'Nahnia', 'Silin', 'Umarah', 'Urmira', 'Vithenah']
            },
            'grung': {
                male: ['Groak', 'Croal', 'Droop', 'Gripp', 'Narg', 'Plop', 'Ribbit', 'Slurp', 'Splish', 'Sproing', 'Squish', 'Sticky', 'Webfoot'],
                female: ['Chirrip', 'Croaka', 'Glossa', 'Hopper', 'Jumpa', 'Leapa', 'Phibia', 'Ribbita', 'Slippa', 'Splasha', 'Tadda', 'Wetta']
            },
            'locathah': {
                male: ['Auric', 'Coral', 'Dorsal', 'Finlay', 'Gillam', 'Kelp', 'Marlin', 'Nemo', 'Pelagic', 'Reef', 'Shelldon', 'Tidal', 'Triton', 'Urchin'],
                female: ['Anemone', 'Bubbles', 'Coraline', 'Delphina', 'Finna', 'Laguna', 'Marina', 'Nautia', 'Pearl', 'Ripple', 'Selkie', 'Shella', 'Waverly']
            },
            'shadar-kai': {
                male: ['Barathen', 'Drath', 'Immeral', 'Kethend', 'Lethander', 'Maltheas', 'Nethral', 'Paelias', 'Quarion', 'Riardon', 'Seldrel', 'Theren', 'Varis', 'Xanaphia'],
                female: ['Anastrianna', 'Ceithlenn', 'Dara', 'Enna', 'Galadrel', 'Ilanis', 'Keyleth', 'Lia', 'Meriele', 'Naivara', 'Quelenna', 'Sariel', 'Theirastra', 'Vadania'],
                clan: ['Darkweave', 'Gloomheart', 'Nightshroud', 'Shadowmend', 'Sorrowdusk', 'Voidwalker', 'Dreadhold', 'Grimsoul', 'Ravenscar', 'Deathwhisper']
            },
            'tortle': {
                male: ['Baka', 'Damu', 'Gad', 'Jappa', 'Krull', 'Lim', 'Molo', 'Nuja', 'Posu', 'Quabi', 'Rashi', 'Shelli', 'Tibor', 'Ulu', 'Xopa'],
                female: ['Bimbi', 'Dura', 'Gura', 'Juba', 'Kura', 'Lima', 'Molu', 'Nala', 'Pola', 'Quli', 'Ruma', 'Sula', 'Tula', 'Ura', 'Xula']
            },
            'verdan': {
                male: ['Brocc', 'Crink', 'Droo', 'Flek', 'Gribble', 'Jix', 'Klek', 'Meepo', 'Nyx', 'Plik', 'Snaggle', 'Tibbs', 'Vex', 'Wix', 'Zix'],
                female: ['Bree', 'Crikket', 'Drenna', 'Flicka', 'Grix', 'Jenna', 'Kree', 'Mika', 'Neela', 'Pip', 'Snik', 'Trix', 'Venna', 'Wren', 'Zella']
            },
            // === RACES FROM GENERATED NAMES ===
            'aarakocra': {
                male: ['Aera', 'Aial', 'Aur', 'Cikek', 'Darar', 'Deekek', 'Errk', 'Heehk', 'Ikki', 'Kleeck', 'Ogorek', 'Quaf', 'Quierk', 'Salleek', 'Urreek', 'Zeed'],
                female: ['Aera', 'Arial', 'Callia', 'Dessia', 'Ekia', 'Ennia', 'Kalia', 'Lizara', 'Quara', 'Sallia', 'Talia', 'Uthra', 'Vivien', 'Yria', 'Zara']
            },
            'aasimar': {
                male: ['Cernan', 'Darnys', 'Erevan', 'Harko', 'Herim', 'Kaltar', 'Kashin', 'Mathas', 'Nerin', 'Okoro', 'Praval', 'Rander', 'Satrim', 'Tavas', 'Uriel', 'Valos', 'Zefir'],
                female: ['Ariah', 'Calia', 'Daelia', 'Eshra', 'Fela', 'Galia', 'Helai', 'Iara', 'Jaliah', 'Kassia', 'Lenia', 'Masela', 'Neriah', 'Relia', 'Saria', 'Tabia', 'Vaela', 'Zenia'],
                clan: ['Brightborn', 'Dawnbringer', 'Gloryseeker', 'Heavensent', 'Lightbringer', 'Radiant', 'Skytouched', 'Starborn', 'Sunchild', 'Twilightwalker']
            },
            'bugbear': {
                male: ['Brug', 'Drukk', 'Frug', 'Glarrk', 'Grukk', 'Hrung', 'Krung', 'Lurk', 'Morug', 'Nurgg', 'Prukk', 'Rhogg', 'Skrang', 'Thrug', 'Vragg', 'Wrugg', 'Xruk', 'Zrug'],
                female: ['Brikka', 'Drukka', 'Glarra', 'Grukka', 'Hrunga', 'Klunga', 'Morga', 'Prukka', 'Rhugga', 'Shrukka', 'Thrukka', 'Vrugga', 'Wrikka', 'Zrugga']
            },
            'centaur': {
                male: ['Bonmod', 'Dosar', 'Edoluc', 'Fodric', 'Godar', 'Heluc', 'Idar', 'Kelric', 'Lodar', 'Modar', 'Nedar', 'Odar', 'Peluc', 'Ridar', 'Soelar', 'Tedar', 'Ulric', 'Vodar'],
                female: ['Bimda', 'Cendala', 'Dirania', 'Elonia', 'Fimra', 'Gilanda', 'Himala', 'Iremia', 'Jimala', 'Kendra', 'Limada', 'Mirala', 'Nirala', 'Pirema', 'Rimala', 'Sirala', 'Tirala'],
                clan: ['Dusthoof', 'Grassrunner', 'Hillstrider', 'Meadowborn', 'Plainswalker', 'Swiftmane', 'Thunderhoof', 'Wildrunner', 'Windmane']
            },
            'changeling': {
                male: ['Bin', 'Dox', 'Fie', 'Hars', 'Jin', 'Lam', 'Nix', 'Ot', 'Paik', 'Ruz', 'Sim', 'Vic', 'Wil', 'Yog'],
                female: ['Adi', 'Bec', 'Cel', 'Dil', 'Evi', 'Fyn', 'Gil', 'Hil', 'Imi', 'Jil', 'Kyn', 'Lia', 'Mia', 'Nai', 'Opi', 'Pil', 'Ria', 'Syn', 'Tia', 'Vie']
            },
            'fairy': {
                male: ['Bramble', 'Chirp', 'Dewdrop', 'Fern', 'Glimmer', 'Hyssop', 'Ivy', 'Juniper', 'Kestrel', 'Larkspur', 'Moss', 'Nettle', 'Oak', 'Puck', 'Reed', 'Sage', 'Thistle', 'Wren'],
                female: ['Aurora', 'Blossom', 'Clover', 'Dahlia', 'Eglantine', 'Fawn', 'Garland', 'Honeysuckle', 'Iris', 'Jasmine', 'Kira', 'Lily', 'Marigold', 'Nectar', 'Orchid', 'Petunia', 'Rose', 'Sunbeam', 'Violet', 'Willow']
            },
            'genasi': {
                male: ['Akmen', 'Balen', 'Cinder', 'Drogue', 'Ember', 'Flint', 'Granite', 'Haze', 'Ignis', 'Jet', 'Kelvin', 'Limestone', 'Magma', 'Nimbus', 'Onyx', 'Pyre', 'Quake', 'Rime', 'Slate', 'Torrent'],
                female: ['Aether', 'Blaze', 'Cinder', 'Dew', 'Ember', 'Flame', 'Gale', 'Hail', 'Inferna', 'Jade', 'Kindle', 'Lava', 'Mist', 'Nova', 'Obsidian', 'Pearl', 'Quartz', 'Rain', 'Storm', 'Terra']
            },
            'goblin': {
                male: ['Blix', 'Crink', 'Droop', 'Frug', 'Glix', 'Hork', 'Ibik', 'Jank', 'Krix', 'Lunk', 'Mox', 'Nix', 'Pog', 'Rix', 'Snaga', 'Tix', 'Urt', 'Vex', 'Wix', 'Zix'],
                female: ['Bixa', 'Crink', 'Dreka', 'Flixa', 'Glint', 'Hix', 'Irix', 'Jixa', 'Krix', 'Lixa', 'Mixa', 'Nixa', 'Pixa', 'Rixa', 'Sixa', 'Tixa', 'Vixa', 'Wixa', 'Zixa']
            },
            'half-elf': {
                male: ['Adran', 'Beiro', 'Carric', 'Dayereth', 'Erevan', 'Galinndan', 'Hadarai', 'Immeral', 'Korfel', 'Lamlis', 'Mindartis', 'Paelias', 'Quarion', 'Riardon', 'Soveliss', 'Thamior', 'Varis'],
                female: ['Adrie', 'Birel', 'Chaedi', 'Dara', 'Enna', 'Faral', 'Galinnda', 'Irann', 'Jelenneth', 'Keyleth', 'Lia', 'Mialee', 'Naivara', 'Quelenna', 'Sariel', 'Silaqui', 'Vadania', 'Valanthe', 'Xanaphia']
            },
            'harengon': {
                male: ['Barley', 'Bramble', 'Burrow', 'Clover', 'Dandelion', 'Fern', 'Hazel', 'Hickory', 'Juniper', 'Mallow', 'Nettle', 'Parsley', 'Pippin', 'Radish', 'Sorrel', 'Thistle', 'Thyme', 'Yarrow'],
                female: ['Basil', 'Blossom', 'Buttercup', 'Chamomile', 'Daffodil', 'Ginger', 'Heather', 'Ivy', 'Lavender', 'Marigold', 'Petunia', 'Poppy', 'Primrose', 'Rosemary', 'Saffron', 'Sage', 'Tansy', 'Violet']
            },
            'hobgoblin': {
                male: ['Aruget', 'Chetiin', 'Dagii', 'Draavath', 'Durkaan', 'Fennix', 'Gashna', 'Haruuc', 'Jhazaal', 'Kallaad', 'Lhurusk', 'Molric', 'Muut', 'Ontarr', 'Pardik', 'Riila', 'Senen', 'Tariic', 'Volaar'],
                female: ['Aaspar', 'Baalkra', 'Caal', 'Draaka', 'Ekhaas', 'Graatul', 'Haluun', 'Jhuraal', 'Kethaal', 'Lhuraal', 'Maakul', 'Nathaal', 'Paatcha', 'Ruukil', 'Saatul', 'Thavaal', 'Uusha', 'Vaal']
            },
            'kalashtar': {
                male: ['Halkhad', 'Havakhad', 'Kanatash', 'Lanharath', 'Malharath', 'Minharath', 'Nevitash', 'Parmelk', 'Thakakhad', 'Thinharath'],
                female: ['Ganitari', 'Khashana', 'Lakashtari', 'Mevakri', 'Novakri', 'Panitari', 'Sorashi', 'Thakashtai', 'Vakri', 'Vishara']
            },
            'kender': {
                male: ['Burrfoot', 'Caramon', 'Earwig', 'Fizzle', 'Gelfig', 'Hederick', 'Jillan', 'Keli', 'Kronin', 'Mayleaf', 'Paxina', 'Riverwind', 'Seamus', 'Tass', 'Tasslehoff', 'Tobin', 'Trap', 'Whistler'],
                female: ['Amberle', 'Bertina', 'Catt', 'Damaris', 'Emberglow', 'Gisella', 'Honeybee', 'Juniper', 'Keli', 'Lavender', 'Maplebough', 'Nutmeg', 'Peppercorn', 'Ripple', 'Sundew', 'Thistle', 'Tika', 'Willow'],
                clan: ['Burrfoot', 'Furrfoot', 'Lockpicker', 'Nimblefingers', 'Quickstep', 'Riddler', 'Softfoot', 'Stargazer', 'Thistleknot', 'Wanderfoot']
            },
            'kenku': {
                male: ['Clatter', 'Click', 'Creak', 'Croak', 'Flap', 'Hoot', 'Screech', 'Squawk', 'Thud', 'Whistle', 'Chirp', 'Caw', 'Rustle', 'Snap', 'Crack'],
                female: ['Clink', 'Drip', 'Flutter', 'Hiss', 'Murmur', 'Patter', 'Rustle', 'Sigh', 'Tinkle', 'Whisper', 'Chirrup', 'Peep', 'Trill', 'Warble']
            },
            'kobold': {
                male: ['Arix', 'Draak', 'Gix', 'Hox', 'Irk', 'Jex', 'Krix', 'Molo', 'Nebs', 'Pox', 'Rix', 'Sniv', 'Tarx', 'Ux', 'Vex', 'Wix', 'Yix', 'Zix'],
                female: ['Adi', 'Bis', 'Ciri', 'Dix', 'Ebs', 'Fix', 'Gli', 'His', 'Ix', 'Jis', 'Kis', 'Lix', 'Mix', 'Nix', 'Pis', 'Ris', 'Sis', 'Tix', 'Vis', 'Wis']
            },
            'leonin': {
                male: ['Acteon', 'Aiolos', 'Aristos', 'Brygos', 'Damikos', 'Dryas', 'Grexes', 'Hermos', 'Kallistos', 'Linos', 'Makarios', 'Nerien', 'Orien', 'Prokos', 'Pyknos', 'Theron', 'Xanthos', 'Zotikos'],
                female: ['Agathe', 'Alkmene', 'Areto', 'Chara', 'Desma', 'Eirene', 'Galene', 'Hypatia', 'Ianthe', 'Kallisto', 'Koralia', 'Megara', 'Neoma', 'Oraia', 'Phaenna', 'Thaleia', 'Xanthe', 'Zosime'],
                clan: ['Goldmane', 'Ironpride', 'Keeneye', 'Rapidclaw', 'Shadowprowl', 'Starfang', 'Sunmane', 'Swiftclaw', 'Thunderroar', 'Wildrunner']
            },
            'lizardfolk': {
                male: ['Arashk', 'Braza', 'Drazzat', 'Grasskh', 'Harshak', 'Irhtos', 'Jassik', 'Krusk', 'Othokent', 'Sauriv', 'Throden', 'Usk', 'Varak', 'Xisth', 'Yissk', 'Zassik'],
                female: ['Achuak', 'Aryte', 'Biri', 'Cesinha', 'Darastrix', 'Erekess', 'Faershing', 'Geshthak', 'Heskan', 'Irsh', 'Jhank', 'Kassh', 'Lithssk', 'Mirik', 'Nesthak', 'Othiss', 'Prithssk', 'Quassk']
            },
            'loxodon': {
                male: ['Bayul', 'Berov', 'Brooj', 'Chedumov', 'Dobrun', 'Drozan', 'Golomov', 'Heruj', 'Ilromov', 'Kel', 'Niklov', 'Ondros', 'Ravaj', 'Solomov', 'Tamuj', 'Vasool', 'Xidaj'],
                female: ['Ajj', 'Bada', 'Chedda', 'Domil', 'Fanumil', 'Irda', 'Jasda', 'Kimil', 'Loxil', 'Namil', 'Oolda', 'Pendda', 'Raal', 'Soolda', 'Thoolda', 'Vasda', 'Yoolda']
            },
            'orc': {
                male: ['Dench', 'Feng', 'Gell', 'Henk', 'Holg', 'Imsh', 'Keth', 'Krusk', 'Mhurren', 'Ront', 'Shump', 'Thokk', 'Urzul', 'Vrarg', 'Yevelda', 'Zorn'],
                female: ['Baggi', 'Emen', 'Engong', 'Kansif', 'Myev', 'Neega', 'Ovak', 'Ownka', 'Shautha', 'Sutha', 'Vola', 'Volen', 'Yevelda']
            },
            'satyr': {
                male: ['Apostius', 'Baucis', 'Ceryx', 'Dardanos', 'Elpidios', 'Gracchos', 'Helios', 'Kreios', 'Linos', 'Marsyas', 'Nerio', 'Orestes', 'Pan', 'Phyleus', 'Silenus', 'Theron', 'Xanthos', 'Zephyros'],
                female: ['Aglaia', 'Daphne', 'Erato', 'Eupheme', 'Galatea', 'Harmonia', 'Ianthe', 'Kalypso', 'Ligeia', 'Melete', 'Naiara', 'Orithyia', 'Phoebe', 'Syrinx', 'Thaleia', 'Xanthe'],
                clan: ['Dewfall', 'Greenglade', 'Honeymead', 'Laughingbrook', 'Mosshorn', 'Revelry', 'Sunsong', 'Wildfoot', 'Winecask']
            },
            'sea elf': {
                male: ['Aelrindel', 'Brindol', 'Caladrel', 'Deltharin', 'Elashor', 'Faelar', 'Gylledhel', 'Haelithar', 'Ilbryen', 'Kyrindel', 'Lyrindel', 'Maelthir', 'Naelindel', 'Orelthir', 'Phelindor', 'Rylindel', 'Sylvithar', 'Thaelindel', 'Umberlee', 'Vaelindor'],
                female: ['Aelindra', 'Bryndalin', 'Caladriel', 'Delindra', 'Elaerith', 'Faelindra', 'Gylladeth', 'Haelindra', 'Ildrineth', 'Kylindra', 'Lyrindeth', 'Maelindra', 'Naelrith', 'Orelindra', 'Phelindra', 'Rylindeth', 'Sylvindra', 'Thaelindra', 'Uldrineth', 'Vaelindra'],
                clan: ['Coralcrest', 'Deepcurrent', 'Foamrunner', 'Kelpweaver', 'Pearlbright', 'Reefdancer', 'Saltspray', 'Shellsinger', 'Tidecaller', 'Wavechaser']
            },
            'simic hybrid': {
                male: ['Aglar', 'Brindom', 'Cespian', 'Dromil', 'Evorn', 'Gorzad', 'Havron', 'Jezral', 'Kelvan', 'Laszril', 'Merzel', 'Navril', 'Ovlan', 'Prezial', 'Razgil', 'Seszil', 'Tavim', 'Vazril'],
                female: ['Amindi', 'Beliss', 'Cozira', 'Delnia', 'Esmera', 'Fezla', 'Glazin', 'Hazriel', 'Izmara', 'Jezin', 'Kezra', 'Lezin', 'Merzin', 'Nezra', 'Ozela', 'Prezin', 'Rezina', 'Sezra']
            },
            'tabaxi': {
                male: ['Cloud on the Mountaintop', 'Five Timber', 'Jade Shoe', 'Left-Handed Hummingbird', 'Seven Thundercloud', 'Skirt of Snakes', 'Smoking Mirror', 'Jade Whisker', 'Swift Hunter', 'Midnight Prowler'],
                female: ['Dew on the Grass', 'Eyes of Onyx', 'Flower of the Dawn', 'Jade Nose', 'Swift Strike', 'Velvet Shadow', 'Whisper of the Wind', 'Silver Claw', 'Moonlit Path', 'Soft Paw'],
                clan: ['Bright Cliffs', 'Distant Rain', 'Mountain Tree', 'Rumbling River', 'Snoring Mountain', 'Summer Mist', 'Wailing Wind', 'Warm Shore']
            },
            'triton': {
                male: ['Corus', 'Delnis', 'Fonmor', 'Glun', 'Hestis', 'Jhimas', 'Kelsus', 'Molos', 'Nalos', 'Polus', 'Rodus', 'Silus', 'Thallis', 'Vodos', 'Zunis'],
                female: ['Arista', 'Belthyn', 'Caleris', 'Delthis', 'Elyntha', 'Fathyn', 'Glathis', 'Ilmara', 'Jhynris', 'Kythis', 'Lathyn', 'Mirathis', 'Nyris', 'Phynris', 'Silithyn', 'Velthis'],
                clan: ['Ahlorsath', 'Deepcrest', 'Koitolon', 'Ranalos', 'Saltmere', 'Seacrest', 'Stormsurge', 'Tidecaller', 'Wavecrest', 'Vuuvaxath']
            },
            'vedalken': {
                male: ['Aglar', 'Belam', 'Corevil', 'Dillias', 'Evmal', 'Firellan', 'Gorvin', 'Hallem', 'Ixmal', 'Jothin', 'Kevmal', 'Lathliss', 'Mathvan', 'Nevam', 'Orsil', 'Pelvas', 'Quovam', 'Rivall', 'Solivin', 'Tolmal'],
                female: ['Agdia', 'Bimella', 'Cirrel', 'Delissa', 'Essellia', 'Finrath', 'Gorella', 'Hallia', 'Irella', 'Jillian', 'Kellista', 'Linnatha', 'Mintha', 'Nirrel', 'Ottilla', 'Pellian', 'Rintha', 'Sillin', 'Thindra', 'Ullia']
            },
            'warforged': {
                male: ['Anchor', 'Banner', 'Bastion', 'Blade', 'Blue', 'Bow', 'Church', 'Crunch', 'Dagger', 'Dent', 'Five', 'Glaive', 'Hammer', 'Iron', 'Lucky', 'Mace', 'Oak', 'Onyx', 'Piety', 'Red', 'Rusty', 'Scout', 'Seven', 'Shield', 'Smite', 'Spike', 'Stone', 'Temple', 'Titan', 'Tower', 'Victor', 'Wall', 'Wood']
            },
            'yuan-ti': {
                male: ['Asutali', 'Eztli', 'Hessatal', 'Hitotee', 'Issahu', 'Itstli', 'Mictli', 'Satal', 'Sisava', 'Sitlali', 'Soatal', 'Ssimalli', 'Suisatal', 'Taltal', 'Teotal', 'Tezatal', 'Tlaltal', 'Xisetal', 'Yaotal'],
                female: ['Asadeh', 'Citalal', 'Ecitli', 'Ichtaca', 'Icnoyotl', 'Isala', 'Kalama', 'Maquil', 'Mitnal', 'Nahuali', 'Nenetla', 'Nestli', 'Sacal', 'Sisi', 'Sitala', 'Sutal', 'Talama', 'Ueha', 'Xilama', 'Yaretzi']
            },
            // === TRULY NEW LORE-ACCURATE RACES ===
            'astral elf': {
                male: ['Aerdyl', 'Caelindel', 'Daerathel', 'Elastaros', 'Faelorin', 'Galandel', 'Helianthir', 'Iluvanis', 'Jorathal', 'Kaelorin', 'Lunaril', 'Melathorn', 'Novaril', 'Orionel', 'Phaethorn', 'Quelindor', 'Raeloril', 'Solanis', 'Thaloriel', 'Vaelorin'],
                female: ['Astraea', 'Celestiel', 'Daelora', 'Elowen', 'Faelwen', 'Galadriel', 'Heliara', 'Ilunara', 'Joralei', 'Kaeleth', 'Lunara', 'Melawen', 'Novariel', 'Orioneth', 'Phaelora', 'Quenaya', 'Raelora', 'Solanei', 'Thalara', 'Vaelora'],
                clan: ['Starweaver', 'Voidwalker', 'Cosmosborne', 'Astralwind', 'Silverveil', 'Eternity', 'Constellation', 'Celestine', 'Nebulae', 'Twilightgaze']
            },
            'autognome': {
                male: ['Brass-7', 'Cog', 'Copper-3', 'Digit', 'Gearsworth', 'Iron-12', 'Klank', 'Lever', 'Mechanical', 'Nickel-9', 'Piston', 'Rivet', 'Servo', 'Sprocket', 'Steelwick', 'Tinker', 'Valve', 'Widget', 'Zinc-4'],
                female: ['Alloy-5', 'Bolt', 'Circuit', 'Dynamo', 'Ember-8', 'Flux', 'Gadget', 'Harmony', 'Iris-2', 'Jewel', 'Kiln', 'Lithia', 'Mica', 'Nimble', 'Opal-6', 'Pearl', 'Quartz', 'Ruby', 'Spring', 'Tera']
            },
            'dhampir': {
                male: ['Aldric', 'Blackwood', 'Caine', 'Dante', 'Ezran', 'Fenris', 'Gideon', 'Hector', 'Ivan', 'Janos', 'Kael', 'Lucian', 'Magnus', 'Nicolae', 'Orion', 'Pyotr', 'Quinlan', 'Razvan', 'Stefan', 'Viktor'],
                female: ['Adriana', 'Bianca', 'Carmilla', 'Drusilla', 'Elena', 'Freya', 'Genevieve', 'Helena', 'Isadora', 'Jezebel', 'Katarina', 'Lenore', 'Mirena', 'Natasha', 'Ophelia', 'Petra', 'Ravenna', 'Seraphina', 'Tatiana', 'Valentina'],
                clan: ['Bloodmoon', 'Crimsonveil', 'Darkhollow', 'Duskmere', 'Gravewalker', 'Nightborne', 'Shadowthorn', 'Twilightfang', 'Voidheart', 'Wraithwood']
            },
            'firbolg': {
                male: ['Adair', 'Becan', 'Cathbad', 'Donal', 'Eamon', 'Fiachra', 'Grainne', 'Hogan', 'Iollan', 'Kieran', 'Lorcan', 'Murchadh', 'Niall', 'Oisin', 'Padraig', 'Ronan', 'Seanan', 'Tomas', 'Uaine', 'Wylie'],
                female: ['Aideen', 'Branna', 'Caoimhe', 'Deirdre', 'Eithne', 'Fionnuala', 'Grania', 'Honora', 'Iona', 'Keavy', 'Liadan', 'Maeve', 'Niamh', 'Orlaith', 'Padraigin', 'Roisin', 'Saoirse', 'Treasa', 'Una', 'Wynne'],
                clan: ['Forestkeeper', 'Greenmantle', 'Mossbeard', 'Oakheart', 'Stonehallow', 'Willowsong', 'Wildwood', 'Thornshade', 'Fernwalker', 'Dewnest']
            },
            'goliath': {
                male: ['Aukan', 'Eglath', 'Gae-Al', 'Gauthak', 'Ilikan', 'Keothi', 'Kuori', 'Lo-Kag', 'Manneo', 'Maveith', 'Nalla', 'Orilo', 'Paavu', 'Pethani', 'Thalai', 'Thotham', 'Uthal', 'Vaunea', 'Vimak'],
                female: ['Gae-Al', 'Gauthak', 'Ilikan', 'Keothi', 'Kuori', 'Manneo', 'Nalla', 'Orilo', 'Paavu', 'Pethani', 'Thalai', 'Uthal', 'Vaunea', 'Vimak', 'Beyla', 'Kuori', 'Manneo', 'Nalla'],
                clan: ['Anakalathai', 'Elanithino', 'Gathakanathi', 'Kalagiano', 'Katho-Olavi', 'Kolae-Gileana', 'Ogolakanu', 'Thuliaga', 'Thunukalathi', 'Vaimei-Laga']
            },
            'hadozee': {
                male: ['Bandar', 'Chim', 'Dalla', 'Fitch', 'Gib', 'Hoot', 'Jak', 'Kip', 'Lob', 'Mik', 'Nix', 'Ook', 'Pip', 'Rook', 'Scrap', 'Tik', 'Wik', 'Zeb'],
                female: ['Bina', 'Chika', 'Dina', 'Fern', 'Gigi', 'Hana', 'Jina', 'Kika', 'Lina', 'Mina', 'Nana', 'Ona', 'Pina', 'Rina', 'Suki', 'Tina', 'Wina', 'Zina']
            },
            'hexblood': {
                male: ['Ashwood', 'Bramble', 'Corvus', 'Draven', 'Eldric', 'Fenrir', 'Grimwald', 'Hemlock', 'Ichabod', 'Jareth', 'Korvin', 'Lachlan', 'Mordecai', 'Noctis', 'Obsidian', 'Phineas', 'Quillan', 'Ravencroft', 'Silas', 'Thornton'],
                female: ['Agatha', 'Belladonna', 'Circe', 'Drusilla', 'Esmeralda', 'Fern', 'Grimhilde', 'Hecate', 'Isolde', 'Jezebel', 'Kestrel', 'Lilith', 'Morgana', 'Nightshade', 'Oleander', 'Persephone', 'Raven', 'Sable', 'Thorn', 'Vesper'],
                clan: ['Blackthorn', 'Crowhollow', 'Darkwood', 'Eldergrove', 'Fogmire', 'Grimhollow', 'Hexwood', 'Ironbark', 'Jinxhollow', 'Knarlwood']
            },
            'minotaur': {
                male: ['Asterion', 'Baphomet', 'Cernos', 'Dagon', 'Euryon', 'Grothax', 'Hornhelm', 'Ixion', 'Khadon', 'Laertes', 'Minos', 'Neoptolemus', 'Ochus', 'Perseus', 'Rhoecus', 'Sthenelus', 'Taurus', 'Xanthos', 'Zagreus'],
                female: ['Aegle', 'Brizo', 'Cyrene', 'Danae', 'Euryale', 'Galene', 'Hestia', 'Ianthe', 'Kydoime', 'Larissa', 'Melitta', 'Nephele', 'Okyroe', 'Phaedra', 'Rhoda', 'Sthenele', 'Thebe', 'Xanthippe'],
                clan: ['Axehorn', 'Bloodhoof', 'Ironhorn', 'Ragefury', 'Stonehide', 'Stormhoof', 'Thunderhorn', 'Wartrample']
            },
            'owlin': {
                male: ['Aegolius', 'Bubo', 'Corvinus', 'Dusk', 'Echo', 'Feather', 'Glaucus', 'Hush', 'Inkwell', 'Jasper', 'Kestrel', 'Lumen', 'Morrow', 'Night', 'Orbit', 'Plume', 'Quill', 'Roost', 'Shadow', 'Talon'],
                female: ['Alba', 'Barrow', 'Celeste', 'Dawn', 'Evening', 'Frost', 'Gloom', 'Haven', 'Ivory', 'Journey', 'Kindred', 'Luna', 'Moon', 'Nova', 'Owl', 'Pearl', 'Quiet', 'Reverie', 'Star', 'Twilight']
            },
            'plasmoid': {
                male: ['Blob', 'Drip', 'Flow', 'Gel', 'Goop', 'Gunk', 'Jelly', 'Morph', 'Ooze', 'Puddle', 'Ripple', 'Slick', 'Slime', 'Splash', 'Squish', 'Stream', 'Surge', 'Tide', 'Wave', 'Wobble'],
                female: ['Bubble', 'Dew', 'Droplet', 'Fizz', 'Gleam', 'Glisten', 'Mist', 'Pearl', 'Rain', 'Shimmer', 'Silk', 'Slip', 'Smooth', 'Sparkle', 'Splash', 'Spring', 'Stream', 'Trickle', 'Vapor', 'Wisp']
            },
            'reborn': {
                male: ['Alaric', 'Barnabas', 'Casimir', 'Destrian', 'Edmund', 'Fletcher', 'Grimwald', 'Heinrich', 'Istvan', 'Jorah', 'Kael', 'Lazarus', 'Mortimer', 'Nikolai', 'Osric', 'Percival', 'Quinn', 'Revenant', 'Silas', 'Thane'],
                female: ['Abigail', 'Beatrix', 'Constance', 'Drusilla', 'Elara', 'Freya', 'Genevieve', 'Helena', 'Isolde', 'Jasmine', 'Katarina', 'Lenore', 'Mirabel', 'Nadia', 'Ophelia', 'Persephone', 'Quinn', 'Rowena', 'Seraphina', 'Tabitha']
            },
            'shifter': {
                male: ['Ash', 'Bark', 'Claw', 'Dusk', 'Fang', 'Gray', 'Howl', 'Keen', 'Longfang', 'Moon', 'Night', 'Prowl', 'Ridge', 'Scar', 'Storm', 'Thorn', 'Tracker', 'Wild', 'Wolf', 'Zephyr'],
                female: ['Amber', 'Briar', 'Cinder', 'Dawn', 'Echo', 'Fern', 'Gale', 'Hazel', 'Ivy', 'Jade', 'Kestrel', 'Luna', 'Moss', 'Night', 'Onyx', 'Pine', 'Rain', 'Shadow', 'Thistle', 'Willow'],
                clan: ['Beasthide', 'Cliffwalk', 'Dreamsight', 'Gorebrute', 'Longtooth', 'Razorclaw', 'Swiftstride', 'Trueheart', 'Wildhunt']
            },
            'thri-kreen': {
                male: ['Chak-tha', 'Drik-chkit', 'Kacht-ta', 'Kat-chra', 'Krik-tikik', 'Pak-cha', 'Pik-ik-cha', 'Ptekwe', 'Tak-tha', 'Tik-tik', 'Tikchak', 'Tiktik', 'Tokchak', 'Trikchik'],
                female: ['Chaktha', 'Chit-kra', 'Drik-cha', 'Iktha', 'Kachka', 'Katcha', 'Krikka', 'Pakka', 'Pikcha', 'Prikka', 'Takka', 'Tikka', 'Tokka', 'Trikka']
            }
        };

        // =================================================================
        // DYNAMIC NAME GENERATION SYSTEM
        // Fragment-based name generation for races with source data
        // =================================================================
        
        const raceNameFragments = {
            // ELF - Pattern: male=nm1+nm2, female=nm3+nm4, surname=nm12+nm13
            'elf': {
                nm1: ["Ad","Ae","Bal","Bei","Car","Cra","Dae","Dor","El","Ela","Er","Far","Fen","Gen","Glyn","Hei","Her","Ian","Ili","Kea","Kel","Leo","Lu","Mira","Mor","Nae","Nor","Olo","Oma","Pa","Per","Pet","Qi","Qin","Ralo","Ro","Sar","Syl","The","Tra","Ume","Uri","Va","Vir","Waes","Wran","Yel","Yin","Zin","Zum"],
                nm2: ["balar","beros","can","ceran","dan","dithas","faren","fir","geiros","golor","hice","horn","jeon","jor","kas","kian","lamin","lar","len","maer","maris","menor","myar","nan","neiros","nelis","norin","peiros","petor","qen","quinal","ran","ren","ric","ris","ro","salor","sandoral","toris","tumal","valur","ven","warin","wraek","xalim","xidor","yarus","ydark","zeiros","zumin"],
                nm3: ["Ad","Ara","Bi","Bry","Cai","Chae","Da","Dae","Eil","En","Fa","Fae","Gil","Gre","Hele","Hola","Iar","Ina","Jo","Key","Kris","Lia","Lora","Mag","Mia","Neri","Ola","Ori","Phi","Pres","Qi","Qui","Rava","Rey","Sha","Syl","Tor","Tris","Ula","Uri","Val","Ven","Wyn","Wysa","Xil","Xyr","Yes","Ylla","Zin","Zyl"],
                nm4: ["banise","bella","caryn","cyne","di","dove","fiel","fina","gella","gwyn","hana","harice","jyre","kalyn","krana","lana","lee","leth","lynn","moira","mys","na","nala","phine","phyra","qirelle","ra","ralei","rel","rie","rieth","rona","rora","roris","satra","stina","sys","thana","thyra","tris","varis","vyre","wenys","wynn","xina","xisys","ynore","yra","zana","zorwyn"],
                nm12: ["alder","amber","ash","aspen","autumn","azure","beech","birch","blue","bold","bronze","cedar","crimson","dawn","dew","diamond","dusk","eager","elder","elm","ember","even","fall","far","feather","fir","flower","fog","forest","gem","gold","green","hazel","light","lunar","mist","moon","moss","night","oak","oaken","ocean","poplar","rain","rapid","raven","sage","shadow","silent","silver","spark","spirit","spring","star","still","stone","summer","sun","swift","wild","willow","wind","winter","wood"],
                nm13: ["beam","bell","birth","blossom","breath","breeze","brook","cloud","crown","dew","dream","dreamer","fall","fate","flight","flow","flower","fond","gaze","gazer","gift","gleam","grove","guard","heart","heel","hold","kind","light","mane","might","mind","moon","path","petal","pride","rest","river","seeker","sense","shadow","shard","shine","singer","smile","song","spark","spell","spirit","star","vale","walker","watcher","whisper","wish"],
                pattern: 'simple'
            },
            // DWARF - Pattern: male=nm1+nm2, female=nm3+nm4, surname=nm12+nm13
            'dwarf': {
                nm1: ["Ad","Am","Arm","Baer","Daer","Bal","Ban","Bar","Bel","Ben","Ber","Bhal","Bhar","Bhel","Bram","Bran","Brom","Brum","Bun","Dal","Dar","Dol","Dul","Eb","Em","Erm","Far","Gal","Gar","Ger","Gim","Gral","Gram","Gran","Grem","Gren","Gril","Gry","Gul","Har","Hjal","Hjol","Hjul","Hor","Hul","Hur","Kar","Khar","Kram","Krom","Krum","Mag","Mal","Mel","Mor","Muir","Mur","Rag","Ran","Reg","Rot","Thal","Thar","Thel","Ther","Tho","Thor","Thul","Thur","Thy","Tor","Ty","Um","Urm","Von"],
                nm2: ["adin","bek","brek","dahr","dain","dal","dan","dar","dek","dir","dohr","dor","drak","dram","dren","drom","drum","drus","duhr","dur","dus","garn","gram","gran","grim","grom","gron","grum","grun","gurn","gus","iggs","kahm","kam","kohm","kom","kuhm","kum","kyl","man","mand","mar","mek","miir","min","mir","mond","mor","mun","mund","mur","mus","myl","myr","nam","nar","nik","nir","nom","num","nur","nus","nyl","rak","ram","ren","rig","rigg","rik","rim","rom","ron","rum","rus","ryl","tharm","tharn","thran","thrum","thrun"],
                nm3: ["An","Ar","Baer","Bar","Bel","Belle","Bon","Bonn","Braen","Bral","Bralle","Bran","Bren","Bret","Bril","Brille","Brol","Bron","Brul","Bryl","Brylle","Bryn","Bryt","Byl","Bylle","Daer","Dear","Dim","Ed","Ein","El","Gem","Ger","Gwan","Gwen","Gwin","Gwyn","Gym","Ing","Jen","Jenn","Jin","Jyn","Kait","Kar","Kat","Kath","Ket","Las","Lass","Les","Less","Lyes","Lys","Lyss","Maer","Maev","Mar","Mis","Mist","Myr","Mys","Myst","Naer","Nal","Nas","Nass","Nes","Nis","Nys","Raen","Ran","Red","Reyn","Run","Ryn","Sar","Sol","Tas","Taz","Tis","Tish","Tiz","Tor","Tys","Tysh"],
                nm4: ["belle","bera","delle","deth","dielle","dille","dish","dora","dryn","dyl","giel","glia","glian","gwyn","la","leen","leil","len","lin","linn","lyl","lyn","lynn","ma","mera","mora","mura","myl","myla","nan","nar","nas","nera","nia","nip","nis","niss","nora","nura","nyl","nys","nyss","ra","ras","res","ri","ria","rielle","rin","ris","ros","ryl","ryn","sael","selle","sora","syl","thel","thiel","tin","tyn","va","van","via","vian","waen","win","wyn","wynn"],
                nm12: ["battle","big","black","blood","bold","boulder","brave","brawn","bright","broad","bronze","brood","burrow","cold","dark","deep","drunk","even","ever","fire","first","flint","frost","frozen","giant","goblin","gold","golden","gray","great","half","hammer","hard","iron","keen","kind","last","light","loud","mad","marble","might","molten","mountain","silver","smug","stark","steel","stern","stone","storm","stout","strong","thunder","troll","true","wild"],
                nm13: ["ale","anvil","axe","back","bane","beard","belch","belt","blade","bleeder","blood","boot","boots","bottom","braid","branch","breaker","breath","brow","buster","delver","eye","eyes","fall","feast","finder","fist","fists","flight","force","forge","found","front","fury","gift","grace","grip","guard","hammer","hand","handle","head","heart","helm","hold","horn","kin","kind","kith","mane","mantle","mask","might","pass","past","pride","reach","rest","roar","rock","shaper","shield","song","stand","stone","storm","strike","tale","tankard","ward"],
                pattern: 'simple'
            },
            // HALFLING - Pattern: male=nm1+nm2, female=nm3+nm4, surname=nm12+nm13
            'halfling': {
                nm1: ["An","Ar","Bar","Bel","Con","Cor","Dan","Dav","El","Er","Fal","Fin","Flyn","Gar","Go","Hal","Hor","Ido","Ira","Jan","Jo","Kas","Kor","La","Lin","Mar","Mer","Ne","Nor","Ori","Os","Pan","Per","Pim","Quin","Quo","Ri","Ric","San","Shar","Tar","Te","Ul","Uri","Val","Vin","Wen","Wil","Xan","Xo","Yar","Yen","Zal","Zen"],
                nm2: ["ace","amin","bin","bul","dak","dal","der","don","emin","eon","fer","fire","gin","hace","horn","kas","kin","lan","los","min","mo","nad","nan","ner","orin","os","pher","pos","ras","ret","ric","rich","rin","ry","ser","sire","ster","ton","tran","umo","ver","vias","von","wan","wrick","yas","yver","zin","zor","zu"],
                nm3: ["An","Ari","Bel","Bre","Cal","Chen","Dar","Dia","Ei","Eo","Eli","Era","Fay","Fen","Fro","Gel","Gra","Ha","Hil","Ida","Isa","Jay","Jil","Kel","Kith","Le","Lid","Mae","Mal","Mar","Ne","Ned","Odi","Ora","Pae","Pru","Qi","Qu","Ri","Ros","Sa","Shae","Syl","Tham","Ther","Tryn","Una","Uvi","Va","Ver","Wel","Wi","Xan","Xi","Yes","Yo","Zef","Zen"],
                nm4: ["alyn","ara","brix","byn","caryn","cey","da","dove","drey","elle","eni","fice","fira","grace","gwen","haly","jen","kath","kis","leigh","la","lie","lile","lienne","lyse","mia","mita","ne","na","ni","nys","ola","ora","phina","prys","rana","ree","ri","ris","sica","sira","sys","tina","trix","ula","vira","vyre","wyn","wyse","yola","yra","zana","zira"],
                nm12: ["amber","apple","autumn","barley","big","boulder","bramble","bright","bronze","brush","cherry","cinder","clear","cloud","common","copper","deep","dust","earth","elder","ember","fast","fat","fern","flint","fog","fore","free","glen","glow","gold","good","grand","grass","great","green","haven","heart","high","hill","hog","humble","keen","laughing","lea","leaf","light","little","lone","long","lunar","marble","mild","mist","moon","moss","night","nimble","proud","quick","raven","reed","river","rose","rumble","shadow","silent","silver","smooth","soft","spring","still","stone","stout","strong","summer","sun","swift","tall","tea","ten","thistle","thorn","toss","true","twilight","under","warm","whisper","wild","wise"],
                nm13: ["ace","barrel","beam","belly","berry","bloom","blossom","bluff","bottle","bough","brace","braid","branch","brand","bridge","brook","brush","cheeks","cloak","cobble","creek","crest","dance","dancer","dew","dream","earth","eye","eyes","feet","fellow","finger","fingers","flow","flower","foot","found","gather","glide","grove","hand","hands","hare","heart","hill","hollow","kettle","lade","leaf","man","mane","mantle","meadow","moon","mouse","pot","rabbit","seeker","shadow","shine","sky","song","spark","spell","spirit","step","stride","sun","surge","top","topple","vale","water","whistle","willow","wind","wood","woods"],
                pattern: 'simple'
            },
            // GNOME - Pattern: male=nm1+nm2, female=nm3+nm4, surname=nm13+nm14
            'gnome': {
                nm1: ["Al","Ari","Bil","Bri","Cal","Cor","Dav","Dor","Eni","Er","Far","Fel","Ga","Gra","His","Hor","Ian","Ipa","Je","Jor","Kas","Kel","Lan","Lo","Man","Mer","Nes","Ni","Or","Oru","Pana","Po","Qua","Quo","Ras","Ron","Sa","Sal","Sin","Tan","To","Tra","Um","Uri","Val","Vor","War","Wil","Wre","Xal","Xo","Ye","Yos","Zan","Zil"],
                nm2: ["bar","ben","bis","corin","cryn","don","dri","fan","fiz","gim","grim","hik","him","ji","jin","kas","kur","len","lin","min","mop","morn","nan","ner","ni","pip","pos","rick","ros","rug","ryn","ser","ston","tix","tor","ver","vyn","win","wor","xif","xim","ybar","yur","ziver","zu"],
                nm3: ["Alu","Ari","Ban","Bree","Car","Cel","Daphi","Do","Eili","El","Fae","Fen","Fol","Gal","Gren","Hel","Hes","Ina","Iso","Jel","Jo","Klo","Kri","Lil","Lori","Min","My","Ni","Ny","Oda","Or","Phi","Pri","Qi","Que","Re","Rosi","Sa","Sel","Spi","Ta","Tifa","Tri","Ufe","Uri","Ven","Vo","Wel","Wro","Xa","Xyro","Ylo","Yo","Zani","Zin"],
                nm4: ["bi","bys","celi","ci","dira","dysa","fi","fyx","gani","gyra","hana","hani","kasys","kini","la","li","lin","lys","mila","miphi","myn","myra","na","niana","noa","nove","phina","pine","qaryn","qys","rhana","roe","sany","ssa","sys","tina","tra","wyn","wyse","xi","xis","yaris","yore","za","zyre"],
                nm13: ["babble","baffle","bellow","belly","berry","billow","bold","boon","brass","brisk","broad","bronze","cobble","copper","dapple","dark","dazzle","deep","fapple","fiddle","fine","fizzle","flicker","fluke","glitter","gobble","gold","iron","kind","last","light","long","loud","lucky","marble","pale","pebble","puddle","quick","quiet","quill","shadow","short","silver","single","sparkle","spring","squiggle","stark","stout","strong","swift","thistle","thunder","tinker","toggle","tossle","true","twin","twist","waggle","whistle","wiggle","wild","wobble"],
                nm14: ["back","badge","belch","bell","belt","bit","block","bonk","boot","boots","bottom","braid","branch","brand","case","cheek","cloak","collar","cord","craft","crag","diggles","drop","dust","dwadle","fall","feast","fen","fern","field","firn","flight","flow","front","gem","gift","grace","guard","hand","heart","helm","hide","hold","kind","ligt","lob","mane","mantle","mask","patch","peak","pitch","pocket","reach","rest","river","rock","shield","song","span","spark","spell","spring","stamp","stand","stitch","stone","thread","top","trick","twist","wander"],
                pattern: 'simple'
            },
            // DRAGONBORN - Pattern: male=nm1+nm2, female=nm3+nm4, clan=procedural
            'dragonborn': {
                nm1: ["Ali","Ar","Ba","Bal","Bel","Bha","Bren","Caer","Calu","Dur","Do","Dra","Era","Faer","Fro","Gre","Ghe","Gora","He","Hi","Ior","Jin","Jar","Kil","Kriv","Lor","Lumi","Mar","Mor","Med","Nar","Nes","Na","Oti","Orla","Pri","Pa","Qel","Ravo","Ras","Rho","Sa","Sha","Sul","Taz","To","Trou","Udo","Uro","Vor","Vyu","Vrak","Wor","Wu","Wra","Wul","Xar","Yor","Zor","Zra"],
                nm2: ["barum","bor","broth","ciar","crath","daar","dhall","dorim","farn","fras","gar","ghull","grax","hadur","hazar","jhan","jurn","kax","kris","kul","lasar","lin","mash","morn","naar","prax","qiroth","qrin","qull","rakas","rash","rinn","roth","sashi","seth","skan","trin","turim","varax","vroth","vull","warum","wunax","xan","xiros","yax","ythas","zavur","zire","ziros"],
                nm3: ["Ari","A","Bi","Bel","Cris","Ca","Drys","Da","Erli","Esh","Fae","Fen","Gur","Gri","Hin","Ha","Irly","Irie","Jes","Jo","Ka","Kel","Ko","Lilo","Lora","Mal","Mi","Na","Nes","Nys","Ori","O","Ophi","Phi","Per","Qi","Quil","Rai","Rashi","So","Su","Tha","Ther","Uri","Ushi","Val","Vyra","Welsi","Wra","Xy","Xis","Ya","Yr","Zen","Zof"],
                nm4: ["birith","bis","bith","coria","cys","dalynn","drish","drith","faeth","fyire","gil","gissa","gwen","hime","hymm","karyn","kira","larys","liann","lyassa","meila","myse","norae","nys","patys","pora","qorel","qwen","rann","riel","rina","rinn","rish","rith","saadi","shann","sira","thibra","thyra","vayla","vyre","vys","wophyl","wyn","xiris","xora","yassa","yries","zita","zys"],
                pattern: 'simple'
            },
            // TIEFLING - Pattern: male=nm1+nm2, female=nm4+nm5, virtue=nm3
            'tiefling': {
                nm1: ["Aet","Ak","Am","Aran","And","Ar","Ark","Bar","Car","Cas","Dam","Dhar","Eb","Ek","Er","Gar","Gu","Gue","Hor","Ia","Ka","Kai","Kar","Kil","Kos","Ky","Loke","Mal","Male","Mav","Me","Mor","Neph","Oz","Ral","Re","Rol","Sal","Sha","Sir","Ska","The","Thy","Thyne","Ur","Uri","Val","Xar","Zar","Zer","Zher","Zor"],
                nm2: ["adius","akas","akos","char","cis","cius","dos","emon","ichar","il","ilius","ira","lech","lius","lyre","marir","menos","meros","mir","mong","mos","mus","non","rai","rakas","rakir","reus","rias","ris","rius","ron","ros","rus","rut","shoon","thor","thos","thus","us","venom","vir","vius","xes","xik","xikas","xire","xius","xus","zer","zire"],
                nm3: ["Achievement","Adventure","Aid","Ambition","Anguish","Art","Ashes","Atonement","Awe","Bliss","Bright","Carrion","Chant","Cheer","Cherish","Comfort","Compassion","Confidence","Content","Courage","Creed","Cunning","Darkness","Death","Deceit","Delight","Desire","Despair","Devotion","Doom","Doubt","Dread","Ecstasy","End","Entropy","Esteem","Eternal","Euphoria","Excellence","Faith","Fear","Free","Freedom","Fresh","Gentle","Gladness","Glee","Gloom","Glory","Grief","Happiness","Happy","Harmony","Hate","Hero","Hope","Horror","Hunt","Hymn","Ideal","Immortal","Innovation","Journey","Joy","Laughter","Life","Light","Love","Loyal","Lust","Mantra","Master","Mayhem","Misery","Mockery","Murder","Muse","Music","Mystery","Pain","Panic","Passion","Perfect","Piety","Pleasure","Poetry","Promise","Psalm","Pure","Quest","Redemption","Respect","Reverence","Sadness","Silence","Song","Sorrow","Suffering","Temerity","Terror","Torment","Tragedy","Trouble","Trust","Truth","Vice","Virtue","Void","Voyage","Weary","Wit","Woe"],
                nm4: ["Af","Agne","Ani","Ara","Ari","Aria","Bel","Bri","Cre","Da","Di","Dim","Dor","Ea","Fri","Gri","His","In","Ini","Kal","Le","Lev","Lil","Ma","Mar","Mis","Mith","Na","Nat","Ne","Neth","Nith","Ori","Pes","Phe","Qu","Ri","Ro","Sa","Sar","Seiri","Sha","Val","Vel","Ya","Yora","Yu","Za","Zai","Ze"],
                nm5: ["bis","borys","cria","cyra","dani","doris","faris","firith","goria","grea","hala","hiri","karia","ki","laia","lia","lies","lista","lith","loth","lypsis","lyvia","maia","meia","mine","narei","nirith","nise","phi","pione","punith","qine","rali","rissa","seis","solis","spira","tari","tish","uphis","vari","vine","wala","wure","xibis","xori","yis","yola","za","zes"],
                pattern: 'tiefling'
            },
            // HALF-ORC - Pattern: male=nm1+nm2+nm3 (3-part), female=nm4+nm5+nm6 (3-part)
            'half-orc': {
                nm1: ["Ag","Agg","Ar","Arn","As","At","Atr","B","Bar","Bel","Bor","Br","Brak","C","Cr","D","Dor","Dr","Dur","G","Gal","Gan","Gar","Gna","Gor","Got","Gr","Gram","Grim","Grom","Grum","Gul","H","Hag","Han","Har","Hog","Hon","Hor","Hun","Hur","K","Kal","Kam","Kar","Kel","Kil","Kom","Kor","Kra","Kru","Kul","Kur","Lum","M","Mag","Mahl","Mak","Mal","Mar","Mog","Mok","Mor","Mug","Muk","Mura","N","Oggu","Ogu","Ok","Oll","Or","Rek","Ren","Ron","Rona","S","Sar","Sor","T","Tan","Th","Thar","Ther","Thr","Thur","Trak","Truk","Ug","Uk","Ukr","Ull","Ur","Urth","Urtr","Z","Za","Zar","Zas","Zav","Zev","Zor","Zur","Zus"],
                nm2: ["a","a","a","o","o","e","i","u","u","u"],
                nm3: ["bak","bar","bark","bash","bur","burk","d","dak","dall","dar","dark","dash","dim","dur","durk","g","gak","gall","gar","gark","gash","glar","gul","gur","m","mak","mar","marsh","mash","mir","mur","n","nar","nars","nur","rak","rall","rash","rim","rimm","rk","rsh","rth","ruk","sk","tar","tir","tur","z","zall","zar","zur"],
                nm4: ["Al","Ar","Br","Ek","El","Fal","Fel","Fol","Ful","G","Gaj","Gar","Gij","Gor","Gr","Gry","Gyn","Hur","K","Kar","Kat","Ker","Ket","Kir","Kot","Kur","Kut","Lag","M","Mer","Mir","Mor","N","Ol","Oot","Puy","R","Rah","Rahk","Ras","Rash","Raw","Roh","Rohk","S","Sam","San","Sem","Sen","Sh","Shay","Sin","Sum","Sun","Tam","Tem","Tu","Tum","Ub","Um","Ur","Van","Zan","Zen","Zon","Zun"],
                nm5: ["a","a","o","o","e","i","i","u"],
                nm6: ["d","da","dar","dur","g","gar","gh","gri","gu","sh","sha","shi","gum","gume","gur","ki","mar","mi","mira","me","mur","ne","ner","nir","nar","nchu","ni","nur","ral","rel","ri","rook","ti","tah","tir","tar","tur","war","z","zar","zara","zi","zur","zura","zira"],
                pattern: 'halforc'
            },
            // GOLIATH - Full pattern with nickname
            'goliath': {
                nmMF: ["Ag","Apa","Ar","Au","Aug","Aur","Eag","Eg","Erg","Ga","Gau","Gea","Gha","Gra","Ila","Ili","Ira","Kana","Kava","Kaza","Keo","Khu","Kora","Kra","La","Lau","Laza","Loro","Ma","Mara","Mau","Mea","Mo","Na","Nara","Nau","Neo","Pa","Pu","Tara","Tau","Tha","Thava","Tho","Va","Vara","Vau","Vaura","Vega","Vi","Vo","Za","Zau"],
                nmML: ["dak","dath","dhan","gak","gal","gan","gath","ghan","gith","glath","gun","kan","kein","khal","kin","kon","lath","lig","lok","mahg","mahk","mahl","mak","man","mith","mul","nak","nath","nihl","noth","path","phak","rad","rath","rein","rhak","rhan","riak","rian","rin","rok","roth","thag","thak","tham","thi","thok","veith","vek","vhal","vhik","vith","voi","zak","ziath"],
                nmFF: ["Age","Ane","Are","Daa","Dau","Di","Ga","Gal","Gau","Ge","Gel","Ila","Ina","Ka","Kau","Ke","Ki","Kuo","La","Lau","Le","Lo","Maa","Man","Mau","Me","Na","Nal","Nau","Ni","No","Ola","One","Ore","Ori","Pa","Paa","Pau","Pe","Tha","Thau","The","Thu","Vaa","Vau","Ve","Vo","Vu","Za","Zaa","Zau","Zo"],
                nmFL: ["gea","geo","ggeo","ghu","gia","gu","kea","keo","kha","ki","kia","kio","kko","la","lai","lane","lea","leo","lo","lu","ma","meo","mi","mia","ne","nea","neo","ni","nia","nna","nnio","nu","peo","peu","pu","rea","rheo","ri","ria","rra","rrea","the","thea","thi","thia","thio","thu","vea","vi","via","vu"],
                nmMdF: ["Adept","Bear","Brave","Bright","Dawn","Day","Deer","Dream","Flint","Fearless","Flower","Food","Fright","Goat","Hard","Hide","High","Honest","Horn","Keen","Lone","Long","Low","Lumber","Master","Mind","Mountain","Night","Rain","River","Rock","Root","Silent","Sky","Sly","Smart","Steady","Stone","Storm","Strong","Swift","Thread","Thunder","Tree","Tribe","True","Truth","Wander","Wild","Wise","Wound"],
                nmMdL: ["aid","bearer","breaker","caller","carver","chaser","climber","cook","dream","drifter","eye","finder","fist","friend","frightener","guard","hand","hauler","heart","herder","hunter","jumper","killer","lander","leader","leaper","logger","maker","mender","picker","runner","shot","smasher","speaker","stalker","striker","tanner","twister","vigor","walker","wanderer","warrior","watcher","weaver","worker"],
                nmSF: ["Agu-Ul","Agu-V","Anakal","Apuna-M","Athun","Egena-V","Egum","Elan","Ganu-M","Gathak","Gean","Inul","Kalag","Kaluk","Katho-Ol","Kolae-G","Kolak","Kulan","Kulum","Lakum","Maluk","Munak","Muthal","Nalak","Nola-K","Nugal","Nulak","Ogol","Oveth","Thenal","Thul","Thunuk","Ugun","Uthenu-K","Vaimei-L","Valu-N","Vathun","Veom","Vuma-Th","Vunak"],
                nmSL: ["aga","ageane","akane","akanu","akume","alathi","amino","amune","anathi","atake","athai","athala","atho","avea","avi","avone","eaku","ekali","elo","iaga","iago","iala","iano","igala","igane","igano","igo","igone","ileana","ithino","olake","ugate","ugoni","ukane","ukate","ukena","ulane","upine","utha","uthea"],
                pattern: 'goliath'
            },
            // AARAKOCRA - Genderless pattern
            'aarakocra': {
                nm1: ["","","","","","c","cl","cr","d","g","gr","h","k","kh","kl","kr","q","qh","ql","qr","r","rh","s","y","z"],
                nm2: ["a","e","i","u","a","e","i","u","a","e","i","u","a","e","i","u","a","e","i","u","a","e","i","u","a","e","i","u","ae","aia","ee","oo","ou","ua","uie"],
                nm3: ["c","cc","k","kk","l","ll","q","r","rr"],
                nm4: ["a","e","i","a","e","i","a","e","i","a","e","i","a","e","i","aa","ea","ee","ia","ie"],
                nm5: ["","","","","c","ck","d","f","g","hk","k","l","r","rr","rc","rk","rrk","s","ss"],
                pattern: 'aarakocra'
            },
            // GENASI - Element-based full names
            'genasi': {
                fire: ["Ablaze","Alight","Ardor","Arson","Ash","Beacon","Blaze","Burn","Cinder","Coal","Ember","Flame","Flare","Flash","Forge","Furnace","Heat","Ignite","Inferno","Kindle","Magma","Pyre","Scorch","Sear","Singe","Smoke","Spark","Torch"],
                water: ["Aqua","Azure","Brook","Creek","Current","Dew","Drip","Flood","Flow","Fountain","Geyser","Lake","Mist","Ocean","Pond","Pool","Rain","River","Sea","Splash","Spring","Stream","Surge","Tide","Torrent","Wave","Well"],
                earth: ["Adamant","Agate","Basalt","Boulder","Brick","Clay","Cliff","Cobble","Crag","Crystal","Diamond","Flint","Fossil","Garnet","Gem","Granite","Gravel","Jade","Marble","Mountain","Obsidian","Onyx","Opal","Ore","Pebble","Quartz","Rock","Ruby","Sand","Slate","Stone"],
                air: ["Aerate","Air","Breeze","Breath","Cloud","Cyclone","Draft","Drift","Float","Flutter","Gale","Gust","Heaven","Hover","Hurricane","Lift","Mist","Sky","Soar","Storm","Tempest","Tornado","Twister","Waft","Whisper","Whirl","Wind","Zephyr"],
                pattern: 'genasi'
            },
            // TRITON - male ends in 's', female ends in 'yn', surname ends in 'ath'
            'triton': {
                nm1: ["c","d","dh","j","jh","k","kh","m","n","r","v","z"],
                nm2: ["a","e","i","o","u"],
                nm3: ["d","dd","g","gl","hn","hl","hr","l","lg","lm","ld","ln","lz","m","mn","mr","n","nn","nd","nl","nr","nv","r","rl","rn","rv","rz","v","vn","z"],
                nm4: ["","","","","","","","","b","bh","d","dh","f","fl","h","l","m","n","s","sh","vl","w","wh","y"],
                nm5: ["a","e","o","u","a","e","o","u","i"],
                nm6: ["d","dd","dr","gr","gl","hl","hn","l","lr","lt","lth","ml","nl","nth","nr","r","rn","rl","rr","s","sh","st","sl","sn","t","th","tr","thr","tl","thl"],
                nm7: ["d","h","l","m","n","r"],
                nm8: ["e","y","y","y","y","y","y"],
                nm9: ["","","","b","bh","d","dh","j","g","l","m","n","p","r","s","v","z"],
                nm10: ["a","u","a","u","a","u","e","o"],
                nm11: ["b","d","g","gh","hl","hn","hm","hr","l","n","m","r","v"],
                nm12: ["a","o","a","o","e","u"],
                nm13: ["d","g","l","ll","ln","lm","lv","m","mn","n","ns","nz","r","rs","s","sn","x","z"],
                pattern: 'triton'
            },
            // KENKU - Sound-based full names
            'kenku': {
                actions: ["Angler","Baker","Barker","Basher","Biter","Buzzer","Cackler","Carver","Chirper","Chomper","Chopper","Clanger","Clapper","Cleaver","Clicker","Cutter","Digger","Drummer","Forger","Gnasher","Gnawer","Grinder","Growler","Hammer","Hummer","Knocker","Masher","Nibbler","Piper","Rattler","Ripper","Roarer","Rustler","Scratcher","Shrieker","Singer","Smasher","Snapper","Stomper","Striker","Sweeper","Tinkerer","Whistler"],
                animals: ["Bat Screech","Bear Growl","Bee Buzzer","Cat Purr","Crow Call","Dog Bark","Duck Quacker","Eagle Screech","Fox Yelp","Frog Croak","Goat Bleat","Hawk Cry","Horse Neigh","Lion Roar","Monkey Howl","Mouse Squeak","Owl Hoot","Parrot Squawk","Rat Squeak","Raven Caw","Seal Bark","Snake Hiss","Swan Honk","Wolf Howl"],
                objects: ["Anchor Chain","Bell Ring","Book Slam","Cork Pop","Fire Crackle","Glass Shatter","Hammer Crash","Kettle Bubble","Lute Pluck","Net Splash","Page Turn","Rope Slap","Saw Pull","Ship Creak","Steel Clank","Wood Crack"],
                pattern: 'kenku'
            },
            // WARFORGED - Full name list
            'warforged': {
                names: ["Abider","Achiever","Actor","Adapter","Aegis","Agent","Basher","Bastion","Battler","Beast","Blade","Book","Bouncer","Brain","Brawler","Breaker","Bruiser","Builder","Bulwark","Cannon","Carver","Caster","Catcher","Champion","Charger","Chaser","Cleaver","Climber","Clock","Commander","Counter","Creator","Crusher","Cutter","Dagger","Dealer","Defender","Destroyer","Diver","Dozer","Dreamer","Drifter","Driver","Drone","Echo","Edge","Eraser","Expert","Fighter","Flail","Flame","Forger","Friend","Ghost","Giant","Gift","Glaive","Grinder","Guardian","Guide","Hammer","Handler","Heart","Hunter","Iron","Judge","Killer","Knife","Lurker","Mace","Marker","Mauler","Menace","Mentor","Metal","Mime","Nameless","Needle","One","Patriot","Pilot","Probe","Protector","Prowler","Ravager","Reader","Render","Rider","Saber","Salvager","Savior","Scorcher","Searcher","Seeker","Sentinel","Sentry","Servant","Shaper","Shield","Slasher","Slicer","Smasher","Smiter","Spark","Spirit","Sprinter","Stalker","Steel","Striker","Sword","Tackler","Teacher","Tester","Thinker","Thunder","Tinkerer","Titan","Tracker","Two","Unit","Victor","Walker","Ward","Warden","Watcher","Wielder","Winner","Wrestler","Zealot","Zero"],
                pattern: 'warforged'
            },
            // TABAXI - Phrase names with nickname
            'tabaxi': {
                phrases: ["Afternoon Nap","Bird Feather","Blazing Fire","Breath of Fresh Air","Burning Fire","Call of the Owl","Cloud in the Sky","Crescent Moon","Dew on the Grass","Dream of Days","Drifting Cloud","Drop in a Pond","Fallen Twig","Feather in the Wind","Fire in the Distance","Flame of Passion","Flower in the Field","Glow of the Sun","Leaf on the Water","Light in the Morning","Lightning After Thunder","Mist in the Morning","Mountain Boulder","Night of Dreams","Rain in Summer","Rainbow After Rain","Rays of the Sun","Shadow of a Star","Sky Full of Stars","Snow of the Mountain","Spark of Life","Star in the Morning","Storm at Sea","Tale of Wonder","Thunder in the Morning","Tree in the Woods","Wave on the Shore","Wing of an Angel","Winter Breath","Wish Upon a Star"],
                adjectives: ["Active","Agile","Ancient","Bold","Brave","Bright","Bronze","Clever","Curious","Eager","Elegant","Emerald","Free","Golden","Grand","Happy","Hidden","Jade","Jolly","Kind","Lazy","Little","Lone","Lost","Lucky","Magic","Mellow","Merry","Misty","Nimble","Odd","Proud","Pure","Quick","Quiet","Rare","Ruby","Secret","Serene","Shady","Silent","Single","Smooth","Stout","Sweet","Swift","True","Twin","Velvet","Vibrant","Wild"],
                nouns: ["Animal","Bear","Beast","Beetle","Berry","Bird","Bite","Bone","Book","Branch","Breath","Brush","Button","Cake","Candle","Card","Chain","Chalk","Claw","Cloud","Clover","Deer","Dream","Dust","Fang","Feather","Fire","Fish","Flame","Flower","Frog","Gem","Gift","Grass","Heart","Honey","Ice","Ink","Jewel","Kite","Leaf","Light","Lock","Luck","Marble","Mark","Mask","Mirror","Needle","Night","Owl","Patch","Peak","Piece","Quill","Rain","River","Rock","Scale","Scarf","Scratch","Shadow","Shell","Smoke","Snow","Song","Spark","Star","Stitch","Stone","Storm","Stream","Stripe","Tale","Thrill","Thunder","Timber","Trail","Tree","Trick","Veil","Wave","Wind","Wing","Wish"],
                pattern: 'tabaxi'
            },
            // ORC - Pattern with epithet
            'orc': {
                nm1: ["","","","b","bh","br","d","dh","dr","g","gh","gr","j","l","m","n","r","rh","sh","z","zh"],
                nm2: ["a","o","u"],
                nm3: ["b","br","bz","d","dd","dz","dg","dr","g","gg","gr","gz","gv","hr","hz","j","kr","kz","m","mz","mv","n","ng","nd","nz","r","rt","rz","rd","rl","rz","t","tr","v","vr","z","zz"],
                nm4: ["b","d","g","g","k","k","kk","kk","l","ll","n","r"],
                nm5: ["","","","","b","bh","d","dh","g","gh","h","k","m","n","r","rh","s","sh","v","z"],
                nm6: ["a","e","i","o","u","a","e","i","o","u","a","e","i","o","u","ee","au","ye","ie","aa","ou","ua","ao"],
                nm7: ["d","dd","dk","dg","dv","g","gg","gn","gv","gz","l","ll","lv","lz","m","md","mz","mv","ng","nk","ns","nz","t","thr","th","v","vn","vr","vg","vd","wnk","wg","wn"],
                nm8: ["","","","","","f","h","k","l","m","n","ng","v","z"],
                epithets: ["The Aberrant","The Ancient","The Angry","The Barbaric","The Berserk","The Bitter","The Bloody","The Brutal","The Cold","The Crooked","The Cruel","The Dark","The Defiant","The Disfigured","The Enraged","The Fearless","The Fierce","The Forsaken","The Grim","The Gruesome","The Lethal","The Lost","The Loyal","The Mad","The Merciless","The Mighty","The Powerful","The Proud","The Reckless","The Ruthless","The Shady","The Silent","The Simple","The Smug","The Spiteful","The Swift","The Vengeful","The Vicious","The Violent","The Wicked","The Wild","The Wrathful"],
                pattern: 'orc'
            },
            // GITHZERAI - Pattern: male=nm1+nm2, female=nm3+nm4
            'githzerai': {
                nm1: ["Am","Ar","Ara","Aza","Bar","Bra","Bran","Bru","Da","Dar","Dor","Dra","Dro","Du","Duu","Fa","Far","Fe","Fer","Fur","Gan","Gra","Gran","Gre","Gro","Gru","Hra","Hu","Ka","Kar","Kha","Kra","Kro","Ma","Mar","Mu","Muu","Na","Nar","Nir","Nu","On","Or","Ora","Oro","Ra","Ran","Rhu","Rin","Ru","Sa","Sha","Shra","Sra","Un","Una","Ur","Ura","Xa","Xha","Xo","Zar","Zra"],
                nm2: ["d","dahn","dak","dar","dh","dran","gahr","gh","gor","k","kh","kahr","kar","khar","kiak","kk","kran","lag","lahr","lian","lid","lis","lla","llak","loth","mag","mak","miak","mir","nag","nak","niar","nod","rad","rag","rak","ram","rath","rek","rg","rm","rra","rth","ruk","rzth","tar","th","tig","zad","zag","zak","zar","zeg","zirg","zth"],
                nm3: ["Ad","Alm","Ar","Arw","Ash","Dah","Dhar","Dolm","Dran","El","Ell","Erzh","Esz","Ezh","Genr","Grel","Grin","Halm","Han","Harn","Heln","Ihr","Iln","Imm","Immil","Iz","Jan","Kan","Kharm","Khaz","Krez","Laz","Lez","Lhash","Lir","Lor","Magd","Marm","Meir","Mir","Nagr","Nah","Nalm","Nash","Niar","Ohn","Or","Rasz","Rez","Sham","Sharm","Shund","Sil","Um","Ur","Uw","Vith"],
                nm4: ["a","ah","aka","al","alin","alla","ane","anith","anya","arah","arin","aya","ayah","ayis","eah","eka","ekus","el","ela","elna","elya","elzal","ena","enah","era","erah","erath","erra","eth","eya","ihn","ila","ilias","ilzin","in","ina","ines","ira","iren","iris","ith","iza","la","mina","mira","nara","nel","nera","nia","niya","ra","ya","yara","zin"],
                pattern: 'simple'
            },
            // LIZARDFOLK - Pattern: procedural + draconic names
            'lizardfolk': {
                nm1: ["","","","","","b","d","g","jh","k","l","m","n","r","s","sh","t","tr","th","thr","v"],
                nm2: ["a","e","i","o","u","a","e","i","o","u","aa","ae","ao","au"],
                nm3: ["ch","d","dr","dh","g","gr","gh","gg","l","ll","lt","lth","lr","p","r","rg","rht","rk","rt","rd","rth","sh","sk","shr","sl","t","th","tr","thr"],
                nm4: ["a","e","i","o","u","y","a","e","i","o","u","y","ea","ua","ae","ia","aa","ao"],
                nm5: ["c","g","gr","gn","k","kh","kr","r","rr","s","ss","sr","st","str","t","th","tr"],
                nm6: ["","","","","","","","ch","k","n","nd","nk","nt","r","rd","rk","rt","rth","s","ss","sh","sj","sk","t","th","v","x"],
                draconic: ["Achiever","Adventure","Air","Anger","Animal","Armor","Art","Axe","Badge","Balance","Battle","Beast","Bite","Blade","Blood","Bone","Brain","Brave","Breath","Cave","Chain","Chaos","Chest","Choice","Clever","Cloud","Courage","Dark","Demon","Desire","Diamond","Dragon","Dream","Earth","Edge","Eye","Faith","Fall","Family","Fang","Fear","Fight","Fire","Flame","Flight","Force","Fortune","Freedom","Friend","Gem","Ghost","Gold","Green","Guide","Hammer","Harmony","Hate","Heart","Honor","Horn","Ice","Iron","Journey","Justice","Knowledge","Life","Light","Love","Luck","Marble","Mark","Mask","Memory","Mercy","Might","Miracle","Mist","Moon","Mountain","Muscle","Night","Omen","Patience","Power","Pride","Promise","Rain","Reason","Red","Respect","Ring","Risk","Rose","Scale","Secret","Shadow","Shell","Shock","Signal","Silver","Skill","Sky","Sleep","Smoke","Snow","Song","Spark","Spell","Spider","Spirit","Steel","Stone","Storm","Strength","Strike","Talent","Thunder","Tool","Travel","Trick","Trust","Truth","Victory","Voice","War","Watch","Wave","Wealth","Wisdom","Wish","Wonder","Wrath"],
                pattern: 'lizardfolk'
            }
        };

        // Dynamic name generation functions
        function capitalize(str) {
            if (!str) return '';
            return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
        }

        function generateSimpleName(fragments, type) {
            let prefix, suffix;
            if (type === 'male') {
                prefix = randomChoice(fragments.nm1);
                suffix = randomChoice(fragments.nm2);
            } else if (type === 'female') {
                suffix = randomChoice(fragments.nm4);
                if (fragments.nm3) {
                    prefix = randomChoice(fragments.nm3);
                } else {
                    prefix = randomChoice(fragments.nm1);
                }
            } else if (type === 'clan' || type === 'surname') {
                if (fragments.nm12 && fragments.nm13) {
                    prefix = randomChoice(fragments.nm12);
                    suffix = randomChoice(fragments.nm13);
                } else if (fragments.nm13 && fragments.nm14) {
                    prefix = randomChoice(fragments.nm13);
                    suffix = randomChoice(fragments.nm14);
                } else {
                    return null;
                }
            }
            return capitalize(prefix + suffix);
        }

        function generateHalfOrcName(fragments, gender) {
            if (gender === 'male') {
                return capitalize(randomChoice(fragments.nm1) + randomChoice(fragments.nm2) + randomChoice(fragments.nm3));
            } else {
                return capitalize(randomChoice(fragments.nm4) + randomChoice(fragments.nm5) + randomChoice(fragments.nm6));
            }
        }

        function generateGoliathName(fragments, gender) {
            let firstName, nickname, clanName;
            if (gender === 'male') {
                firstName = capitalize(randomChoice(fragments.nmMF) + randomChoice(fragments.nmML));
            } else {
                firstName = capitalize(randomChoice(fragments.nmFF) + randomChoice(fragments.nmFL));
            }
            nickname = capitalize(randomChoice(fragments.nmMdF) + randomChoice(fragments.nmMdL));
            clanName = capitalize(randomChoice(fragments.nmSF) + randomChoice(fragments.nmSL));
            return firstName;
        }

        function generateGoliathSurname(fragments) {
            const nickname = capitalize(randomChoice(fragments.nmMdF) + randomChoice(fragments.nmMdL));
            const clanName = capitalize(randomChoice(fragments.nmSF) + randomChoice(fragments.nmSL));
            return nickname + ' ' + clanName;
        }

        function generateAarakocraName(fragments) {
            const useShort = Math.random() < 0.5;
            if (useShort) {
                return capitalize(randomChoice(fragments.nm1) + randomChoice(fragments.nm2) + randomChoice(fragments.nm5));
            } else {
                return capitalize(randomChoice(fragments.nm1) + randomChoice(fragments.nm2) + randomChoice(fragments.nm3) + randomChoice(fragments.nm4) + randomChoice(fragments.nm5));
            }
        }

        function generateTieflingName(fragments, gender) {
            if (gender === 'male') {
                return capitalize(randomChoice(fragments.nm1) + randomChoice(fragments.nm2));
            } else {
                return capitalize(randomChoice(fragments.nm4) + randomChoice(fragments.nm5));
            }
        }

        function generateTieflingVirtue(fragments) {
            return randomChoice(fragments.nm3);
        }

        function generateGenasiName(fragments) {
            const elements = ['fire', 'water', 'earth', 'air'];
            const element = randomChoice(elements);
            return randomChoice(fragments[element]);
        }

        function generateTritonName(fragments, gender) {
            if (gender === 'male') {
                const name = randomChoice(fragments.nm1) + randomChoice(fragments.nm2) + randomChoice(fragments.nm3) + randomChoice(fragments.nm2) + 's';
                return capitalize(name);
            } else {
                const name = randomChoice(fragments.nm4) + randomChoice(fragments.nm5) + randomChoice(fragments.nm6) + randomChoice(fragments.nm8) + 'n';
                return capitalize(name);
            }
        }

        function generateTritonSurname(fragments) {
            const name = randomChoice(fragments.nm9) + randomChoice(fragments.nm10) + randomChoice(fragments.nm11) + randomChoice(fragments.nm12) + randomChoice(fragments.nm13) + 'ath';
            return capitalize(name);
        }

        function generateKenkuName(fragments) {
            const type = Math.floor(Math.random() * 3);
            if (type === 0) {
                return randomChoice(fragments.actions);
            } else if (type === 1) {
                return randomChoice(fragments.animals);
            } else {
                return randomChoice(fragments.objects);
            }
        }

        function generateTabaxiName(fragments) {
            const usePhrase = Math.random() < 0.5;
            if (usePhrase) {
                const phrase = randomChoice(fragments.phrases);
                const words = phrase.split(' ');
                const nickname = words[words.length - 1];
                return phrase + ' (' + nickname + ')';
            } else {
                const adj = randomChoice(fragments.adjectives);
                const noun = randomChoice(fragments.nouns);
                const nickname = Math.random() < 0.5 ? adj : noun;
                return adj + ' ' + noun + ' (' + nickname + ')';
            }
        }

        function generateOrcName(fragments, gender) {
            if (gender === 'male') {
                const useShort = Math.random() < 0.4;
                if (useShort) {
                    return capitalize(randomChoice(fragments.nm1) + randomChoice(fragments.nm2) + randomChoice(fragments.nm4));
                } else {
                    return capitalize(randomChoice(fragments.nm1) + randomChoice(fragments.nm2) + randomChoice(fragments.nm3) + randomChoice(fragments.nm2) + randomChoice(fragments.nm4));
                }
            } else {
                const useShort = Math.random() < 0.4;
                if (useShort) {
                    return capitalize(randomChoice(fragments.nm5) + randomChoice(fragments.nm6) + randomChoice(fragments.nm8));
                } else {
                    return capitalize(randomChoice(fragments.nm5) + randomChoice(fragments.nm6) + randomChoice(fragments.nm7) + randomChoice(fragments.nm6) + randomChoice(fragments.nm8));
                }
            }
        }

        function generateOrcEpithet(fragments) {
            return randomChoice(fragments.epithets);
        }

        function generateLizardfolkName(fragments) {
            const useDraconic = Math.random() < 0.3;
            if (useDraconic) {
                return randomChoice(fragments.draconic);
            }
            const name = randomChoice(fragments.nm1) + randomChoice(fragments.nm2) + randomChoice(fragments.nm3) + randomChoice(fragments.nm4) + randomChoice(fragments.nm6);
            return capitalize(name);
        }

        // Main function to generate a name dynamically
        function generateDynamicName(race, gender) {
            const raceKey = race.toLowerCase();
            const fragments = raceNameFragments[raceKey];
            
            if (!fragments) return null;
            
            const genderToUse = gender === 'non-binary' ? randomChoice(['male', 'female']) : gender;
            
            switch (fragments.pattern) {
                case 'simple':
                    return generateSimpleName(fragments, genderToUse);
                case 'halforc':
                    return generateHalfOrcName(fragments, genderToUse);
                case 'goliath':
                    return generateGoliathName(fragments, genderToUse);
                case 'aarakocra':
                    return generateAarakocraName(fragments);
                case 'tiefling':
                    return generateTieflingName(fragments, genderToUse);
                case 'genasi':
                    return generateGenasiName(fragments);
                case 'triton':
                    return generateTritonName(fragments, genderToUse);
                case 'kenku':
                    return generateKenkuName(fragments);
                case 'warforged':
                    return randomChoice(fragments.names);
                case 'tabaxi':
                    return generateTabaxiName(fragments);
                case 'orc':
                    return generateOrcName(fragments, genderToUse);
                case 'lizardfolk':
                    return generateLizardfolkName(fragments);
                default:
                    return null;
            }
        }

        // Generate dynamic surname
        function generateDynamicSurname(race) {
            const raceKey = race.toLowerCase();
            const fragments = raceNameFragments[raceKey];
            
            if (!fragments) return null;
            
            switch (fragments.pattern) {
                case 'simple':
                    return generateSimpleName(fragments, 'clan');
                case 'goliath':
                    return generateGoliathSurname(fragments);
                case 'tiefling':
                    return generateTieflingVirtue(fragments);
                case 'triton':
                    return generateTritonSurname(fragments);
                case 'orc':
                    return generateOrcEpithet(fragments);
                default:
                    return null;
            }
        }

        // Function to get race-appropriate names
        function getRaceName(race, gender) {
            const raceKey = race.toLowerCase();
            
            // Try dynamic generation first for races with fragment data
            const dynamicName = generateDynamicName(race, gender);
            if (dynamicName) {
                return dynamicName;
            }
            
            // Handle non-binary by randomly choosing between male/female names
            if (gender === 'non-binary') {
                const genderChoice = randomChoice(['male', 'female']);
                if (raceNames[raceKey] && raceNames[raceKey][genderChoice]) {
                    return randomChoice(raceNames[raceKey][genderChoice]);
                }
            } else if (raceNames[raceKey] && raceNames[raceKey][gender]) {
                return randomChoice(raceNames[raceKey][gender]);
            }
            
            // Fallback to human names if race not found
            if (gender === 'non-binary') {
                const genderChoice = randomChoice(['male', 'female']);
                return randomChoice(raceNames.human[genderChoice] || raceNames.human.male);
            }
            return randomChoice(raceNames.human[gender] || raceNames.human.male);
        }

        // Function to get race-appropriate surname
        function getRaceSurname(race) {
            const raceKey = race.toLowerCase();
            
            // Try dynamic surname generation first
            const dynamicSurname = generateDynamicSurname(race);
            if (dynamicSurname) {
                return dynamicSurname;
            }
            
            // Fall back to static arrays
            if (raceNames[raceKey]) {
                if (raceNames[raceKey].clan) {
                    return randomChoice(raceNames[raceKey].clan);
                } else if (raceNames[raceKey].family) {
                    return randomChoice(raceNames[raceKey].family);
                } else if (raceNames[raceKey].virtue) {
                    return randomChoice(raceNames[raceKey].virtue);
                }
            }
            // Fallback to generic surnames
            return randomChoice(['Blackwood', 'Brightblade', 'Copperforge', 'Darkwater', 'Evergreen', 'Fireheart', 'Goldleaf', 'Ironhelm', 'Moonwhisper', 'Nightshade', 'Oakenshield', 'Ravencrest', 'Silverhand', 'Stormwind', 'Thornweaver', 'Vale', 'Whitestone', 'Windrider', 'Woodhaven', 'Stonebridge']);
        }

        const alignments = ['lawful good', 'neutral good', 'chaotic good', 'lawful neutral', 'true neutral', 'chaotic neutral', 'lawful evil', 'neutral evil', 'chaotic evil'];

        // Ability score names
        const abilityNames = {
            str: 'Strength',
            dex: 'Dexterity',
            con: 'Constitution',
            int: 'Intelligence',
            wis: 'Wisdom',
            cha: 'Charisma'
        };

        // Map skills to their associated ability scores
        const skillAbilities = {
            'Acrobatics': 'dex',
            'Animal Handling': 'wis',
            'Arcana': 'int',
            'Athletics': 'str',
            'Deception': 'cha',
            'History': 'int',
            'Insight': 'wis',
            'Intimidation': 'cha',
            'Investigation': 'int',
            'Medicine': 'wis',
            'Nature': 'int',
            'Perception': 'wis',
            'Performance': 'cha',
            'Persuasion': 'cha',
            'Religion': 'int',
            'Sleight of Hand': 'dex',
            'Stealth': 'dex',
            'Survival': 'wis'
        };

        // Racial Trait Descriptions for Character Sheet Export
        const traitDescriptions = {
            // Flight abilities
            'Flight (50 ft)': 'You have a flying speed of 50 feet. To use this speed, you can\'t be wearing medium or heavy armor.',
            'Flight (30 ft)': 'You have a flying speed of 30 feet. To use this speed, you can\'t be wearing medium or heavy armor.',
            'Flight (equal to speed)': 'You have a flying speed equal to your walking speed. To use this speed, you can\'t be wearing medium or heavy armor.',
            
            // Darkvision variants
            'Darkvision 60 ft': 'You can see in dim light within 60 feet as if it were bright light, and in darkness as if it were dim light. You can\'t discern color in darkness, only shades of gray.',
            'Darkvision 120 ft': 'You can see in dim light within 120 feet as if it were bright light, and in darkness as if it were dim light. You can\'t discern color in darkness, only shades of gray.',
            'Superior Darkvision 120 ft': 'You can see in dim light within 120 feet as if it were bright light, and in darkness as if it were dim light. You can\'t discern color in darkness, only shades of gray.',
            
            // Natural weapons
            'Talons (1d4 slashing)': 'Your talons are natural weapons, which you can use to make unarmed strikes. If you hit with them, you deal slashing damage equal to 1d4 + your Strength modifier.',
            'Claws (1d4 slashing)': 'Your claws are natural weapons, which you can use to make unarmed strikes. If you hit with them, you deal slashing damage equal to 1d4 + your Strength modifier.',
            'Bite (1d6 piercing)': 'Your fanged maw is a natural weapon, which you can use to make unarmed strikes. If you hit with it, you deal piercing damage equal to 1d6 + your Strength modifier.',
            'Horns (1d6 piercing)': 'Your horns are natural weapons, which you can use to make unarmed strikes. If you hit with them, you deal piercing damage equal to 1d6 + your Strength modifier.',
            'Hooves (1d4+STR)': 'Your hooves are natural weapons, which you can use to make unarmed strikes. If you hit with them, you deal bludgeoning damage equal to 1d4 + your Strength modifier.',
            'Cat\'s Claws (1d4 slashing, climb 20 ft)': 'Your claws give you a climbing speed of 20 feet and are natural weapons dealing 1d4 + Strength modifier slashing damage on unarmed strikes.',
            
            // Resistances and immunities
            'Celestial Resistance (necrotic, radiant)': 'You have resistance to necrotic damage and radiant damage.',
            'Hellish Resistance (fire)': 'You have resistance to fire damage.',
            'Damage Resistance (draconic ancestry)': 'You have resistance to the damage type associated with your draconic ancestry.',
            'Poison Immunity': 'You are immune to poison damage and the poisoned condition.',
            'Natural Resilience (acid/poison)': 'You have resistance to acid and poison damage, and advantage on saving throws against being poisoned.',
            
            // Elf traits
            'Fey Ancestry': 'You have advantage on saving throws against being charmed, and magic can\'t put you to sleep.',
            'Keen Senses': 'You have proficiency in the Perception skill.',
            'Trance': 'You don\'t need to sleep. Instead, you meditate deeply for 4 hours a day. After resting this way, you gain the same benefit as 8 hours of sleep.',
            'Fey Step (teleport 30 ft)': 'As a bonus action, you can magically teleport up to 30 feet to an unoccupied space you can see. You can use this trait a number of times equal to your proficiency bonus, regaining all uses after a long rest.',
            
            // Dwarf traits
            'Dwarven Resilience (poison resistance)': 'You have advantage on saving throws against poison, and you have resistance against poison damage.',
            'Stonecunning': 'Whenever you make an Intelligence (History) check related to the origin of stonework, you are considered proficient and add double your proficiency bonus.',
            'Tool Proficiency': 'You gain proficiency with the artisan\'s tools of your choice: smith\'s tools, brewer\'s supplies, or mason\'s tools.',
            
            // Halfling traits
            'Lucky (reroll 1s)': 'When you roll a 1 on the d20 for an attack roll, ability check, or saving throw, you can reroll the die and must use the new roll.',
            'Brave': 'You have advantage on saving throws against being frightened.',
            'Halfling Nimbleness': 'You can move through the space of any creature that is of a size larger than yours.',
            
            // Gnome traits
            'Gnome Cunning (advantage vs magic INT/WIS/CHA saves)': 'You have advantage on all Intelligence, Wisdom, and Charisma saving throws against magic.',
            'Stone Camouflage': 'You have advantage on Dexterity (Stealth) checks to hide in rocky terrain.',
            
            // Dragonborn traits
            'Breath Weapon': 'You can use your action to exhale destructive energy. Your draconic ancestry determines the size, shape, and damage type of the exhalation. Each creature in the area must make a saving throw (DC = 8 + CON mod + proficiency). A creature takes 2d6 damage on a failed save, and half on a success. This increases to 3d6 at 6th level, 4d6 at 11th, and 5d6 at 16th.',
            
            // Tiefling traits
            'Infernal Legacy (Thaumaturgy, Hellish Rebuke, Darkness)': 'You know the Thaumaturgy cantrip. At 3rd level, you can cast Hellish Rebuke as a 2nd-level spell once per long rest. At 5th level, you can cast Darkness once per long rest. Charisma is your spellcasting ability.',
            
            // Half-orc traits
            'Menacing': 'You gain proficiency in the Intimidation skill.',
            'Relentless Endurance': 'When you are reduced to 0 hit points but not killed outright, you can drop to 1 hit point instead. You can\'t use this feature again until you finish a long rest.',
            'Savage Attacks': 'When you score a critical hit with a melee weapon attack, you can roll one of the weapon\'s damage dice one additional time and add it to the extra damage.',
            
            // Aasimar traits
            'Healing Hands': 'As an action, you can touch a creature and cause it to regain hit points equal to your level. Once you use this trait, you can\'t use it again until you finish a long rest.',
            'Light Bearer': 'You know the Light cantrip. Charisma is your spellcasting ability for it.',
            
            // Bugbear traits
            'Long-Limbed': 'When you make a melee attack on your turn, your reach for it is 5 feet greater than normal.',
            'Powerful Build': 'You count as one size larger when determining your carrying capacity and the weight you can push, drag, or lift.',
            'Sneaky': 'You are proficient in the Stealth skill.',
            'Surprise Attack': 'If you hit a creature that is surprised with an attack, it takes an extra 2d6 damage from the attack.',
            
            // Centaur traits
            'Fey': 'Your creature type is fey, rather than humanoid.',
            'Charge': 'If you move at least 30 feet straight toward a target and then hit it with a melee weapon attack, you can immediately follow that attack with a bonus action hoof attack against the target.',
            'Equine Build': 'You count as one size larger for carrying capacity. Climbing costs you 4 feet of movement per 1 foot climbed. Any mount designed for Medium creatures is too small for you.',
            
            // Changeling traits
            'Shapechanger': 'As an action, you can change your appearance and voice. You determine the specifics of the changes, including your coloration, hair length, and sex. You can also adjust your height and weight, but not so much that your size changes.',
            'Changeling Instincts': 'You gain proficiency with two of the following skills: Deception, Insight, Intimidation, or Persuasion.',
            
            // Firbolg traits
            'Firbolg Magic (Detect Magic, Disguise Self)': 'You can cast Detect Magic and Disguise Self with this trait, using Wisdom as your spellcasting ability. When you use Disguise Self, you can seem up to 3 feet shorter than normal. You can use each spell once per short or long rest.',
            'Hidden Step (invisibility)': 'As a bonus action, you can turn invisible until the start of your next turn or until you attack, make a damage roll, or force someone to make a saving throw. You can use this trait a number of times equal to your proficiency bonus, regaining all uses after a long rest.',
            'Speech of Beast and Leaf': 'You can communicate simple ideas with beasts and plants. You have advantage on Charisma checks to influence them.',
            
            // Genasi trait
            'Elemental Heritage (varies by subrace)': 'Your elemental heritage manifests in various traits depending on your subtype (Air, Earth, Fire, or Water), including resistances, spells, and environmental adaptations.',
            
            // Giff traits
            'Astral Spark': 'Your psychic connection to the Astral Plane gives you advantage on saving throws against being charmed and the stunned condition.',
            'Firearms Mastery': 'You have proficiency with all firearms and ignore the loading property of firearms.',
            'Hippo Build': 'You have advantage on Strength-based ability checks and Strength saving throws. You count as one size larger for carrying capacity.',
            
            // Githyanki traits
            'Githyanki Psionics (Mage Hand, Jump, Misty Step)': 'You know the Mage Hand cantrip (invisible hand). At 3rd level, you can cast Jump once per long rest. At 5th level, you can cast Misty Step once per long rest. Intelligence is your spellcasting ability.',
            'Martial Prodigy': 'You are proficient with light and medium armor and with shortswords, longswords, and greatswords.',
            
            // Githzerai traits
            'Githzerai Psionics (Mage Hand, Shield, Detect Thoughts)': 'You know the Mage Hand cantrip (invisible hand). At 3rd level, you can cast Shield once per long rest. At 5th level, you can cast Detect Thoughts once per long rest. Wisdom is your spellcasting ability.',
            'Mental Discipline': 'You have advantage on saving throws against being charmed and frightened.',
            
            // Goblin traits
            'Fury of the Small': 'When you damage a creature that is larger than you, you can add extra damage equal to your proficiency bonus. You can use this trait a number of times equal to your proficiency bonus, regaining all uses after a long rest.',
            'Nimble Escape': 'You can take the Disengage or Hide action as a bonus action on each of your turns.',
            
            // Goliath traits
            'Natural Athlete': 'You have proficiency in the Athletics skill.',
            'Stone\'s Endurance': 'When you take damage, you can use your reaction to roll a d12 and add your Constitution modifier, reducing the damage by that total. You can use this trait a number of times equal to your proficiency bonus, regaining all uses after a long rest.',
            'Mountain Born': 'You have resistance to cold damage. You\'re also acclimated to high altitude, including elevations above 20,000 feet.',
            
            // Grung traits
            'Arboreal Alertness': 'You have proficiency in the Perception skill.',
            'Amphibious': 'You can breathe air and water.',
            'Poisonous Skin': 'Any creature that grapples you or otherwise comes into direct contact with your skin must succeed on a DC 12 Constitution saving throw or become poisoned for 1 minute.',
            'Standing Leap': 'Your long jump is up to 25 feet and your high jump is up to 15 feet, with or without a running start.',
            
            // Hadozee traits
            'Dexterous Feet': 'You can use your feet to manipulate objects, open or close containers, or pick up or set down a Tiny object.',
            'Glide': 'When you fall, you can move 5 feet horizontally for every 1 foot you descend, taking no falling damage.',
            'Hadozee Resilience': 'When you take damage, you can use your reaction to reduce the damage by 1d6 + your proficiency bonus.',
            
            // Half-elf traits
            'Skill Versatility (two skills)': 'You gain proficiency in two skills of your choice.',
            
            // Harengon traits
            'Hare-Trigger (bonus to initiative)': 'You can add your proficiency bonus to your initiative rolls.',
            'Leporine Senses': 'You have proficiency in the Perception skill.',
            'Lucky Footwork': 'When you fail a Dexterity saving throw, you can use your reaction to roll a d4 and add it to the save, potentially turning the failure into a success.',
            'Rabbit Hop': 'As a bonus action, you can jump a number of feet equal to five times your proficiency bonus without provoking opportunity attacks. You can use this a number of times equal to your proficiency bonus, regaining all uses after a long rest.',
            
            // Hexblood traits
            'Eerie Token': 'You can harmlessly remove a lock of your hair, a nail, or a tooth. This token is imbued with magic until you finish a long rest. While the token is imbued, you can use an action to send a telepathic message to the creature holding or carrying the token, or use your action to enter a trance and perceive through the token.',
            'Hex Magic (Disguise Self, Hex)': 'You can cast Disguise Self and Hex with this trait. You can cast each spell once per long rest. Intelligence, Wisdom, or Charisma is your spellcasting ability (choose when you select this race).',
            
            // Hobgoblin traits
            'Fortune from the Many': 'When you miss with an attack roll or fail an ability check or saving throw, you can gain a bonus to the roll equal to the number of allies you can see within 30 feet (max +3). You can use this trait a number of times equal to your proficiency bonus, regaining all uses after a long rest.',
            'Martial Training': 'You are proficient with two martial weapons of your choice and light armor.',
            
            // Human traits
            'Extra Language': 'You can speak, read, and write one extra language of your choice.',
            'Extra Skill': 'You gain proficiency in one skill of your choice.',
            
            // Kalashtar traits
            'Dual Mind (advantage on WIS saves)': 'You have advantage on all Wisdom saving throws.',
            'Mind Link (telepathy)': 'You can speak telepathically to any creature you can see within 60 feet. You don\'t need to share a language, but the creature must be able to understand at least one language.',
            'Severed from Dreams': 'You are immune to spells and effects that require you to dream, like the Dream spell, but can still benefit from long rests.',
            
            // Kenku traits
            'Expert Duplication': 'When you copy writing or craftwork, you have advantage on ability checks you make to produce an exact duplicate.',
            'Kenku Training': 'You are proficient in your choice of two of the following skills: Acrobatics, Deception, Stealth, and Sleight of Hand.',
            'Mimicry': 'You can accurately mimic sounds you have heard, including voices. A creature that hears the sounds can tell they are imitations with a successful Wisdom (Insight) check against your Deception.',
            
            // Kobold traits
            'Draconic Cry': 'As a bonus action, you let out a cry at enemies within 10 feet. Until the start of your next turn, you and your allies have advantage on attack rolls against any of those enemies. You can use this trait a number of times equal to your proficiency bonus, regaining all uses after a long rest.',
            'Kobold Legacy': 'Choose one of the following: Defiance (advantage vs frightened), Draconic Sorcery (a sorcerer cantrip), or Craftiness (proficiency in one skill).',
            'Sunlight Sensitivity': 'You have disadvantage on attack rolls and on Wisdom (Perception) checks that rely on sight when you, the target of your attack, or whatever you are trying to perceive is in direct sunlight.',
            
            // Leonin traits
            'Hunter\'s Instincts': 'You have proficiency in one of the following skills: Athletics, Intimidation, Perception, or Survival.',
            'Daunting Roar': 'As a bonus action, you can let out a menacing roar. Creatures of your choice within 10 feet that can hear you must succeed on a Wisdom saving throw (DC = 8 + proficiency + CHA mod) or become frightened of you until the end of your next turn. You can use this trait a number of times equal to your proficiency bonus, regaining all uses after a long rest.',
            
            // Lizardfolk traits
            'Cunning Artisan': 'During a short rest, you can harvest bone and hide from a slain beast, construct, dragon, monstrosity, or plant creature of size Small or larger to create a shield, club, javelin, or 1d4 darts or blowgun needles.',
            'Hold Breath (15 min)': 'You can hold your breath for up to 15 minutes at a time.',
            'Hunter\'s Lore': 'You gain proficiency with two of the following skills: Animal Handling, Nature, Perception, Stealth, and Survival.',
            'Natural Armor (13+DEX)': 'You have tough, scaly skin. When you aren\'t wearing armor, your AC is 13 + your Dexterity modifier. You can use this natural armor to determine your AC if the armor you wear would leave you with a lower AC.',
            
            // Locathah traits
            'Natural Armor (12+DEX)': 'You have tough, scaly skin. When you aren\'t wearing armor, your AC is 12 + your Dexterity modifier.',
            'Observant & Athletic': 'You have proficiency in the Athletics and Perception skills.',
            'Leviathan Will': 'You have advantage on saving throws against being charmed, frightened, paralyzed, poisoned, stunned, or put to sleep.',
            'Limited Amphibiousness': 'You can breathe air and water, but you need to be submerged at least once every 4 hours to avoid suffocating.',
            
            // Loxodon traits
            'Loxodon Serenity (charm/fear advantage)': 'You have advantage on saving throws against being charmed or frightened.',
            'Natural Armor (12+CON)': 'You have thick, leathery skin. When you aren\'t wearing armor, your AC is 12 + your Constitution modifier.',
            'Trunk': 'You can grasp things with your trunk; it has a reach of 5 feet. You can use it to lift a number of pounds equal to five times your Strength score. You can\'t use it to wield weapons, shields, or anything requiring manual precision.',
            'Keen Smell': 'You have advantage on Wisdom (Perception), Wisdom (Survival), and Intelligence (Investigation) checks that involve smell.',
            
            // Minotaur traits
            'Goring Rush': 'When you take the Dash action and move at least 20 feet straight toward a creature, you can make one melee attack with your horns as a bonus action.',
            'Hammering Horns': 'When you hit a creature with a melee attack on your turn, you can use a bonus action to push that creature with your horns. The creature must be no more than one size larger and within 5 feet. It must succeed on a Strength save (DC = 8 + proficiency + STR mod) or be pushed 10 feet away.',
            'Labyrinthine Recall': 'You can perfectly recall any path you have traveled.',
            
            // Orc traits
            'Aggressive': 'As a bonus action, you can move up to your speed toward an enemy that you can see or hear. You must end this move closer to the enemy than you started.',
            'Primal Intuition': 'You have proficiency in two of the following skills: Animal Handling, Insight, Intimidation, Medicine, Nature, Perception, or Survival.',
            
            // Owlin traits
            'Silent Feathers (Stealth proficiency)': 'You have proficiency in the Stealth skill.',
            
            // Plasmoid traits
            'Amorphous': 'You can squeeze through a space as narrow as 1 inch wide, provided you are wearing and carrying nothing. You have advantage on ability checks you make to initiate or escape a grapple.',
            'Hold Breath (1 hour)': 'You can hold your breath for 1 hour.',
            'Shape Self': 'As an action, you can reshape your body to give yourself a head, one or two arms, one or two legs, and makeshift hands and feet, or revert to a limbless blob. While you have a humanlike form, you can wear clothing and armor made for a Humanoid of your size.',
            
            // Reborn traits
            'Ancestral Legacy': 'You have two proficiencies of your choice: two skills, or one skill and one tool.',
            'Deathless Nature': 'You don\'t need to eat, drink, or breathe. You don\'t need to sleep and can\'t be put to sleep. You have advantage on death saving throws and saving throws against disease and being poisoned.',
            'Knowledge from a Past Life': 'When you make an ability check that uses a skill, you can add a d6 to the roll. You can use this trait a number of times equal to your proficiency bonus, regaining all uses after a long rest.',
            
            // Satyr traits
            'Magic Resistance': 'You have advantage on saving throws against spells and other magical effects.',
            'Mirthful Leaps': 'Whenever you make a long or high jump, you can roll a d8 and add the result to the distance in feet.',
            'Reveler (Performance/Persuasion)': 'You have proficiency in the Performance and Persuasion skills.',
            
            // Sea elf traits
            'Child of the Sea (swim 30 ft, water breathing)': 'You have a swimming speed of 30 feet, and you can breathe air and water.',
            'Friend of the Sea': 'Using gestures and sounds, you can communicate simple ideas with any beast that has an innate swimming speed.',
            
            // Shadar-kai traits
            'Blessing of the Raven Queen (teleport+resistance)': 'As a bonus action, you can magically teleport up to 30 feet to an unoccupied space you can see. Once you use this trait, you can\'t do so again until you finish a long rest. Starting at 3rd level, you gain resistance to all damage when you teleport using this trait until the start of your next turn.',
            
            // Kender traits
            'Fearless': 'You are immune to the frightened condition.',
            'Kender Ace (sleight of hand proficiency)': 'You have proficiency in the Sleight of Hand skill.',
            'Taunt': 'You have an extraordinary ability to fluster creatures. As a bonus action, you can taunt a creature within 60 feet of you that can hear and understand you. The creature must succeed on a Wisdom saving throw (DC equals 8 + your proficiency bonus + your Charisma modifier) or have disadvantage on attack rolls against targets other than you until the start of your next turn.',
            
            // Shifter traits
            'Shifting (bonus action transformation)': 'As a bonus action, you can assume a more bestial appearance for 1 minute. You gain temporary hit points equal to your level + your Constitution modifier. Your specific subrace determines additional benefits. You can shift a number of times equal to your proficiency bonus, regaining all uses after a long rest.',
            
            // Simic Hybrid traits
            'Animal Enhancement (choice of adaptation)': 'Your body has been altered to incorporate animal characteristics. At 1st level, choose one of: Manta Glide (swim speed, glide), Nimble Climber (climb speed), or Underwater Adaptation (swim speed, water breathing). At 5th level, gain an additional adaptation: Grappling Appendages, Carapace (+1 AC), or Acid Spit.',
            
            // Tabaxi traits
            'Feline Agility': 'When you move on your turn in combat, you can double your speed until the end of the turn. Once you use this trait, you can\'t use it again until you move 0 feet on one of your turns.',
            'Cat\'s Talent': 'You have proficiency in the Perception and Stealth skills.',
            
            // Thri-kreen traits
            'Chameleon Carapace': 'While you aren\'t wearing armor, your carapace gives you a base AC of 13 + your Dexterity modifier. As an action, you can change the color of your carapace to match your surroundings, giving you advantage on Stealth checks to hide.',
            'Secondary Arms': 'You have two slightly smaller secondary arms below your primary pair. They can manipulate an object, open or close a door or container, or pick up or set down a Tiny object. They can\'t wield weapons or shields.',
            'Sleepless': 'You don\'t require sleep and can remain conscious during a long rest, though you must still refrain from strenuous activity.',
            'Thri-kreen Telepathy': 'You have the magical ability to communicate mentally with any number of willing creatures you can see within 120 feet. A contacted creature doesn\'t need to share a language, but it must understand at least one language.',
            
            // Tortle traits
            'Hold Breath (1 hour)': 'You can hold your breath for up to 1 hour at a time.',
            'Natural Armor (AC 17)': 'Your shell provides a base AC of 17 (your Dexterity modifier doesn\'t affect this). You can\'t wear armor, but if you use a shield, you can apply its bonus.',
            'Shell Defense': 'You can withdraw into your shell as an action. Until you emerge as a bonus action, you have +4 AC, advantage on Strength and Constitution saves, but speed 0, disadvantage on Dexterity saves, and can\'t take reactions.',
            
            // Triton traits
            'Control Air and Water (spells)': 'You can cast Fog Cloud. At 3rd level, you can cast Gust of Wind. At 5th level, you can cast Wall of Water. You can cast each spell once per long rest. Charisma is your spellcasting ability.',
            'Emissary of the Sea': 'You can communicate simple ideas with beasts that can breathe water. They can understand your words, though you have no special ability to understand them in return.',
            'Guardian of the Depths': 'You have resistance to cold damage. You ignore any drawbacks caused by a deep, underwater environment.',
            
            // Vedalken traits
            'Vedalken Dispassion (saves vs WIS/CHA)': 'You have advantage on all Intelligence, Wisdom, and Charisma saving throws.',
            'Tireless Precision': 'You are proficient in one skill and one tool of your choice. When you make an ability check with the chosen skill or tool, roll a d4 and add it to the result.',
            'Partially Amphibious': 'You can breathe air and water for up to 1 hour at a time, after which you need to rest for at least 1 minute before breathing water again.',
            
            // Verdan traits
            'Black Blood Healing': 'When you roll a 1 or 2 on any Hit Die you spend at the end of a short rest, you can reroll the die and must use the new roll.',
            'Limited Telepathy': 'You can speak telepathically to any creature within 30 feet. The creature understands you only if you share a language. You can speak this way to only one creature at a time.',
            'Persuasive': 'You have proficiency in the Persuasion skill.',
            'Telepathic Insight': 'You have advantage on Wisdom and Charisma saving throws.',
            
            // Warforged traits
            'Constructed Resilience': 'You were created to have remarkable fortitude: advantage on saves vs. poison, resistance to poison damage, immunity to disease, no need to eat/drink/breathe, no need to sleep (immune to magical sleep).',
            'Sentry\'s Rest': 'When you take a long rest, you must spend at least six hours in an inactive, motionless state, rather than sleeping. You appear inert, but remain conscious.',
            'Integrated Protection (+1 AC)': 'Your body has built-in defensive layers. You gain a +1 bonus to Armor Class. You can don armor by incorporating it into your body over 1 hour, or doff it over the same period.',
            'Specialized Design': 'You gain one skill proficiency and one tool proficiency of your choice.',
            
            // Yuan-ti traits
            'Innate Spellcasting (Poison Spray, Animal Friendship, Suggestion)': 'You know the Poison Spray cantrip. At 3rd level, you can cast Animal Friendship (snakes only) at will. At 5th level, you can cast Suggestion once per long rest. Charisma is your spellcasting ability.',
            
            // Autognome traits
            'Armored Casing': 'You are encased in thin metal or some other durable material. While you aren\'t wearing armor, your base AC is 13 + your Dexterity modifier.',
            'Built for Success': 'You can add a d4 to one attack roll, ability check, or saving throw you make, after seeing the d20 result but before knowing the outcome. You can use this trait a number of times equal to your proficiency bonus, regaining all uses after a long rest.',
            'Mechanical Nature': 'You have resistance to poison damage and immunity to disease. You don\'t need to eat, drink, or breathe. You don\'t need to sleep and can\'t be put to sleep.',
            
            // Astral Elf traits
            'Astral Fire': 'You know the Dancing Lights or Light cantrip (your choice). Intelligence, Wisdom, or Charisma is your spellcasting ability (choose when you select this race).',
            'Starlight Step': 'As a bonus action, you can magically teleport up to 30 feet to an unoccupied space you can see. You can use this trait a number of times equal to your proficiency bonus, regaining all uses after a long rest.',
            
            // Dhampir traits
            'Spider Climb': 'You have a climbing speed equal to your walking speed. You can climb difficult surfaces, including upside down on ceilings, without needing to make an ability check.',
            'Vampiric Bite': 'Your fanged bite is a natural weapon, dealing 1d4 + Constitution modifier piercing damage. You can use your Constitution modifier instead of Strength for attack rolls. When you attack with this bite, you can empower yourself by gaining temporary hit points equal to the damage dealt, and a bonus to your next ability check or attack roll equal to the damage dealt. You can empower yourself this way a number of times equal to your proficiency bonus.',
            
            // Duergar traits
            'Dwarven Resilience': 'You have advantage on saving throws against poison, and you have resistance against poison damage.',
            'Duergar Magic (Enlarge/Invisibility)': 'At 3rd level, you can cast Enlarge/Reduce on yourself (enlarge only) once per long rest. At 5th level, you can cast Invisibility on yourself once per long rest, requiring no material components. Intelligence, Wisdom, or Charisma is your spellcasting ability.',
        };

        // ============================================
        // SPELLCASTING SYSTEM
        // ============================================

        // ============================================
        // WEAPONS DATABASE
        // ============================================

        const weapons = {
            // ========== SIMPLE MELEE WEAPONS ==========
            'club': { name: 'Club', type: 'simple', category: 'melee', damage: '1d4', damageType: 'bludgeoning', weight: 2, properties: ['light'], cost: '1 sp', description: 'A simple wooden club.' },
            'dagger': { name: 'Dagger', type: 'simple', category: 'melee', damage: '1d4', damageType: 'piercing', weight: 1, properties: ['finesse', 'light', 'thrown (20/60)'], cost: '2 gp', description: 'A small blade suitable for close combat or throwing.' },
            'greatclub': { name: 'Greatclub', type: 'simple', category: 'melee', damage: '1d8', damageType: 'bludgeoning', weight: 10, properties: ['two-handed'], cost: '2 sp', description: 'A large, heavy club requiring two hands to wield.' },
            'handaxe': { name: 'Handaxe', type: 'simple', category: 'melee', damage: '1d6', damageType: 'slashing', weight: 2, properties: ['light', 'thrown (20/60)'], cost: '5 gp', description: 'A small axe designed for one-handed use.' },
            'javelin': { name: 'Javelin', type: 'simple', category: 'melee', damage: '1d6', damageType: 'piercing', weight: 2, properties: ['thrown (30/120)'], cost: '5 sp', description: 'A light spear designed primarily for throwing.' },
            'light-hammer': { name: 'Light Hammer', type: 'simple', category: 'melee', damage: '1d4', damageType: 'bludgeoning', weight: 2, properties: ['light', 'thrown (20/60)'], cost: '2 gp', description: 'A small hammer that can be thrown.' },
            'mace': { name: 'Mace', type: 'simple', category: 'melee', damage: '1d6', damageType: 'bludgeoning', weight: 4, properties: [], cost: '5 gp', description: 'A heavy club with a metal head.' },
            'quarterstaff': { name: 'Quarterstaff', type: 'simple', category: 'melee', damage: '1d6', damageType: 'bludgeoning', weight: 4, properties: ['versatile (1d8)'], cost: '2 sp', description: 'A long wooden staff, versatile in combat.' },
            'sickle': { name: 'Sickle', type: 'simple', category: 'melee', damage: '1d4', damageType: 'slashing', weight: 2, properties: ['light'], cost: '1 gp', description: 'A curved blade used for harvesting crops.' },
            'spear': { name: 'Spear', type: 'simple', category: 'melee', damage: '1d6', damageType: 'piercing', weight: 3, properties: ['thrown (20/60)', 'versatile (1d8)'], cost: '1 gp', description: 'A simple pole weapon with a pointed tip.' },

            // ========== SIMPLE RANGED WEAPONS ==========
            'light-crossbow': { name: 'Light Crossbow', type: 'simple', category: 'ranged', damage: '1d8', damageType: 'piercing', weight: 5, properties: ['ammunition (80/320)', 'loading', 'two-handed'], cost: '25 gp', description: 'A small crossbow that fires bolts.' },
            'dart': { name: 'Dart', type: 'simple', category: 'ranged', damage: '1d4', damageType: 'piercing', weight: 0.25, properties: ['finesse', 'thrown (20/60)'], cost: '5 cp', description: 'A small throwing weapon with a weighted tip.' },
            'shortbow': { name: 'Shortbow', type: 'simple', category: 'ranged', damage: '1d6', damageType: 'piercing', weight: 2, properties: ['ammunition (80/320)', 'two-handed'], cost: '25 gp', description: 'A small bow suited for quick shots.' },
            'sling': { name: 'Sling', type: 'simple', category: 'ranged', damage: '1d4', damageType: 'bludgeoning', weight: 0, properties: ['ammunition (30/120)'], cost: '1 sp', description: 'A simple weapon that hurls stones.' },

            // ========== MARTIAL MELEE WEAPONS ==========
            'battleaxe': { name: 'Battleaxe', type: 'martial', category: 'melee', damage: '1d8', damageType: 'slashing', weight: 4, properties: ['versatile (1d10)'], cost: '10 gp', description: 'A heavy axe designed for combat.' },
            'flail': { name: 'Flail', type: 'martial', category: 'melee', damage: '1d8', damageType: 'bludgeoning', weight: 2, properties: [], cost: '10 gp', description: 'A weighted ball on a chain attached to a handle.' },
            'glaive': { name: 'Glaive', type: 'martial', category: 'melee', damage: '1d10', damageType: 'slashing', weight: 6, properties: ['heavy', 'reach', 'two-handed'], cost: '20 gp', description: 'A polearm with a single-edged blade.' },
            'greataxe': { name: 'Greataxe', type: 'martial', category: 'melee', damage: '1d12', damageType: 'slashing', weight: 7, properties: ['heavy', 'two-handed'], cost: '30 gp', description: 'A massive axe requiring two hands.' },
            'greatsword': { name: 'Greatsword', type: 'martial', category: 'melee', damage: '2d6', damageType: 'slashing', weight: 6, properties: ['heavy', 'two-handed'], cost: '50 gp', description: 'A large sword requiring two hands to wield effectively.' },
            'halberd': { name: 'Halberd', type: 'martial', category: 'melee', damage: '1d10', damageType: 'slashing', weight: 6, properties: ['heavy', 'reach', 'two-handed'], cost: '20 gp', description: 'A polearm with an axe blade and spike.' },
            'lance': { name: 'Lance', type: 'martial', category: 'melee', damage: '1d12', damageType: 'piercing', weight: 6, properties: ['reach', 'special'], cost: '10 gp', description: 'A long weapon designed for mounted combat. You have disadvantage when you use a lance to attack a target within 5 feet of you. Also, a lance requires two hands to wield when you aren\'t mounted.' },
            'longsword': { name: 'Longsword', type: 'martial', category: 'melee', damage: '1d8', damageType: 'slashing', weight: 3, properties: ['versatile (1d10)'], cost: '15 gp', description: 'A classic sword with a long blade.' },
            'maul': { name: 'Maul', type: 'martial', category: 'melee', damage: '2d6', damageType: 'bludgeoning', weight: 10, properties: ['heavy', 'two-handed'], cost: '10 gp', description: 'A massive hammer requiring two hands.' },
            'morningstar': { name: 'Morningstar', type: 'martial', category: 'melee', damage: '1d8', damageType: 'piercing', weight: 4, properties: [], cost: '15 gp', description: 'A spiked mace designed to pierce armor.' },
            'pike': { name: 'Pike', type: 'martial', category: 'melee', damage: '1d10', damageType: 'piercing', weight: 18, properties: ['heavy', 'reach', 'two-handed'], cost: '5 gp', description: 'A very long spear used in formation fighting.' },
            'rapier': { name: 'Rapier', type: 'martial', category: 'melee', damage: '1d8', damageType: 'piercing', weight: 2, properties: ['finesse'], cost: '25 gp', description: 'A thin, sharp sword favoring quick thrusts.' },
            'scimitar': { name: 'Scimitar', type: 'martial', category: 'melee', damage: '1d6', damageType: 'slashing', weight: 3, properties: ['finesse', 'light'], cost: '25 gp', description: 'A curved blade designed for slashing attacks.' },
            'shortsword': { name: 'Shortsword', type: 'martial', category: 'melee', damage: '1d6', damageType: 'piercing', weight: 2, properties: ['finesse', 'light'], cost: '10 gp', description: 'A short blade ideal for quick attacks.' },
            'trident': { name: 'Trident', type: 'martial', category: 'melee', damage: '1d6', damageType: 'piercing', weight: 4, properties: ['thrown (20/60)', 'versatile (1d8)'], cost: '5 gp', description: 'A three-pronged spear.' },
            'war-pick': { name: 'War Pick', type: 'martial', category: 'melee', damage: '1d8', damageType: 'piercing', weight: 2, properties: [], cost: '5 gp', description: 'A military pick designed to pierce armor.' },
            'warhammer': { name: 'Warhammer', type: 'martial', category: 'melee', damage: '1d8', damageType: 'bludgeoning', weight: 2, properties: ['versatile (1d10)'], cost: '15 gp', description: 'A hammer designed for combat.' },
            'whip': { name: 'Whip', type: 'martial', category: 'melee', damage: '1d4', damageType: 'slashing', weight: 3, properties: ['finesse', 'reach'], cost: '2 gp', description: 'A flexible weapon with exceptional reach.' },

            // ========== MARTIAL RANGED WEAPONS ==========
            'blowgun': { name: 'Blowgun', type: 'martial', category: 'ranged', damage: '1', damageType: 'piercing', weight: 1, properties: ['ammunition (25/100)', 'loading'], cost: '10 gp', description: 'A tube through which darts are blown.' },
            'hand-crossbow': { name: 'Hand Crossbow', type: 'martial', category: 'ranged', damage: '1d6', damageType: 'piercing', weight: 3, properties: ['ammunition (30/120)', 'light', 'loading'], cost: '75 gp', description: 'A small crossbow designed for one-handed use.' },
            'heavy-crossbow': { name: 'Heavy Crossbow', type: 'martial', category: 'ranged', damage: '1d10', damageType: 'piercing', weight: 18, properties: ['ammunition (100/400)', 'heavy', 'loading', 'two-handed'], cost: '50 gp', description: 'A large, powerful crossbow.' },
            'longbow': { name: 'Longbow', type: 'martial', category: 'ranged', damage: '1d8', damageType: 'piercing', weight: 2, properties: ['ammunition (150/600)', 'heavy', 'two-handed'], cost: '50 gp', description: 'A tall bow with exceptional range.' },
            'net': { name: 'Net', type: 'martial', category: 'ranged', damage: '0', damageType: 'none', weight: 3, properties: ['special', 'thrown (5/15)'], cost: '1 gp', description: 'A mesh of rope used to restrain creatures. A Large or smaller creature hit by a net is restrained until it is freed. A net has no effect on creatures that are formless, or creatures that are Huge or larger.' },

            // ========== SPECIAL/EXOTIC WEAPONS (from various books) ==========
            'double-bladed-scimitar': { name: 'Double-Bladed Scimitar', type: 'martial', category: 'melee', damage: '2d4', damageType: 'slashing', weight: 6, properties: ['special', 'two-handed'], cost: '100 gp', description: 'An elegant elven weapon with blades on both ends. If you attack with this weapon as part of the Attack action, you can use a bonus action to make a melee attack with it, dealing 1d4 slashing damage.' },
            'yklwa': { name: 'Yklwa', type: 'simple', category: 'melee', damage: '1d8', damageType: 'piercing', weight: 3, properties: ['thrown (10/30)'], cost: '1 gp', description: 'A traditional Chultan weapon consisting of a 3-foot wooden shaft with a steel or stone blade up to 18 inches long.' },

            // ========== FIREARMS (optional, from DMG) ==========
            'pistol': { name: 'Pistol', type: 'martial', category: 'ranged', damage: '1d10', damageType: 'piercing', weight: 3, properties: ['ammunition (30/90)', 'loading'], cost: '250 gp', description: 'A Renaissance-era firearm. Requires gunpowder and bullets.' },
            'musket': { name: 'Musket', type: 'martial', category: 'ranged', damage: '1d12', damageType: 'piercing', weight: 10, properties: ['ammunition (40/120)', 'loading', 'two-handed'], cost: '500 gp', description: 'A long-barreled firearm. Requires gunpowder and bullets.' }
        };

        // Class weapon proficiencies
        const classWeaponProficiencies = {
            artificer: { simple: true, martial: false, specific: [] },
            barbarian: { simple: true, martial: true, specific: [] },
            bard: { simple: true, martial: false, specific: ['hand-crossbow', 'longsword', 'rapier', 'shortsword'] },
            cleric: { simple: true, martial: false, specific: [] },
            druid: { simple: false, martial: false, specific: ['club', 'dagger', 'dart', 'javelin', 'mace', 'quarterstaff', 'scimitar', 'sickle', 'sling', 'spear'] },
            fighter: { simple: true, martial: true, specific: [] },
            monk: { simple: true, martial: false, specific: ['shortsword'] },
            paladin: { simple: true, martial: true, specific: [] },
            ranger: { simple: true, martial: true, specific: [] },
            rogue: { simple: true, martial: false, specific: ['hand-crossbow', 'longsword', 'rapier', 'shortsword'] },
            sorcerer: { simple: false, martial: false, specific: ['dagger', 'dart', 'sling', 'quarterstaff', 'light-crossbow'] },
            warlock: { simple: true, martial: false, specific: [] },
            wizard: { simple: false, martial: false, specific: ['dagger', 'dart', 'sling', 'quarterstaff', 'light-crossbow'] },
            commoner: { simple: false, martial: false, specific: [] } // Uses improvised weapons
        };

        // Occupation-based improvised weapons for commoners (1d2 damage)
        const occupationWeapons = {
            'infant': { name: 'Tiny Fists', damage: '0', damageType: 'bludgeoning', description: 'Too young to wield any weapon.' },
            'child': { name: 'Stick', damage: '1', damageType: 'bludgeoning', description: 'A small stick or branch found on the ground.' },
            'farmer': { name: 'Pitchfork', damage: '1d2', damageType: 'piercing', description: 'A farming tool repurposed for defense.' },
            'blacksmith': { name: 'Smith\'s Hammer', damage: '1d2', damageType: 'bludgeoning', description: 'A heavy hammer used for metalwork.' },
            'baker': { name: 'Rolling Pin', damage: '1d2', damageType: 'bludgeoning', description: 'A sturdy wooden cylinder for rolling dough.' },
            'butcher': { name: 'Cleaver', damage: '1d2', damageType: 'slashing', description: 'A heavy blade used for cutting meat.' },
            'carpenter': { name: 'Carpenter\'s Mallet', damage: '1d2', damageType: 'bludgeoning', description: 'A wooden mallet used for construction.' },
            'cobbler': { name: 'Awl', damage: '1d2', damageType: 'piercing', description: 'A sharp tool for punching holes in leather.' },
            'cook': { name: 'Cast Iron Pan', damage: '1d2', damageType: 'bludgeoning', description: 'A heavy cooking pan, surprisingly effective.' },
            'fisherman': { name: 'Fishing Gaff', damage: '1d2', damageType: 'piercing', description: 'A hooked pole used for landing fish.' },
            'herbalist': { name: 'Pestle', damage: '1d2', damageType: 'bludgeoning', description: 'A grinding tool from a mortar and pestle set.' },
            'hunter': { name: 'Hunting Knife', damage: '1d2', damageType: 'slashing', description: 'A knife used for skinning game.' },
            'innkeeper': { name: 'Bottle', damage: '1d2', damageType: 'bludgeoning', description: 'A glass bottle, breaks on impact.' },
            'merchant': { name: 'Walking Cane', damage: '1d2', damageType: 'bludgeoning', description: 'A sturdy cane for long journeys.' },
            'miner': { name: 'Mining Pick', damage: '1d2', damageType: 'piercing', description: 'A pick used for breaking rock.' },
            'noble': { name: 'Ornate Cane', damage: '1d2', damageType: 'bludgeoning', description: 'A decorative but sturdy walking stick.' },
            'scholar': { name: 'Heavy Tome', damage: '1d2', damageType: 'bludgeoning', description: 'A thick, heavy book swung with conviction.' },
            'servant': { name: 'Broom Handle', damage: '1d2', damageType: 'bludgeoning', description: 'A wooden broom handle.' },
            'shepherd': { name: 'Crook', damage: '1d2', damageType: 'bludgeoning', description: 'A hooked staff for herding sheep.' },
            'tailor': { name: 'Shears', damage: '1d2', damageType: 'slashing', description: 'Large scissors used for cutting fabric.' },
            'tanner': { name: 'Scraping Knife', damage: '1d2', damageType: 'slashing', description: 'A curved blade used for processing hides.' },
            'weaver': { name: 'Shuttle', damage: '1d2', damageType: 'bludgeoning', description: 'A wooden weaving tool.' },
            'woodcutter': { name: 'Hatchet', damage: '1d2', damageType: 'slashing', description: 'A small axe for chopping wood.' },
            'stablehand': { name: 'Horseshoe', damage: '1d2', damageType: 'bludgeoning', description: 'A thrown or swung metal horseshoe.' },
            'gravedigger': { name: 'Shovel', damage: '1d2', damageType: 'bludgeoning', description: 'A digging tool with a flat blade.' },
            'brewer': { name: 'Barrel Tap', damage: '1d2', damageType: 'bludgeoning', description: 'A wooden spigot for tapping barrels.' },
            'chandler': { name: 'Candle Mold', damage: '1d2', damageType: 'bludgeoning', description: 'A metal mold for making candles.' },
            'potter': { name: 'Clay Tool', damage: '1d2', damageType: 'piercing', description: 'A wire and wooden handle for cutting clay.' },
            'scribe': { name: 'Letter Opener', damage: '1d2', damageType: 'piercing', description: 'A small blade for opening correspondence.' },
            'street-performer': { name: 'Juggling Pin', damage: '1d2', damageType: 'bludgeoning', description: 'A weighted club used in performances.' },
            'beggar': { name: 'Begging Bowl', damage: '1d2', damageType: 'bludgeoning', description: 'A wooden bowl, surprisingly sturdy.' },
            'dockworker': { name: 'Cargo Hook', damage: '1d2', damageType: 'piercing', description: 'A hook used for moving crates.' },
            'messenger': { name: 'Satchel', damage: '1d2', damageType: 'bludgeoning', description: 'A leather bag swung as a weapon.' },
            'guard': { name: 'Truncheon', damage: '1d2', damageType: 'bludgeoning', description: 'A short wooden club for keeping order.' },
            'sailor': { name: 'Belaying Pin', damage: '1d2', damageType: 'bludgeoning', description: 'A wooden pin used to secure ropes on ships.' },
            'ratcatcher': { name: 'Rat Stick', damage: '1d2', damageType: 'bludgeoning', description: 'A club with nails for catching vermin.' },
            'urchin': { name: 'Broken Glass', damage: '1d2', damageType: 'slashing', description: 'A shard of broken glass wrapped in cloth.' },
            'laborer': { name: 'Crowbar', damage: '1d2', damageType: 'bludgeoning', description: 'An iron bar for prying.' },
            'mason': { name: 'Stone Chisel', damage: '1d2', damageType: 'piercing', description: 'A sharp metal tool for carving stone.' },
            'jeweler': { name: 'Gem Cutter', damage: '1d2', damageType: 'slashing', description: 'A small blade used to cut and shape gems.' },
            'glassblower': { name: 'Hot Glass Rod', damage: '1d2', damageType: 'bludgeoning', description: 'A metal rod still warm from the furnace.' },
            'vintner': { name: 'Wine Bottle', damage: '1d2', damageType: 'bludgeoning', description: 'A heavy glass bottle, full or empty.' },
            'trapper': { name: 'Snare Wire', damage: '1d2', damageType: 'slashing', description: 'A length of sharp wire used for traps.' },
            'beekeeper': { name: 'Hive Tool', damage: '1d2', damageType: 'bludgeoning', description: 'A flat metal tool for prying open beehives.' },
            'miller': { name: 'Grain Flail', damage: '1d2', damageType: 'bludgeoning', description: 'A threshing tool with a swinging head.' },
            'peddler': { name: 'Walking Stick', damage: '1d2', damageType: 'bludgeoning', description: 'A sturdy stick for long journeys on foot.' },
            'shopkeeper': { name: 'Measuring Rod', damage: '1d2', damageType: 'bludgeoning', description: 'A wooden rod marked for measuring goods.' },
            'banker': { name: 'Coin Bag', damage: '1d2', damageType: 'bludgeoning', description: 'A heavy pouch filled with coins.' },
            'trader': { name: 'Scale Weight', damage: '1d2', damageType: 'bludgeoning', description: 'A dense metal weight used for measuring.' },
            'barkeep': { name: 'Tankard', damage: '1d2', damageType: 'bludgeoning', description: 'A heavy drinking vessel, preferably pewter.' },
            'courier': { name: 'Message Tube', damage: '1d2', damageType: 'bludgeoning', description: 'A sturdy metal tube for carrying scrolls.' },
            'librarian': { name: 'Heavy Bookend', damage: '1d2', damageType: 'bludgeoning', description: 'A dense metal or stone bookend.' },
            'tutor': { name: 'Wooden Ruler', damage: '1d2', damageType: 'bludgeoning', description: 'A rigid wooden measuring stick.' },
            'cartographer': { name: 'Drawing Compass', damage: '1d2', damageType: 'piercing', description: 'A sharp-pointed compass for mapmaking.' },
            'acolyte': { name: 'Candlestick', damage: '1d2', damageType: 'bludgeoning', description: 'A heavy metal candle holder.' },
            'priest': { name: 'Censer', damage: '1d2', damageType: 'bludgeoning', description: 'A swinging metal incense burner on a chain.' },
            'monk_civilian': { name: 'Prayer Beads', damage: '1d2', damageType: 'bludgeoning', description: 'A string of heavy wooden or stone beads.' },
            'gravewarden': { name: 'Grave Stake', damage: '1d2', damageType: 'piercing', description: 'A wooden stake for marking or consecrating graves.' },
            'entertainer': { name: 'Prop Sword', damage: '1d2', damageType: 'bludgeoning', description: 'A wooden sword used in performances.' },
            'musician': { name: 'Lute', damage: '1d2', damageType: 'bludgeoning', description: 'A stringed instrument swung in desperation.' },
            'actor': { name: 'Stage Prop', damage: '1d2', damageType: 'bludgeoning', description: 'A theatrical prop repurposed for defense.' },
            'jester': { name: 'Marotte', damage: '1d2', damageType: 'bludgeoning', description: 'A fool\'s scepter topped with a carved head.' },
            'storyteller': { name: 'Walking Cane', damage: '1d2', damageType: 'bludgeoning', description: 'A carved cane used for dramatic gestures.' },
            'healer': { name: 'Bone Saw', damage: '1d2', damageType: 'slashing', description: 'A serrated surgical saw.' },
            'midwife': { name: 'Swaddling Rod', damage: '1d2', damageType: 'bludgeoning', description: 'A smooth wooden rod for wrapping linens.' },
            'apothecary': { name: 'Mortar', damage: '1d2', damageType: 'bludgeoning', description: 'A heavy stone bowl for grinding ingredients.' },
            'soldier': { name: 'Training Sword', damage: '1d2', damageType: 'bludgeoning', description: 'A wooden practice weapon.' },
            'watchman': { name: 'Night Stick', damage: '1d2', damageType: 'bludgeoning', description: 'A short wooden club for patrols.' },
            'bouncer': { name: 'Brass Knuckles', damage: '1d2', damageType: 'bludgeoning', description: 'Metal rings worn over the fist.' },
            'shipwright': { name: 'Caulking Mallet', damage: '1d2', damageType: 'bludgeoning', description: 'A heavy mallet for sealing ship hulls.' },
            'advisor': { name: 'Weighted Cane', damage: '1d2', damageType: 'bludgeoning', description: 'An elegant cane with a heavy metal head.' },
            'herald': { name: 'Standard Pole', damage: '1d2', damageType: 'bludgeoning', description: 'A long pole for carrying banners.' },
            'diplomat': { name: 'Letter Opener', damage: '1d2', damageType: 'piercing', description: 'An ornate blade for opening correspondence.' },
            'tax_collector': { name: 'Lockbox', damage: '1d2', damageType: 'bludgeoning', description: 'A heavy metal box for collecting coins.' },
            'pickpocket': { name: 'Shiv', damage: '1d2', damageType: 'piercing', description: 'A sharpened piece of metal or bone.' },
            'smuggler': { name: 'Weighted Sap', damage: '1d2', damageType: 'bludgeoning', description: 'A leather pouch filled with lead shot.' },
            'fence': { name: 'Hidden Blade', damage: '1d2', damageType: 'piercing', description: 'A small knife concealed in clothing.' },
            'default': { name: 'Improvised Club', damage: '1d2', damageType: 'bludgeoning', description: 'A makeshift weapon grabbed in desperation.' }
        };

        // Preferred weapons by class (for auto-generation)
        const classPreferredWeapons = {
            artificer: ['light-crossbow', 'handaxe', 'dagger'],
            barbarian: ['greataxe', 'greatsword', 'handaxe', 'javelin'],
            bard: ['rapier', 'shortsword', 'dagger', 'longsword'],
            cleric: ['mace', 'warhammer', 'light-crossbow', 'quarterstaff'],
            druid: ['quarterstaff', 'scimitar', 'sling', 'dagger'],
            fighter: ['longsword', 'greatsword', 'longbow', 'battleaxe', 'shield'],
            monk: ['shortsword', 'quarterstaff', 'dart'],
            paladin: ['longsword', 'greatsword', 'javelin', 'warhammer'],
            ranger: ['longbow', 'shortsword', 'longsword', 'handaxe'],
            rogue: ['rapier', 'shortsword', 'dagger', 'hand-crossbow'],
            sorcerer: ['quarterstaff', 'dagger', 'light-crossbow'],
            warlock: ['quarterstaff', 'dagger', 'light-crossbow'],
            wizard: ['quarterstaff', 'dagger', 'light-crossbow'],
            commoner: [] // Uses occupation weapon
        };

        // Racial natural weapons
        const racialNaturalWeapons = {
            'aarakocra': { name: 'Talons', damage: '1d4', damageType: 'slashing', description: 'Sharp talons on your feet that can be used as natural weapons.' },
            'centaur': { name: 'Hooves', damage: '1d4', damageType: 'bludgeoning', usesStr: true, description: 'Powerful hooves that can deliver crushing blows.' },
            'dhampir': { name: 'Vampiric Bite', damage: '1d4', damageType: 'piercing', usesConOrStr: true, description: 'Fanged bite that can drain vitality from a target.' },
            'leonin': { name: 'Claws', damage: '1d4', damageType: 'slashing', description: 'Retractable claws ideal for rending attacks.' },
            'lizardfolk': { name: 'Bite', damage: '1d6', damageType: 'piercing', description: 'Powerful jaws lined with sharp teeth.' },
            'minotaur': { name: 'Horns', damage: '1d6', damageType: 'piercing', description: 'Sharp horns that can gore enemies.' },
            'tabaxi': { name: "Cat's Claws", damage: '1d4', damageType: 'slashing', description: 'Sharp claws that can also aid in climbing.' },
            'tortle': { name: 'Claws', damage: '1d4', damageType: 'slashing', description: 'Natural claws on hands and feet.' }
        };

        // Get racial natural weapon for a race
        function getRacialNaturalWeapon(race, modifiers) {
            const raceLower = race.toLowerCase();
            const weaponData = racialNaturalWeapons[raceLower];
            
            if (!weaponData) return null;
            
            // Determine which modifier to use for damage
            let damageModifier = modifiers.str; // Default to STR
            if (weaponData.usesConOrStr) {
                damageModifier = Math.max(modifiers.con, modifiers.str);
            }
            
            return {
                ...weaponData,
                id: 'racial-' + raceLower,
                type: 'natural',
                category: 'melee',
                weight: 0,
                properties: [],
                cost: '0 gp',
                isProficient: true,
                damageBonus: damageModifier,
                attackBonus: modifiers.str // Natural weapons typically use STR for attack
            };
        }

        // Get weapons a character is proficient with
        function getCharacterWeapons(className, occupation = null) {
            // Infants get no additional weapons - Tiny Fists is shown as their natural weapon
            if (occupation === 'infant') {
                return [];
            }
            
            // Handle commoners with occupation-based weapons
            if (className === 'commoner' || !className) {
                const occupationKey = occupation ? occupation.toLowerCase().replace(/\s+/g, '-') : 'default';
                const weapon = occupationWeapons[occupationKey] || occupationWeapons['default'];
                return [{
                    ...weapon,
                    id: 'improvised-' + occupationKey,
                    type: 'improvised',
                    category: 'melee',
                    weight: 1,
                    properties: [],
                    cost: '0 gp',
                    isProficient: true
                }];
            }

            const proficiency = classWeaponProficiencies[className] || { simple: true, martial: false, specific: [] };
            const preferred = classPreferredWeapons[className] || [];
            const result = [];

            // Add primary weapon (melee)
            const meleeWeapons = preferred.filter(id => weapons[id] && weapons[id].category === 'melee');
            if (meleeWeapons.length > 0) {
                const primaryMelee = meleeWeapons[Math.floor(Math.random() * meleeWeapons.length)];
                const weapon = weapons[primaryMelee];
                result.push({
                    ...weapon,
                    id: primaryMelee,
                    isProficient: true
                });
            }

            // Add ranged weapon if class typically uses one
            const rangedWeapons = preferred.filter(id => weapons[id] && weapons[id].category === 'ranged');
            if (rangedWeapons.length > 0 && Math.random() > 0.3) {
                const rangedWeapon = rangedWeapons[Math.floor(Math.random() * rangedWeapons.length)];
                const weapon = weapons[rangedWeapon];
                result.push({
                    ...weapon,
                    id: rangedWeapon,
                    isProficient: true
                });
            }

            // Add a backup weapon (dagger is common)
            if (result.length > 0 && Math.random() > 0.5) {
                const backupOptions = ['dagger', 'handaxe', 'light-hammer'];
                const validBackups = backupOptions.filter(id => {
                    if (proficiency.simple) return weapons[id].type === 'simple';
                    return proficiency.specific.includes(id);
                });
                if (validBackups.length > 0) {
                    const backup = validBackups[Math.floor(Math.random() * validBackups.length)];
                    if (!result.find(w => w.id === backup)) {
                        result.push({
                            ...weapons[backup],
                            id: backup,
                            isProficient: true
                        });
                    }
                }
            }

            return result;
        }

        // Check if a character is proficient with a specific weapon
        function isWeaponProficient(className, weaponId) {
            const proficiency = classWeaponProficiencies[className];
            if (!proficiency) return false;
            
            const weapon = weapons[weaponId];
            if (!weapon) return false;

            if (proficiency.simple && weapon.type === 'simple') return true;
            if (proficiency.martial && weapon.type === 'martial') return true;
            if (proficiency.specific.includes(weaponId)) return true;

            return false;
        }

        // Calculate attack bonus for a weapon
        function calculateAttackBonus(weapon, modifiers, proficiencyBonus, isProficient) {
            let abilityMod;
            
            // Finesse weapons can use STR or DEX
            if (weapon.properties.includes('finesse')) {
                abilityMod = Math.max(modifiers.str, modifiers.dex);
            } else if (weapon.category === 'ranged') {
                abilityMod = modifiers.dex;
            } else {
                abilityMod = modifiers.str;
            }

            return abilityMod + (isProficient ? proficiencyBonus : 0);
        }

        // Calculate damage for a weapon
        function calculateDamageBonus(weapon, modifiers) {
            // Finesse weapons can use STR or DEX for damage
            if (weapon.properties.includes('finesse')) {
                return Math.max(modifiers.str, modifiers.dex);
            } else if (weapon.category === 'ranged' && !weapon.properties.some(p => p.includes('thrown'))) {
                return modifiers.dex;
            } else {
                return modifiers.str;
            }
        }

        // Get unarmed strike stats based on class and level
        function getUnarmedStrike(className, level, modifiers, proficiencyBonus) {
            // Monk Martial Arts die progression
            const monkMartialArtsDie = {
                1: '1d4', 2: '1d4', 3: '1d4', 4: '1d4',
                5: '1d6', 6: '1d6', 7: '1d6', 8: '1d6', 9: '1d6', 10: '1d6',
                11: '1d8', 12: '1d8', 13: '1d8', 14: '1d8', 15: '1d8', 16: '1d8',
                17: '1d10', 18: '1d10', 19: '1d10', 20: '1d10'
            };

            const isMonk = className === 'monk';
            
            // Monks can use DEX for unarmed strikes (Martial Arts)
            const abilityMod = isMonk ? Math.max(modifiers.str, modifiers.dex) : modifiers.str;
            
            // Damage: Monks use Martial Arts die, others deal 1 + STR mod
            let damage, damageBonus;
            if (isMonk) {
                damage = monkMartialArtsDie[level] || '1d4';
                damageBonus = abilityMod;
            } else {
                damage = '1';
                damageBonus = modifiers.str;
            }

            return {
                id: 'unarmed-strike',
                name: 'Unarmed Strike',
                type: 'natural',
                category: 'melee',
                damage: damage,
                damageType: 'bludgeoning',
                weight: 0,
                properties: isMonk ? ['finesse', 'monk weapon'] : [],
                cost: '',
                description: isMonk 
                    ? 'Martial Arts allows you to use Dexterity instead of Strength and roll your Martial Arts die for damage.'
                    : 'A punch, kick, head-butt, or similar forceful blow.',
                isProficient: true,
                isUnarmed: true, // Flag to prevent removal
                attackBonus: abilityMod + proficiencyBonus,
                damageBonus: damageBonus
            };
        }

        // Spellcasting rules for each class
        const spellcastingRules = {
            artificer: {
                ability: 'int',
                type: 'prepared',
                startLevel: 1,
                casterType: 'half',
                cantripsKnown: [2,2,2,2,2,2,2,2,2,3,3,3,3,4,4,4,4,4,4,4],
                spellsKnownFormula: (level, mod) => Math.max(1, mod + Math.floor(level / 2)),
                restrictedSchools: null
            },
            bard: {
                ability: 'cha',
                type: 'known',
                startLevel: 1,
                casterType: 'full',
                cantripsKnown: [2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,5,5],
                spellsKnown: [4,5,6,7,8,9,10,11,12,14,15,15,16,18,19,19,20,22,22,22],
                restrictedSchools: null
            },
            cleric: {
                ability: 'wis',
                type: 'prepared',
                startLevel: 1,
                casterType: 'full',
                cantripsKnown: [3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5],
                spellsKnownFormula: (level, mod) => Math.max(1, mod + level),
                restrictedSchools: null
            },
            druid: {
                ability: 'wis',
                type: 'prepared',
                startLevel: 1,
                casterType: 'full',
                cantripsKnown: [2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4],
                spellsKnownFormula: (level, mod) => Math.max(1, mod + level),
                restrictedSchools: null
            },
            paladin: {
                ability: 'cha',
                type: 'prepared',
                startLevel: 2,
                casterType: 'half',
                cantripsKnown: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                spellsKnownFormula: (level, mod) => Math.max(1, mod + Math.floor(level / 2)),
                restrictedSchools: null
            },
            ranger: {
                ability: 'wis',
                type: 'known',
                startLevel: 2,
                casterType: 'half',
                cantripsKnown: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                spellsKnown: [0,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11],
                restrictedSchools: null
            },
            sorcerer: {
                ability: 'cha',
                type: 'known',
                startLevel: 1,
                casterType: 'full',
                cantripsKnown: [4,4,4,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6],
                spellsKnown: [2,3,4,5,6,7,8,9,10,11,12,12,13,13,14,14,15,15,15,15],
                restrictedSchools: null
            },
            warlock: {
                ability: 'cha',
                type: 'known',
                startLevel: 1,
                casterType: 'pact',
                cantripsKnown: [2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4],
                spellsKnown: [2,3,4,5,6,7,8,9,10,10,11,11,12,12,13,13,14,14,15,15],
                restrictedSchools: null
            },
            wizard: {
                ability: 'int',
                type: 'prepared',
                startLevel: 1,
                casterType: 'full',
                cantripsKnown: [3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5],
                spellsKnownFormula: (level, mod) => Math.max(1, mod + level),
                restrictedSchools: null
            },
            'eldritch-knight': {
                ability: 'int',
                type: 'known',
                startLevel: 3,
                casterType: 'third',
                cantripsKnown: [0,0,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3],
                spellsKnown: [0,0,3,4,4,4,5,6,6,7,8,8,9,10,10,11,11,11,12,13],
                restrictedSchools: ['abjuration', 'evocation']
            },
            'arcane-trickster': {
                ability: 'int',
                type: 'known',
                startLevel: 3,
                casterType: 'third',
                cantripsKnown: [0,0,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4],
                spellsKnown: [0,0,3,4,4,4,5,6,6,7,8,8,9,10,10,11,11,11,12,13],
                restrictedSchools: ['enchantment', 'illusion']
            }
        };

        // Spell slot progression tables
        const spellSlotTable = {
            full: [
                [2,0,0,0,0,0,0,0,0], // Level 1
                [3,0,0,0,0,0,0,0,0], // Level 2
                [4,2,0,0,0,0,0,0,0], // Level 3
                [4,3,0,0,0,0,0,0,0], // Level 4
                [4,3,2,0,0,0,0,0,0], // Level 5
                [4,3,3,0,0,0,0,0,0], // Level 6
                [4,3,3,1,0,0,0,0,0], // Level 7
                [4,3,3,2,0,0,0,0,0], // Level 8
                [4,3,3,3,1,0,0,0,0], // Level 9
                [4,3,3,3,2,0,0,0,0], // Level 10
                [4,3,3,3,2,1,0,0,0], // Level 11
                [4,3,3,3,2,1,0,0,0], // Level 12
                [4,3,3,3,2,1,1,0,0], // Level 13
                [4,3,3,3,2,1,1,0,0], // Level 14
                [4,3,3,3,2,1,1,1,0], // Level 15
                [4,3,3,3,2,1,1,1,0], // Level 16
                [4,3,3,3,2,1,1,1,1], // Level 17
                [4,3,3,3,3,1,1,1,1], // Level 18
                [4,3,3,3,3,2,1,1,1], // Level 19
                [4,3,3,3,3,2,2,1,1]  // Level 20
            ],
            half: [
                [0,0,0,0,0,0,0,0,0], // Level 1
                [2,0,0,0,0,0,0,0,0], // Level 2
                [3,0,0,0,0,0,0,0,0], // Level 3
                [3,0,0,0,0,0,0,0,0], // Level 4
                [4,2,0,0,0,0,0,0,0], // Level 5
                [4,2,0,0,0,0,0,0,0], // Level 6
                [4,3,0,0,0,0,0,0,0], // Level 7
                [4,3,0,0,0,0,0,0,0], // Level 8
                [4,3,2,0,0,0,0,0,0], // Level 9
                [4,3,2,0,0,0,0,0,0], // Level 10
                [4,3,3,0,0,0,0,0,0], // Level 11
                [4,3,3,0,0,0,0,0,0], // Level 12
                [4,3,3,1,0,0,0,0,0], // Level 13
                [4,3,3,1,0,0,0,0,0], // Level 14
                [4,3,3,2,0,0,0,0,0], // Level 15
                [4,3,3,2,0,0,0,0,0], // Level 16
                [4,3,3,3,1,0,0,0,0], // Level 17
                [4,3,3,3,1,0,0,0,0], // Level 18
                [4,3,3,3,2,0,0,0,0], // Level 19
                [4,3,3,3,2,0,0,0,0]  // Level 20
            ],
            third: [
                [0,0,0,0,0,0,0,0,0], // Level 1
                [0,0,0,0,0,0,0,0,0], // Level 2
                [2,0,0,0,0,0,0,0,0], // Level 3
                [3,0,0,0,0,0,0,0,0], // Level 4
                [3,0,0,0,0,0,0,0,0], // Level 5
                [3,0,0,0,0,0,0,0,0], // Level 6
                [4,2,0,0,0,0,0,0,0], // Level 7
                [4,2,0,0,0,0,0,0,0], // Level 8
                [4,2,0,0,0,0,0,0,0], // Level 9
                [4,3,0,0,0,0,0,0,0], // Level 10
                [4,3,0,0,0,0,0,0,0], // Level 11
                [4,3,0,0,0,0,0,0,0], // Level 12
                [4,3,2,0,0,0,0,0,0], // Level 13
                [4,3,2,0,0,0,0,0,0], // Level 14
                [4,3,2,0,0,0,0,0,0], // Level 15
                [4,3,3,0,0,0,0,0,0], // Level 16
                [4,3,3,0,0,0,0,0,0], // Level 17
                [4,3,3,0,0,0,0,0,0], // Level 18
                [4,3,3,1,0,0,0,0,0], // Level 19
                [4,3,3,1,0,0,0,0,0]  // Level 20
            ],
            pact: [
                [1,0,0,0,0,0,0,0,0], // Level 1 (1 slot, 1st level)
                [2,0,0,0,0,0,0,0,0], // Level 2 (2 slots, 1st level)
                [0,2,0,0,0,0,0,0,0], // Level 3 (2 slots, 2nd level)
                [0,2,0,0,0,0,0,0,0], // Level 4
                [0,0,2,0,0,0,0,0,0], // Level 5 (2 slots, 3rd level)
                [0,0,2,0,0,0,0,0,0], // Level 6
                [0,0,0,2,0,0,0,0,0], // Level 7 (2 slots, 4th level)
                [0,0,0,2,0,0,0,0,0], // Level 8
                [0,0,0,0,2,0,0,0,0], // Level 9 (2 slots, 5th level)
                [0,0,0,0,2,0,0,0,0], // Level 10
                [0,0,0,0,3,0,0,0,0], // Level 11 (3 slots, 5th level)
                [0,0,0,0,3,0,0,0,0], // Level 12
                [0,0,0,0,3,0,0,0,0], // Level 13
                [0,0,0,0,3,0,0,0,0], // Level 14
                [0,0,0,0,3,0,0,0,0], // Level 15
                [0,0,0,0,3,0,0,0,0], // Level 16
                [0,0,0,0,4,0,0,0,0], // Level 17 (4 slots, 5th level)
                [0,0,0,0,4,0,0,0,0], // Level 18
                [0,0,0,0,4,0,0,0,0], // Level 19
                [0,0,0,0,4,0,0,0,0]  // Level 20
            ]
        };

        // Warlock Mystic Arcanum (6th-9th level spells, 1/long rest each)
        const warlockMysticArcanum = {
            11: [6], // 1 6th-level spell
            13: [6, 7], // + 1 7th-level spell
            15: [6, 7, 8], // + 1 8th-level spell
            17: [6, 7, 8, 9] // + 1 9th-level spell
        };

        // Comprehensive D&D 5e Spell Database
        const spells = {
            // ========== CANTRIPS (Level 0) ==========
            'acid-splash': { name: 'Acid Splash', level: 0, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'sorcerer', 'wizard'], description: 'You hurl a bubble of acid. Choose one creature within range, or choose two creatures within range that are within 5 feet of each other. A target must succeed on a Dexterity saving throw or take 1d6 acid damage. This spell\'s damage increases by 1d6 when you reach 5th level (2d6), 11th level (3d6), and 17th level (4d6).', source: 'PHB' },
            'blade-ward': { name: 'Blade Ward', level: 0, school: 'abjuration', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: null }, duration: '1 round', concentration: false, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You extend your hand and trace a sigil of warding in the air. Until the end of your next turn, you have resistance against bludgeoning, piercing, and slashing damage dealt by weapon attacks.', source: 'PHB' },
            'booming-blade': { name: 'Booming Blade', level: 0, school: 'evocation', castingTime: '1 action', range: 'Self (5-foot radius)', components: { v: false, s: true, m: 'A melee weapon worth at least 1 sp' }, duration: '1 round', concentration: false, ritual: false, classes: ['artificer', 'sorcerer', 'warlock', 'wizard'], description: 'You brandish the weapon used in the spell\'s casting and make a melee attack with it against one creature within 5 feet of you. On a hit, the target suffers the weapon attack\'s normal effects and then becomes sheathed in booming energy until the start of your next turn. If the target willingly moves 5 feet or more before then, the target takes 1d8 thunder damage, and the spell ends. This spell\'s damage increases when you reach certain levels.', source: 'TCoE' },
            'chill-touch': { name: 'Chill Touch', level: 0, school: 'necromancy', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: '1 round', concentration: false, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'You create a ghostly, skeletal hand in the space of a creature within range. Make a ranged spell attack against the creature to assail it with the chill of the grave. On a hit, the target takes 1d8 necrotic damage, and it can\'t regain hit points until the start of your next turn. Until then, the hand clings to the target. If you hit an undead target, it also has disadvantage on attack rolls against you until the end of your next turn. This spell\'s damage increases by 1d8 when you reach 5th level (2d8), 11th level (3d8), and 17th level (4d8).', source: 'PHB' },
            'dancing-lights': { name: 'Dancing Lights', level: 0, school: 'evocation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: 'A bit of phosphorus or wychwood, or a glowworm' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['artificer', 'bard', 'sorcerer', 'wizard'], description: 'You create up to four torch-sized lights within range, making them appear as torches, lanterns, or glowing orbs that hover in the air for the duration. You can also combine the four lights into one glowing vaguely humanoid form of Medium size. Whichever form you choose, each light sheds dim light in a 10-foot radius.', source: 'PHB' },
            'druidcraft': { name: 'Druidcraft', level: 0, school: 'transmutation', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['druid'], description: 'Whispering to the spirits of nature, you create one of the following effects within range: You create a tiny, harmless sensory effect that predicts what the weather will be at your location for the next 24 hours. You instantly make a flower blossom, a seed pod open, or a leaf bud bloom. You create an instantaneous, harmless sensory effect, such as falling leaves, a puff of wind, the sound of a small animal, or the faint odor of skunk. You instantly light or snuff out a candle, a torch, or a small campfire.', source: 'PHB' },
            'eldritch-blast': { name: 'Eldritch Blast', level: 0, school: 'evocation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['warlock'], description: 'A beam of crackling energy streaks toward a creature within range. Make a ranged spell attack against the target. On a hit, the target takes 1d10 force damage. The spell creates more than one beam when you reach higher levels: two beams at 5th level, three beams at 11th level, and four beams at 17th level. You can direct the beams at the same target or at different ones. Make a separate attack roll for each beam.', source: 'PHB' },
            'fire-bolt': { name: 'Fire Bolt', level: 0, school: 'evocation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'sorcerer', 'wizard'], description: 'You hurl a mote of fire at a creature or object within range. Make a ranged spell attack against the target. On a hit, the target takes 1d10 fire damage. A flammable object hit by this spell ignites if it isn\'t being worn or carried. This spell\'s damage increases by 1d10 when you reach 5th level (2d10), 11th level (3d10), and 17th level (4d10).', source: 'PHB' },
            'friends': { name: 'Friends', level: 0, school: 'enchantment', castingTime: '1 action', range: 'Self', components: { v: false, s: true, m: 'A small amount of makeup applied to the face as this spell is cast' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'For the duration, you have advantage on all Charisma checks directed at one creature of your choice that isn\'t hostile toward you. When the spell ends, the creature realizes that you used magic to influence its mood and becomes hostile toward you.', source: 'PHB' },
            'green-flame-blade': { name: 'Green-Flame Blade', level: 0, school: 'evocation', castingTime: '1 action', range: 'Self (5-foot radius)', components: { v: false, s: true, m: 'A melee weapon worth at least 1 sp' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'sorcerer', 'warlock', 'wizard'], description: 'You brandish the weapon used in the spell\'s casting and make a melee attack with it against one creature within 5 feet of you. On a hit, the target suffers the weapon attack\'s normal effects, and you can cause green fire to leap from the target to a different creature of your choice that you can see within 5 feet of it. The second creature takes fire damage equal to your spellcasting ability modifier. This spell\'s damage increases when you reach certain levels.', source: 'TCoE' },
            'guidance': { name: 'Guidance', level: 0, school: 'divination', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['artificer', 'cleric', 'druid'], description: 'You touch one willing creature. Once before the spell ends, the target can roll a d4 and add the number rolled to one ability check of its choice. It can roll the die before or after making the ability check. The spell then ends.', source: 'PHB' },
            'gust': { name: 'Gust', level: 0, school: 'transmutation', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'You seize the air and compel it to create one of the following effects at a point you can see within range: One Medium or smaller creature that you choose must succeed on a Strength saving throw or be pushed up to 5 feet away from you. You create a small blast of air capable of moving one object that is neither held nor carried and that weighs no more than 5 pounds. You create a harmless sensory effect using air.', source: 'XGtE' },
            'light': { name: 'Light', level: 0, school: 'evocation', castingTime: '1 action', range: 'Touch', components: { v: true, s: false, m: 'A firefly or phosphorescent moss' }, duration: '1 hour', concentration: false, ritual: false, classes: ['artificer', 'bard', 'cleric', 'sorcerer', 'wizard'], description: 'You touch one object that is no larger than 10 feet in any dimension. Until the spell ends, the object sheds bright light in a 20-foot radius and dim light for an additional 20 feet. The light can be colored as you like. Completely covering the object with something opaque blocks the light. The spell ends if you cast it again or dismiss it as an action.', source: 'PHB' },
            'mage-hand': { name: 'Mage Hand', level: 0, school: 'conjuration', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: null }, duration: '1 minute', concentration: false, ritual: false, classes: ['artificer', 'bard', 'sorcerer', 'warlock', 'wizard'], description: 'A spectral, floating hand appears at a point you choose within range. The hand lasts for the duration or until you dismiss it as an action. The hand vanishes if it is ever more than 30 feet away from you or if you cast this spell again. You can use your action to control the hand. You can use the hand to manipulate an object, open an unlocked door or container, stow or retrieve an item from an open container, or pour the contents out of a vial.', source: 'PHB' },
            'mending': { name: 'Mending', level: 0, school: 'transmutation', castingTime: '1 minute', range: 'Touch', components: { v: true, s: true, m: 'Two lodestones' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'bard', 'cleric', 'druid', 'sorcerer', 'wizard'], description: 'This spell repairs a single break or tear in an object you touch, such as a broken chain link, two halves of a broken key, a torn cloak, or a leaking wineskin. As long as the break or tear is no larger than 1 foot in any dimension, you mend it, leaving no trace of the former damage.', source: 'PHB' },
            'message': { name: 'Message', level: 0, school: 'transmutation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: 'A short piece of copper wire' }, duration: '1 round', concentration: false, ritual: false, classes: ['artificer', 'bard', 'sorcerer', 'wizard'], description: 'You point your finger toward a creature within range and whisper a message. The target (and only the target) hears the message and can reply in a whisper that only you can hear. You can cast this spell through solid objects if you are familiar with the target and know it is beyond the barrier.', source: 'PHB' },
            'minor-illusion': { name: 'Minor Illusion', level: 0, school: 'illusion', castingTime: '1 action', range: '30 feet', components: { v: false, s: true, m: 'A bit of fleece' }, duration: '1 minute', concentration: false, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You create a sound or an image of an object within range that lasts for the duration. The illusion also ends if you dismiss it as an action or cast this spell again. If you create a sound, its volume can range from a whisper to a scream. If you create an image of an object, it must be no larger than a 5-foot cube. The image can\'t create sound, light, smell, or any other sensory effect. Physical interaction with the image reveals it to be an illusion.', source: 'PHB' },
            'poison-spray': { name: 'Poison Spray', level: 0, school: 'conjuration', castingTime: '1 action', range: '10 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'druid', 'sorcerer', 'warlock', 'wizard'], description: 'You extend your hand toward a creature you can see within range and project a puff of noxious gas from your palm. The creature must succeed on a Constitution saving throw or take 1d12 poison damage. This spell\'s damage increases by 1d12 when you reach 5th level (2d12), 11th level (3d12), and 17th level (4d12).', source: 'PHB' },
            'prestidigitation': { name: 'Prestidigitation', level: 0, school: 'transmutation', castingTime: '1 action', range: '10 feet', components: { v: true, s: true, m: null }, duration: 'Up to 1 hour', concentration: false, ritual: false, classes: ['artificer', 'bard', 'sorcerer', 'warlock', 'wizard'], description: 'This spell is a minor magical trick that novice spellcasters use for practice. You create one of the following magical effects within range: You create an instantaneous, harmless sensory effect. You instantaneously light or snuff out a candle, torch, or small campfire. You instantaneously clean or soil an object no larger than 1 cubic foot. You chill, warm, or flavor up to 1 cubic foot of nonliving material for 1 hour. You make a color, small mark, or symbol appear on an object or surface for 1 hour. You create a nonmagical trinket or illusory image that can fit in your hand.', source: 'PHB' },
            'produce-flame': { name: 'Produce Flame', level: 0, school: 'conjuration', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: null }, duration: '10 minutes', concentration: false, ritual: false, classes: ['druid'], description: 'A flickering flame appears in your hand. The flame remains there for the duration and harms neither you nor your equipment. The flame sheds bright light in a 10-foot radius and dim light for an additional 10 feet. The spell ends if you dismiss it as an action or if you cast it again. You can also attack with the flame, although doing so ends the spell. When you cast this spell, or as an action on a later turn, you can hurl the flame at a creature within 30 feet of you. Make a ranged spell attack. On a hit, the target takes 1d8 fire damage.', source: 'PHB' },
            'ray-of-frost': { name: 'Ray of Frost', level: 0, school: 'evocation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'sorcerer', 'wizard'], description: 'A frigid beam of blue-white light streaks toward a creature within range. Make a ranged spell attack against the target. On a hit, it takes 1d8 cold damage, and its speed is reduced by 10 feet until the start of your next turn. The spell\'s damage increases by 1d8 when you reach 5th level (2d8), 11th level (3d8), and 17th level (4d8).', source: 'PHB' },
            'resistance': { name: 'Resistance', level: 0, school: 'abjuration', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'A miniature cloak' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['artificer', 'cleric', 'druid'], description: 'You touch one willing creature. Once before the spell ends, the target can roll a d4 and add the number rolled to one saving throw of its choice. It can roll the die before or after making the saving throw. The spell then ends.', source: 'PHB' },
            'sacred-flame': { name: 'Sacred Flame', level: 0, school: 'evocation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric'], description: 'Flame-like radiance descends on a creature that you can see within range. The target must succeed on a Dexterity saving throw or take 1d8 radiant damage. The target gains no benefit from cover for this saving throw. The spell\'s damage increases by 1d8 when you reach 5th level (2d8), 11th level (3d8), and 17th level (4d8).', source: 'PHB' },
            'shillelagh': { name: 'Shillelagh', level: 0, school: 'transmutation', castingTime: '1 bonus action', range: 'Touch', components: { v: true, s: true, m: 'Mistletoe, a shamrock leaf, and a club or quarterstaff' }, duration: '1 minute', concentration: false, ritual: false, classes: ['druid'], description: 'The wood of a club or quarterstaff you are holding is imbued with nature\'s power. For the duration, you can use your spellcasting ability instead of Strength for the attack and damage rolls of melee attacks using that weapon, and the weapon\'s damage die becomes a d8. The weapon also becomes magical, if it isn\'t already. The spell ends if you cast it again or if you let go of the weapon.', source: 'PHB' },
            'shocking-grasp': { name: 'Shocking Grasp', level: 0, school: 'evocation', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'sorcerer', 'wizard'], description: 'Lightning springs from your hand to deliver a shock to a creature you try to touch. Make a melee spell attack against the target. You have advantage on the attack roll if the target is wearing armor made of metal. On a hit, the target takes 1d8 lightning damage, and it can\'t take reactions until the start of its next turn. The spell\'s damage increases by 1d8 when you reach 5th level (2d8), 11th level (3d8), and 17th level (4d8).', source: 'PHB' },
            'spare-the-dying': { name: 'Spare the Dying', level: 0, school: 'necromancy', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'cleric'], description: 'You touch a living creature that has 0 hit points. The creature becomes stable. This spell has no effect on undead or constructs.', source: 'PHB' },
            'thaumaturgy': { name: 'Thaumaturgy', level: 0, school: 'transmutation', castingTime: '1 action', range: '30 feet', components: { v: true, s: false, m: null }, duration: 'Up to 1 minute', concentration: false, ritual: false, classes: ['cleric'], description: 'You manifest a minor wonder, a sign of supernatural power, within range. You create one of the following magical effects within range: Your voice booms up to three times as loud as normal for 1 minute. You cause flames to flicker, brighten, dim, or change color for 1 minute. You cause harmless tremors in the ground for 1 minute. You create an instantaneous sound. You instantaneously cause an unlocked door or window to fly open or slam shut. You alter the appearance of your eyes for 1 minute.', source: 'PHB' },
            'thorn-whip': { name: 'Thorn Whip', level: 0, school: 'transmutation', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'The stem of a plant with thorns' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'druid'], description: 'You create a long, vine-like whip covered in thorns that lashes out at your command toward a creature in range. Make a melee spell attack against the target. If the attack hits, the creature takes 1d6 piercing damage, and if the creature is Large or smaller, you pull the creature up to 10 feet closer to you. This spell\'s damage increases by 1d6 when you reach 5th level (2d6), 11th level (3d6), and 17th level (4d6).', source: 'PHB' },
            'thunderclap': { name: 'Thunderclap', level: 0, school: 'evocation', castingTime: '1 action', range: 'Self (5-foot radius)', components: { v: false, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'bard', 'druid', 'sorcerer', 'warlock', 'wizard'], description: 'You create a burst of thunderous sound that can be heard up to 100 feet away. Each creature within range, other than you, must succeed on a Constitution saving throw or take 1d6 thunder damage. The spell\'s damage increases by 1d6 when you reach 5th level (2d6), 11th level (3d6), and 17th level (4d6).', source: 'XGtE' },
            'toll-the-dead': { name: 'Toll the Dead', level: 0, school: 'necromancy', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric', 'warlock', 'wizard'], description: 'You point at one creature you can see within range, and the sound of a dolorous bell fills the air around it for a moment. The target must succeed on a Wisdom saving throw or take 1d8 necrotic damage. If the target is missing any of its hit points, it instead takes 1d12 necrotic damage. The spell\'s damage increases by one die when you reach 5th level (2d8 or 2d12), 11th level (3d8 or 3d12), and 17th level (4d8 or 4d12).', source: 'XGtE' },
            'true-strike': { name: 'True Strike', level: 0, school: 'divination', castingTime: '1 action', range: '30 feet', components: { v: false, s: true, m: null }, duration: 'Concentration, up to 1 round', concentration: true, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You extend your hand and point a finger at a target in range. Your magic grants you a brief insight into the target\'s defenses. On your next turn, you gain advantage on your first attack roll against the target, provided that this spell hasn\'t ended.', source: 'PHB' },
            'vicious-mockery': { name: 'Vicious Mockery', level: 0, school: 'enchantment', castingTime: '1 action', range: '60 feet', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard'], description: 'You unleash a string of insults laced with subtle enchantments at a creature you can see within range. If the target can hear you (though it need not understand you), it must succeed on a Wisdom saving throw or take 1d4 psychic damage and have disadvantage on the next attack roll it makes before the end of its next turn. This spell\'s damage increases by 1d4 when you reach 5th level (2d4), 11th level (3d4), and 17th level (4d4).', source: 'PHB' },
            'word-of-radiance': { name: 'Word of Radiance', level: 0, school: 'evocation', castingTime: '1 action', range: '5 feet', components: { v: true, s: false, m: 'A holy symbol' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric'], description: 'You utter a divine word, and burning radiance erupts from you. Each creature of your choice that you can see within range must succeed on a Constitution saving throw or take 1d6 radiant damage. The spell\'s damage increases by 1d6 when you reach 5th level (2d6), 11th level (3d6), and 17th level (4d6).', source: 'XGtE' },

            // ========== 1ST LEVEL SPELLS ==========
            'absorb-elements': { name: 'Absorb Elements', level: 1, school: 'abjuration', castingTime: '1 reaction', range: 'Self', components: { v: false, s: true, m: null }, duration: '1 round', concentration: false, ritual: false, classes: ['artificer', 'druid', 'ranger', 'sorcerer', 'wizard'], description: 'The spell captures some of the incoming energy, lessening its effect on you and storing it for your next melee attack. You have resistance to the triggering damage type until the start of your next turn. Also, the first time you hit with a melee attack on your next turn, the target takes an extra 1d6 damage of the triggering type, and the spell ends.', source: 'XGtE' },
            'alarm': { name: 'Alarm', level: 1, school: 'abjuration', castingTime: '1 minute', range: '30 feet', components: { v: true, s: true, m: 'A tiny bell and a piece of fine silver wire' }, duration: '8 hours', concentration: false, ritual: true, classes: ['artificer', 'ranger', 'wizard'], description: 'You set an alarm against unwanted intrusion. Choose a door, a window, or an area within range that is no larger than a 20-foot cube. Until the spell ends, an alarm alerts you whenever a Tiny or larger creature touches or enters the warded area.', source: 'PHB' },
            'animal-friendship': { name: 'Animal Friendship', level: 1, school: 'enchantment', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A morsel of food' }, duration: '24 hours', concentration: false, ritual: false, classes: ['bard', 'druid', 'ranger'], description: 'This spell lets you convince a beast that you mean it no harm. Choose a beast that you can see within range. It must see and hear you. If the beast\'s Intelligence is 4 or higher, the spell fails. Otherwise, the beast must succeed on a Wisdom saving throw or be charmed by you for the spell\'s duration.', source: 'PHB' },
            'armor-of-agathys': { name: 'Armor of Agathys', level: 1, school: 'abjuration', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'A cup of water' }, duration: '1 hour', concentration: false, ritual: false, classes: ['warlock'], description: 'A protective magical force surrounds you, manifesting as a spectral frost that covers you and your gear. You gain 5 temporary hit points for the duration. If a creature hits you with a melee attack while you have these hit points, the creature takes 5 cold damage.', source: 'PHB' },
            'arms-of-hadar': { name: 'Arms of Hadar', level: 1, school: 'conjuration', castingTime: '1 action', range: 'Self (10-foot radius)', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['warlock'], description: 'You invoke the power of Hadar, the Dark Hunger. Tendrils of dark energy erupt from you and batter all creatures within 10 feet of you. Each creature in that area must make a Strength saving throw. On a failed save, a target takes 2d6 necrotic damage and can\'t take reactions until its next turn. On a successful save, the creature takes half damage, but suffers no other effect.', source: 'PHB' },
            'bane': { name: 'Bane', level: 1, school: 'enchantment', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A drop of blood' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'cleric'], description: 'Up to three creatures of your choice that you can see within range must make Charisma saving throws. Whenever a target that fails this saving throw makes an attack roll or a saving throw before the spell ends, the target must roll a d4 and subtract the number rolled from the attack roll or saving throw.', source: 'PHB' },
            'bless': { name: 'Bless', level: 1, school: 'enchantment', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A sprinkling of holy water' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['cleric', 'paladin'], description: 'You bless up to three creatures of your choice within range. Whenever a target makes an attack roll or a saving throw before the spell ends, the target can roll a d4 and add the number rolled to the attack roll or saving throw.', source: 'PHB' },
            'burning-hands': { name: 'Burning Hands', level: 1, school: 'evocation', castingTime: '1 action', range: 'Self (15-foot cone)', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'As you hold your hands with thumbs touching and fingers spread, a thin sheet of flames shoots forth from your outstretched fingertips. Each creature in a 15-foot cone must make a Dexterity saving throw. A creature takes 3d6 fire damage on a failed save, or half as much damage on a successful one.', source: 'PHB' },
            'charm-person': { name: 'Charm Person', level: 1, school: 'enchantment', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: null }, duration: '1 hour', concentration: false, ritual: false, classes: ['bard', 'druid', 'sorcerer', 'warlock', 'wizard'], description: 'You attempt to charm a humanoid you can see within range. It must make a Wisdom saving throw, and does so with advantage if you or your companions are fighting it. If it fails the saving throw, it is charmed by you until the spell ends or until you or your companions do anything harmful to it. The charmed creature regards you as a friendly acquaintance.', source: 'PHB' },
            'chromatic-orb': { name: 'Chromatic Orb', level: 1, school: 'evocation', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'A diamond worth at least 50 gp' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'You hurl a 4-inch-diameter sphere of energy at a creature that you can see within range. You choose acid, cold, fire, lightning, poison, or thunder for the type of orb you create, and then make a ranged spell attack against the target. If the attack hits, the creature takes 3d8 damage of the type you chose.', source: 'PHB' },
            'color-spray': { name: 'Color Spray', level: 1, school: 'illusion', castingTime: '1 action', range: 'Self (15-foot cone)', components: { v: true, s: true, m: 'A pinch of powder or sand that is colored red, yellow, and blue' }, duration: '1 round', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'A dazzling array of flashing, colored light springs from your hand. Roll 6d10; the total is how many hit points of creatures this spell can affect. Creatures in a 15-foot cone originating from you are affected in ascending order of their current hit points (ignoring unconscious creatures and creatures that can\'t see). Starting with the creature that has the lowest current hit points, each creature affected by this spell is blinded until the end of your next turn.', source: 'PHB' },
            'command': { name: 'Command', level: 1, school: 'enchantment', castingTime: '1 action', range: '60 feet', components: { v: true, s: false, m: null }, duration: '1 round', concentration: false, ritual: false, classes: ['cleric', 'paladin'], description: 'You speak a one-word command to a creature you can see within range. The target must succeed on a Wisdom saving throw or follow the command on its next turn. The spell has no effect if the target is undead, if it doesn\'t understand your language, or if your command is directly harmful to it. Some typical commands and their effects follow: Approach, Drop, Flee, Grovel, Halt.', source: 'PHB' },
            'compelled-duel': { name: 'Compelled Duel', level: 1, school: 'enchantment', castingTime: '1 bonus action', range: '30 feet', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['paladin'], description: 'You attempt to compel a creature into a duel. One creature that you can see within range must make a Wisdom saving throw. On a failed save, the creature is drawn to you, compelled by your divine demand. For the duration, it has disadvantage on attack rolls against creatures other than you, and must make a Wisdom saving throw each time it attempts to move to a space that is more than 30 feet away from you.', source: 'PHB' },
            'comprehend-languages': { name: 'Comprehend Languages', level: 1, school: 'divination', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'A pinch of soot and salt' }, duration: '1 hour', concentration: false, ritual: true, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'For the duration, you understand the literal meaning of any spoken language that you hear. You also understand any written language that you see, but you must be touching the surface on which the words are written. It takes about 1 minute to read one page of text.', source: 'PHB' },
            'create-or-destroy-water': { name: 'Create or Destroy Water', level: 1, school: 'transmutation', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A drop of water if creating water or a few grains of sand if destroying it' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric', 'druid'], description: 'You either create or destroy water. Create Water: You create up to 10 gallons of clean water within range in an open container. Alternatively, the water falls as rain in a 30-foot cube within range, extinguishing exposed flames in the area. Destroy Water: You destroy up to 10 gallons of water in an open container within range. Alternatively, you destroy fog in a 30-foot cube within range.', source: 'PHB' },
            'cure-wounds': { name: 'Cure Wounds', level: 1, school: 'evocation', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'bard', 'cleric', 'druid', 'paladin', 'ranger'], description: 'A creature you touch regains a number of hit points equal to 1d8 + your spellcasting ability modifier. This spell has no effect on undead or constructs.', source: 'PHB' },
            'detect-evil-and-good': { name: 'Detect Evil and Good', level: 1, school: 'divination', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['cleric', 'paladin'], description: 'For the duration, you know if there is an aberration, celestial, elemental, fey, fiend, or undead within 30 feet of you, as well as where the creature is located. Similarly, you know if there is a place or object within 30 feet of you that has been magically consecrated or desecrated.', source: 'PHB' },
            'detect-magic': { name: 'Detect Magic', level: 1, school: 'divination', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: true, classes: ['artificer', 'bard', 'cleric', 'druid', 'paladin', 'ranger', 'sorcerer', 'wizard'], description: 'For the duration, you sense the presence of magic within 30 feet of you. If you sense magic in this way, you can use your action to see a faint aura around any visible creature or object in the area that bears magic, and you learn its school of magic, if any.', source: 'PHB' },
            'detect-poison-and-disease': { name: 'Detect Poison and Disease', level: 1, school: 'divination', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'A yew leaf' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: true, classes: ['cleric', 'druid', 'paladin', 'ranger'], description: 'For the duration, you can sense the presence and location of poisons, poisonous creatures, and diseases within 30 feet of you. You also identify the kind of poison, poisonous creature, or disease in each case.', source: 'PHB' },
            'disguise-self': { name: 'Disguise Self', level: 1, school: 'illusion', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: null }, duration: '1 hour', concentration: false, ritual: false, classes: ['artificer', 'bard', 'sorcerer', 'wizard'], description: 'You make yourselfincluding your clothing, armor, weapons, and other belongings on your personlook different until the spell ends or until you use your action to dismiss it. You can seem 1 foot shorter or taller and can appear thin, fat, or in between. You can\'t change your body type, so you must adopt a form that has the same basic arrangement of limbs.', source: 'PHB' },
            'dissonant-whispers': { name: 'Dissonant Whispers', level: 1, school: 'enchantment', castingTime: '1 action', range: '60 feet', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard'], description: 'You whisper a discordant melody that only one creature of your choice within range can hear, wracking it with terrible pain. The target must make a Wisdom saving throw. On a failed save, it takes 3d6 psychic damage and must immediately use its reaction, if available, to move as far as its speed allows away from you.', source: 'PHB' },
            'divine-favor': { name: 'Divine Favor', level: 1, school: 'evocation', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['paladin'], description: 'Your prayer empowers you with divine radiance. Until the spell ends, your weapon attacks deal an extra 1d4 radiant damage on a hit.', source: 'PHB' },
            'entangle': { name: 'Entangle', level: 1, school: 'conjuration', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['druid', 'ranger'], description: 'Grasping weeds and vines sprout from the ground in a 20-foot square starting from a point within range. For the duration, these plants turn the ground in the area into difficult terrain. A creature in the area when you cast the spell must succeed on a Strength saving throw or be restrained by the entangling plants until the spell ends.', source: 'PHB' },
            'expeditious-retreat': { name: 'Expeditious Retreat', level: 1, school: 'transmutation', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['artificer', 'sorcerer', 'warlock', 'wizard'], description: 'This spell allows you to move at an incredible pace. When you cast this spell, and then as a bonus action on each of your turns until the spell ends, you can take the Dash action.', source: 'PHB' },
            'faerie-fire': { name: 'Faerie Fire', level: 1, school: 'evocation', castingTime: '1 action', range: '60 feet', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['artificer', 'bard', 'druid'], description: 'Each object in a 20-foot cube within range is outlined in blue, green, or violet light (your choice). Any creature in the area when the spell is cast is also outlined in light if it fails a Dexterity saving throw. For the duration, objects and affected creatures shed dim light in a 10-foot radius. Any attack roll against an affected creature or object has advantage if the attacker can see it, and the affected creature or object can\'t benefit from being invisible.', source: 'PHB' },
            'false-life': { name: 'False Life', level: 1, school: 'necromancy', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'A small amount of alcohol or distilled spirits' }, duration: '1 hour', concentration: false, ritual: false, classes: ['artificer', 'sorcerer', 'wizard'], description: 'Bolstering yourself with a necromantic facsimile of life, you gain 1d4 + 4 temporary hit points for the duration.', source: 'PHB' },
            'feather-fall': { name: 'Feather Fall', level: 1, school: 'transmutation', castingTime: '1 reaction', range: '60 feet', components: { v: true, s: false, m: 'A small feather or piece of down' }, duration: '1 minute', concentration: false, ritual: false, classes: ['artificer', 'bard', 'sorcerer', 'wizard'], description: 'Choose up to five falling creatures within range. A falling creature\'s rate of descent slows to 60 feet per round until the spell ends. If the creature lands before the spell ends, it takes no falling damage and can land on its feet, and the spell ends for that creature.', source: 'PHB' },
            'find-familiar': { name: 'Find Familiar', level: 1, school: 'conjuration', castingTime: '1 hour', range: '10 feet', components: { v: true, s: true, m: '10 gp worth of charcoal, incense, and herbs that must be consumed by fire in a brass brazier' }, duration: 'Instantaneous', concentration: false, ritual: true, classes: ['wizard'], description: 'You gain the service of a familiar, a spirit that takes an animal form you choose: bat, cat, crab, frog (toad), hawk, lizard, octopus, owl, poisonous snake, fish (quipper), rat, raven, sea horse, spider, or weasel. The familiar has the statistics of the chosen form, though it is a celestial, fey, or fiend (your choice) instead of a beast.', source: 'PHB' },
            'fog-cloud': { name: 'Fog Cloud', level: 1, school: 'conjuration', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['druid', 'ranger', 'sorcerer', 'wizard'], description: 'You create a 20-foot-radius sphere of fog centered on a point within range. The sphere spreads around corners, and its area is heavily obscured. It lasts for the duration or until a wind of moderate or greater speed (at least 10 miles per hour) disperses it.', source: 'PHB' },
            'goodberry': { name: 'Goodberry', level: 1, school: 'transmutation', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'A sprig of mistletoe' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['druid', 'ranger'], description: 'Up to ten berries appear in your hand and are infused with magic for the duration. A creature can use its action to eat one berry. Eating a berry restores 1 hit point, and the berry provides enough nourishment to sustain a creature for one day. The berries lose their potency if they have not been consumed within 24 hours of the casting of this spell.', source: 'PHB' },
            'grease': { name: 'Grease', level: 1, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A bit of pork rind or butter' }, duration: '1 minute', concentration: false, ritual: false, classes: ['artificer', 'wizard'], description: 'Slick grease covers the ground in a 10-foot square centered on a point within range and turns it into difficult terrain for the duration. When the grease appears, each creature standing in its area must succeed on a Dexterity saving throw or fall prone. A creature that enters the area or ends its turn there must also succeed on a Dexterity saving throw or fall prone.', source: 'PHB' },
            'guiding-bolt': { name: 'Guiding Bolt', level: 1, school: 'evocation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: '1 round', concentration: false, ritual: false, classes: ['cleric'], description: 'A flash of light streaks toward a creature of your choice within range. Make a ranged spell attack against the target. On a hit, the target takes 4d6 radiant damage, and the next attack roll made against this target before the end of your next turn has advantage, thanks to the mystical dim light glittering on the target until then.', source: 'PHB' },
            'healing-word': { name: 'Healing Word', level: 1, school: 'evocation', castingTime: '1 bonus action', range: '60 feet', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'cleric', 'druid'], description: 'A creature of your choice that you can see within range regains hit points equal to 1d4 + your spellcasting ability modifier. This spell has no effect on undead or constructs.', source: 'PHB' },
            'hellish-rebuke': { name: 'Hellish Rebuke', level: 1, school: 'evocation', castingTime: '1 reaction', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['warlock'], description: 'You point your finger, and the creature that damaged you is momentarily surrounded by hellish flames. The creature must make a Dexterity saving throw. It takes 2d10 fire damage on a failed save, or half as much damage on a successful one.', source: 'PHB' },
            'heroism': { name: 'Heroism', level: 1, school: 'enchantment', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'paladin'], description: 'A willing creature you touch is imbued with bravery. Until the spell ends, the creature is immune to being frightened and gains temporary hit points equal to your spellcasting ability modifier at the start of each of its turns. When the spell ends, the target loses any remaining temporary hit points from this spell.', source: 'PHB' },
            'hex': { name: 'Hex', level: 1, school: 'enchantment', castingTime: '1 bonus action', range: '90 feet', components: { v: true, s: true, m: 'The petrified eye of a newt' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['warlock'], description: 'You place a curse on a creature that you can see within range. Until the spell ends, you deal an extra 1d6 necrotic damage to the target whenever you hit it with an attack. Also, choose one ability when you cast the spell. The target has disadvantage on ability checks made with the chosen ability.', source: 'PHB' },
            'hunters-mark': { name: "Hunter's Mark", level: 1, school: 'divination', castingTime: '1 bonus action', range: '90 feet', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['ranger'], description: 'You choose a creature you can see within range and mystically mark it as your quarry. Until the spell ends, you deal an extra 1d6 damage to the target whenever you hit it with a weapon attack, and you have advantage on any Wisdom (Perception) or Wisdom (Survival) check you make to find it.', source: 'PHB' },
            'identify': { name: 'Identify', level: 1, school: 'divination', castingTime: '1 minute', range: 'Touch', components: { v: true, s: true, m: 'A pearl worth at least 100 gp and an owl feather' }, duration: 'Instantaneous', concentration: false, ritual: true, classes: ['artificer', 'bard', 'wizard'], description: 'You choose one object that you must touch throughout the casting of the spell. If it is a magic item or some other magic-imbued object, you learn its properties and how to use them, whether it requires attunement to use, and how many charges it has, if any.', source: 'PHB' },
            'illusory-script': { name: 'Illusory Script', level: 1, school: 'illusion', castingTime: '1 minute', range: 'Touch', components: { v: false, s: true, m: 'A lead-based ink worth at least 10 gp, which the spell consumes' }, duration: '10 days', concentration: false, ritual: true, classes: ['bard', 'warlock', 'wizard'], description: 'You write on parchment, paper, or some other suitable writing material and imbue it with a potent illusion that lasts for the duration. To you and any creatures you designate when you cast the spell, the writing appears normal, written in your hand, and conveys whatever meaning you intended when you wrote the text.', source: 'PHB' },
            'inflict-wounds': { name: 'Inflict Wounds', level: 1, school: 'necromancy', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric'], description: 'Make a melee spell attack against a creature you can reach. On a hit, the target takes 3d10 necrotic damage.', source: 'PHB' },
            'jump': { name: 'Jump', level: 1, school: 'transmutation', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'A grasshopper\'s hind leg' }, duration: '1 minute', concentration: false, ritual: false, classes: ['artificer', 'druid', 'ranger', 'sorcerer', 'wizard'], description: 'You touch a creature. The creature\'s jump distance is tripled until the spell ends.', source: 'PHB' },
            'longstrider': { name: 'Longstrider', level: 1, school: 'transmutation', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'A pinch of dirt' }, duration: '1 hour', concentration: false, ritual: false, classes: ['artificer', 'bard', 'druid', 'ranger', 'wizard'], description: 'You touch a creature. The target\'s speed increases by 10 feet until the spell ends.', source: 'PHB' },
            'mage-armor': { name: 'Mage Armor', level: 1, school: 'abjuration', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'A piece of cured leather' }, duration: '8 hours', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'You touch a willing creature who isn\'t wearing armor, and a protective magical force surrounds it until the spell ends. The target\'s base AC becomes 13 + its Dexterity modifier. The spell ends if the target dons armor or if you dismiss the spell as an action.', source: 'PHB' },
            'magic-missile': { name: 'Magic Missile', level: 1, school: 'evocation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'You create three glowing darts of magical force. Each dart hits a creature of your choice that you can see within range. A dart deals 1d4 + 1 force damage to its target. The darts all strike simultaneously, and you can direct them to hit one creature or several.', source: 'PHB' },
            'protection-from-evil-and-good': { name: 'Protection from Evil and Good', level: 1, school: 'abjuration', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'Holy water or powdered silver and iron, which the spell consumes' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['cleric', 'paladin', 'warlock', 'wizard'], description: 'Until the spell ends, one willing creature you touch is protected against certain types of creatures: aberrations, celestials, elementals, fey, fiends, and undead. The protection grants several benefits against those creature types.', source: 'PHB' },
            'purify-food-and-drink': { name: 'Purify Food and Drink', level: 1, school: 'transmutation', castingTime: '1 action', range: '10 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: true, classes: ['artificer', 'cleric', 'druid', 'paladin'], description: 'All nonmagical food and drink within a 5-foot-radius sphere centered on a point of your choice within range is purified and rendered free of poison and disease.', source: 'PHB' },
            'sanctuary': { name: 'Sanctuary', level: 1, school: 'abjuration', castingTime: '1 bonus action', range: '30 feet', components: { v: true, s: true, m: 'A small silver mirror' }, duration: '1 minute', concentration: false, ritual: false, classes: ['artificer', 'cleric'], description: 'You ward a creature within range against attack. Until the spell ends, any creature who targets the warded creature with an attack or a harmful spell must first make a Wisdom saving throw. On a failed save, the creature must choose a new target or lose the attack or spell.', source: 'PHB' },
            'searing-smite': { name: 'Searing Smite', level: 1, school: 'evocation', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['paladin'], description: 'The next time you hit a creature with a melee weapon attack during the spell\'s duration, your weapon flares with white-hot intensity, and the attack deals an extra 1d6 fire damage to the target and causes the target to ignite in flames.', source: 'PHB' },
            'shield': { name: 'Shield', level: 1, school: 'abjuration', castingTime: '1 reaction', range: 'Self', components: { v: true, s: true, m: null }, duration: '1 round', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'An invisible barrier of magical force appears and protects you. Until the start of your next turn, you have a +5 bonus to AC, including against the triggering attack, and you take no damage from magic missile.', source: 'PHB' },
            'shield-of-faith': { name: 'Shield of Faith', level: 1, school: 'abjuration', castingTime: '1 bonus action', range: '60 feet', components: { v: true, s: true, m: 'A small parchment with a bit of holy text written on it' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['cleric', 'paladin'], description: 'A shimmering field appears and surrounds a creature of your choice within range, granting it a +2 bonus to AC for the duration.', source: 'PHB' },
            'silent-image': { name: 'Silent Image', level: 1, school: 'illusion', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A bit of fleece' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['bard', 'sorcerer', 'wizard'], description: 'You create the image of an object, a creature, or some other visible phenomenon that is no larger than a 15-foot cube. The image appears at a spot within range and lasts for the duration. The image is purely visual; it isn\'t accompanied by sound, smell, or other sensory effects.', source: 'PHB' },
            'sleep': { name: 'Sleep', level: 1, school: 'enchantment', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'A pinch of fine sand, rose petals, or a cricket' }, duration: '1 minute', concentration: false, ritual: false, classes: ['bard', 'sorcerer', 'wizard'], description: 'This spell sends creatures into a magical slumber. Roll 5d8; the total is how many hit points of creatures this spell can affect. Creatures within 20 feet of a point you choose within range are affected in ascending order of their current hit points (ignoring unconscious creatures).', source: 'PHB' },
            'speak-with-animals': { name: 'Speak with Animals', level: 1, school: 'divination', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: null }, duration: '10 minutes', concentration: false, ritual: true, classes: ['bard', 'druid', 'ranger'], description: 'You gain the ability to comprehend and verbally communicate with beasts for the duration. The knowledge and awareness of many beasts is limited by their intelligence, but at minimum, beasts can give you information about nearby locations and monsters, including whatever they can perceive or have perceived within the past day.', source: 'PHB' },
            'tashas-hideous-laughter': { name: "Tasha's Hideous Laughter", level: 1, school: 'enchantment', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'Tiny tarts and a feather that is waved in the air' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'wizard'], description: 'A creature of your choice that you can see within range perceives everything as hilariously funny and falls into fits of laughter if this spell affects it. The target must succeed on a Wisdom saving throw or fall prone, becoming incapacitated and unable to stand up for the duration.', source: 'PHB' },
            'tensers-floating-disk': { name: "Tenser's Floating Disk", level: 1, school: 'conjuration', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A drop of mercury' }, duration: '1 hour', concentration: false, ritual: true, classes: ['wizard'], description: 'This spell creates a circular, horizontal plane of force, 3 feet in diameter and 1 inch thick, that floats 3 feet above the ground in an unoccupied space of your choice that you can see within range. The disk remains for the duration, and can hold up to 500 pounds.', source: 'PHB' },
            'thunderous-smite': { name: 'Thunderous Smite', level: 1, school: 'evocation', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['paladin'], description: 'The first time you hit with a melee weapon attack during this spell\'s duration, your weapon rings with thunder that is audible within 300 feet of you, and the attack deals an extra 2d6 thunder damage to the target. Additionally, if the target is a creature, it must succeed on a Strength saving throw or be pushed 10 feet away from you and knocked prone.', source: 'PHB' },
            'thunderwave': { name: 'Thunderwave', level: 1, school: 'evocation', castingTime: '1 action', range: 'Self (15-foot cube)', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'druid', 'sorcerer', 'wizard'], description: 'A wave of thunderous force sweeps out from you. Each creature in a 15-foot cube originating from you must make a Constitution saving throw. On a failed save, a creature takes 2d8 thunder damage and is pushed 10 feet away from you. On a successful save, the creature takes half as much damage and isn\'t pushed.', source: 'PHB' },
            'unseen-servant': { name: 'Unseen Servant', level: 1, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A piece of string and a bit of wood' }, duration: '1 hour', concentration: false, ritual: true, classes: ['bard', 'warlock', 'wizard'], description: 'This spell creates an invisible, mindless, shapeless, Medium force that performs simple tasks at your command until the spell ends. The servant springs into existence in an unoccupied space on the ground within range. It has AC 10, 1 hit point, and a Strength of 2, and it can\'t attack.', source: 'PHB' },
            'witch-bolt': { name: 'Witch Bolt', level: 1, school: 'evocation', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A twig from a tree that has been struck by lightning' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'A beam of crackling, blue energy lances out toward a creature within range, forming a sustained arc of lightning between you and the target. Make a ranged spell attack against that creature. On a hit, the target takes 1d12 lightning damage, and on each of your turns for the duration, you can use your action to deal 1d12 lightning damage to the target automatically.', source: 'PHB' },
            'wrathful-smite': { name: 'Wrathful Smite', level: 1, school: 'evocation', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['paladin'], description: 'The next time you hit with a melee weapon attack during this spell\'s duration, your attack deals an extra 1d6 psychic damage. Additionally, if the target is a creature, it must make a Wisdom saving throw or be frightened of you until the spell ends.', source: 'PHB' },

            // ========== 2ND LEVEL SPELLS ==========
            'aid': { name: 'Aid', level: 2, school: 'abjuration', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A tiny strip of white cloth' }, duration: '8 hours', concentration: false, ritual: false, classes: ['artificer', 'bard', 'cleric', 'paladin', 'ranger'], description: 'Your spell bolsters your allies with toughness and resolve. Choose up to three creatures within range. Each target\'s hit point maximum and current hit points increase by 5 for the duration.', source: 'PHB' },
            'alter-self': { name: 'Alter Self', level: 2, school: 'transmutation', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['artificer', 'sorcerer', 'wizard'], description: 'You assume a different form. When you cast the spell, choose one of the following options: Aquatic Adaptation, Change Appearance, or Natural Weapons.', source: 'PHB' },
            'arcane-lock': { name: 'Arcane Lock', level: 2, school: 'abjuration', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'Gold dust worth at least 25 gp, which the spell consumes' }, duration: 'Until dispelled', concentration: false, ritual: false, classes: ['artificer', 'wizard'], description: 'You touch a closed door, window, gate, chest, or other entryway, and it becomes locked for the duration. You and the creatures you designate when you cast this spell can open the object normally.', source: 'PHB' },
            'blindness-deafness': { name: 'Blindness/Deafness', level: 2, school: 'necromancy', castingTime: '1 action', range: '30 feet', components: { v: true, s: false, m: null }, duration: '1 minute', concentration: false, ritual: false, classes: ['bard', 'cleric', 'sorcerer', 'wizard'], description: 'You can blind or deafen a foe. Choose one creature that you can see within range to make a Constitution saving throw. If it fails, the target is either blinded or deafened (your choice) for the duration.', source: 'PHB' },
            'blur': { name: 'Blur', level: 2, school: 'illusion', castingTime: '1 action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['artificer', 'sorcerer', 'wizard'], description: 'Your body becomes blurred, shifting and wavering to all who can see you. For the duration, any creature has disadvantage on attack rolls against you.', source: 'PHB' },
            'calm-emotions': { name: 'Calm Emotions', level: 2, school: 'enchantment', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'cleric'], description: 'You attempt to suppress strong emotions in a group of people. Each humanoid in a 20-foot-radius sphere centered on a point you choose within range must make a Charisma saving throw.', source: 'PHB' },
            'cloud-of-daggers': { name: 'Cloud of Daggers', level: 2, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A sliver of glass' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You fill the air with spinning daggers in a cube 5 feet on each side, centered on a point you choose within range. A creature takes 4d4 slashing damage when it enters the spell\'s area for the first time on a turn or starts its turn there.', source: 'PHB' },
            'darkness': { name: 'Darkness', level: 2, school: 'evocation', castingTime: '1 action', range: '60 feet', components: { v: true, s: false, m: 'Bat fur and a drop of pitch or piece of coal' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'Magical darkness spreads from a point you choose within range to fill a 15-foot-radius sphere for the duration. Darkvision can\'t see through it, and nonmagical light can\'t illuminate it.', source: 'PHB' },
            'darkvision': { name: 'Darkvision', level: 2, school: 'transmutation', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'Either a pinch of dried carrot or an agate' }, duration: '8 hours', concentration: false, ritual: false, classes: ['artificer', 'druid', 'ranger', 'sorcerer', 'wizard'], description: 'You touch a willing creature to grant it the ability to see in the dark. For the duration, that creature has darkvision out to a range of 60 feet.', source: 'PHB' },
            'detect-thoughts': { name: 'Detect Thoughts', level: 2, school: 'divination', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'A copper piece' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'sorcerer', 'wizard'], description: 'For the duration, you can read the thoughts of certain creatures. When you cast the spell and as your action on each turn until the spell ends, you can focus your mind on any one creature that you can see within 30 feet of you.', source: 'PHB' },
            'enhance-ability': { name: 'Enhance Ability', level: 2, school: 'transmutation', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'Fur or a feather from a beast' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['artificer', 'bard', 'cleric', 'druid', 'ranger', 'sorcerer'], description: 'You touch a creature and bestow upon it a magical enhancement. Choose one of the following effects: Bear\'s Endurance, Bull\'s Strength, Cat\'s Grace, Eagle\'s Splendor, Fox\'s Cunning, or Owl\'s Wisdom.', source: 'PHB' },
            'enlarge-reduce': { name: 'Enlarge/Reduce', level: 2, school: 'transmutation', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A pinch of powdered iron' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['artificer', 'sorcerer', 'wizard'], description: 'You cause a creature or an object you can see within range to grow larger or smaller for the duration. Choose either a creature or an object that is neither worn nor carried.', source: 'PHB' },
            'find-steed': { name: 'Find Steed', level: 2, school: 'conjuration', castingTime: '10 minutes', range: '30 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['paladin'], description: 'You summon a spirit that assumes the form of an unusually intelligent, strong, and loyal steed, creating a long-lasting bond with it.', source: 'PHB' },
            'flaming-sphere': { name: 'Flaming Sphere', level: 2, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A bit of tallow, a pinch of brimstone, and a dusting of powdered iron' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'A 5-foot-diameter sphere of fire appears in an unoccupied space of your choice within range and lasts for the duration. Any creature that ends its turn within 5 feet of the sphere must make a Dexterity saving throw. The creature takes 2d6 fire damage on a failed save, or half as much damage on a successful one.', source: 'PHB' },
            'heat-metal': { name: 'Heat Metal', level: 2, school: 'transmutation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A piece of iron and a flame' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['artificer', 'bard', 'druid'], description: 'Choose a manufactured metal object, such as a metal weapon or a suit of heavy or medium metal armor, that you can see within range. You cause the object to glow red-hot. Any creature in physical contact with the object takes 2d8 fire damage when you cast the spell.', source: 'PHB' },
            'hold-person': { name: 'Hold Person', level: 2, school: 'enchantment', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A small, straight piece of iron' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'cleric', 'druid', 'sorcerer', 'warlock', 'wizard'], description: 'Choose a humanoid that you can see within range. The target must succeed on a Wisdom saving throw or be paralyzed for the duration. At the end of each of its turns, the target can make another Wisdom saving throw. On a success, the spell ends on the target.', source: 'PHB' },
            'invisibility': { name: 'Invisibility', level: 2, school: 'illusion', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'An eyelash encased in gum arabic' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['artificer', 'bard', 'sorcerer', 'warlock', 'wizard'], description: 'A creature you touch becomes invisible until the spell ends. Anything the target is wearing or carrying is invisible as long as it is on the target\'s person. The spell ends for a target that attacks or casts a spell.', source: 'PHB' },
            'knock': { name: 'Knock', level: 2, school: 'transmutation', castingTime: '1 action', range: '60 feet', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'sorcerer', 'wizard'], description: 'Choose an object that you can see within range. The object can be a door, a box, a chest, a set of manacles, a padlock, or another object that contains a mundane or magical means that prevents access. A target that is held shut by a mundane lock or that is stuck or barred becomes unlocked, unstuck, or unbarred.', source: 'PHB' },
            'lesser-restoration': { name: 'Lesser Restoration', level: 2, school: 'abjuration', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'bard', 'cleric', 'druid', 'paladin', 'ranger'], description: 'You touch a creature and can end either one disease or one condition afflicting it. The condition can be blinded, deafened, paralyzed, or poisoned.', source: 'PHB' },
            'levitate': { name: 'Levitate', level: 2, school: 'transmutation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'Either a small leather loop or a piece of golden wire bent into a cup shape with a long shank on one end' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['artificer', 'sorcerer', 'wizard'], description: 'One creature or loose object of your choice that you can see within range rises vertically, up to 20 feet, and remains suspended there for the duration.', source: 'PHB' },
            'locate-object': { name: 'Locate Object', level: 2, school: 'divination', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'A forked twig' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['bard', 'cleric', 'druid', 'paladin', 'ranger', 'wizard'], description: 'Describe or name an object that is familiar to you. You sense the direction to the object\'s location, as long as that object is within 1,000 feet of you.', source: 'PHB' },
            'magic-weapon': { name: 'Magic Weapon', level: 2, school: 'transmutation', castingTime: '1 bonus action', range: 'Touch', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['artificer', 'paladin', 'wizard'], description: 'You touch a nonmagical weapon. Until the spell ends, that weapon becomes a magic weapon with a +1 bonus to attack rolls and damage rolls.', source: 'PHB' },
            'mirror-image': { name: 'Mirror Image', level: 2, school: 'illusion', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: null }, duration: '1 minute', concentration: false, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'Three illusory duplicates of yourself appear in your space. Until the spell ends, the duplicates move with you and mimic your actions, shifting position so it\'s impossible to track which image is real.', source: 'PHB' },
            'misty-step': { name: 'Misty Step', level: 2, school: 'conjuration', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'Briefly surrounded by silvery mist, you teleport up to 30 feet to an unoccupied space that you can see.', source: 'PHB' },
            'moonbeam': { name: 'Moonbeam', level: 2, school: 'evocation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: 'Several seeds of any moonseed plant and a piece of opalescent feldspar' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['druid'], description: 'A silvery beam of pale light shines down in a 5-foot-radius, 40-foot-high cylinder centered on a point within range. Until the spell ends, dim light fills the cylinder. When a creature enters the spell\'s area for the first time on a turn or starts its turn there, it is engulfed in ghostly flames that cause searing pain, and it must make a Constitution saving throw. It takes 2d10 radiant damage on a failed save, or half as much damage on a successful one.', source: 'PHB' },
            'pass-without-trace': { name: 'Pass without Trace', level: 2, school: 'abjuration', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'Ashes from a burned leaf of mistletoe and a sprig of spruce' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['druid', 'ranger'], description: 'A veil of shadows and silence radiates from you, masking you and your companions from detection. For the duration, each creature you choose within 30 feet of you (including you) has a +10 bonus to Dexterity (Stealth) checks and can\'t be tracked except by magical means.', source: 'PHB' },
            'prayer-of-healing': { name: 'Prayer of Healing', level: 2, school: 'evocation', castingTime: '10 minutes', range: '30 feet', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric', 'paladin'], description: 'Up to six creatures of your choice that you can see within range each regain hit points equal to 2d8 + your spellcasting ability modifier. This spell has no effect on undead or constructs.', source: 'PHB' },
            'protection-from-poison': { name: 'Protection from Poison', level: 2, school: 'abjuration', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: '1 hour', concentration: false, ritual: false, classes: ['artificer', 'cleric', 'druid', 'paladin', 'ranger'], description: 'You touch a creature. If it is poisoned, you neutralize the poison. If more than one poison afflicts the target, you neutralize one poison that you know is present, or you neutralize one at random. For the duration, the target has advantage on saving throws against being poisoned, and it has resistance to poison damage.', source: 'PHB' },
            'scorching-ray': { name: 'Scorching Ray', level: 2, school: 'evocation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'You create three rays of fire and hurl them at targets within range. You can hurl them at one target or several. Make a ranged spell attack for each ray. On a hit, the target takes 2d6 fire damage.', source: 'PHB' },
            'see-invisibility': { name: 'See Invisibility', level: 2, school: 'divination', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'A pinch of talc and a small sprinkling of powdered silver' }, duration: '1 hour', concentration: false, ritual: false, classes: ['artificer', 'bard', 'sorcerer', 'wizard'], description: 'For the duration, you see invisible creatures and objects as if they were visible, and you can see into the Ethereal Plane.', source: 'PHB' },
            'shatter': { name: 'Shatter', level: 2, school: 'evocation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A chip of mica' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'A sudden loud ringing noise, painfully intense, erupts from a point of your choice within range. Each creature in a 10-foot-radius sphere centered on that point must make a Constitution saving throw. A creature takes 3d8 thunder damage on a failed save, or half as much damage on a successful one.', source: 'PHB' },
            'silence': { name: 'Silence', level: 2, school: 'illusion', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: true, classes: ['bard', 'cleric', 'ranger'], description: 'For the duration, no sound can be created within or pass through a 20-foot-radius sphere centered on a point you choose within range. Any creature or object entirely inside the sphere is immune to thunder damage, and creatures are deafened while entirely inside it. Casting a spell that includes a verbal component is impossible there.', source: 'PHB' },
            'spider-climb': { name: 'Spider Climb', level: 2, school: 'transmutation', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'A drop of bitumen and a spider' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['artificer', 'sorcerer', 'warlock', 'wizard'], description: 'Until the spell ends, one willing creature you touch gains the ability to move up, down, and across vertical surfaces and upside down along ceilings, while leaving its hands free. The target also gains a climbing speed equal to its walking speed.', source: 'PHB' },
            'spiritual-weapon': { name: 'Spiritual Weapon', level: 2, school: 'evocation', castingTime: '1 bonus action', range: '60 feet', components: { v: true, s: true, m: null }, duration: '1 minute', concentration: false, ritual: false, classes: ['cleric'], description: 'You create a floating, spectral weapon within range that lasts for the duration or until you cast this spell again. When you cast the spell, you can make a melee spell attack against a creature within 5 feet of the weapon. On a hit, the target takes force damage equal to 1d8 + your spellcasting ability modifier.', source: 'PHB' },
            'suggestion': { name: 'Suggestion', level: 2, school: 'enchantment', castingTime: '1 action', range: '30 feet', components: { v: true, s: false, m: 'A snake\'s tongue and either a bit of honeycomb or a drop of sweet oil' }, duration: 'Concentration, up to 8 hours', concentration: true, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You suggest a course of activity (limited to a sentence or two) and magically influence a creature you can see within range that can hear and understand you. Creatures that can\'t be charmed are immune to this effect.', source: 'PHB' },
            'warding-bond': { name: 'Warding Bond', level: 2, school: 'abjuration', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'A pair of platinum rings worth at least 50 gp each, which you and the target must wear for the duration' }, duration: '1 hour', concentration: false, ritual: false, classes: ['cleric', 'paladin'], description: 'This spell wards a willing creature you touch and creates a mystic connection between you and the target until the spell ends. While the target is within 60 feet of you, it gains a +1 bonus to AC and saving throws, and it has resistance to all damage. Also, each time it takes damage, you take the same amount of damage.', source: 'PHB' },
            'web': { name: 'Web', level: 2, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A bit of spiderweb' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['artificer', 'sorcerer', 'wizard'], description: 'You conjure a mass of thick, sticky webbing at a point of your choice within range. The webs fill a 20-foot cube from that point for the duration. The webs are difficult terrain and lightly obscure their area.', source: 'PHB' },
            'zone-of-truth': { name: 'Zone of Truth', level: 2, school: 'enchantment', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: '10 minutes', concentration: false, ritual: false, classes: ['bard', 'cleric', 'paladin'], description: 'You create a magical zone that guards against deception in a 15-foot-radius sphere centered on a point of your choice within range. Until the spell ends, a creature that enters the spell\'s area for the first time on a turn or starts its turn there must make a Charisma saving throw. On a failed save, a creature can\'t speak a deliberate lie while in the radius.', source: 'PHB' },

            // ========== 3RD LEVEL SPELLS ==========
            'animate-dead': { name: 'Animate Dead', level: 3, school: 'necromancy', castingTime: '1 minute', range: '10 feet', components: { v: true, s: true, m: 'A drop of blood, a piece of flesh, and a pinch of bone dust' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric', 'wizard'], description: 'This spell creates an undead servant. Choose a pile of bones or a corpse of a Medium or Small humanoid within range. Your spell imbues the target with a foul mimicry of life, raising it as an undead creature.', source: 'PHB' },
            'aura-of-vitality': { name: 'Aura of Vitality', level: 3, school: 'evocation', castingTime: '1 action', range: 'Self (30-foot radius)', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['cleric', 'druid', 'paladin'], description: 'Healing energy radiates from you in an aura with a 30-foot radius. Until the spell ends, the aura moves with you, centered on you. You can use a bonus action to cause one creature in the aura (including you) to regain 2d6 hit points.', source: 'PHB' },
            'beacon-of-hope': { name: 'Beacon of Hope', level: 3, school: 'abjuration', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['cleric'], description: 'This spell bestows hope and vitality. Choose any number of creatures within range. For the duration, each target has advantage on Wisdom saving throws and death saving throws, and regains the maximum number of hit points possible from any healing.', source: 'PHB' },
            'bestow-curse': { name: 'Bestow Curse', level: 3, school: 'necromancy', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'cleric', 'wizard'], description: 'You touch a creature, and that creature must succeed on a Wisdom saving throw or become cursed for the duration of the spell. When you cast this spell, choose the nature of the curse.', source: 'PHB' },
            'call-lightning': { name: 'Call Lightning', level: 3, school: 'conjuration', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['druid'], description: 'A storm cloud appears in the shape of a cylinder that is 10 feet tall with a 60-foot radius, centered on a point you can see within range directly above you. Each creature within 5 feet of that point must make a Dexterity saving throw. A creature takes 3d10 lightning damage on a failed save, or half as much damage on a successful one.', source: 'PHB' },
            'conjure-animals': { name: 'Conjure Animals', level: 3, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['druid', 'ranger'], description: 'You summon fey spirits that take the form of beasts and appear in unoccupied spaces that you can see within range.', source: 'PHB' },
            'counterspell': { name: 'Counterspell', level: 3, school: 'abjuration', castingTime: '1 reaction', range: '60 feet', components: { v: false, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'You attempt to interrupt a creature in the process of casting a spell. If the creature is casting a spell of 3rd level or lower, its spell fails and has no effect. If it is casting a spell of 4th level or higher, make an ability check using your spellcasting ability.', source: 'PHB' },
            'crusaders-mantle': { name: "Crusader's Mantle", level: 3, school: 'evocation', castingTime: '1 action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['paladin'], description: 'Holy power radiates from you in an aura with a 30-foot radius, awakening boldness in friendly creatures. Until the spell ends, the aura moves with you, centered on you. While in the aura, each nonhostile creature in the aura (including you) deals an extra 1d4 radiant damage when it hits with a weapon attack.', source: 'PHB' },
            'daylight': { name: 'Daylight', level: 3, school: 'evocation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: '1 hour', concentration: false, ritual: false, classes: ['cleric', 'druid', 'paladin', 'ranger', 'sorcerer'], description: 'A 60-foot-radius sphere of light spreads out from a point you choose within range. The sphere is bright light and sheds dim light for an additional 60 feet.', source: 'PHB' },
            'dispel-magic': { name: 'Dispel Magic', level: 3, school: 'abjuration', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'bard', 'cleric', 'druid', 'paladin', 'sorcerer', 'warlock', 'wizard'], description: 'Choose one creature, object, or magical effect within range. Any spell of 3rd level or lower on the target ends. For each spell of 4th level or higher on the target, make an ability check using your spellcasting ability.', source: 'PHB' },
            'fear': { name: 'Fear', level: 3, school: 'illusion', castingTime: '1 action', range: 'Self (30-foot cone)', components: { v: true, s: true, m: 'A white feather or the heart of a hen' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You project a phantasmal image of a creature\'s worst fears. Each creature in a 30-foot cone must succeed on a Wisdom saving throw or drop whatever it is holding and become frightened for the duration.', source: 'PHB' },
            'fireball': { name: 'Fireball', level: 3, school: 'evocation', castingTime: '1 action', range: '150 feet', components: { v: true, s: true, m: 'A tiny ball of bat guano and sulfur' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'A bright streak flashes from your pointing finger to a point you choose within range and then blossoms with a low roar into an explosion of flame. Each creature in a 20-foot-radius sphere centered on that point must make a Dexterity saving throw. A target takes 8d6 fire damage on a failed save, or half as much damage on a successful one.', source: 'PHB' },
            'fly': { name: 'Fly', level: 3, school: 'transmutation', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'A wing feather from any bird' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['artificer', 'sorcerer', 'warlock', 'wizard'], description: 'You touch a willing creature. The target gains a flying speed of 60 feet for the duration. When the spell ends, the target falls if it is still aloft, unless it can stop the fall.', source: 'PHB' },
            'haste': { name: 'Haste', level: 3, school: 'transmutation', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A shaving of licorice root' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['artificer', 'sorcerer', 'wizard'], description: 'Choose a willing creature that you can see within range. Until the spell ends, the target\'s speed is doubled, it gains a +2 bonus to AC, it has advantage on Dexterity saving throws, and it gains an additional action on each of its turns.', source: 'PHB' },
            'hunger-of-hadar': { name: 'Hunger of Hadar', level: 3, school: 'conjuration', castingTime: '1 action', range: '150 feet', components: { v: true, s: true, m: 'A pickled octopus tentacle' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['warlock'], description: 'You open a gateway to the dark between the stars, a region infested with unknown horrors. A 20-foot-radius sphere of blackness and bitter cold appears, centered on a point within range.', source: 'PHB' },
            'hypnotic-pattern': { name: 'Hypnotic Pattern', level: 3, school: 'illusion', castingTime: '1 action', range: '120 feet', components: { v: false, s: true, m: 'A glowing stick of incense or a crystal vial filled with phosphorescent material' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You create a twisting pattern of colors that weaves through the air inside a 30-foot cube within range. The pattern appears for a moment and vanishes. Each creature in the area who sees the pattern must make a Wisdom saving throw. On a failed save, the creature becomes charmed for the duration.', source: 'PHB' },
            'leomunds-tiny-hut': { name: "Leomund's Tiny Hut", level: 3, school: 'evocation', castingTime: '1 minute', range: 'Self (10-foot-radius hemisphere)', components: { v: true, s: true, m: 'A small crystal bead' }, duration: '8 hours', concentration: false, ritual: true, classes: ['bard', 'wizard'], description: 'A 10-foot-radius immobile dome of force springs into existence around and above you and remains stationary for the duration. The spell ends if you leave its area.', source: 'PHB' },
            'lightning-bolt': { name: 'Lightning Bolt', level: 3, school: 'evocation', castingTime: '1 action', range: 'Self (100-foot line)', components: { v: true, s: true, m: 'A bit of fur and a rod of amber, crystal, or glass' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'A stroke of lightning forming a line 100 feet long and 5 feet wide blasts out from you in a direction you choose. Each creature in the line must make a Dexterity saving throw. A creature takes 8d6 lightning damage on a failed save, or half as much damage on a successful one.', source: 'PHB' },
            'magic-circle': { name: 'Magic Circle', level: 3, school: 'abjuration', castingTime: '1 minute', range: '10 feet', components: { v: true, s: true, m: 'Holy water or powdered silver and iron worth at least 100 gp, which the spell consumes' }, duration: '1 hour', concentration: false, ritual: false, classes: ['cleric', 'paladin', 'warlock', 'wizard'], description: 'You create a 10-foot-radius, 20-foot-tall cylinder of magical energy centered on a point on the ground that you can see within range. The cylinder is protection against creatures of a chosen type.', source: 'PHB' },
            'major-image': { name: 'Major Image', level: 3, school: 'illusion', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: 'A bit of fleece' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You create the image of an object, a creature, or some other visible phenomenon that is no larger than a 20-foot cube. The image appears at a spot that you can see within range and lasts for the duration. It seems completely real, including sounds, smells, and temperature appropriate to the thing depicted.', source: 'PHB' },
            'mass-healing-word': { name: 'Mass Healing Word', level: 3, school: 'evocation', castingTime: '1 bonus action', range: '60 feet', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'cleric'], description: 'As you call out words of restoration, up to six creatures of your choice that you can see within range regain hit points equal to 1d4 + your spellcasting ability modifier. This spell has no effect on undead or constructs.', source: 'PHB' },
            'plant-growth': { name: 'Plant Growth', level: 3, school: 'transmutation', castingTime: '1 action or 8 hours', range: '150 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'druid', 'ranger'], description: 'This spell channels vitality into plants within a specific area. There are two possible uses for the spell, granting either immediate or long-term benefits.', source: 'PHB' },
            'protection-from-energy': { name: 'Protection from Energy', level: 3, school: 'abjuration', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['artificer', 'cleric', 'druid', 'ranger', 'sorcerer', 'wizard'], description: 'For the duration, the willing creature you touch has resistance to one damage type of your choice: acid, cold, fire, lightning, or thunder.', source: 'PHB' },
            'remove-curse': { name: 'Remove Curse', level: 3, school: 'abjuration', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric', 'paladin', 'warlock', 'wizard'], description: 'At your touch, all curses affecting one creature or object end. If the object is a cursed magic item, its curse remains, but the spell breaks its owner\'s attunement to the object so it can be removed or discarded.', source: 'PHB' },
            'revivify': { name: 'Revivify', level: 3, school: 'necromancy', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'Diamonds worth 300 gp, which the spell consumes' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'cleric', 'druid', 'paladin', 'ranger'], description: 'You touch a creature that has died within the last minute. That creature returns to life with 1 hit point. This spell can\'t return to life a creature that has died of old age, nor can it restore any missing body parts.', source: 'PHB' },
            'sending': { name: 'Sending', level: 3, school: 'evocation', castingTime: '1 action', range: 'Unlimited', components: { v: true, s: true, m: 'A short piece of fine copper wire' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'cleric', 'wizard'], description: 'You send a short message of twenty-five words or less to a creature with which you are familiar. The creature hears the message in its mind, recognizes you as the sender if it knows you, and can answer in a like manner immediately.', source: 'PHB' },
            'slow': { name: 'Slow', level: 3, school: 'transmutation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: 'A drop of molasses' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['sorcerer', 'wizard'], description: 'You alter time around up to six creatures of your choice in a 40-foot cube within range. Each target must succeed on a Wisdom saving throw or be affected by this spell for the duration.', source: 'PHB' },
            'speak-with-dead': { name: 'Speak with Dead', level: 3, school: 'necromancy', castingTime: '1 action', range: '10 feet', components: { v: true, s: true, m: 'Burning incense' }, duration: '10 minutes', concentration: false, ritual: false, classes: ['bard', 'cleric'], description: 'You grant the semblance of life and intelligence to a corpse of your choice within range, allowing it to answer the questions you pose. The corpse must still have a mouth and can\'t be undead.', source: 'PHB' },
            'spirit-guardians': { name: 'Spirit Guardians', level: 3, school: 'conjuration', castingTime: '1 action', range: 'Self (15-foot radius)', components: { v: true, s: true, m: 'A holy symbol' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['cleric'], description: 'You call forth spirits to protect you. They flit around you to a distance of 15 feet for the duration. If you are good or neutral, their spectral form appears angelic or fey. If you are evil, they appear fiendish.', source: 'PHB' },
            'stinking-cloud': { name: 'Stinking Cloud', level: 3, school: 'conjuration', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'A rotten egg or several skunk cabbage leaves' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'sorcerer', 'wizard'], description: 'You create a 20-foot-radius sphere of yellow, nauseating gas centered on a point within range. The cloud spreads around corners, and its area is heavily obscured.', source: 'PHB' },
            'tongues': { name: 'Tongues', level: 3, school: 'divination', castingTime: '1 action', range: 'Touch', components: { v: true, s: false, m: 'A small clay model of a ziggurat' }, duration: '1 hour', concentration: false, ritual: false, classes: ['bard', 'cleric', 'sorcerer', 'warlock', 'wizard'], description: 'This spell grants the creature you touch the ability to understand any spoken language it hears. Moreover, when the target speaks, any creature that knows at least one language and can hear the target understands what it says.', source: 'PHB' },
            'vampiric-touch': { name: 'Vampiric Touch', level: 3, school: 'necromancy', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'The touch of your shadow-wreathed hand can siphon life force from others to heal your wounds. Make a melee spell attack against a creature within your reach. On a hit, the target takes 3d6 necrotic damage, and you regain hit points equal to half the amount of necrotic damage dealt.', source: 'PHB' },
            'water-breathing': { name: 'Water Breathing', level: 3, school: 'transmutation', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A short reed or piece of straw' }, duration: '24 hours', concentration: false, ritual: true, classes: ['artificer', 'druid', 'ranger', 'sorcerer', 'wizard'], description: 'This spell grants up to ten willing creatures you can see within range the ability to breathe underwater until the spell ends. Affected creatures also retain their normal mode of respiration.', source: 'PHB' },
            'water-walk': { name: 'Water Walk', level: 3, school: 'transmutation', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A piece of cork' }, duration: '1 hour', concentration: false, ritual: true, classes: ['artificer', 'cleric', 'druid', 'ranger', 'sorcerer'], description: 'This spell grants the ability to move across any liquid surfacesuch as water, acid, mud, snow, quicksand, or lavaas if it were harmless solid ground (creatures crossing molten lava can still take damage from the heat).', source: 'PHB' },

            // ========== 4TH LEVEL SPELLS ==========
            'arcane-eye': { name: 'Arcane Eye', level: 4, school: 'divination', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A bit of bat fur' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['artificer', 'wizard'], description: 'You create an invisible, magical eye within range that hovers in the air for the duration. You mentally receive visual information from the eye, which has normal vision and darkvision out to 30 feet.', source: 'PHB' },
            'aura-of-life': { name: 'Aura of Life', level: 4, school: 'abjuration', castingTime: '1 action', range: 'Self (30-foot radius)', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['cleric', 'paladin'], description: 'Life-preserving energy radiates from you in an aura with a 30-foot radius. Until the spell ends, the aura moves with you, centered on you.', source: 'PHB' },
            'aura-of-purity': { name: 'Aura of Purity', level: 4, school: 'abjuration', castingTime: '1 action', range: 'Self (30-foot radius)', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['cleric', 'paladin'], description: 'Purifying energy radiates from you in an aura with a 30-foot radius. Until the spell ends, the aura moves with you, centered on you.', source: 'PHB' },
            'banishment': { name: 'Banishment', level: 4, school: 'abjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'An item distasteful to the target' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['cleric', 'paladin', 'sorcerer', 'warlock', 'wizard'], description: 'You attempt to send one creature that you can see within range to another plane of existence. The target must succeed on a Charisma saving throw or be banished.', source: 'PHB' },
            'blight': { name: 'Blight', level: 4, school: 'necromancy', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['druid', 'sorcerer', 'warlock', 'wizard'], description: 'Necromantic energy washes over a creature of your choice that you can see within range, draining moisture and vitality from it. The target must make a Constitution saving throw. The target takes 8d8 necrotic damage on a failed save, or half as much damage on a successful one.', source: 'PHB' },
            'confusion': { name: 'Confusion', level: 4, school: 'enchantment', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'Three nut shells' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'druid', 'sorcerer', 'wizard'], description: 'This spell assaults and twists creatures\' minds, spawning delusions and provoking uncontrolled action. Each creature in a 10-foot-radius sphere centered on a point you choose within range must succeed on a Wisdom saving throw when you cast this spell or be affected by it.', source: 'PHB' },
            'conjure-minor-elementals': { name: 'Conjure Minor Elementals', level: 4, school: 'conjuration', castingTime: '1 minute', range: '90 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['druid', 'wizard'], description: 'You summon elementals that appear in unoccupied spaces that you can see within range.', source: 'PHB' },
            'control-water': { name: 'Control Water', level: 4, school: 'transmutation', castingTime: '1 action', range: '300 feet', components: { v: true, s: true, m: 'A drop of water and a pinch of dust' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['cleric', 'druid', 'wizard'], description: 'Until the spell ends, you control any freestanding water inside an area you choose that is a cube up to 100 feet on a side.', source: 'PHB' },
            'death-ward': { name: 'Death Ward', level: 4, school: 'abjuration', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: '8 hours', concentration: false, ritual: false, classes: ['cleric', 'paladin'], description: 'You touch a creature and grant it a measure of protection from death. The first time the target would drop to 0 hit points as a result of taking damage, the target instead drops to 1 hit point, and the spell ends.', source: 'PHB' },
            'dimension-door': { name: 'Dimension Door', level: 4, school: 'conjuration', castingTime: '1 action', range: '500 feet', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You teleport yourself from your current location to any other spot within range. You arrive at exactly the spot desired. It can be a place you can see, one you can visualize, or one you can describe by stating distance and direction.', source: 'PHB' },
            'divination': { name: 'Divination', level: 4, school: 'divination', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'Incense and a sacrificial offering appropriate to your religion, together worth at least 25 gp, which the spell consumes' }, duration: 'Instantaneous', concentration: false, ritual: true, classes: ['cleric'], description: 'Your magic and an offering put you in contact with a god or a god\'s servants. You ask a single question concerning a specific goal, event, or activity to occur within 7 days.', source: 'PHB' },
            'dominate-beast': { name: 'Dominate Beast', level: 4, school: 'enchantment', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['druid', 'sorcerer'], description: 'You attempt to beguile a beast that you can see within range. It must succeed on a Wisdom saving throw or be charmed by you for the duration.', source: 'PHB' },
            'fabricate': { name: 'Fabricate', level: 4, school: 'transmutation', castingTime: '10 minutes', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'wizard'], description: 'You convert raw materials into products of the same material.', source: 'PHB' },
            'fire-shield': { name: 'Fire Shield', level: 4, school: 'evocation', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'A bit of phosphorus or a firefly' }, duration: '10 minutes', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'Thin and wispy flames wreathe your body for the duration, shedding bright light in a 10-foot radius and dim light for an additional 10 feet. You can end the spell early by using an action to dismiss it.', source: 'PHB' },
            'freedom-of-movement': { name: 'Freedom of Movement', level: 4, school: 'abjuration', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'A leather strap, bound around the arm or a similar appendage' }, duration: '1 hour', concentration: false, ritual: false, classes: ['artificer', 'bard', 'cleric', 'druid', 'paladin', 'ranger'], description: 'You touch a willing creature. For the duration, the target\'s movement is unaffected by difficult terrain, and spells and other magical effects can neither reduce the target\'s speed nor cause the target to be paralyzed or restrained.', source: 'PHB' },
            'greater-invisibility': { name: 'Greater Invisibility', level: 4, school: 'illusion', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'sorcerer', 'wizard'], description: 'You or a creature you touch becomes invisible until the spell ends. Anything the target is wearing or carrying is invisible as long as it is on the target\'s person.', source: 'PHB' },
            'guardian-of-faith': { name: 'Guardian of Faith', level: 4, school: 'conjuration', castingTime: '1 action', range: '30 feet', components: { v: true, s: false, m: null }, duration: '8 hours', concentration: false, ritual: false, classes: ['cleric'], description: 'A Large spectral guardian appears and hovers for the duration in an unoccupied space of your choice that you can see within range.', source: 'PHB' },
            'ice-storm': { name: 'Ice Storm', level: 4, school: 'evocation', castingTime: '1 action', range: '300 feet', components: { v: true, s: true, m: 'A pinch of dust and a few drops of water' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'A hail of rock-hard ice pounds to the ground in a 20-foot-radius, 40-foot-high cylinder centered on a point within range. Each creature in the cylinder must make a Dexterity saving throw. A creature takes 2d8 bludgeoning damage and 4d6 cold damage on a failed save, or half as much damage on a successful one.', source: 'PHB' },
            'locate-creature': { name: 'Locate Creature', level: 4, school: 'divination', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'A bit of fur from a bloodhound' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['bard', 'cleric', 'druid', 'paladin', 'ranger', 'wizard'], description: 'Describe or name a creature that is familiar to you. You sense the direction to the creature\'s location, as long as that creature is within 1,000 feet of you.', source: 'PHB' },
            'mordenkainens-faithful-hound': { name: "Mordenkainen's Faithful Hound", level: 4, school: 'conjuration', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A tiny silver whistle, a piece of bone, and a thread' }, duration: '8 hours', concentration: false, ritual: false, classes: ['artificer', 'wizard'], description: 'You conjure a phantom watchdog in an unoccupied space that you can see within range, where it remains for the duration, until you dismiss it as an action, or until you move more than 100 feet away from it.', source: 'PHB' },
            'otilukes-resilient-sphere': { name: "Otiluke's Resilient Sphere", level: 4, school: 'evocation', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A hemispherical piece of clear crystal and a matching hemispherical piece of gum arabic' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['artificer', 'wizard'], description: 'A sphere of shimmering force encloses a creature or object of Large size or smaller within range.', source: 'PHB' },
            'phantasmal-killer': { name: 'Phantasmal Killer', level: 4, school: 'illusion', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['wizard'], description: 'You tap into the nightmares of a creature you can see within range and create an illusory manifestation of its deepest fears, visible only to that creature.', source: 'PHB' },
            'polymorph': { name: 'Polymorph', level: 4, school: 'transmutation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A caterpillar cocoon' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['bard', 'druid', 'sorcerer', 'wizard'], description: 'This spell transforms a creature that you can see within range into a new form. An unwilling creature must make a Wisdom saving throw to avoid the effect.', source: 'PHB' },
            'staggering-smite': { name: 'Staggering Smite', level: 4, school: 'evocation', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['paladin'], description: 'The next time you hit a creature with a melee weapon attack during this spell\'s duration, your weapon pierces both body and mind, and the attack deals an extra 4d6 psychic damage to the target.', source: 'PHB' },
            'stone-shape': { name: 'Stone Shape', level: 4, school: 'transmutation', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'Soft clay, which must be worked into roughly the desired shape of the stone object' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'cleric', 'druid', 'wizard'], description: 'You touch a stone object of Medium size or smaller or a section of stone no more than 5 feet in any dimension and form it into any shape that suits your purpose.', source: 'PHB' },
            'stoneskin': { name: 'Stoneskin', level: 4, school: 'abjuration', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'Diamond dust worth 100 gp, which the spell consumes' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['artificer', 'druid', 'ranger', 'sorcerer', 'wizard'], description: 'This spell turns the flesh of a willing creature you touch as hard as stone. Until the spell ends, the target has resistance to nonmagical bludgeoning, piercing, and slashing damage.', source: 'PHB' },
            'summon-greater-demon': { name: 'Summon Greater Demon', level: 4, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A vial of blood from a humanoid killed within the past 24 hours' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['warlock', 'wizard'], description: 'You utter foul words, summoning one demon from the chaos of the Abyss.', source: 'XGtE' },
            'wall-of-fire': { name: 'Wall of Fire', level: 4, school: 'evocation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: 'A small piece of phosphorus' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'You create a wall of fire on a solid surface within range. You can make the wall up to 60 feet long, 20 feet high, and 1 foot thick, or a ringed wall up to 20 feet in diameter, 20 feet high, and 1 foot thick.', source: 'PHB' },

            // ========== 5TH LEVEL SPELLS ==========
            'animate-objects': { name: 'Animate Objects', level: 5, school: 'transmutation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['artificer', 'bard', 'sorcerer', 'wizard'], description: 'Objects come to life at your command. Choose up to ten nonmagical objects within range that are not being worn or carried.', source: 'PHB' },
            'antilife-shell': { name: 'Antilife Shell', level: 5, school: 'abjuration', castingTime: '1 action', range: 'Self (10-foot radius)', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['druid'], description: 'A shimmering barrier extends out from you in a 10-foot radius and moves with you, remaining centered on you and hedging out creatures other than undead and constructs.', source: 'PHB' },
            'awaken': { name: 'Awaken', level: 5, school: 'transmutation', castingTime: '8 hours', range: 'Touch', components: { v: true, s: true, m: 'An agate worth at least 1,000 gp, which the spell consumes' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'druid'], description: 'After spending the casting time tracing magical pathways within a precious gemstone, you touch a Huge or smaller beast or plant.', source: 'PHB' },
            'banishing-smite': { name: 'Banishing Smite', level: 5, school: 'abjuration', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['paladin'], description: 'The next time you hit a creature with a weapon attack before this spell ends, your weapon crackles with force, and the attack deals an extra 5d10 force damage to the target.', source: 'PHB' },
            'bigbys-hand': { name: "Bigby's Hand", level: 5, school: 'evocation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: 'An eggshell and a snakeskin glove' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['artificer', 'sorcerer', 'wizard'], description: 'You create a Large hand of shimmering, translucent force in an unoccupied space that you can see within range.', source: 'PHB' },
            'circle-of-power': { name: 'Circle of Power', level: 5, school: 'abjuration', castingTime: '1 action', range: 'Self (30-foot radius)', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['paladin'], description: 'Divine energy radiates from you, distorting and diffusing magical energy within 30 feet of you.', source: 'PHB' },
            'cloudkill': { name: 'Cloudkill', level: 5, school: 'conjuration', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['sorcerer', 'wizard'], description: 'You create a 20-foot-radius sphere of poisonous, yellow-green fog centered on a point you choose within range.', source: 'PHB' },
            'commune': { name: 'Commune', level: 5, school: 'divination', castingTime: '1 minute', range: 'Self', components: { v: true, s: true, m: 'Incense and a vial of holy or unholy water' }, duration: '1 minute', concentration: false, ritual: true, classes: ['cleric'], description: 'You contact your deity or a divine proxy and ask up to three questions that can be answered with a yes or no.', source: 'PHB' },
            'commune-with-nature': { name: 'Commune with Nature', level: 5, school: 'divination', castingTime: '1 minute', range: 'Self', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: true, classes: ['druid', 'ranger'], description: 'You briefly become one with nature and gain knowledge of the surrounding territory.', source: 'PHB' },
            'cone-of-cold': { name: 'Cone of Cold', level: 5, school: 'evocation', castingTime: '1 action', range: 'Self (60-foot cone)', components: { v: true, s: true, m: 'A small crystal or glass cone' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'A blast of cold air erupts from your hands. Each creature in a 60-foot cone must make a Constitution saving throw. A creature takes 8d8 cold damage on a failed save, or half as much damage on a successful one.', source: 'PHB' },
            'conjure-elemental': { name: 'Conjure Elemental', level: 5, school: 'conjuration', castingTime: '1 minute', range: '90 feet', components: { v: true, s: true, m: 'Burning incense for air, soft clay for earth, sulfur and phosphorus for fire, or water and sand for water' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['druid', 'wizard'], description: 'You call forth an elemental servant.', source: 'PHB' },
            'contact-other-plane': { name: 'Contact Other Plane', level: 5, school: 'divination', castingTime: '1 minute', range: 'Self', components: { v: true, s: false, m: null }, duration: '1 minute', concentration: false, ritual: true, classes: ['warlock', 'wizard'], description: 'You mentally contact a demigod, the spirit of a long-dead sage, or some other mysterious entity from another plane.', source: 'PHB' },
            'contagion': { name: 'Contagion', level: 5, school: 'necromancy', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: '7 days', concentration: false, ritual: false, classes: ['cleric', 'druid'], description: 'Your touch inflicts disease. Make a melee spell attack against a creature within your reach. On a hit, the target is poisoned.', source: 'PHB' },
            'creation': { name: 'Creation', level: 5, school: 'illusion', castingTime: '1 minute', range: '30 feet', components: { v: true, s: true, m: 'A tiny piece of matter of the same type of the item you plan to create' }, duration: 'Special', concentration: false, ritual: false, classes: ['artificer', 'sorcerer', 'wizard'], description: 'You pull wisps of shadow material from the Shadowfell to create a nonliving object of vegetable matter within range.', source: 'PHB' },
            'destructive-wave': { name: 'Destructive Wave', level: 5, school: 'evocation', castingTime: '1 action', range: 'Self (30-foot radius)', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['paladin'], description: 'You strike the ground, creating a burst of divine energy that ripples outward from you. Each creature you choose within 30 feet of you must succeed on a Constitution saving throw or take 5d6 thunder damage, as well as 5d6 radiant or necrotic damage (your choice), and be knocked prone.', source: 'PHB' },
            'dispel-evil-and-good': { name: 'Dispel Evil and Good', level: 5, school: 'abjuration', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'Holy water or powdered silver and iron' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['cleric', 'paladin'], description: 'Shimmering energy surrounds and protects you from fey, undead, and creatures originating from beyond the Material Plane.', source: 'PHB' },
            'dominate-person': { name: 'Dominate Person', level: 5, school: 'enchantment', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'sorcerer', 'wizard'], description: 'You attempt to beguile a humanoid that you can see within range. It must succeed on a Wisdom saving throw or be charmed by you for the duration.', source: 'PHB' },
            'dream': { name: 'Dream', level: 5, school: 'illusion', castingTime: '1 minute', range: 'Special', components: { v: true, s: true, m: 'A handful of sand, a dab of ink, and a writing quill plucked from a sleeping bird' }, duration: '8 hours', concentration: false, ritual: false, classes: ['bard', 'warlock', 'wizard'], description: 'This spell shapes a creature\'s dreams. Choose a creature known to you as the target of this spell.', source: 'PHB' },
            'flame-strike': { name: 'Flame Strike', level: 5, school: 'evocation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A pinch of sulfur' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric'], description: 'A vertical column of divine fire roars down from the heavens in a location you specify. Each creature in a 10-foot-radius, 40-foot-high cylinder centered on a point within range must make a Dexterity saving throw. A creature takes 4d6 fire damage and 4d6 radiant damage on a failed save, or half as much damage on a successful one.', source: 'PHB' },
            'geas': { name: 'Geas', level: 5, school: 'enchantment', castingTime: '1 minute', range: '60 feet', components: { v: true, s: false, m: null }, duration: '30 days', concentration: false, ritual: false, classes: ['bard', 'cleric', 'druid', 'paladin', 'wizard'], description: 'You place a magical command on a creature that you can see within range, forcing it to carry out some service or refrain from some action or course of activity as you decide.', source: 'PHB' },
            'greater-restoration': { name: 'Greater Restoration', level: 5, school: 'abjuration', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'Diamond dust worth at least 100 gp, which the spell consumes' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'bard', 'cleric', 'druid'], description: 'You imbue a creature you touch with positive energy to undo a debilitating effect.', source: 'PHB' },
            'hallow': { name: 'Hallow', level: 5, school: 'evocation', castingTime: '24 hours', range: 'Touch', components: { v: true, s: true, m: 'Herbs, oils, and incense worth at least 1,000 gp, which the spell consumes' }, duration: 'Until dispelled', concentration: false, ritual: false, classes: ['cleric'], description: 'You touch a point and infuse an area around it with holy (or unholy) power.', source: 'PHB' },
            'hold-monster': { name: 'Hold Monster', level: 5, school: 'enchantment', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'A small, straight piece of iron' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'Choose a creature that you can see within range. The target must succeed on a Wisdom saving throw or be paralyzed for the duration.', source: 'PHB' },
            'insect-plague': { name: 'Insect Plague', level: 5, school: 'conjuration', castingTime: '1 action', range: '300 feet', components: { v: true, s: true, m: 'A few grains of sugar, some kernels of grain, and a smear of fat' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['cleric', 'druid', 'sorcerer'], description: 'Swarming, biting locusts fill a 20-foot-radius sphere centered on a point you choose within range.', source: 'PHB' },
            'legend-lore': { name: 'Legend Lore', level: 5, school: 'divination', castingTime: '10 minutes', range: 'Self', components: { v: true, s: true, m: 'Incense worth at least 250 gp, which the spell consumes, and four ivory strips worth at least 50 gp each' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'cleric', 'wizard'], description: 'Name or describe a person, place, or object. The spell brings to your mind a brief summary of the significant lore about the thing you named.', source: 'PHB' },
            'mass-cure-wounds': { name: 'Mass Cure Wounds', level: 5, school: 'evocation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'cleric', 'druid'], description: 'A wave of healing energy washes out from a point of your choice within range. Choose up to six creatures in a 30-foot-radius sphere centered on that point. Each target regains hit points equal to 3d8 + your spellcasting ability modifier.', source: 'PHB' },
            'modify-memory': { name: 'Modify Memory', level: 5, school: 'enchantment', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'wizard'], description: 'You attempt to reshape another creature\'s memories. One creature that you can see must make a Wisdom saving throw.', source: 'PHB' },
            'passwall': { name: 'Passwall', level: 5, school: 'transmutation', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A pinch of sesame seeds' }, duration: '1 hour', concentration: false, ritual: false, classes: ['wizard'], description: 'A passage appears at a point of your choice that you can see on a wooden, plaster, or stone surface (such as a wall, a ceiling, or a floor) within range, and lasts for the duration.', source: 'PHB' },
            'planar-binding': { name: 'Planar Binding', level: 5, school: 'abjuration', castingTime: '1 hour', range: '60 feet', components: { v: true, s: true, m: 'A jewel worth at least 1,000 gp, which the spell consumes' }, duration: '24 hours', concentration: false, ritual: false, classes: ['bard', 'cleric', 'druid', 'wizard'], description: 'With this spell, you attempt to bind a celestial, an elemental, a fey, or a fiend to your service.', source: 'PHB' },
            'raise-dead': { name: 'Raise Dead', level: 5, school: 'necromancy', castingTime: '1 hour', range: 'Touch', components: { v: true, s: true, m: 'A diamond worth at least 500 gp, which the spell consumes' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'cleric', 'paladin'], description: 'You return a dead creature you touch to life, provided that it has been dead no longer than 10 days.', source: 'PHB' },
            'rary-s-telepathic-bond': { name: "Rary's Telepathic Bond", level: 5, school: 'divination', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'Pieces of eggshell from two different kinds of creatures' }, duration: '1 hour', concentration: false, ritual: true, classes: ['wizard'], description: 'You forge a telepathic link among up to eight willing creatures of your choice within range, psychically linking each creature to all the others for the duration.', source: 'PHB' },
            'reincarnate': { name: 'Reincarnate', level: 5, school: 'transmutation', castingTime: '1 hour', range: 'Touch', components: { v: true, s: true, m: 'Rare oils and unguents worth at least 1,000 gp, which the spell consumes' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['druid'], description: 'You touch a dead humanoid or a piece of a dead humanoid. Provided that the creature has been dead no longer than 10 days, the spell forms a new adult body for it and then calls the soul to enter that body.', source: 'PHB' },
            'scrying': { name: 'Scrying', level: 5, school: 'divination', castingTime: '10 minutes', range: 'Self', components: { v: true, s: true, m: 'A focus worth at least 1,000 gp, such as a crystal ball, a silver mirror, or a font filled with holy water' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['bard', 'cleric', 'druid', 'warlock', 'wizard'], description: 'You can see and hear a particular creature you choose that is on the same plane of existence as you.', source: 'PHB' },
            'seeming': { name: 'Seeming', level: 5, school: 'illusion', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: null }, duration: '8 hours', concentration: false, ritual: false, classes: ['bard', 'sorcerer', 'wizard'], description: 'This spell allows you to change the appearance of any number of creatures that you can see within range.', source: 'PHB' },
            'synaptic-static': { name: 'Synaptic Static', level: 5, school: 'enchantment', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You choose a point within range and cause psychic energy to explode there. Each creature in a 20-foot-radius sphere centered on that point must make an Intelligence saving throw. A creature takes 8d6 psychic damage on a failed save, or half as much damage on a successful one.', source: 'XGtE' },
            'telekinesis': { name: 'Telekinesis', level: 5, school: 'transmutation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['sorcerer', 'wizard'], description: 'You gain the ability to move or manipulate creatures or objects by thought.', source: 'PHB' },
            'teleportation-circle': { name: 'Teleportation Circle', level: 5, school: 'conjuration', castingTime: '1 minute', range: '10 feet', components: { v: true, s: false, m: 'Rare chalks and inks infused with precious gems worth 50 gp, which the spell consumes' }, duration: '1 round', concentration: false, ritual: false, classes: ['bard', 'sorcerer', 'wizard'], description: 'As you cast the spell, you draw a 10-foot-diameter circle on the ground inscribed with sigils that link your location to a permanent teleportation circle of your choice whose sigil sequence you know.', source: 'PHB' },
            'tree-stride': { name: 'Tree Stride', level: 5, school: 'conjuration', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['druid', 'ranger'], description: 'You gain the ability to enter a tree and move from inside it to inside another tree of the same kind within 500 feet.', source: 'PHB' },
            'wall-of-force': { name: 'Wall of Force', level: 5, school: 'evocation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: 'A pinch of powder made by crushing a clear gemstone' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['wizard'], description: 'An invisible wall of force springs into existence at a point you choose within range.', source: 'PHB' },
            'wall-of-stone': { name: 'Wall of Stone', level: 5, school: 'evocation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: 'A small block of granite' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['artificer', 'druid', 'sorcerer', 'wizard'], description: 'A nonmagical wall of solid stone springs into existence at a point you choose within range.', source: 'PHB' },

            // ========== 6TH-9TH LEVEL SPELLS (Key Spells) ==========
            // 6th Level
            'blade-barrier': { name: 'Blade Barrier', level: 6, school: 'evocation', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['cleric'], description: 'You create a vertical wall of whirling, razor-sharp blades made of magical energy.', source: 'PHB' },
            'chain-lightning': { name: 'Chain Lightning', level: 6, school: 'evocation', castingTime: '1 action', range: '150 feet', components: { v: true, s: true, m: 'A bit of fur; a piece of amber, glass, or a crystal rod; and three silver pins' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'You create a bolt of lightning that arcs toward a target of your choice that you can see within range. Three bolts then leap from that target to as many as three other targets, each of which must be within 30 feet of the first target.', source: 'PHB' },
            'circle-of-death': { name: 'Circle of Death', level: 6, school: 'necromancy', castingTime: '1 action', range: '150 feet', components: { v: true, s: true, m: 'The powder of a crushed black pearl worth at least 500 gp' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'A sphere of negative energy ripples out in a 60-foot-radius sphere from a point within range. Each creature in that area must make a Constitution saving throw. A target takes 8d6 necrotic damage on a failed save, or half as much damage on a successful one.', source: 'PHB' },
            'create-undead': { name: 'Create Undead', level: 6, school: 'necromancy', castingTime: '1 minute', range: '10 feet', components: { v: true, s: true, m: 'One clay pot filled with grave dirt, one clay pot filled with brackish water, and one 150 gp black onyx stone for each corpse' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric', 'warlock', 'wizard'], description: 'You can cast this spell only at night. Choose up to three corpses of Medium or Small humanoids within range. Each corpse becomes a ghoul under your control.', source: 'PHB' },
            'disintegrate': { name: 'Disintegrate', level: 6, school: 'transmutation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A lodestone and a pinch of dust' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'A thin green ray springs from your pointing finger to a target that you can see within range. The target can be a creature, an object, or a creation of magical force. A creature targeted by this spell must make a Dexterity saving throw. On a failed save, the target takes 10d6 + 40 force damage.', source: 'PHB' },
            'eyebite': { name: 'Eyebite', level: 6, school: 'necromancy', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'For the spell\'s duration, your eyes become an inky void imbued with dread power.', source: 'PHB' },
            'find-the-path': { name: 'Find the Path', level: 6, school: 'divination', castingTime: '1 minute', range: 'Self', components: { v: true, s: true, m: 'A set of divinatory toolssuch as bones, ivory sticks, cards, teeth, or carved runesworth 100 gp and an object from the location you wish to find' }, duration: 'Concentration, up to 1 day', concentration: true, ritual: false, classes: ['bard', 'cleric', 'druid'], description: 'This spell allows you to find the shortest, most direct physical route to a specific fixed location that you are familiar with on the same plane of existence.', source: 'PHB' },
            'globe-of-invulnerability': { name: 'Globe of Invulnerability', level: 6, school: 'abjuration', castingTime: '1 action', range: 'Self (10-foot radius)', components: { v: true, s: true, m: 'A glass or crystal bead that shatters when the spell ends' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['sorcerer', 'wizard'], description: 'An immobile, faintly shimmering barrier springs into existence in a 10-foot radius around you and remains for the duration.', source: 'PHB' },
            'harm': { name: 'Harm', level: 6, school: 'necromancy', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric'], description: 'You unleash a virulent disease on a creature that you can see within range. The target must make a Constitution saving throw. On a failed save, it takes 14d6 necrotic damage, or half as much damage on a successful save.', source: 'PHB' },
            'heal': { name: 'Heal', level: 6, school: 'evocation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric', 'druid'], description: 'Choose a creature that you can see within range. A surge of positive energy washes through the creature, causing it to regain 70 hit points.', source: 'PHB' },
            'heroes-feast': { name: "Heroes' Feast", level: 6, school: 'conjuration', castingTime: '10 minutes', range: '30 feet', components: { v: true, s: true, m: 'A gem-encrusted bowl worth at least 1,000 gp, which the spell consumes' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric', 'druid'], description: 'You bring forth a great feast, including magnificent food and drink.', source: 'PHB' },
            'mass-suggestion': { name: 'Mass Suggestion', level: 6, school: 'enchantment', castingTime: '1 action', range: '60 feet', components: { v: true, s: false, m: 'A snake\'s tongue and either a bit of honeycomb or a drop of sweet oil' }, duration: '24 hours', concentration: false, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You suggest a course of activity and magically influence up to twelve creatures of your choice that you can see within range.', source: 'PHB' },
            'move-earth': { name: 'Move Earth', level: 6, school: 'transmutation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: 'An iron blade and a small bag containing a mixture of soilsclay, loam, and sand' }, duration: 'Concentration, up to 2 hours', concentration: true, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'Choose an area of terrain no larger than 40 feet on a side within range. You can reshape dirt, sand, or clay in the area in any manner you choose for the duration.', source: 'PHB' },
            'ottos-irresistible-dance': { name: "Otto's Irresistible Dance", level: 6, school: 'enchantment', castingTime: '1 action', range: '30 feet', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'wizard'], description: 'Choose one creature that you can see within range. The target begins a comic dance in place: shuffling, tapping its feet, and capering for the duration.', source: 'PHB' },
            'planar-ally': { name: 'Planar Ally', level: 6, school: 'conjuration', castingTime: '10 minutes', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric'], description: 'You beseech an otherworldly entity for aid.', source: 'PHB' },
            'sunbeam': { name: 'Sunbeam', level: 6, school: 'evocation', castingTime: '1 action', range: 'Self (60-foot line)', components: { v: true, s: true, m: 'A magnifying glass' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'A beam of brilliant light flashes out from your hand in a 5-foot-wide, 60-foot-long line.', source: 'PHB' },
            'transport-via-plants': { name: 'Transport via Plants', level: 6, school: 'conjuration', castingTime: '1 action', range: '10 feet', components: { v: true, s: true, m: null }, duration: '1 round', concentration: false, ritual: false, classes: ['druid'], description: 'This spell creates a magical link between a Large or larger inanimate plant within range and another plant, at any distance, on the same plane of existence.', source: 'PHB' },
            'true-seeing': { name: 'True Seeing', level: 6, school: 'divination', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'An ointment for the eyes that costs 25 gp; is made from mushroom powder, saffron, and fat; and is consumed by the spell' }, duration: '1 hour', concentration: false, ritual: false, classes: ['bard', 'cleric', 'sorcerer', 'warlock', 'wizard'], description: 'This spell gives the willing creature you touch the ability to see things as they actually are.', source: 'PHB' },
            'wall-of-ice': { name: 'Wall of Ice', level: 6, school: 'evocation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: 'A small piece of quartz' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['wizard'], description: 'You create a wall of ice on a solid surface within range.', source: 'PHB' },
            'wall-of-thorns': { name: 'Wall of Thorns', level: 6, school: 'conjuration', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: 'A handful of thorns' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['druid'], description: 'You create a wall of tough, pliable, tangled brush bristling with needle-sharp thorns.', source: 'PHB' },
            'word-of-recall': { name: 'Word of Recall', level: 6, school: 'conjuration', castingTime: '1 action', range: '5 feet', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric'], description: 'You and up to five willing creatures within 5 feet of you instantly teleport to a previously designated sanctuary.', source: 'PHB' },

            // 7th Level
            'divine-word': { name: 'Divine Word', level: 7, school: 'evocation', castingTime: '1 bonus action', range: '30 feet', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric'], description: 'You utter a divine word, imbued with the power that shaped the world at the dawn of creation.', source: 'PHB' },
            'etherealness': { name: 'Etherealness', level: 7, school: 'transmutation', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: null }, duration: '8 hours', concentration: false, ritual: false, classes: ['bard', 'cleric', 'sorcerer', 'warlock', 'wizard'], description: 'You step into the border regions of the Ethereal Plane, in the area where it overlaps with your current plane.', source: 'PHB' },
            'finger-of-death': { name: 'Finger of Death', level: 7, school: 'necromancy', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'You send negative energy coursing through a creature that you can see within range, causing it searing pain. The target must make a Constitution saving throw. It takes 7d8 + 30 necrotic damage on a failed save, or half as much damage on a successful one.', source: 'PHB' },
            'fire-storm': { name: 'Fire Storm', level: 7, school: 'evocation', castingTime: '1 action', range: '150 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric', 'druid', 'sorcerer'], description: 'A storm made up of sheets of roaring flame appears in a location you choose within range.', source: 'PHB' },
            'forcecage': { name: 'Forcecage', level: 7, school: 'evocation', castingTime: '1 action', range: '100 feet', components: { v: true, s: true, m: 'Ruby dust worth 1,500 gp' }, duration: '1 hour', concentration: false, ritual: false, classes: ['bard', 'warlock', 'wizard'], description: 'An immobile, invisible, cube-shaped prison composed of magical force springs into existence around an area you choose within range.', source: 'PHB' },
            'mirage-arcane': { name: 'Mirage Arcane', level: 7, school: 'illusion', castingTime: '10 minutes', range: 'Sight', components: { v: true, s: true, m: null }, duration: '10 days', concentration: false, ritual: false, classes: ['bard', 'druid', 'wizard'], description: 'You make terrain in an area up to 1 mile square look, sound, smell, and even feel like some other sort of terrain.', source: 'PHB' },
            'mordenkainens-sword': { name: "Mordenkainen's Sword", level: 7, school: 'evocation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A miniature platinum sword with a grip and pommel of copper and zinc, worth 250 gp' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'wizard'], description: 'You create a sword-shaped plane of force that hovers within range.', source: 'PHB' },
            'plane-shift': { name: 'Plane Shift', level: 7, school: 'conjuration', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'A forked, metal rod worth at least 250 gp, attuned to a particular plane of existence' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric', 'druid', 'sorcerer', 'warlock', 'wizard'], description: 'You and up to eight willing creatures who link hands in a circle are transported to a different plane of existence.', source: 'PHB' },
            'prismatic-spray': { name: 'Prismatic Spray', level: 7, school: 'evocation', castingTime: '1 action', range: 'Self (60-foot cone)', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'Eight multicolored rays of light flash from your hand. Each ray is a different color and has a different power and purpose.', source: 'PHB' },
            'project-image': { name: 'Project Image', level: 7, school: 'illusion', castingTime: '1 action', range: '500 miles', components: { v: true, s: true, m: 'A small replica of you made from materials worth at least 5 gp' }, duration: 'Concentration, up to 1 day', concentration: true, ritual: false, classes: ['bard', 'wizard'], description: 'You create an illusory copy of yourself that lasts for the duration.', source: 'PHB' },
            'regenerate': { name: 'Regenerate', level: 7, school: 'transmutation', castingTime: '1 minute', range: 'Touch', components: { v: true, s: true, m: 'A prayer wheel and holy water' }, duration: '1 hour', concentration: false, ritual: false, classes: ['bard', 'cleric', 'druid'], description: 'You touch a creature and stimulate its natural healing ability.', source: 'PHB' },
            'resurrection': { name: 'Resurrection', level: 7, school: 'necromancy', castingTime: '1 hour', range: 'Touch', components: { v: true, s: true, m: 'A diamond worth at least 1,000 gp, which the spell consumes' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'cleric'], description: 'You touch a dead creature that has been dead for no more than a century. If the creature\'s soul is both willing and at liberty to rejoin the body, the creature returns to life with all its hit points.', source: 'PHB' },
            'reverse-gravity': { name: 'Reverse Gravity', level: 7, school: 'transmutation', castingTime: '1 action', range: '100 feet', components: { v: true, s: true, m: 'A lodestone and iron filings' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'This spell reverses gravity in a 50-foot-radius, 100-foot-high cylinder centered on a point within range.', source: 'PHB' },
            'sequester': { name: 'Sequester', level: 7, school: 'transmutation', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'A powder composed of diamond, emerald, ruby, and sapphire dust worth at least 5,000 gp, which the spell consumes' }, duration: 'Until dispelled', concentration: false, ritual: false, classes: ['wizard'], description: 'By means of this spell, a willing creature or an object can be hidden away, safe from detection for the duration.', source: 'PHB' },
            'simulacrum': { name: 'Simulacrum', level: 7, school: 'illusion', castingTime: '12 hours', range: 'Touch', components: { v: true, s: true, m: 'Snow or ice in quantities sufficient to made a life-size copy of the duplicated creature; some hair, fingernail clippings, or other piece of that creature\'s body placed inside the snow or ice; and powdered ruby worth 1,500 gp, sprinkled over the duplicate and consumed by the spell' }, duration: 'Until dispelled', concentration: false, ritual: false, classes: ['wizard'], description: 'You shape an illusory duplicate of one beast or humanoid that is within range for the entire casting time of the spell.', source: 'PHB' },
            'symbol': { name: 'Symbol', level: 7, school: 'abjuration', castingTime: '1 minute', range: 'Touch', components: { v: true, s: true, m: 'Mercury, phosphorus, and powdered diamond and opal with a total value of at least 1,000 gp, which the spell consumes' }, duration: 'Until dispelled or triggered', concentration: false, ritual: false, classes: ['bard', 'cleric', 'wizard'], description: 'When you cast this spell, you inscribe a harmful glyph either on a surface (such as a section of floor, a wall, or a table) or within an object that can be closed to conceal the glyph (such as a book, a scroll, or a treasure chest).', source: 'PHB' },
            'teleport': { name: 'Teleport', level: 7, school: 'conjuration', castingTime: '1 action', range: '10 feet', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'sorcerer', 'wizard'], description: 'This spell instantly transports you and up to eight willing creatures of your choice that you can see within range, or a single object that you can see within range, to a destination you select.', source: 'PHB' },

            // 8th Level
            'antimagic-field': { name: 'Antimagic Field', level: 8, school: 'abjuration', castingTime: '1 action', range: 'Self (10-foot-radius sphere)', components: { v: true, s: true, m: 'A pinch of powdered iron or iron filings' }, duration: '1 hour', concentration: true, ritual: false, classes: ['cleric', 'wizard'], description: 'A 10-foot-radius invisible sphere of antimagic surrounds you.', source: 'PHB' },
            'antipathy-sympathy': { name: 'Antipathy/Sympathy', level: 8, school: 'enchantment', castingTime: '1 hour', range: '60 feet', components: { v: true, s: true, m: 'Either a lump of alum soaked in vinegar for the antipathy effect or a drop of honey for the sympathy effect' }, duration: '10 days', concentration: false, ritual: false, classes: ['bard', 'druid', 'wizard'], description: 'This spell attracts or repels creatures of your choice.', source: 'PHB' },
            'clone': { name: 'Clone', level: 8, school: 'necromancy', castingTime: '1 hour', range: 'Touch', components: { v: true, s: true, m: 'A diamond worth at least 1,000 gp and at least 1 cubic inch of flesh of the creature that is to be cloned, which the spell consumes, and a vessel worth at least 2,000 gp that has a sealable lid and is large enough to hold the creature being cloned, such as a huge urn, coffin, mud-filled cyst in the ground, or crystal container filled with salt water' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['wizard'], description: 'This spell grows an inert duplicate of a living creature as a safeguard against death.', source: 'PHB' },
            'control-weather': { name: 'Control Weather', level: 8, school: 'transmutation', castingTime: '10 minutes', range: 'Self (5-mile radius)', components: { v: true, s: true, m: 'Burning incense and bits of earth and wood mixed in water' }, duration: 'Concentration, up to 8 hours', concentration: true, ritual: false, classes: ['cleric', 'druid', 'wizard'], description: 'You take control of the weather within 5 miles of you for the duration.', source: 'PHB' },
            'demiplane': { name: 'Demiplane', level: 8, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: false, s: true, m: null }, duration: '1 hour', concentration: false, ritual: false, classes: ['warlock', 'wizard'], description: 'You create a shadowy door on a flat solid surface that you can see within range.', source: 'PHB' },
            'dominate-monster': { name: 'Dominate Monster', level: 8, school: 'enchantment', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You attempt to beguile a creature that you can see within range.', source: 'PHB' },
            'earthquake': { name: 'Earthquake', level: 8, school: 'evocation', castingTime: '1 action', range: '500 feet', components: { v: true, s: true, m: 'A pinch of dirt, a piece of rock, and a lump of clay' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['cleric', 'druid', 'sorcerer'], description: 'You create a seismic disturbance at a point on the ground that you can see within range.', source: 'PHB' },
            'feeblemind': { name: 'Feeblemind', level: 8, school: 'enchantment', castingTime: '1 action', range: '150 feet', components: { v: true, s: true, m: 'A handful of clay, crystal, glass, or mineral spheres' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'druid', 'warlock', 'wizard'], description: 'You blast the mind of a creature that you can see within range, attempting to shatter its intellect and personality.', source: 'PHB' },
            'glibness': { name: 'Glibness', level: 8, school: 'transmutation', castingTime: '1 action', range: 'Self', components: { v: true, s: false, m: null }, duration: '1 hour', concentration: false, ritual: false, classes: ['bard', 'warlock'], description: 'Until the spell ends, when you make a Charisma check, you can replace the number you roll with a 15.', source: 'PHB' },
            'holy-aura': { name: 'Holy Aura', level: 8, school: 'abjuration', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'A tiny reliquary worth at least 1,000 gp containing a sacred relic, such as a scrap of cloth from a saint\'s robe or a piece of parchment from a religious text' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['cleric'], description: 'Divine light washes out from you and coalesces in a soft radiance in a 30-foot radius around you.', source: 'PHB' },
            'incendiary-cloud': { name: 'Incendiary Cloud', level: 8, school: 'conjuration', castingTime: '1 action', range: '150 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['sorcerer', 'wizard'], description: 'A swirling cloud of smoke shot through with white-hot embers appears in a 20-foot-radius sphere centered on a point within range.', source: 'PHB' },
            'maze': { name: 'Maze', level: 8, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['wizard'], description: 'You banish a creature that you can see within range into a labyrinthine demiplane.', source: 'PHB' },
            'mind-blank': { name: 'Mind Blank', level: 8, school: 'abjuration', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: '24 hours', concentration: false, ritual: false, classes: ['bard', 'wizard'], description: 'Until the spell ends, one willing creature you touch is immune to psychic damage, any effect that would sense its emotions or read its thoughts, divination spells, and the charmed condition.', source: 'PHB' },
            'power-word-stun': { name: 'Power Word Stun', level: 8, school: 'enchantment', castingTime: '1 action', range: '60 feet', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You speak a word of power that can overwhelm the mind of one creature you can see within range, leaving it dumbfounded.', source: 'PHB' },
            'sunburst': { name: 'Sunburst', level: 8, school: 'evocation', castingTime: '1 action', range: '150 feet', components: { v: true, s: true, m: 'Fire and a piece of sunstone' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric', 'druid', 'sorcerer', 'wizard'], description: 'Brilliant sunlight flashes in a 60-foot radius centered on a point you choose within range.', source: 'PHB' },
            'telepathy': { name: 'Telepathy', level: 8, school: 'evocation', castingTime: '1 action', range: 'Unlimited', components: { v: true, s: true, m: 'A pair of linked silver rings' }, duration: '24 hours', concentration: false, ritual: false, classes: ['wizard'], description: 'You create a telepathic link between yourself and a willing creature with which you are familiar.', source: 'PHB' },

            // 9th Level
            'astral-projection': { name: 'Astral Projection', level: 9, school: 'necromancy', castingTime: '1 hour', range: '10 feet', components: { v: true, s: true, m: 'For each creature you affect with this spell, you must provide one jacinth worth at least 1,000 gp and one ornately carved bar of silver worth at least 100 gp, all of which the spell consumes' }, duration: 'Special', concentration: false, ritual: false, classes: ['cleric', 'warlock', 'wizard'], description: 'You and up to eight willing creatures within range project your astral bodies into the Astral Plane.', source: 'PHB' },
            'foresight': { name: 'Foresight', level: 9, school: 'divination', castingTime: '1 minute', range: 'Touch', components: { v: true, s: true, m: 'A hummingbird feather' }, duration: '8 hours', concentration: false, ritual: false, classes: ['bard', 'druid', 'warlock', 'wizard'], description: 'You touch a willing creature and bestow a limited ability to see into the immediate future.', source: 'PHB' },
            'gate': { name: 'Gate', level: 9, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A diamond worth at least 5,000 gp' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['cleric', 'sorcerer', 'wizard'], description: 'You conjure a portal linking an unoccupied space you can see within range to a precise location on a different plane of existence.', source: 'PHB' },
            'imprisonment': { name: 'Imprisonment', level: 9, school: 'abjuration', castingTime: '1 minute', range: '30 feet', components: { v: true, s: true, m: 'A vellum depiction or a carved statuette in the likeness of the target, and a special component that varies according to the version of the spell you choose, worth at least 500 gp per Hit Die of the target' }, duration: 'Until dispelled', concentration: false, ritual: false, classes: ['warlock', 'wizard'], description: 'You create a magical restraint to hold a creature that you can see within range.', source: 'PHB' },
            'mass-heal': { name: 'Mass Heal', level: 9, school: 'evocation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric'], description: 'A flood of healing energy flows from you into injured creatures around you. You restore up to 700 hit points, divided as you choose among any number of creatures that you can see within range.', source: 'PHB' },
            'meteor-swarm': { name: 'Meteor Swarm', level: 9, school: 'evocation', castingTime: '1 action', range: '1 mile', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'Blazing orbs of fire plummet to the ground at four different points you can see within range. Each creature in a 40-foot-radius sphere centered on each point you choose must make a Dexterity saving throw. A creature takes 20d6 fire damage and 20d6 bludgeoning damage on a failed save, or half as much damage on a successful one.', source: 'PHB' },
            'power-word-heal': { name: 'Power Word Heal', level: 9, school: 'evocation', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'cleric'], description: 'A wave of healing energy washes over the creature you touch. The target regains all its hit points. If the creature is charmed, frightened, paralyzed, or stunned, the condition ends.', source: 'PHB' },
            'power-word-kill': { name: 'Power Word Kill', level: 9, school: 'enchantment', castingTime: '1 action', range: '60 feet', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You utter a word of power that can compel one creature you can see within range to die instantly. If the creature you choose has 100 hit points or fewer, it dies. Otherwise, the spell has no effect.', source: 'PHB' },
            'prismatic-wall': { name: 'Prismatic Wall', level: 9, school: 'abjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: '10 minutes', concentration: false, ritual: false, classes: ['wizard'], description: 'A shimmering, multicolored plane of light forms a vertical opaque wallup to 90 feet long, 30 feet high, and 1 inch thickcentered on a point you can see within range.', source: 'PHB' },
            'shapechange': { name: 'Shapechange', level: 9, school: 'transmutation', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'A jade circlet worth at least 1,500 gp, which you must place on your head before you cast the spell' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['druid', 'wizard'], description: 'You assume the form of a different creature for the duration.', source: 'PHB' },
            'storm-of-vengeance': { name: 'Storm of Vengeance', level: 9, school: 'conjuration', castingTime: '1 action', range: 'Sight', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['druid'], description: 'A churning storm cloud forms, centered on a point you can see and spreading to a radius of 360 feet.', source: 'PHB' },
            'time-stop': { name: 'Time Stop', level: 9, school: 'transmutation', castingTime: '1 action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'You briefly stop the flow of time for everyone but yourself.', source: 'PHB' },
            'true-polymorph': { name: 'True Polymorph', level: 9, school: 'transmutation', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A drop of mercury, a dollop of gum arabic, and a wisp of smoke' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['bard', 'warlock', 'wizard'], description: 'Choose one creature or nonmagical object that you can see within range. You transform the creature into a different creature, the creature into a nonmagical object, or the object into a creature.', source: 'PHB' },
            'true-resurrection': { name: 'True Resurrection', level: 9, school: 'necromancy', castingTime: '1 hour', range: 'Touch', components: { v: true, s: true, m: 'A sprinkle of holy water and diamonds worth at least 25,000 gp, which the spell consumes' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric', 'druid'], description: 'You touch a creature that has been dead for no longer than 200 years and that died for any reason except old age. If the creature\'s soul is free and willing, the creature is restored to life with all its hit points.', source: 'PHB' },
            'weird': { name: 'Weird', level: 9, school: 'illusion', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['wizard'], description: 'Drawing on the deepest fears of a group of creatures, you create illusory creatures in their minds, visible only to them.', source: 'PHB' },
            'wish': { name: 'Wish', level: 9, school: 'conjuration', castingTime: '1 action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'Wish is the mightiest spell a mortal creature can cast. By simply speaking aloud, you can alter the very foundations of reality in accord with your desires.', source: 'PHB' },

            // ========== ADDITIONAL CANTRIPS ==========
            'control-flames': { name: 'Control Flames', level: 0, school: 'transmutation', castingTime: '1 action', range: '60 feet', components: { v: false, s: true, m: null }, duration: 'Instantaneous or 1 hour', concentration: false, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'You choose nonmagical flame that you can see within range and that fits within a 5-foot cube. You affect it in one of the following ways: You instantaneously expand the flame 5 feet in one direction. You instantaneously extinguish the flames. You double or halve the area of bright and dim light. You cause simple shapes to appear within the flames.', source: 'XGtE' },
            'create-bonfire': { name: 'Create Bonfire', level: 0, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['artificer', 'druid', 'sorcerer', 'warlock', 'wizard'], description: 'You create a bonfire on ground that you can see within range. Until the spell ends, the magic bonfire fills a 5-foot cube. Any creature in the bonfire\'s space when you cast the spell must succeed on a Dexterity saving throw or take 1d8 fire damage. A creature must also make the saving throw when it moves into the bonfire\'s space for the first time on a turn or ends its turn there.', source: 'XGtE' },
            'frostbite': { name: 'Frostbite', level: 0, school: 'evocation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'druid', 'sorcerer', 'warlock', 'wizard'], description: 'You cause numbing frost to form on one creature that you can see within range. The target must make a Constitution saving throw. On a failed save, the target takes 1d6 cold damage, and it has disadvantage on the next weapon attack roll it makes before the end of its next turn.', source: 'XGtE' },
            'infestation': { name: 'Infestation', level: 0, school: 'conjuration', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A living flea' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['druid', 'sorcerer', 'warlock', 'wizard'], description: 'You cause a cloud of mites, fleas, and other parasites to appear momentarily on one creature you can see within range. The target must succeed on a Constitution saving throw, or it takes 1d6 poison damage and moves 5 feet in a random direction if it can move.', source: 'XGtE' },
            'magic-stone': { name: 'Magic Stone', level: 0, school: 'transmutation', castingTime: '1 bonus action', range: 'Touch', components: { v: true, s: true, m: null }, duration: '1 minute', concentration: false, ritual: false, classes: ['artificer', 'druid', 'warlock'], description: 'You touch one to three pebbles and imbue them with magic. You or someone else can make a ranged spell attack with one of the pebbles by throwing it or hurling it with a sling. If thrown, a pebble has a range of 60 feet. On a hit, the target takes bludgeoning damage equal to 1d6 + your spellcasting ability modifier.', source: 'XGtE' },
            'mold-earth': { name: 'Mold Earth', level: 0, school: 'transmutation', castingTime: '1 action', range: '30 feet', components: { v: false, s: true, m: null }, duration: 'Instantaneous or 1 hour', concentration: false, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'You choose a portion of dirt or stone that you can see within range and that fits within a 5-foot cube. You manipulate it in one of the following ways: You instantaneously excavate it, move it along the ground, and deposit it up to 5 feet away. You cause shapes, colors, or both to appear on the dirt or stone. You cause the ground to become difficult terrain or normal terrain.', source: 'XGtE' },
            'primal-savagery': { name: 'Primal Savagery', level: 0, school: 'transmutation', castingTime: '1 action', range: 'Self', components: { v: false, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['druid'], description: 'You channel primal magic to cause your teeth or fingernails to sharpen, ready to deliver a corrosive attack. Make a melee spell attack against one creature within 5 feet of you. On a hit, the target takes 1d10 acid damage. After you make the attack, your teeth or fingernails return to normal.', source: 'XGtE' },
            'shape-water': { name: 'Shape Water', level: 0, school: 'transmutation', castingTime: '1 action', range: '30 feet', components: { v: false, s: true, m: null }, duration: 'Instantaneous or 1 hour', concentration: false, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'You choose an area of water that you can see within range and that fits within a 5-foot cube. You manipulate it in one of the following ways: You instantaneously move or otherwise change the flow of the water. You cause the water to form into simple shapes. You change the water\'s color or opacity. You freeze the water for up to 1 hour.', source: 'XGtE' },
            'thunderclap': { name: 'Thunderclap', level: 0, school: 'evocation', castingTime: '1 action', range: 'Self (5-foot radius)', components: { v: false, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'bard', 'druid', 'sorcerer', 'warlock', 'wizard'], description: 'You create a burst of thunderous sound that can be heard up to 100 feet away. Each creature within range, other than you, must succeed on a Constitution saving throw or take 1d6 thunder damage.', source: 'XGtE' },
            'toll-the-dead': { name: 'Toll the Dead', level: 0, school: 'necromancy', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric', 'warlock', 'wizard'], description: 'You point at one creature you can see within range, and the sound of a dolorous bell fills the air around it for a moment. The target must succeed on a Wisdom saving throw or take 1d8 necrotic damage. If the target is missing any of its hit points, it instead takes 1d12 necrotic damage.', source: 'XGtE' },
            'word-of-radiance': { name: 'Word of Radiance', level: 0, school: 'evocation', castingTime: '1 action', range: '5 feet', components: { v: true, s: false, m: 'A holy symbol' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric'], description: 'You utter a divine word, and burning radiance erupts from you. Each creature of your choice that you can see within range must succeed on a Constitution saving throw or take 1d6 radiant damage.', source: 'XGtE' },
            'mind-sliver': { name: 'Mind Sliver', level: 0, school: 'enchantment', castingTime: '1 action', range: '60 feet', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'You drive a disorienting spike of psychic energy into the mind of one creature you can see within range. The target must succeed on an Intelligence saving throw or take 1d6 psychic damage and subtract 1d4 from the next saving throw it makes before the end of your next turn.', source: 'TCoE' },
            'sapping-sting': { name: 'Sapping Sting', level: 0, school: 'necromancy', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['wizard'], description: 'You sap the vitality of one creature you can see in range. The target must succeed on a Constitution saving throw or take 1d4 necrotic damage and fall prone.', source: 'EGtW' },
            'sword-burst': { name: 'Sword Burst', level: 0, school: 'conjuration', castingTime: '1 action', range: 'Self (5-foot radius)', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'sorcerer', 'warlock', 'wizard'], description: 'You create a momentary circle of spectral blades that sweep around you. All other creatures within 5 feet of you must succeed on a Dexterity saving throw or take 1d6 force damage.', source: 'TCoE' },
            'lightning-lure': { name: 'Lightning Lure', level: 0, school: 'evocation', castingTime: '1 action', range: 'Self (15-foot radius)', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'sorcerer', 'warlock', 'wizard'], description: 'You create a lash of lightning energy that strikes at one creature of your choice that you can see within 15 feet of you. The target must succeed on a Strength saving throw or be pulled up to 10 feet in a straight line toward you and then take 1d8 lightning damage if it is within 5 feet of you.', source: 'TCoE' },

            // ========== ADDITIONAL 1ST LEVEL SPELLS ==========
            'absorb-elements': { name: 'Absorb Elements', level: 1, school: 'abjuration', castingTime: '1 reaction', range: 'Self', components: { v: false, s: true, m: null }, duration: '1 round', concentration: false, ritual: false, classes: ['artificer', 'druid', 'ranger', 'sorcerer', 'wizard'], description: 'The spell captures some of the incoming energy, lessening its effect on you and storing it for your next melee attack. You have resistance to the triggering damage type until the start of your next turn. Also, the first time you hit with a melee attack on your next turn, the target takes an extra 1d6 damage of the triggering type.', source: 'XGtE' },
            'beast-bond': { name: 'Beast Bond', level: 1, school: 'divination', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'A bit of fur wrapped in a cloth' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['druid', 'ranger'], description: 'You establish a telepathic link with one beast you touch that is friendly to you or charmed by you. The spell fails if the beast\'s Intelligence score is 4 or higher. Until the spell ends, the link is active while you and the beast are within line of sight of each other.', source: 'XGtE' },
            'cause-fear': { name: 'Cause Fear', level: 1, school: 'necromancy', castingTime: '1 action', range: '60 feet', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['warlock', 'wizard'], description: 'You awaken the sense of mortality in one creature you can see within range. A construct or an undead is immune to this effect. The target must succeed on a Wisdom saving throw or become frightened of you until the spell ends.', source: 'XGtE' },
            'ceremony': { name: 'Ceremony', level: 1, school: 'abjuration', castingTime: '1 hour', range: 'Touch', components: { v: true, s: true, m: '25 gp worth of powdered silver, which the spell consumes' }, duration: 'Instantaneous', concentration: false, ritual: true, classes: ['cleric', 'paladin'], description: 'You perform a special religious ceremony that is infused with magic. When you cast the spell, choose one of the following rites: Atonement, Bless Water, Coming of Age, Dedication, Funeral Rite, or Wedding.', source: 'XGtE' },
            'chaos-bolt': { name: 'Chaos Bolt', level: 1, school: 'evocation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer'], description: 'You hurl an undulating, warbling mass of chaotic energy at one creature in range. Make a ranged spell attack against the target. On a hit, the target takes 2d8 + 1d6 damage. Choose one of the d8s. The number rolled on that die determines the attack\'s damage type.', source: 'XGtE' },
            'earth-tremor': { name: 'Earth Tremor', level: 1, school: 'evocation', castingTime: '1 action', range: '10 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'druid', 'sorcerer', 'wizard'], description: 'You cause a tremor in the ground within range. Each creature other than you in that area must make a Dexterity saving throw. On a failed save, a creature takes 1d6 bludgeoning damage and is knocked prone.', source: 'XGtE' },
            'ice-knife': { name: 'Ice Knife', level: 1, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: false, s: true, m: 'A drop of water or piece of ice' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'You create a shard of ice and fling it at one creature within range. Make a ranged spell attack against the target. On a hit, the target takes 1d10 piercing damage. Hit or miss, the shard then explodes. The target and each creature within 5 feet of it must succeed on a Dexterity saving throw or take 2d6 cold damage.', source: 'XGtE' },
            'snare': { name: 'Snare', level: 1, school: 'abjuration', castingTime: '1 minute', range: 'Touch', components: { v: true, s: true, m: '25 feet of rope, which the spell consumes' }, duration: '8 hours', concentration: false, ritual: false, classes: ['artificer', 'druid', 'ranger', 'wizard'], description: 'As you cast this spell, you use the rope to create a circle with a 5-foot radius on the ground or the floor. When you finish casting, the rope disappears and the circle becomes a magic trap. The trap is nearly invisible.', source: 'XGtE' },
            'zephyr-strike': { name: 'Zephyr Strike', level: 1, school: 'transmutation', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['ranger'], description: 'You move like the wind. Until the spell ends, your movement doesn\'t provoke opportunity attacks. Once before the spell ends, you can give yourself advantage on one weapon attack roll on your turn. That attack deals an extra 1d8 force damage on a hit.', source: 'XGtE' },
            'tashas-caustic-brew': { name: "Tasha's Caustic Brew", level: 1, school: 'evocation', castingTime: '1 action', range: 'Self (30-foot line)', components: { v: true, s: true, m: 'A bit of rotten food' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['artificer', 'sorcerer', 'wizard'], description: 'A stream of acid emanates from you in a line 30 feet long and 5 feet wide in a direction you choose. Each creature in the line must succeed on a Dexterity saving throw or be covered in acid for the spell\'s duration or until a creature uses its action to scrape or wash the acid off itself or another creature. A creature covered in the acid takes 2d4 acid damage at start of each of its turns.', source: 'TCoE' },
            'silvery-barbs': { name: 'Silvery Barbs', level: 1, school: 'enchantment', castingTime: '1 reaction', range: '60 feet', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'sorcerer', 'wizard'], description: 'You magically distract the triggering creature and turn its momentary uncertainty into encouragement for another creature. The triggering creature must reroll the d20 and use the lower roll. You can then choose a different creature you can see within range (you can choose yourself). The chosen creature has advantage on the next attack roll, ability check, or saving throw it makes within 1 minute.', source: 'SCC' },
            'gift-of-alacrity': { name: 'Gift of Alacrity', level: 1, school: 'divination', castingTime: '1 minute', range: 'Touch', components: { v: true, s: true, m: null }, duration: '8 hours', concentration: false, ritual: false, classes: ['wizard'], description: 'You touch a willing creature. For the duration, the target can add 1d8 to its initiative rolls.', source: 'EGtW' },
            'magnify-gravity': { name: 'Magnify Gravity', level: 1, school: 'transmutation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: '1 round', concentration: false, ritual: false, classes: ['wizard'], description: 'The gravity in a 10-foot-radius sphere centered on a point you can see within range increases for a moment. Each creature in the sphere on the turn when you cast the spell must make a Constitution saving throw. On a failed save, a creature takes 2d8 force damage, and its speed is halved until the end of its next turn.', source: 'EGtW' },
            'distort-value': { name: 'Distort Value', level: 1, school: 'illusion', castingTime: '1 minute', range: 'Touch', components: { v: true, s: false, m: null }, duration: '8 hours', concentration: false, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You cast this spell on an object no more than 1 foot on a side, doubling the object\'s perceived value by adding illusory flourishes or diminishing its value by making it appear worn and flawed.', source: 'AI' },
            'jim-magic-missile': { name: "Jim's Magic Missile", level: 1, school: 'evocation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: '1 gp, which the spell consumes' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['wizard'], description: 'You create three twisting, whistling, hypoallergenic, gluten-free darts of magical force. Each dart can target a creature of your choice that you can see within range. Roll a d4 for each dart. On a 1, the dart ricochets to a random target in range. On any other result, a dart that hits its target deals 2d4 force damage.', source: 'AI' },
            'frost-fingers': { name: 'Frost Fingers', level: 1, school: 'evocation', castingTime: '1 action', range: 'Self (15-foot cone)', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['wizard'], description: 'Freezing cold blasts from your fingertips in a 15-foot cone. Each creature in that area must make a Constitution saving throw, taking 2d8 cold damage on a failed save, or half as much damage on a successful one.', source: 'IDRotF' },

            // ========== ADDITIONAL 2ND LEVEL SPELLS ==========
            'aganazzars-scorcher': { name: "Aganazzar's Scorcher", level: 2, school: 'evocation', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A red dragon\'s scale' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'A line of roaring flame 30 feet long and 5 feet wide emanates from you in a direction you choose. Each creature in the line must make a Dexterity saving throw. A creature takes 3d8 fire damage on a failed save, or half as much damage on a successful one.', source: 'XGtE' },
            'dragons-breath': { name: "Dragon's Breath", level: 2, school: 'transmutation', castingTime: '1 bonus action', range: 'Touch', components: { v: true, s: true, m: 'A hot pepper' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['sorcerer', 'wizard'], description: 'You touch one willing creature and imbue it with the power to spew magical energy from its mouth, provided it has one. Choose acid, cold, fire, lightning, or poison. Until the spell ends, the creature can use an action to exhale energy of the chosen type in a 15-foot cone.', source: 'XGtE' },
            'dust-devil': { name: 'Dust Devil', level: 2, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A pinch of dust' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'Choose an unoccupied 5-foot cube of air that you can see within range. An elemental force that resembles a dust devil appears in the cube and lasts for the spell\'s duration.', source: 'XGtE' },
            'earthbind': { name: 'Earthbind', level: 2, school: 'transmutation', castingTime: '1 action', range: '300 feet', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['druid', 'sorcerer', 'warlock', 'wizard'], description: 'Choose one creature you can see within range. Yellow strips of magical energy loop around the creature. The target must succeed on a Strength saving throw, or its flying speed (if any) is reduced to 0 feet for the spell\'s duration.', source: 'XGtE' },
            'healing-spirit': { name: 'Healing Spirit', level: 2, school: 'conjuration', castingTime: '1 bonus action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['druid', 'ranger'], description: 'You call forth a nature spirit to soothe the wounded. The intangible spirit appears in a space that is a 5-foot cube you can see within range. The spirit looks like a transparent beast or fey.', source: 'XGtE' },
            'maximilians-earthen-grasp': { name: "Maximilian's Earthen Grasp", level: 2, school: 'transmutation', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A miniature hand sculpted from clay' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['sorcerer', 'wizard'], description: 'You choose a 5-foot-square unoccupied space on the ground that you can see within range. A Medium hand made from compacted soil rises there and reaches for one creature you can see within 5 feet of it.', source: 'XGtE' },
            'mind-spike': { name: 'Mind Spike', level: 2, school: 'divination', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'You reach into the mind of one creature you can see within range. The target must make a Wisdom saving throw, taking 3d8 psychic damage on a failed save, or half as much damage on a successful one.', source: 'XGtE' },
            'pyrotechnics': { name: 'Pyrotechnics', level: 2, school: 'transmutation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'bard', 'sorcerer', 'wizard'], description: 'Choose an area of nonmagical flame that you can see and that fits within a 5-foot cube within range. You can extinguish the fire in that area, and you create either fireworks or smoke.', source: 'XGtE' },
            'shadow-blade': { name: 'Shadow Blade', level: 2, school: 'illusion', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'You weave together threads of shadow to create a sword of solidified gloom in your hand. This magic sword lasts until the spell ends. It counts as a simple melee weapon with which you are proficient. It deals 2d8 psychic damage on a hit.', source: 'XGtE' },
            'skywrite': { name: 'Skywrite', level: 2, school: 'transmutation', castingTime: '1 action', range: 'Sight', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: true, classes: ['artificer', 'bard', 'druid', 'wizard'], description: 'You cause up to ten words to form in a part of the sky you can see. The words appear to be made of cloud and remain in place for the spell\'s duration.', source: 'XGtE' },
            'snillocs-snowball-swarm': { name: "Snilloc's Snowball Swarm", level: 2, school: 'evocation', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'A piece of ice or a small white rock chip' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'A flurry of magic snowballs erupts from a point you choose within range. Each creature in a 5-foot-radius sphere centered on that point must make a Dexterity saving throw. A creature takes 3d6 cold damage on a failed save, or half as much damage on a successful one.', source: 'XGtE' },
            'warding-wind': { name: 'Warding Wind', level: 2, school: 'evocation', castingTime: '1 action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['bard', 'druid', 'sorcerer', 'wizard'], description: 'A strong wind (20 miles per hour) blows around you in a 10-foot radius and moves with you, remaining centered on you. The wind lasts for the spell\'s duration.', source: 'XGtE' },
            'tashas-mind-whip': { name: "Tasha's Mind Whip", level: 2, school: 'enchantment', castingTime: '1 action', range: '90 feet', components: { v: true, s: false, m: null }, duration: '1 round', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'You psychically lash out at one creature you can see within range. The target must make an Intelligence saving throw. On a failed save, the target takes 3d6 psychic damage, and it can\'t take a reaction until the end of its next turn.', source: 'TCoE' },
            'wristpocket': { name: 'Wristpocket', level: 2, school: 'conjuration', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: true, classes: ['wizard'], description: 'You flick your wrist, causing one object in your hand to vanish. The object, which only you can be holding and can weigh no more than 5 pounds, is transported to an extradimensional space.', source: 'EGtW' },
            'fortune-favor': { name: "Fortune's Favor", level: 2, school: 'divination', castingTime: '1 minute', range: 'Touch', components: { v: true, s: true, m: 'A white pearl worth at least 100 gp, which the spell consumes' }, duration: '1 hour', concentration: false, ritual: false, classes: ['wizard'], description: 'You impart latent luck to yourself or one willing creature you can see within range. When the chosen creature makes an attack roll, ability check, or saving throw before the spell ends, it can dismiss this spell on itself to roll an additional d20 and choose which of the d20s to use.', source: 'EGtW' },
            'immovable-object': { name: 'Immovable Object', level: 2, school: 'transmutation', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'Gold dust worth at least 25 gp, which the spell consumes' }, duration: '1 hour', concentration: false, ritual: false, classes: ['wizard'], description: 'You touch an object that weighs no more than 10 pounds and cause it to become magically fixed in place. You and the creatures you designate when you cast this spell can move the object normally.', source: 'EGtW' },
            'jim-glowing-coin': { name: "Jim's Glowing Coin", level: 2, school: 'enchantment', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A coin' }, duration: '1 minute', concentration: false, ritual: false, classes: ['wizard'], description: 'Of the many tricks Jim has up his sleeve, this is regarded as one of the classiest. When you cast the spell, you hurl the coin, targeting a creature you can see within range.', source: 'AI' },
            'rime-binding-ice': { name: "Rime's Binding Ice", level: 2, school: 'evocation', castingTime: '1 action', range: 'Self (30-foot cone)', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'A burst of cold energy emanates from you in a 30-foot cone. Each creature in that area must make a Constitution saving throw. On a failed save, a creature takes 3d8 cold damage and is hindered by ice formations for 1 minute.', source: 'FToD' },

            // ========== ADDITIONAL 3RD LEVEL SPELLS ==========
            'ashardalons-stride': { name: "Ashardalon's Stride", level: 3, school: 'transmutation', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['artificer', 'ranger', 'sorcerer', 'wizard'], description: 'The billowing flames of a dragon blast from your feet, granting you explosive speed. For the duration, your speed increases by 20 feet and moving doesn\'t provoke opportunity attacks.', source: 'FToD' },
            'catnap': { name: 'Catnap', level: 3, school: 'enchantment', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A pinch of sand' }, duration: '10 minutes', concentration: false, ritual: false, classes: ['artificer', 'bard', 'sorcerer', 'wizard'], description: 'You make a calming gesture, and up to three willing creatures of your choice that you can see within range fall unconscious for the spell\'s duration. The spell ends on a target early if it takes damage or someone uses an action to shake or slap it awake. If a target remains unconscious for the full duration, that target gains the benefit of a short rest.', source: 'XGtE' },
            'enemies-abound': { name: 'Enemies Abound', level: 3, school: 'enchantment', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You reach into the mind of one creature you can see and force it to make an Intelligence saving throw. A creature automatically succeeds if it is immune to being frightened. On a failed save, the target loses the ability to distinguish friend from foe.', source: 'XGtE' },
            'erupting-earth': { name: 'Erupting Earth', level: 3, school: 'transmutation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: 'A piece of obsidian' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'Choose a point you can see on the ground within range. A fountain of churned earth and stone erupts in a 20-foot cube centered on that point. Each creature in that area must make a Dexterity saving throw. A creature takes 3d12 bludgeoning damage on a failed save, or half as much damage on a successful one.', source: 'XGtE' },
            'flame-arrows': { name: 'Flame Arrows', level: 3, school: 'transmutation', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['artificer', 'druid', 'ranger', 'sorcerer', 'wizard'], description: 'You touch a quiver containing arrows or bolts. When a target is hit by a ranged weapon attack using a piece of ammunition drawn from the quiver, the target takes an extra 1d6 fire damage.', source: 'XGtE' },
            'life-transference': { name: 'Life Transference', level: 3, school: 'necromancy', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['cleric', 'wizard'], description: 'You sacrifice some of your health to mend another creature\'s injuries. You take 4d8 necrotic damage, and one creature of your choice that you can see within range regains a number of hit points equal to twice the necrotic damage you take.', source: 'XGtE' },
            'melf-minute-meteors': { name: "Melf's Minute Meteors", level: 3, school: 'evocation', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'Niter, sulfur, and pine tar formed into a bead' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['sorcerer', 'wizard'], description: 'You create six tiny meteors in your space. They float in the air and orbit you for the spell\'s duration. When you cast the spelland as a bonus action on each of your turns thereafteryou can expend one or two of the meteors, sending them streaking toward a point or points you choose within 120 feet of you.', source: 'XGtE' },
            'summon-lesser-demons': { name: 'Summon Lesser Demons', level: 3, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A vial of blood from a humanoid killed within the past 24 hours' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['warlock', 'wizard'], description: 'You utter foul words, summoning demons from the chaos of the Abyss. Roll on the table to determine what appears.', source: 'XGtE' },
            'thunder-step': { name: 'Thunder Step', level: 3, school: 'conjuration', castingTime: '1 action', range: '90 feet', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'You teleport yourself to an unoccupied space you can see within range. Immediately after you disappear, a thunderous boom sounds, and each creature within 10 feet of the space you left must make a Constitution saving throw, taking 3d10 thunder damage on a failed save.', source: 'XGtE' },
            'tidal-wave': { name: 'Tidal Wave', level: 3, school: 'conjuration', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: 'A drop of water' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'You conjure up a wave of water that crashes down on an area within range. The area can be up to 30 feet long, up to 10 feet wide, and up to 10 feet tall.', source: 'XGtE' },
            'tiny-servant': { name: 'Tiny Servant', level: 3, school: 'transmutation', castingTime: '1 minute', range: 'Touch', components: { v: true, s: true, m: null }, duration: '8 hours', concentration: false, ritual: false, classes: ['artificer', 'wizard'], description: 'You touch one Tiny, nonmagical object that isn\'t attached to another object or a surface and isn\'t being carried by another creature. The target animates and sprouts little arms and legs, becoming a creature under your control until the spell ends.', source: 'XGtE' },
            'wall-of-sand': { name: 'Wall of Sand', level: 3, school: 'evocation', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'A handful of sand' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['wizard'], description: 'You create a wall of swirling sand on the ground at a point you can see within range. You can make the wall up to 30 feet long, 10 feet high, and 10 feet thick.', source: 'XGtE' },
            'wall-of-water': { name: 'Wall of Water', level: 3, school: 'evocation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A drop of water' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'You create a wall of water on the ground at a point you can see within range. You can make the wall up to 30 feet long, 10 feet high, and 1 foot thick.', source: 'XGtE' },
            'summon-fey': { name: 'Summon Fey', level: 3, school: 'conjuration', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'A gilded flower worth at least 300 gp' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['druid', 'ranger', 'warlock', 'wizard'], description: 'You call forth a fey spirit. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Fey Spirit stat block.', source: 'TCoE' },
            'summon-shadowspawn': { name: 'Summon Shadowspawn', level: 3, school: 'conjuration', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'Tears inside a crystal vial worth at least 300 gp' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['warlock', 'wizard'], description: 'You call forth a shadowy spirit. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Shadow Spirit stat block.', source: 'TCoE' },
            'summon-undead': { name: 'Summon Undead', level: 3, school: 'necromancy', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'A gilded skull worth at least 300 gp' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['warlock', 'wizard'], description: 'You call forth an undead spirit. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Undead Spirit stat block.', source: 'TCoE' },
            'spirit-shroud': { name: 'Spirit Shroud', level: 3, school: 'necromancy', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['cleric', 'paladin', 'warlock', 'wizard'], description: 'You call forth spirits of the dead, which flit around you for the spell\'s duration. The spirits are intangible and invulnerable. Until the spell ends, any attack you make deals 1d8 extra damage when you hit a creature within 10 feet of you.', source: 'TCoE' },
            'pulse-wave': { name: 'Pulse Wave', level: 3, school: 'evocation', castingTime: '1 action', range: 'Self (30-foot cone)', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['wizard'], description: 'You create intense pressure, unleash it in a 30-foot cone, and decide whether the pressure pulls or pushes creatures and objects. Each creature in that cone must make a Constitution saving throw. A creature takes 6d6 force damage on a failed save, or half as much damage on a successful one.', source: 'EGtW' },
            'fizban-platinum-shield': { name: "Fizban's Platinum Shield", level: 3, school: 'abjuration', castingTime: '1 bonus action', range: '60 feet', components: { v: true, s: true, m: 'A platinum-plated dragon scale, worth at least 500 gp' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['sorcerer', 'wizard'], description: 'You create a field of silvery light that surrounds a creature of your choice within range. The field sheds dim light out to 5 feet. While surrounded by the field, a creature gains resistance to acid, cold, fire, lightning, and poison damage.', source: 'FToD' },

            // ========== ADDITIONAL 4TH LEVEL SPELLS ==========
            'charm-monster': { name: 'Charm Monster', level: 4, school: 'enchantment', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['bard', 'druid', 'sorcerer', 'warlock', 'wizard'], description: 'You attempt to charm a creature you can see within range. It must make a Wisdom saving throw, and it does so with advantage if you or your companions are fighting it.', source: 'XGtE' },
            'elemental-bane': { name: 'Elemental Bane', level: 4, school: 'transmutation', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['artificer', 'druid', 'warlock', 'wizard'], description: 'Choose one creature you can see within range, and choose one of the following damage types: acid, cold, fire, lightning, or thunder. The target must succeed on a Constitution saving throw or be affected by the spell for its duration.', source: 'XGtE' },
            'find-greater-steed': { name: 'Find Greater Steed', level: 4, school: 'conjuration', castingTime: '10 minutes', range: '30 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['paladin'], description: 'You summon a spirit that assumes the form of a loyal, majestic mount. Appearing in an unoccupied space within range, the spirit takes on a form you choose: a griffon, a pegasus, a peryton, a dire wolf, a rhinoceros, or a saber-toothed tiger.', source: 'XGtE' },
            'guardian-of-nature': { name: 'Guardian of Nature', level: 4, school: 'transmutation', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['druid', 'ranger'], description: 'A nature spirit answers your call and transforms you into a powerful guardian. The transformation lasts until the spell ends. You choose one of the following forms to assume: Primal Beast or Great Tree.', source: 'XGtE' },
            'sickening-radiance': { name: 'Sickening Radiance', level: 4, school: 'evocation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'Dim, greenish light spreads within a 30-foot-radius sphere centered on a point you choose within range. The light spreads around corners, and it lasts until the spell ends.', source: 'XGtE' },
            'shadow-of-moil': { name: 'Shadow of Moil', level: 4, school: 'necromancy', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'An undead eyeball encased in a gem worth at least 150 gp' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['warlock'], description: 'Flame-like shadows wreathe your body until the spell ends, causing you to become heavily obscured to others. The shadows turn dim light within 10 feet of you into darkness, and bright light in the same area to dim light.', source: 'XGtE' },
            'storm-sphere': { name: 'Storm Sphere', level: 4, school: 'evocation', castingTime: '1 action', range: '150 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['sorcerer', 'wizard'], description: 'A 20-foot-radius sphere of whirling air springs into existence, centered on a point you choose within range. The sphere remains for the spell\'s duration.', source: 'XGtE' },
            'summon-greater-demon': { name: 'Summon Greater Demon', level: 4, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A vial of blood from a humanoid killed within the past 24 hours' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['warlock', 'wizard'], description: 'You utter foul words, summoning one demon from the chaos of the Abyss.', source: 'XGtE' },
            'vitriolic-sphere': { name: 'Vitriolic Sphere', level: 4, school: 'evocation', castingTime: '1 action', range: '150 feet', components: { v: true, s: true, m: 'A drop of giant slug bile' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'You point at a location within range, and a glowing 1-foot-diameter ball of emerald acid streaks there and explodes in a 20-foot-radius sphere.', source: 'XGtE' },
            'watery-sphere': { name: 'Watery Sphere', level: 4, school: 'conjuration', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'A droplet of water' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'You conjure up a sphere of water with a 5-foot radius at a point you can see within range. The sphere can hover but no more than 10 feet off the ground.', source: 'XGtE' },
            'summon-aberration': { name: 'Summon Aberration', level: 4, school: 'conjuration', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'A pickled tentacle and an eyeball in a platinum-inlaid vial worth at least 400 gp' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['warlock', 'wizard'], description: 'You call forth an aberrant spirit. It manifests in an unoccupied space that you can see within range.', source: 'TCoE' },
            'summon-construct': { name: 'Summon Construct', level: 4, school: 'conjuration', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'An ornate stone and metal lockbox worth at least 400 gp' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['artificer', 'wizard'], description: 'You call forth the spirit of a construct. It manifests in an unoccupied space that you can see within range.', source: 'TCoE' },
            'summon-elemental': { name: 'Summon Elemental', level: 4, school: 'conjuration', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'Air, a pebble, ash, and water inside a gold-inlaid vial worth at least 400 gp' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['druid', 'ranger', 'wizard'], description: 'You call forth an elemental spirit. It manifests in an unoccupied space that you can see within range.', source: 'TCoE' },
            'gravity-sinkhole': { name: 'Gravity Sinkhole', level: 4, school: 'evocation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: 'A black marble' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['wizard'], description: 'A 20-foot-radius sphere of crushing force forms at a point you can see within range and tugs at the creatures there. Each creature in the sphere must make a Constitution saving throw.', source: 'EGtW' },

            // ========== ADDITIONAL 5TH LEVEL SPELLS ==========
            'control-winds': { name: 'Control Winds', level: 5, school: 'transmutation', castingTime: '1 action', range: '300 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'You take control of the air in a 100-foot cube that you can see within range. Choose one of the following effects when you cast the spell. The effect lasts for the spell\'s duration, unless you use your action on a later turn to switch to a different effect.', source: 'XGtE' },
            'danse-macabre': { name: 'Danse Macabre', level: 5, school: 'necromancy', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['warlock', 'wizard'], description: 'Threads of dark power leap from your fingers to pierce up to five Small or Medium corpses you can see within range.', source: 'XGtE' },
            'dawn': { name: 'Dawn', level: 5, school: 'evocation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A sunburst pendant worth at least 100 gp' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['cleric', 'wizard'], description: 'The light of dawn shines down on a location you specify within range. Until the spell ends, a 30-foot-radius, 40-foot-high cylinder of bright light glimmers there.', source: 'XGtE' },
            'enervation': { name: 'Enervation', level: 5, school: 'necromancy', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'A tendril of inky darkness reaches out from you, touching a creature you can see within range to drain life from it.', source: 'XGtE' },
            'far-step': { name: 'Far Step', level: 5, school: 'conjuration', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'You teleport up to 60 feet to an unoccupied space you can see. On each of your turns before the spell ends, you can use a bonus action to teleport in this way again.', source: 'XGtE' },
            'holy-weapon': { name: 'Holy Weapon', level: 5, school: 'evocation', castingTime: '1 bonus action', range: 'Touch', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['cleric', 'paladin'], description: 'You imbue a weapon you touch with holy power. Until the spell ends, the weapon emits bright light in a 30-foot radius and dim light for an additional 30 feet.', source: 'XGtE' },
            'immolation': { name: 'Immolation', level: 5, school: 'evocation', castingTime: '1 action', range: '90 feet', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['sorcerer', 'wizard'], description: 'Flames wreathe one creature you can see within range. The target must make a Dexterity saving throw. It takes 8d6 fire damage on a failed save, or half as much damage on a successful one.', source: 'XGtE' },
            'infernal-calling': { name: 'Infernal Calling', level: 5, school: 'conjuration', castingTime: '1 minute', range: '90 feet', components: { v: true, s: true, m: 'A ruby worth at least 999 gp' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['warlock', 'wizard'], description: 'Uttering a dark incantation, you summon a devil from the Nine Hells.', source: 'XGtE' },
            'negative-energy-flood': { name: 'Negative Energy Flood', level: 5, school: 'necromancy', castingTime: '1 action', range: '60 feet', components: { v: true, s: false, m: 'A broken bone and a square of black silk' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['warlock', 'wizard'], description: 'You send ribbons of negative energy at one creature you can see within range.', source: 'XGtE' },
            'skill-empowerment': { name: 'Skill Empowerment', level: 5, school: 'transmutation', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['artificer', 'bard', 'sorcerer', 'wizard'], description: 'Your magic deepens a creature\'s understanding of its own talent. You touch one willing creature and give it expertise in one skill of your choice.', source: 'XGtE' },
            'steel-wind-strike': { name: 'Steel Wind Strike', level: 5, school: 'conjuration', castingTime: '1 action', range: '30 feet', components: { v: false, s: true, m: 'A melee weapon worth at least 1 sp' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['ranger', 'wizard'], description: 'You flourish the weapon used in the casting and then vanish to strike like the wind. Choose up to five creatures you can see within range. Make a melee spell attack against each target.', source: 'XGtE' },
            'synaptic-static': { name: 'Synaptic Static', level: 5, school: 'enchantment', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You choose a point within range and cause psychic energy to explode there. Each creature in a 20-foot-radius sphere centered on that point must make an Intelligence saving throw.', source: 'XGtE' },
            'temporal-shunt': { name: 'Temporal Shunt', level: 5, school: 'transmutation', castingTime: '1 reaction', range: '120 feet', components: { v: true, s: true, m: null }, duration: '1 round', concentration: false, ritual: false, classes: ['wizard'], description: 'You target the triggering creature, which must succeed on a Wisdom saving throw or vanish, being thrown to another point in time and causing the attack to miss or the spell to be wasted.', source: 'EGtW' },
            'summon-celestial': { name: 'Summon Celestial', level: 5, school: 'conjuration', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'A golden reliquary worth at least 500 gp' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['cleric', 'paladin'], description: 'You call forth a celestial spirit. It manifests in an angelic form in an unoccupied space that you can see within range.', source: 'TCoE' },
            'summon-draconic-spirit': { name: 'Summon Draconic Spirit', level: 5, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'An object with the image of a dragon engraved on it, worth at least 500 gp' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'You call forth a draconic spirit. It manifests in an unoccupied space that you can see within range.', source: 'FToD' },

            // ========== ADDITIONAL 6TH LEVEL SPELLS ==========
            'bones-of-the-earth': { name: 'Bones of the Earth', level: 6, school: 'transmutation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['druid'], description: 'You cause up to six pillars of stone to burst from places on the ground that you can see within range.', source: 'XGtE' },
            'investiture-of-flame': { name: 'Investiture of Flame', level: 6, school: 'transmutation', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['druid', 'sorcerer', 'warlock', 'wizard'], description: 'Flames race across your body, shedding bright light in a 30-foot radius and dim light for an additional 30 feet for the spell\'s duration.', source: 'XGtE' },
            'investiture-of-ice': { name: 'Investiture of Ice', level: 6, school: 'transmutation', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['druid', 'sorcerer', 'warlock', 'wizard'], description: 'Until the spell ends, ice rimes your body, and you gain immunity to cold damage and resistance to fire damage.', source: 'XGtE' },
            'investiture-of-stone': { name: 'Investiture of Stone', level: 6, school: 'transmutation', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['druid', 'sorcerer', 'warlock', 'wizard'], description: 'Until the spell ends, bits of rock spread across your body, and you gain resistance to bludgeoning, piercing, and slashing damage from nonmagical attacks.', source: 'XGtE' },
            'investiture-of-wind': { name: 'Investiture of Wind', level: 6, school: 'transmutation', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['druid', 'sorcerer', 'warlock', 'wizard'], description: 'Until the spell ends, wind whirls around you, and you gain a flying speed of 60 feet.', source: 'XGtE' },
            'mental-prison': { name: 'Mental Prison', level: 6, school: 'illusion', castingTime: '1 action', range: '60 feet', components: { v: false, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'You attempt to bind a creature within an illusory cell that only it perceives. One creature you can see within range must make an Intelligence saving throw.', source: 'XGtE' },
            'primordial-ward': { name: 'Primordial Ward', level: 6, school: 'abjuration', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['druid'], description: 'You have resistance to acid, cold, fire, lightning, and thunder damage for the spell\'s duration.', source: 'XGtE' },
            'scatter': { name: 'Scatter', level: 6, school: 'conjuration', castingTime: '1 action', range: '30 feet', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'The air quivers around up to five creatures of your choice that you can see within range. An unwilling creature must succeed on a Wisdom saving throw to resist this spell.', source: 'XGtE' },
            'soul-cage': { name: 'Soul Cage', level: 6, school: 'necromancy', castingTime: '1 reaction', range: '60 feet', components: { v: true, s: true, m: 'A tiny silver cage worth 100 gp' }, duration: '8 hours', concentration: false, ritual: false, classes: ['warlock', 'wizard'], description: 'This spell snatches the soul of a humanoid as it dies and traps it inside the tiny cage you use for the material component.', source: 'XGtE' },
            'tensers-transformation': { name: "Tenser's Transformation", level: 6, school: 'transmutation', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'A few hairs from a bull' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['wizard'], description: 'You endow yourself with endurance and martial prowess fueled by magic.', source: 'XGtE' },
            'summon-fiend': { name: 'Summon Fiend', level: 6, school: 'conjuration', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'Humanoid blood inside a ruby vial worth at least 600 gp' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['warlock', 'wizard'], description: 'You call forth a fiendish spirit. It manifests in an unoccupied space that you can see within range.', source: 'TCoE' },
            'tashas-otherworldly-guise': { name: "Tasha's Otherworldly Guise", level: 6, school: 'transmutation', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: true, m: 'An object engraved with a symbol of the Outer Planes, worth at least 500 gp' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'Uttering an incantation, you draw on the magic of the Lower Planes or Upper Planes to transform yourself.', source: 'TCoE' },
            'gravity-fissure': { name: 'Gravity Fissure', level: 6, school: 'evocation', castingTime: '1 action', range: 'Self (100-foot line)', components: { v: true, s: true, m: 'A fistful of iron filings' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['wizard'], description: 'You manifest a ravine of gravitational energy in a line originating from you that is 100 feet long and 5 feet wide.', source: 'EGtW' },

            // ========== ADDITIONAL 7TH LEVEL SPELLS ==========
            'crown-of-stars': { name: 'Crown of Stars', level: 7, school: 'evocation', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: null }, duration: '1 hour', concentration: false, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'Seven star-like motes of light appear and orbit your head until the spell ends.', source: 'XGtE' },
            'power-word-pain': { name: 'Power Word Pain', level: 7, school: 'enchantment', castingTime: '1 action', range: '60 feet', components: { v: true, s: false, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'You speak a word of power that causes waves of intense pain to assail one creature you can see within range.', source: 'XGtE' },
            'temple-of-the-gods': { name: 'Temple of the Gods', level: 7, school: 'conjuration', castingTime: '1 hour', range: '120 feet', components: { v: true, s: true, m: 'A holy symbol worth at least 5 gp' }, duration: '24 hours', concentration: false, ritual: false, classes: ['cleric'], description: 'You cause a temple to shimmer into existence on ground you can see within range.', source: 'XGtE' },
            'whirlwind': { name: 'Whirlwind', level: 7, school: 'evocation', castingTime: '1 action', range: '300 feet', components: { v: true, s: true, m: 'A piece of straw' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'A whirlwind howls down to a point that you can see on the ground within range.', source: 'XGtE' },
            'dream-of-the-blue-veil': { name: 'Dream of the Blue Veil', level: 7, school: 'conjuration', castingTime: '10 minutes', range: '20 feet', components: { v: true, s: true, m: 'A magic item or a willing creature from the destination world' }, duration: '6 hours', concentration: false, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You and up to eight willing creatures within range fall unconscious for the spell\'s duration and experience visions of another world on the Material Plane.', source: 'TCoE' },
            'tether-essence': { name: 'Tether Essence', level: 7, school: 'necromancy', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A spool of platinum cord worth at least 250 gp, which the spell consumes' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['wizard'], description: 'Two creatures you can see within range must make a Constitution saving throw, with disadvantage if they are within 30 feet of each other.', source: 'EGtW' },
            'draconic-transformation': { name: 'Draconic Transformation', level: 7, school: 'transmutation', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: true, m: 'A statuette of a dragon, worth at least 500 gp' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['druid', 'sorcerer', 'wizard'], description: 'With a roar, you draw on the magic of dragons to transform yourself, taking on draconic features.', source: 'FToD' },

            // ========== ADDITIONAL 8TH LEVEL SPELLS ==========
            'abi-dalzims-horrid-wilting': { name: "Abi-Dalzim's Horrid Wilting", level: 8, school: 'necromancy', castingTime: '1 action', range: '150 feet', components: { v: true, s: true, m: 'A bit of sponge' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'You draw the moisture from every creature in a 30-foot cube centered on a point you choose within range.', source: 'XGtE' },
            'illusory-dragon': { name: 'Illusory Dragon', level: 8, school: 'illusion', castingTime: '1 action', range: '120 feet', components: { v: false, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['wizard'], description: 'By gathering threads of shadow material from the Shadowfell, you create a Huge shadowy dragon in an unoccupied space that you can see within range.', source: 'XGtE' },
            'maddening-darkness': { name: 'Maddening Darkness', level: 8, school: 'evocation', castingTime: '1 action', range: '150 feet', components: { v: true, s: true, m: 'A drop of pitch mixed with a drop of mercury' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['warlock', 'wizard'], description: 'Magical darkness spreads from a point you choose within range to fill a 60-foot-radius sphere until the spell ends.', source: 'XGtE' },
            'mighty-fortress': { name: 'Mighty Fortress', level: 8, school: 'conjuration', castingTime: '1 minute', range: '1 mile', components: { v: true, s: true, m: 'A diamond worth at least 500 gp, which the spell consumes' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['wizard'], description: 'A fortress of stone erupts from a square area of ground of your choice that you can see within range.', source: 'XGtE' },
            'reality-break': { name: 'Reality Break', level: 8, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A crystal prism' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['wizard'], description: 'You shatter the barriers between realities and timelines, thrusting a creature into turmoil and potential oblivion.', source: 'EGtW' },
            'dark-star': { name: 'Dark Star', level: 8, school: 'evocation', castingTime: '1 action', range: '150 feet', components: { v: true, s: true, m: 'A shard of onyx and a drop of the caster\'s blood, both of which the spell consumes' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['wizard'], description: 'This spell creates a sphere centered on a point you choose within range. The sphere can have a radius of up to 40 feet. The area within this sphere is filled with magical darkness.', source: 'EGtW' },

            // ========== ADDITIONAL 9TH LEVEL SPELLS ==========
            'mass-polymorph': { name: 'Mass Polymorph', level: 9, school: 'transmutation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: 'A caterpillar cocoon' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['bard', 'sorcerer', 'wizard'], description: 'You transform up to ten creatures of your choice that you can see within range.', source: 'XGtE' },
            'psychic-scream': { name: 'Psychic Scream', level: 9, school: 'enchantment', castingTime: '1 action', range: '90 feet', components: { v: false, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You unleash the power of your mind to blast the intellect of up to ten creatures of your choice that you can see within range.', source: 'XGtE' },
            'blade-of-disaster': { name: 'Blade of Disaster', level: 9, school: 'conjuration', castingTime: '1 bonus action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'You create a blade-shaped planar rift about 3 feet long in an unoccupied space you can see within range.', source: 'TCoE' },
            'ravenous-void': { name: 'Ravenous Void', level: 9, school: 'evocation', castingTime: '1 action', range: '1000 feet', components: { v: true, s: true, m: 'A small, nine-pointed star made of iron' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['wizard'], description: 'You create a 20-foot-radius sphere of destructive gravitational force centered on a point you can see within range.', source: 'EGtW' },
            'time-ravage': { name: 'Time Ravage', level: 9, school: 'necromancy', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'An hourglass filled with diamond dust worth at least 5,000 gp, which the spell consumes' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['wizard'], description: 'You target a creature you can see within range, putting its physical form through the devastation of aging.', source: 'EGtW' },

            // ========== MORE MISSING 1ST LEVEL SPELLS ==========
            'armor-of-agathys': { name: 'Armor of Agathys', level: 1, school: 'abjuration', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'A cup of water' }, duration: '1 hour', concentration: false, ritual: false, classes: ['warlock'], description: 'A protective magical force surrounds you, manifesting as a spectral frost that covers you and your gear. You gain 5 temporary hit points for the duration. If a creature hits you with a melee attack while you have these hit points, the creature takes 5 cold damage.', source: 'PHB' },
            'arms-of-hadar': { name: 'Arms of Hadar', level: 1, school: 'conjuration', castingTime: '1 action', range: 'Self (10-foot radius)', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['warlock'], description: 'You invoke the power of Hadar, the Dark Hunger. Tendrils of dark energy erupt from you and batter all creatures within 10 feet of you. Each creature in that area must make a Strength saving throw. On a failed save, a target takes 2d6 necrotic damage and can\'t take reactions until its next turn.', source: 'PHB' },
            'compelled-duel': { name: 'Compelled Duel', level: 1, school: 'enchantment', castingTime: '1 bonus action', range: '30 feet', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['paladin'], description: 'You attempt to compel a creature into a duel. One creature that you can see within range must make a Wisdom saving throw. On a failed save, the creature is drawn to you, compelled by your divine demand.', source: 'PHB' },
            'searing-smite': { name: 'Searing Smite', level: 1, school: 'evocation', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['paladin', 'ranger'], description: 'The next time you hit a creature with a melee weapon attack during the spell\'s duration, your weapon flares with white-hot intensity, and the attack deals an extra 1d6 fire damage to the target and causes the target to ignite in flames.', source: 'PHB' },
            'thunderous-smite': { name: 'Thunderous Smite', level: 1, school: 'evocation', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['paladin'], description: 'The first time you hit with a melee weapon attack during this spell\'s duration, your weapon rings with thunder that is audible within 300 feet of you, and the attack deals an extra 2d6 thunder damage to the target.', source: 'PHB' },
            'wrathful-smite': { name: 'Wrathful Smite', level: 1, school: 'evocation', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['paladin'], description: 'The next time you hit with a melee weapon attack during this spell\'s duration, your attack deals an extra 1d6 psychic damage. Additionally, if the target is a creature, it must make a Wisdom saving throw or be frightened of you until the spell ends.', source: 'PHB' },
            'hail-of-thorns': { name: 'Hail of Thorns', level: 1, school: 'conjuration', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['ranger'], description: 'The next time you hit a creature with a ranged weapon attack before the spell ends, this spell creates a rain of thorns that sprouts from your ranged weapon or ammunition.', source: 'PHB' },
            'ensnaring-strike': { name: 'Ensnaring Strike', level: 1, school: 'conjuration', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['ranger'], description: 'The next time you hit a creature with a weapon attack before this spell ends, a writhing mass of thorny vines appears at the point of impact, and the target must succeed on a Strength saving throw or be restrained by the magical vines until the spell ends.', source: 'PHB' },
            'tashas-hideous-laughter': { name: "Tasha's Hideous Laughter", level: 1, school: 'enchantment', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'Tiny tarts and a feather that is waved in the air' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'wizard'], description: 'A creature of your choice that you can see within range perceives everything as hilariously funny and falls into fits of laughter if this spell affects it. The target must succeed on a Wisdom saving throw or fall prone, becoming incapacitated and unable to stand up for the duration.', source: 'PHB' },
            'tensers-floating-disk': { name: "Tenser's Floating Disk", level: 1, school: 'conjuration', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A drop of mercury' }, duration: '1 hour', concentration: false, ritual: true, classes: ['wizard'], description: 'This spell creates a circular, horizontal plane of force, 3 feet in diameter and 1 inch thick, that floats 3 feet above the ground in an unoccupied space of your choice that you can see within range. The disk remains for the duration, and can hold up to 500 pounds.', source: 'PHB' },
            'ray-of-sickness': { name: 'Ray of Sickness', level: 1, school: 'necromancy', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['sorcerer', 'wizard'], description: 'A ray of sickening greenish energy lashes out toward a creature within range. Make a ranged spell attack against the target. On a hit, the target takes 2d8 poison damage and must make a Constitution saving throw. On a failed save, it is also poisoned until the end of your next turn.', source: 'PHB' },
            'witch-bolt': { name: 'Witch Bolt', level: 1, school: 'evocation', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A twig from a tree that has been struck by lightning' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['sorcerer', 'warlock', 'wizard'], description: 'A beam of crackling, blue energy lances out toward a creature within range, forming a sustained arc of lightning between you and the target. Make a ranged spell attack against that creature. On a hit, the target takes 1d12 lightning damage.', source: 'PHB' },
            'illusory-script': { name: 'Illusory Script', level: 1, school: 'illusion', castingTime: '1 minute', range: 'Touch', components: { v: false, s: true, m: 'A lead-based ink worth at least 10 gp, which the spell consumes' }, duration: '10 days', concentration: false, ritual: true, classes: ['bard', 'warlock', 'wizard'], description: 'You write on parchment, paper, or some other suitable writing material and imbue it with a potent illusion that lasts for the duration. To you and any creatures you designate when you cast the spell, the writing appears normal.', source: 'PHB' },

            // ========== MORE MISSING 2ND LEVEL SPELLS ==========
            'branding-smite': { name: 'Branding Smite', level: 2, school: 'evocation', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['paladin'], description: 'The next time you hit a creature with a weapon attack before this spell ends, the weapon gleams with astral radiance as you strike. The attack deals an extra 2d6 radiant damage to the target, which becomes visible if it\'s invisible.', source: 'PHB' },
            'cloud-of-daggers': { name: 'Cloud of Daggers', level: 2, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A sliver of glass' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'sorcerer', 'warlock', 'wizard'], description: 'You fill the air with spinning daggers in a cube 5 feet on each side, centered on a point you choose within range. A creature takes 4d4 slashing damage when it enters the spell\'s area for the first time on a turn or starts its turn there.', source: 'PHB' },
            'cordon-of-arrows': { name: 'Cordon of Arrows', level: 2, school: 'transmutation', castingTime: '1 action', range: '5 feet', components: { v: true, s: true, m: 'Four or more arrows or bolts' }, duration: '8 hours', concentration: false, ritual: false, classes: ['ranger'], description: 'You plant four pieces of nonmagical ammunitionarrows or crossbow boltsin the ground within range and lay magic upon them to protect an area. Until the spell ends, whenever a creature other than you comes within 30 feet of the ammunition for the first time on a turn or ends its turn there, one piece of ammunition flies up to strike it.', source: 'PHB' },
            'flame-blade': { name: 'Flame Blade', level: 2, school: 'evocation', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: true, m: 'Leaf of sumac' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['druid'], description: 'You evoke a fiery blade in your free hand. The blade is similar in size and shape to a scimitar, and it lasts for the duration. If you let go of the blade, it disappears, but you can evoke the blade again as a bonus action.', source: 'PHB' },
            'heat-metal': { name: 'Heat Metal', level: 2, school: 'transmutation', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'A piece of iron and a flame' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['artificer', 'bard', 'druid'], description: 'Choose a manufactured metal object, such as a metal weapon or a suit of heavy or medium metal armor, that you can see within range. You cause the object to glow red-hot. Any creature in physical contact with the object takes 2d8 fire damage when you cast the spell.', source: 'PHB' },
            'melfs-acid-arrow': { name: "Melf's Acid Arrow", level: 2, school: 'evocation', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'Powdered rhubarb leaf and an adder\'s stomach' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['wizard'], description: 'A shimmering green arrow streaks toward a target within range and bursts in a spray of acid. Make a ranged spell attack against the target. On a hit, the target takes 4d4 acid damage immediately and 2d4 acid damage at the end of its next turn.', source: 'PHB' },
            'nystuls-magic-aura': { name: "Nystul's Magic Aura", level: 2, school: 'illusion', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'A small square of silk' }, duration: '24 hours', concentration: false, ritual: false, classes: ['wizard'], description: 'You place an illusion on a creature or an object you touch so that divination spells reveal false information about it.', source: 'PHB' },
            'see-invisibility': { name: 'See Invisibility', level: 2, school: 'divination', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'A pinch of talc and a small sprinkling of powdered silver' }, duration: '1 hour', concentration: false, ritual: false, classes: ['artificer', 'bard', 'sorcerer', 'wizard'], description: 'For the duration, you see invisible creatures and objects as if they were visible, and you can see into the Ethereal Plane.', source: 'PHB' },
            'locate-animals-or-plants': { name: 'Locate Animals or Plants', level: 2, school: 'divination', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'A bit of fur from a bloodhound' }, duration: 'Instantaneous', concentration: false, ritual: true, classes: ['bard', 'druid', 'ranger'], description: 'Describe or name a specific kind of beast or plant. Concentrating on the voice of nature in your surroundings, you learn the direction and distance to the closest creature or plant of that kind within 5 miles, if any are present.', source: 'PHB' },
            'moonbeam': { name: 'Moonbeam', level: 2, school: 'evocation', castingTime: '1 action', range: '120 feet', components: { v: true, s: true, m: 'Several seeds of any moonseed plant and a piece of opalescent feldspar' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['druid'], description: 'A silvery beam of pale light shines down in a 5-foot-radius, 40-foot-high cylinder centered on a point within range. Until the spell ends, dim light fills the cylinder.', source: 'PHB' },
            'rope-trick': { name: 'Rope Trick', level: 2, school: 'transmutation', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'Powdered corn extract and a twisted loop of parchment' }, duration: '1 hour', concentration: false, ritual: false, classes: ['artificer', 'wizard'], description: 'You touch a length of rope that is up to 60 feet long. One end of the rope then rises into the air until the whole rope hangs perpendicular to the ground. At the upper end of the rope, an invisible entrance opens to an extradimensional space that lasts until the spell ends.', source: 'PHB' },

            // ========== MORE MISSING 3RD LEVEL SPELLS ==========
            'blinding-smite': { name: 'Blinding Smite', level: 3, school: 'evocation', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['paladin'], description: 'The next time you hit a creature with a melee weapon attack during this spell\'s duration, your weapon flares with bright light, and the attack deals an extra 3d8 radiant damage to the target. Additionally, the target must succeed on a Constitution saving throw or be blinded until the spell ends.', source: 'PHB' },
            'conjure-barrage': { name: 'Conjure Barrage', level: 3, school: 'conjuration', castingTime: '1 action', range: 'Self (60-foot cone)', components: { v: true, s: true, m: 'One piece of ammunition or a thrown weapon' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['ranger'], description: 'You throw a nonmagical weapon or fire a piece of nonmagical ammunition into the air to create a cone of identical weapons that shoot forward and then disappear. Each creature in a 60-foot cone must succeed on a Dexterity saving throw.', source: 'PHB' },
            'elemental-weapon': { name: 'Elemental Weapon', level: 3, school: 'transmutation', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['artificer', 'druid', 'paladin', 'ranger'], description: 'A nonmagical weapon you touch becomes a magic weapon. Choose one of the following damage types: acid, cold, fire, lightning, or thunder. For the duration, the weapon has a +1 bonus to attack rolls and deals an extra 1d4 damage of the chosen type when it hits.', source: 'PHB' },
            'feign-death': { name: 'Feign Death', level: 3, school: 'necromancy', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'A pinch of graveyard dirt' }, duration: '1 hour', concentration: false, ritual: true, classes: ['bard', 'cleric', 'druid', 'wizard'], description: 'You touch a willing creature and put it into a cataleptic state that is indistinguishable from death.', source: 'PHB' },
            'hunger-of-hadar': { name: 'Hunger of Hadar', level: 3, school: 'conjuration', castingTime: '1 action', range: '150 feet', components: { v: true, s: true, m: 'A pickled octopus tentacle' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['warlock'], description: 'You open a gateway to the dark between the stars, a region infested with unknown horrors. A 20-foot-radius sphere of blackness and bitter cold appears, centered on a point with range and lasting for the duration.', source: 'PHB' },
            'leomunds-tiny-hut': { name: "Leomund's Tiny Hut", level: 3, school: 'evocation', castingTime: '1 minute', range: 'Self (10-foot-radius hemisphere)', components: { v: true, s: true, m: 'A small crystal bead' }, duration: '8 hours', concentration: false, ritual: true, classes: ['bard', 'wizard'], description: 'A 10-foot-radius immobile dome of force springs into existence around and above you and remains stationary for the duration. The spell ends if you leave its area.', source: 'PHB' },
            'meld-into-stone': { name: 'Meld into Stone', level: 3, school: 'transmutation', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: null }, duration: '8 hours', concentration: false, ritual: true, classes: ['cleric', 'druid'], description: 'You step into a stone object or surface large enough to fully contain your body, melding yourself and all the equipment you carry with the stone for the duration.', source: 'PHB' },
            'phantom-steed': { name: 'Phantom Steed', level: 3, school: 'illusion', castingTime: '1 minute', range: '30 feet', components: { v: true, s: true, m: null }, duration: '1 hour', concentration: false, ritual: true, classes: ['wizard'], description: 'A Large quasi-real, horselike creature appears on the ground in an unoccupied space of your choice within range. You decide the creature\'s appearance, but it is equipped with a saddle, bit, and bridle.', source: 'PHB' },
            'stinking-cloud': { name: 'Stinking Cloud', level: 3, school: 'conjuration', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'A rotten egg or several skunk cabbage leaves' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['bard', 'sorcerer', 'wizard'], description: 'You create a 20-foot-radius sphere of yellow, nauseating gas centered on a point within range. The cloud spreads around corners, and its area is heavily obscured.', source: 'PHB' },
            'water-breathing': { name: 'Water Breathing', level: 3, school: 'transmutation', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A short reed or piece of straw' }, duration: '24 hours', concentration: false, ritual: true, classes: ['artificer', 'druid', 'ranger', 'sorcerer', 'wizard'], description: 'This spell grants up to ten willing creatures you can see within range the ability to breathe underwater until the spell ends. Affected creatures also retain their normal mode of respiration.', source: 'PHB' },
            'water-walk': { name: 'Water Walk', level: 3, school: 'transmutation', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A piece of cork' }, duration: '1 hour', concentration: false, ritual: true, classes: ['artificer', 'cleric', 'druid', 'ranger', 'sorcerer'], description: 'This spell grants the ability to move across any liquid surfacesuch as water, acid, mud, snow, quicksand, or lavaas if it were harmless solid ground (creatures crossing molten lava can still take damage from the heat).', source: 'PHB' },

            // ========== MORE MISSING 4TH LEVEL SPELLS ==========
            'aura-of-life': { name: 'Aura of Life', level: 4, school: 'abjuration', castingTime: '1 action', range: 'Self (30-foot radius)', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['cleric', 'paladin'], description: 'Life-preserving energy radiates from you in an aura with a 30-foot radius. Until the spell ends, the aura moves with you, centered on you.', source: 'PHB' },
            'aura-of-purity': { name: 'Aura of Purity', level: 4, school: 'abjuration', castingTime: '1 action', range: 'Self (30-foot radius)', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['cleric', 'paladin'], description: 'Purifying energy radiates from you in an aura with a 30-foot radius. Until the spell ends, the aura moves with you, centered on you.', source: 'PHB' },
            'conjure-woodland-beings': { name: 'Conjure Woodland Beings', level: 4, school: 'conjuration', castingTime: '1 action', range: '60 feet', components: { v: true, s: true, m: 'One holly berry per creature summoned' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['druid', 'ranger'], description: 'You summon fey creatures that appear in unoccupied spaces that you can see within range.', source: 'PHB' },
            'control-water': { name: 'Control Water', level: 4, school: 'transmutation', castingTime: '1 action', range: '300 feet', components: { v: true, s: true, m: 'A drop of water and a pinch of dust' }, duration: 'Concentration, up to 10 minutes', concentration: true, ritual: false, classes: ['cleric', 'druid', 'wizard'], description: 'Until the spell ends, you control any freestanding water inside an area you choose that is a cube up to 100 feet on a side.', source: 'PHB' },
            'evards-black-tentacles': { name: "Evard's Black Tentacles", level: 4, school: 'conjuration', castingTime: '1 action', range: '90 feet', components: { v: true, s: true, m: 'A piece of tentacle from a giant octopus or a giant squid' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['wizard'], description: 'Squirming, ebony tentacles fill a 20-foot square on ground that you can see within range. For the duration, these tentacles turn the ground in the area into difficult terrain.', source: 'PHB' },
            'fabricate': { name: 'Fabricate', level: 4, school: 'transmutation', castingTime: '10 minutes', range: '120 feet', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'wizard'], description: 'You convert raw materials into products of the same material. For example, you can fabricate a wooden bridge from a clump of trees, a rope from a patch of hemp, and clothes from flax or wool.', source: 'PHB' },
            'freedom-of-movement': { name: 'Freedom of Movement', level: 4, school: 'abjuration', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'A leather strap, bound around the arm or a similar appendage' }, duration: '1 hour', concentration: false, ritual: false, classes: ['artificer', 'bard', 'cleric', 'druid', 'ranger'], description: 'You touch a willing creature. For the duration, the target\'s movement is unaffected by difficult terrain, and spells and other magical effects can neither reduce the target\'s speed nor cause the target to be paralyzed or restrained.', source: 'PHB' },
            'grasping-vine': { name: 'Grasping Vine', level: 4, school: 'conjuration', castingTime: '1 bonus action', range: '30 feet', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['druid', 'ranger'], description: 'You conjure a vine that sprouts from the ground in an unoccupied space of your choice that you can see within range. When you cast this spell, you can direct the vine to lash out at a creature within 30 feet of it that you can see.', source: 'PHB' },
            'leomunds-secret-chest': { name: "Leomund's Secret Chest", level: 4, school: 'conjuration', castingTime: '1 action', range: 'Touch', components: { v: true, s: true, m: 'An exquisite chest, 3 feet by 2 feet by 2 feet, constructed from rare materials worth at least 5,000 gp, and a Tiny replica made from the same materials worth at least 50 gp' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['artificer', 'wizard'], description: 'You hide a chest, and all its contents, on the Ethereal Plane.', source: 'PHB' },
            'locate-creature': { name: 'Locate Creature', level: 4, school: 'divination', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'A bit of fur from a bloodhound' }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['bard', 'cleric', 'druid', 'paladin', 'ranger', 'wizard'], description: 'Describe or name a creature that is familiar to you. You sense the direction to the creature\'s location, as long as that creature is within 1,000 feet of you.', source: 'PHB' },
            'mordenkainens-faithful-hound': { name: "Mordenkainen's Faithful Hound", level: 4, school: 'conjuration', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A tiny silver whistle, a piece of bone, and a thread' }, duration: '8 hours', concentration: false, ritual: false, classes: ['artificer', 'wizard'], description: 'You conjure a phantom watchdog in an unoccupied space that you can see within range, where it remains for the duration, until you dismiss it as an action, or until you move more than 100 feet away from it.', source: 'PHB' },
            'mordenkainens-private-sanctum': { name: "Mordenkainen's Private Sanctum", level: 4, school: 'abjuration', castingTime: '10 minutes', range: '120 feet', components: { v: true, s: true, m: 'A thin sheet of lead, a piece of opaque glass, a wad of cotton or cloth, and powdered chrysolite' }, duration: '24 hours', concentration: false, ritual: false, classes: ['artificer', 'wizard'], description: 'You make an area within range magically secure. The area is a cube that can be as small as 5 feet to as large as 100 feet on each side.', source: 'PHB' },
            'otilukes-resilient-sphere': { name: "Otiluke's Resilient Sphere", level: 4, school: 'evocation', castingTime: '1 action', range: '30 feet', components: { v: true, s: true, m: 'A hemispherical piece of clear crystal and a matching hemispherical piece of gum arabic' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['artificer', 'wizard'], description: 'A sphere of shimmering force encloses a creature or object of Large size or smaller within range.', source: 'PHB' },
            'staggering-smite': { name: 'Staggering Smite', level: 4, school: 'evocation', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['paladin'], description: 'The next time you hit a creature with a melee weapon attack during this spell\'s duration, your weapon pierces both body and mind, and the attack deals an extra 4d6 psychic damage to the target.', source: 'PHB' },

            // ========== MORE MISSING 5TH LEVEL SPELLS ==========
            'antilife-shell': { name: 'Antilife Shell', level: 5, school: 'abjuration', castingTime: '1 action', range: 'Self (10-foot radius)', components: { v: true, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['druid'], description: 'A shimmering barrier extends out from you in a 10-foot radius and moves with you, remaining centered on you and hedging out creatures other than undead and constructs.', source: 'PHB' },
            'banishing-smite': { name: 'Banishing Smite', level: 5, school: 'abjuration', castingTime: '1 bonus action', range: 'Self', components: { v: true, s: false, m: null }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['paladin'], description: 'The next time you hit a creature with a weapon attack before this spell ends, your weapon crackles with force, and the attack deals an extra 5d10 force damage to the target.', source: 'PHB' },
            'commune': { name: 'Commune', level: 5, school: 'divination', castingTime: '1 minute', range: 'Self', components: { v: true, s: true, m: 'Incense and a vial of holy or unholy water' }, duration: '1 minute', concentration: false, ritual: true, classes: ['cleric'], description: 'You contact your deity or a divine proxy and ask up to three questions that can be answered with a yes or no.', source: 'PHB' },
            'commune-with-nature': { name: 'Commune with Nature', level: 5, school: 'divination', castingTime: '1 minute', range: 'Self', components: { v: true, s: true, m: null }, duration: 'Instantaneous', concentration: false, ritual: true, classes: ['druid', 'ranger'], description: 'You briefly become one with nature and gain knowledge of the surrounding territory. In the outdoors, the spell gives you knowledge of the land within 3 miles of you.', source: 'PHB' },
            'conjure-volley': { name: 'Conjure Volley', level: 5, school: 'conjuration', castingTime: '1 action', range: '150 feet', components: { v: true, s: true, m: 'One piece of ammunition or one thrown weapon' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['ranger'], description: 'You fire a piece of nonmagical ammunition from a ranged weapon or throw a nonmagical weapon into the air and choose a point within range. Hundreds of duplicates of the ammunition or weapon fall in a volley from above and then disappear.', source: 'PHB' },
            'contact-other-plane': { name: 'Contact Other Plane', level: 5, school: 'divination', castingTime: '1 minute', range: 'Self', components: { v: true, s: false, m: null }, duration: '1 minute', concentration: false, ritual: true, classes: ['warlock', 'wizard'], description: 'You mentally contact a demigod, the spirit of a long-dead sage, or some other mysterious entity from another plane. Contacting this extraplanar intelligence can strain or even break your mind.', source: 'PHB' },
            'dispel-evil-and-good': { name: 'Dispel Evil and Good', level: 5, school: 'abjuration', castingTime: '1 action', range: 'Self', components: { v: true, s: true, m: 'Holy water or powdered silver and iron' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['cleric', 'paladin'], description: 'Shimmering energy surrounds and protects you from fey, undead, and creatures originating from beyond the Material Plane.', source: 'PHB' },
            'hallow': { name: 'Hallow', level: 5, school: 'evocation', castingTime: '24 hours', range: 'Touch', components: { v: true, s: true, m: 'Herbs, oils, and incense worth at least 1,000 gp, which the spell consumes' }, duration: 'Until dispelled', concentration: false, ritual: false, classes: ['cleric'], description: 'You touch a point and infuse an area around it with holy (or unholy) power. The area can have a radius up to 60 feet.', source: 'PHB' },
            'mislead': { name: 'Mislead', level: 5, school: 'illusion', castingTime: '1 action', range: 'Self', components: { v: false, s: true, m: null }, duration: 'Concentration, up to 1 hour', concentration: true, ritual: false, classes: ['bard', 'wizard'], description: 'You become invisible at the same time that an illusory double of you appears where you are standing.', source: 'PHB' },
            'planar-binding': { name: 'Planar Binding', level: 5, school: 'abjuration', castingTime: '1 hour', range: '60 feet', components: { v: true, s: true, m: 'A jewel worth at least 1,000 gp, which the spell consumes' }, duration: '24 hours', concentration: false, ritual: false, classes: ['bard', 'cleric', 'druid', 'wizard'], description: 'With this spell, you attempt to bind a celestial, an elemental, a fey, or a fiend to your service.', source: 'PHB' },
            'raise-dead': { name: 'Raise Dead', level: 5, school: 'necromancy', castingTime: '1 hour', range: 'Touch', components: { v: true, s: true, m: 'A diamond worth at least 500 gp, which the spell consumes' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['bard', 'cleric', 'paladin'], description: 'You return a dead creature you touch to life, provided that it has been dead no longer than 10 days.', source: 'PHB' },
            'reincarnate': { name: 'Reincarnate', level: 5, school: 'transmutation', castingTime: '1 hour', range: 'Touch', components: { v: true, s: true, m: 'Rare oils and unguents worth at least 1,000 gp, which the spell consumes' }, duration: 'Instantaneous', concentration: false, ritual: false, classes: ['druid'], description: 'You touch a dead humanoid or a piece of a dead humanoid. Provided that the creature has been dead no longer than 10 days, the spell forms a new adult body for it and then calls the soul to enter that body.', source: 'PHB' },
            'swift-quiver': { name: 'Swift Quiver', level: 5, school: 'transmutation', castingTime: '1 bonus action', range: 'Touch', components: { v: true, s: true, m: 'A quiver containing at least one piece of ammunition' }, duration: 'Concentration, up to 1 minute', concentration: true, ritual: false, classes: ['ranger'], description: 'You transmute your quiver so it produces an endless supply of nonmagical ammunition, which seems to leap into your hand when you reach for it.', source: 'PHB' }
        };

        // Get spells available for a specific class
        function getClassSpells(className) {
            return Object.keys(spells).filter(spellId => {
                const spell = spells[spellId];
                return spell.classes.includes(className);
            });
        }

        // Get spells filtered by level
        function getSpellsByLevel(spellList, level) {
            return spellList.filter(spellId => spells[spellId].level === level);
        }

        // Get max spell level a caster can cast
        function getMaxSpellLevel(classLevel, casterType) {
            if (casterType === 'full') {
                if (classLevel >= 17) return 9;
                if (classLevel >= 15) return 8;
                if (classLevel >= 13) return 7;
                if (classLevel >= 11) return 6;
                if (classLevel >= 9) return 5;
                if (classLevel >= 7) return 4;
                if (classLevel >= 5) return 3;
                if (classLevel >= 3) return 2;
                return 1;
            } else if (casterType === 'half') {
                if (classLevel >= 17) return 5;
                if (classLevel >= 13) return 4;
                if (classLevel >= 9) return 3;
                if (classLevel >= 5) return 2;
                if (classLevel >= 2) return 1;
                return 0;
            } else if (casterType === 'third') {
                if (classLevel >= 19) return 4;
                if (classLevel >= 13) return 3;
                if (classLevel >= 7) return 2;
                if (classLevel >= 3) return 1;
                return 0;
            } else if (casterType === 'pact') {
                if (classLevel >= 9) return 5;
                if (classLevel >= 7) return 4;
                if (classLevel >= 5) return 3;
                if (classLevel >= 3) return 2;
                return 1;
            }
            return 0;
        }

        // Calculate spells for a character
        function calculateSpells(characterClass, level, modifiers, subclassId = null) {
            // Check if this class/subclass can cast spells
            let spellRules = null;
            let spellClassName = characterClass;
            
            // Check for subclass spellcasting (Eldritch Knight, Arcane Trickster)
            if (subclassId === 'eldritch-knight') {
                spellRules = spellcastingRules['eldritch-knight'];
                spellClassName = 'wizard'; // Uses wizard spell list with restrictions
            } else if (subclassId === 'arcane-trickster') {
                spellRules = spellcastingRules['arcane-trickster'];
                spellClassName = 'wizard'; // Uses wizard spell list with restrictions
            } else if (spellcastingRules[characterClass]) {
                spellRules = spellcastingRules[characterClass];
            }
            
            // Not a spellcaster
            if (!spellRules || level < spellRules.startLevel) {
                return null;
            }

            const casterLevel = level;
            const abilityMod = modifiers[spellRules.ability] || 0;
            
            // Calculate spell slots
            const slotTable = spellSlotTable[spellRules.casterType];
            const spellSlots = slotTable[casterLevel - 1] || [0,0,0,0,0,0,0,0,0];
            
            // Calculate cantrips known
            const cantripsKnown = spellRules.cantripsKnown[casterLevel - 1] || 0;
            
            // Calculate spells known/prepared
            let spellsKnownCount;
            if (spellRules.spellsKnown) {
                spellsKnownCount = spellRules.spellsKnown[casterLevel - 1] || 0;
            } else if (spellRules.spellsKnownFormula) {
                spellsKnownCount = spellRules.spellsKnownFormula(casterLevel, abilityMod);
            } else {
                spellsKnownCount = Math.max(1, abilityMod + casterLevel);
            }
            
            // Get available spells for this class
            const classSpells = getClassSpells(spellClassName);
            const maxSpellLevel = getMaxSpellLevel(casterLevel, spellRules.casterType);
            
            // Filter by school restrictions if any (for Eldritch Knight, Arcane Trickster)
            let availableSpells = classSpells.filter(spellId => {
                const spell = spells[spellId];
                if (spell.level > maxSpellLevel) return false;
                if (spell.level === 0) return true; // Cantrips always allowed
                if (spellRules.restrictedSchools) {
                    // Most spells must be from restricted schools, but some can be from any school
                    return spellRules.restrictedSchools.includes(spell.school);
                }
                return true;
            });
            
            // Select cantrips
            const availableCantrips = availableSpells.filter(id => spells[id].level === 0);
            const selectedCantrips = [];
            const cantripsCopy = [...availableCantrips];
            for (let i = 0; i < cantripsKnown && cantripsCopy.length > 0; i++) {
                const idx = Math.floor(Math.random() * cantripsCopy.length);
                selectedCantrips.push(cantripsCopy.splice(idx, 1)[0]);
            }
            
            // Select leveled spells (distribute across available levels)
            const selectedSpells = [];
            const availableLeveledSpells = availableSpells.filter(id => spells[id].level > 0 && spells[id].level <= maxSpellLevel);
            
            // Try to get a mix of spell levels, favoring lower levels
            const leveledCopy = [...availableLeveledSpells];
            for (let i = 0; i < spellsKnownCount && leveledCopy.length > 0; i++) {
                // Weight towards lower level spells
                const weights = leveledCopy.map(id => Math.max(1, maxSpellLevel - spells[id].level + 1));
                const totalWeight = weights.reduce((a, b) => a + b, 0);
                let random = Math.random() * totalWeight;
                let idx = 0;
                for (let j = 0; j < weights.length; j++) {
                    random -= weights[j];
                    if (random <= 0) {
                        idx = j;
                        break;
                    }
                }
                selectedSpells.push(leveledCopy.splice(idx, 1)[0]);
            }
            
            // Calculate spell save DC and spell attack bonus
            const spellSaveDC = 8 + modifiers[spellRules.ability] + getProficiencyBonus(level);
            const spellAttackBonus = modifiers[spellRules.ability] + getProficiencyBonus(level);
            
            return {
                ability: spellRules.ability,
                abilityMod: abilityMod,
                saveDC: spellSaveDC,
                attackBonus: spellAttackBonus,
                casterType: spellRules.casterType,
                spellSlots: spellSlots,
                cantrips: selectedCantrips,
                spells: selectedSpells,
                cantripsKnown: cantripsKnown,
                spellsKnownCount: spellsKnownCount,
                maxSpellLevel: maxSpellLevel
            };
        }

        function randomChoice(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        // Weighted random choice - weights object maps items to their relative weights
        function weightedRandomChoice(items, weights) {
            const totalWeight = items.reduce((sum, item) => sum + (weights[item] || 1), 0);
            let random = Math.random() * totalWeight;
            
            for (const item of items) {
                random -= weights[item] || 1;
                if (random <= 0) {
                    return item;
                }
            }
            return items[items.length - 1];
        }

        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function rollAbilityScore() {
            // Roll 4d6, drop lowest
            const rolls = [];
            for (let i = 0; i < 4; i++) {
                rolls.push(randomInt(1, 6));
            }
            rolls.sort((a, b) => b - a);
            return rolls[0] + rolls[1] + rolls[2];
        }

        function getModifier(score) {
            return Math.floor((score - 10) / 2);
        }

        function formatModifier(mod) {
            return mod >= 0 ? `+${mod}` : `${mod}`;
        }

        // Maturity ages from D&D 5e lore - when each race is considered a young adult
        const maturityAges = {
            'aarakocra': 3,
            'aasimar': 18,
            'astral elf': 100,
            'autognome': 2,
            'bugbear': 16,
            'centaur': 15,
            'changeling': 15,
            'deep gnome': 25,
            'dhampir': 18,
            'dragonborn': 15,
            'duergar': 50,
            'dwarf': 50,
            'eladrin': 100,
            'elf': 100,
            'fairy': 20,
            'firbolg': 30,
            'genasi': 18,
            'giff': 18,
            'githyanki': 18,
            'githzerai': 18,
            'gnome': 40,
            'goblin': 8,
            'goliath': 18,
            'grung': 1,
            'hadozee': 14,
            'half-elf': 20,
            'half-orc': 14,
            'halfling': 20,
            'harengon': 20,
            'hexblood': 18,
            'hobgoblin': 14,
            'human': 18,
            'kalashtar': 18,
            'kender': 20,
            'kenku': 12,
            'kobold': 6,
            'leonin': 17,
            'lizardfolk': 14,
            'locathah': 10,
            'loxodon': 60,
            'minotaur': 17,
            'orc': 12,
            'owlin': 18,
            'plasmoid': 1,
            'reborn': 18,
            'satyr': 20,
            'sea elf': 100,
            'shadar-kai': 100,
            'shifter': 10,
            'simic hybrid': 18,
            'tabaxi': 15,
            'thri-kreen': 7,
            'tiefling': 18,
            'tortle': 15,
            'triton': 15,
            'vedalken': 40,
            'verdan': 24,
            'warforged': 2,
            'yuan-ti': 12
        };

        function generateAge(category, race) {
            // Get lifespan and maturity age for the race
            const raceKey = race.toLowerCase();
            const lifespan = races[raceKey]?.lifespan || 80;
            const maturity = maturityAges[raceKey] || 18;
            
            // Calculate age ranges based on maturity and lifespan
            // Young Adult starts at maturity, other stages scale from there
            const adultEnd = maturity + Math.floor((lifespan - maturity) * 0.35);      // ~35% into adult life
            const matureEnd = maturity + Math.floor((lifespan - maturity) * 0.70);     // ~70% into adult life
            
            // Age ranges based on maturity
            const ageRanges = {
                'infant': [0, Math.floor(maturity * 0.25)],                            // 0-25% of maturity
                'child': [Math.floor(maturity * 0.25), Math.floor(maturity * 0.85)],   // 25-85% of maturity
                'young-adult': [maturity, adultEnd],                                    // Maturity to 35% of adult life
                'adult': [adultEnd, matureEnd],                                         // 35-70% of adult life
                'mature': [matureEnd, Math.floor(lifespan * 0.90)],                     // 70-90% of lifespan
                'elderly': [Math.floor(lifespan * 0.90), lifespan]                      // 90-100% of lifespan
            };
            
            if (category === 'random') {
                category = randomChoice(Object.keys(ageRanges));
            }
            
            let [minAge, maxAge] = ageRanges[category];
            
            // Ensure minimum reasonable ages that make narrative sense
            // Even for short-lived races, these categories should feel appropriate
            const minimums = { 
                'infant': 0,       // Newborns are fine
                'child': 2,        // Old enough to walk and communicate
                'young-adult': 6,  // Old enough to be somewhat independent
                'adult': 12,       // Old enough to have responsibilities
                'mature': 25,      // Old enough to have life experience
                'elderly': 40      // Old enough to feel aged
            };
            minAge = Math.max(minAge, minimums[category]);
            maxAge = Math.max(maxAge, minAge + 1);
            
            return randomInt(minAge, maxAge);
        }

        function generateNPC() {
            // Get form values
            const race = document.getElementById('race').value;
            const npcClass = document.getElementById('npcClass').value;
            const occupation = document.getElementById('occupation').value;
            const ageCategory = document.getElementById('age').value;
            const gender = document.getElementById('gender').value;
            const alignment = document.getElementById('alignment').value;
            // Determine values, respecting locks (use locked value if available)
            let selectedRace, selectedClass, selectedOccupation, selectedGender, selectedAlignment, age;
            let selectedAgeCategory;

            // Race - locked or generate new
            if (lockStates.race && currentNPC) {
                selectedRace = currentNPC.race;
            } else {
                selectedRace = race === 'random' ? randomChoice(Object.keys(races)) : race;
            }

            // Gender - locked or generate new (needed for name generation)
            if (lockStates.gender && currentNPC) {
                selectedGender = currentNPC.gender;
            } else {
                selectedGender = gender === 'random' ? randomChoice(['male', 'female', 'non-binary']) : gender;
            }

            // Alignment - locked or generate new
            if (lockStates.alignment && currentNPC) {
                selectedAlignment = currentNPC.alignment;
            } else {
                selectedAlignment = alignment === 'random' ? randomChoice(alignments) : alignment;
            }

            // Determine if infant is allowed based on class and occupation selections
            // Infant is NOT allowed if:
            // - Class is explicitly set to non-commoner (not random, not commoner)
            // - Occupation is explicitly set to non-infant (not random, not infant)
            // - Any multiclasses are set (adventurer training means no infants)
            const classBlocksInfant = npcClass !== 'random' && npcClass !== 'commoner';
            const occupationBlocksInfant = occupation !== 'random' && occupation !== 'infant';
            const hasMulticlasses = multiclasses.length > 0;
            const infantAllowed = !classBlocksInfant && !occupationBlocksInfant && !hasMulticlasses;

            // Age - locked or generate new (determine before class and occupation)
            if (lockStates.age && currentNPC) {
                age = currentNPC.age;
                selectedAgeCategory = determineAgeCategory(age, selectedRace);
                // If locked age is infant but infant not allowed, regenerate
                if (selectedAgeCategory === 'infant' && !infantAllowed) {
                    selectedAgeCategory = 'child'; // Fall back to child
                    age = generateAge(selectedAgeCategory, selectedRace);
                }
            } else {
                // Build list of allowed age categories
                let allowedAgeCategories = ['infant', 'child', 'young-adult', 'adult', 'mature', 'elderly'];
                if (!infantAllowed) {
                    allowedAgeCategories = allowedAgeCategories.filter(a => a !== 'infant');
                }
                
                // Age category weights: 10% infant, 10% child, 20% for others
                const ageCategoryWeights = {
                    'infant': 10,
                    'child': 10,
                    'young-adult': 20,
                    'adult': 20,
                    'mature': 20,
                    'elderly': 20
                };
                
                if (ageCategory === 'random') {
                    selectedAgeCategory = weightedRandomChoice(allowedAgeCategories, ageCategoryWeights);
                } else if (ageCategory === 'infant' && !infantAllowed) {
                    // User selected infant but it's not allowed, fall back to child
                    selectedAgeCategory = 'child';
                } else {
                    selectedAgeCategory = ageCategory;
                }
                age = generateAge(selectedAgeCategory, selectedRace);
            }

            // Class - locked or generate new
            // Infants are always commoners
            let characterClasses = []; // Array of {className, level}
            
            if (selectedAgeCategory === 'infant') {
                selectedClass = 'commoner';
                characterClasses = [{ className: 'commoner', level: 0 }];
            } else if (lockStates.npcClass && currentNPC && currentNPC.characterClasses) {
                characterClasses = [...currentNPC.characterClasses];
                selectedClass = characterClasses[0]?.className || 'commoner';
            } else {
                const adventurerClasses = Object.keys(classes).filter(c => c !== 'commoner');
                selectedClass = npcClass === 'random' ? randomChoice(adventurerClasses) : npcClass;
                
                if (selectedClass === 'commoner') {
                    characterClasses = [{ className: 'commoner', level: 0, subclass: null }];
                    
                    // Add multiclasses for commoners (retired adventurers, etc.)
                    multiclasses.forEach(mc => {
                        const mcSubclassData = subclasses[mc.className];
                        let mcSubclass = mc.subclass;
                        // If random or not set, pick a random subclass if level is high enough
                        if ((!mcSubclass || mcSubclass === 'random') && mcSubclassData && mc.level >= mcSubclassData.level) {
                            mcSubclass = randomChoice(mcSubclassData.options).id;
                        } else if (!mcSubclassData || mc.level < mcSubclassData.level) {
                            mcSubclass = null;
                        }
                        characterClasses.push({ className: mc.className, level: mc.level, subclass: mcSubclass });
                    });
                } else {
                    // Get main class level from form
                    const mainLevel = parseInt(document.getElementById('npcClassLevel').value) || 1;
                    
                    // Get subclass
                    const subclassSelect = document.getElementById('npcSubclass');
                    let selectedSubclass = subclassSelect.value;
                    const subclassData = subclasses[selectedClass];
                    
                    // If random or level not high enough, pick a random one
                    if (selectedSubclass === 'random' && subclassData && mainLevel >= subclassData.level) {
                        selectedSubclass = randomChoice(subclassData.options).id;
                    } else if (!subclassData || mainLevel < subclassData.level) {
                        selectedSubclass = null;
                    }
                    
                    characterClasses = [{ className: selectedClass, level: mainLevel, subclass: selectedSubclass }];
                    
                    // Add multiclasses (with random subclasses)
                    multiclasses.forEach(mc => {
                        const mcSubclassData = subclasses[mc.className];
                        let mcSubclass = mc.subclass;
                        // If random or not set, pick a random subclass if level is high enough
                        if ((!mcSubclass || mcSubclass === 'random') && mcSubclassData && mc.level >= mcSubclassData.level) {
                            mcSubclass = randomChoice(mcSubclassData.options).id;
                        } else if (!mcSubclassData || mc.level < mcSubclassData.level) {
                            mcSubclass = null;
                        }
                        characterClasses.push({ className: mc.className, level: mc.level, subclass: mcSubclass });
                    });
                }
            }

            // Occupation - locked or generate new
            // Infants are always locked to "infant" occupation
            // Characters with Commoner class get an occupation, pure adventurers use "adventurer"
            const hasCommoner = characterClasses.some(cc => cc.className === 'commoner');
            
            if (selectedAgeCategory === 'infant') {
                selectedOccupation = 'infant';
            } else if (!hasCommoner) {
                // Pure adventurers use "adventurer" as their occupation
                selectedOccupation = 'adventurer';
            } else if (lockStates.occupation && currentNPC) {
                selectedOccupation = currentNPC.occupation;
                // If previously was infant but now isn't, regenerate occupation
                if (selectedOccupation === 'infant') {
                    const validOccupations = Object.keys(occupations).filter(o => o !== 'infant' && o !== 'adventurer');
                    selectedOccupation = occupation === 'random' ? randomChoice(validOccupations) : occupation;
                }
            } else {
                const validOccupations = Object.keys(occupations).filter(o => o !== 'infant' && o !== 'adventurer');
                selectedOccupation = occupation === 'random' ? randomChoice(validOccupations) : occupation;
            }

            // Name - locked or generate new
            let fullName;
            if (lockStates.name && currentNPC) {
                fullName = currentNPC.name;
            } else {
                const firstName = getRaceName(selectedRace, selectedGender);
                const lastName = getRaceSurname(selectedRace);
                fullName = `${firstName} ${lastName}`;
            }

            // Get class and occupation data
            const classData = classes[selectedClass];
            const occData = occupations[selectedOccupation];
            
            // Stats - locked or generate new
            let abilities, modifiers;
            if (lockStates.stats && currentNPC) {
                abilities = { ...currentNPC.abilities };
                modifiers = { ...currentNPC.modifiers };
            } else {
                // Generate 6 ability scores: 1d4 for infants, 4d4 drop lowest for pure commoners, 4d6 drop lowest for adventurers
                const rawScores = [];
                const isInfant = selectedAgeCategory === 'infant';
                // Use adventurer rolls if they have any adventurer classes (including multiclass)
                const hasAdventurerClass = characterClasses.some(cc => cc.className !== 'commoner');
                const isPureCommoner = selectedClass === 'commoner' && !hasAdventurerClass;
                for (let i = 0; i < 6; i++) {
                    rawScores.push(isInfant ? rollInfantScore() : (isPureCommoner ? rollCommonerScore() : rollAbilityScore()));
                }
                rawScores.sort((a, b) => b - a);
                
                abilities = {
                    str: 0,
                    dex: 0,
                    con: 0,
                    int: 0,
                    wis: 0,
                    cha: 0
                };
                
                if (classData.primaryStat !== 'none') {
                    const primary = classData.primaryStat;
                    const secondary = (classData.secondaryStat && classData.secondaryStat !== 'none') 
                        ? classData.secondaryStat 
                        : ({ 'str': 'con', 'dex': 'con', 'con': 'str', 'int': 'wis', 'wis': 'con', 'cha': 'dex' }[primary] || 'con');
                    const dump = (classData.dumpStat && classData.dumpStat !== 'none') 
                        ? classData.dumpStat 
                        : ({ 'str': 'int', 'dex': 'str', 'con': 'int', 'int': 'str', 'wis': 'str', 'cha': 'str' }[primary] || 'str');
                    
                    abilities[primary] = rawScores[0];
                    abilities[secondary] = rawScores[1];
                    abilities[dump] = rawScores[5];
                    
                    const assignedStats = [primary, secondary, dump];
                    const remainingStats = Object.keys(abilities).filter(stat => !assignedStats.includes(stat));
                    remainingStats.forEach((stat, index) => {
                        abilities[stat] = rawScores[index + 2];
                    });
                } else {
                    const stats = Object.keys(abilities);
                    const shuffledStats = stats.sort(() => Math.random() - 0.5);
                    rawScores.forEach((score, index) => {
                        abilities[shuffledStats[index]] = score;
                    });
                }

                // Apply race bonuses
                const raceData = races[selectedRace];
                const hasAnyBonus = raceData.abilityBonus.any !== undefined;
                const fixedBonuses = Object.keys(raceData.abilityBonus).filter(a => a !== 'any');
                
                if (hasAnyBonus && fixedBonuses.length === 0) {
                    Object.keys(abilities).forEach(ability => {
                        abilities[ability] += raceData.abilityBonus.any;
                    });
                } else if (Object.keys(raceData.abilityBonus).length === 0) {
                    const sortedAbilities = Object.entries(abilities).sort((a, b) => b[1] - a[1]);
                    abilities[sortedAbilities[0][0]] += 2;
                    if (sortedAbilities.length > 1) {
                        abilities[sortedAbilities[1][0]] += 1;
                    }
                } else {
                    Object.keys(raceData.abilityBonus).forEach(ability => {
                        if (ability !== 'any') {
                            abilities[ability] += raceData.abilityBonus[ability];
                        }
                    });
                    if (hasAnyBonus) {
                        const sortedAbilities = Object.entries(abilities).sort((a, b) => b[1] - a[1]);
                        abilities[sortedAbilities[0][0]] += raceData.abilityBonus.any;
                    }
                }

                modifiers = {};
                Object.keys(abilities).forEach(ability => {
                    modifiers[ability] = getModifier(abilities[ability]);
                });
            }

            // Skills - locked or generate new (combine from all classes)
            let skills;
            if (lockStates.skills && currentNPC) {
                skills = [...currentNPC.skills];
            } else {
                let allClassSkills = [];
                characterClasses.forEach(cc => {
                    const cd = classes[cc.className];
                    if (cd && cd.skills) {
                        allClassSkills = [...allClassSkills, ...cd.skills];
                    }
                });
                const occSkills = occData.skills || [];
                skills = [...new Set([...allClassSkills, ...occSkills])];
            }

            // Equipment - locked or generate new
            let equipment;
            if (lockStates.equipment && currentNPC) {
                equipment = [...currentNPC.equipment];
            } else {
                equipment = occData.equipment || [];
            }

            // Calculate total level and proficiency bonus (commoner is level 0, doesn't count)
            const totalLevel = characterClasses.reduce((sum, cc) => cc.className === 'commoner' ? sum : sum + cc.level, 0) || 1;
            const proficiencyBonus = getProficiencyBonus(totalLevel);

            // Calculate hit points from all classes (level 0 classes like commoner don't contribute)
            const hitDieMap = { 'd4': 4, 'd6': 6, 'd8': 8, 'd10': 10, 'd12': 12 };
            let hitPoints = 0;
            let hitDiceStr = [];
            let firstAdventurerClass = true;
            
            characterClasses.forEach((cc, index) => {
                // Skip level 0 classes (like commoner)
                if (cc.level <= 0) return;
                
                const cd = classes[cc.className];
                const hitDieMax = hitDieMap[cd.hitDie] || 4;
                const hitDieAvg = Math.floor(hitDieMax / 2) + 1;
                
                if (firstAdventurerClass) {
                    // First adventurer class, first level: max hit die + CON
                    hitPoints += hitDieMax + modifiers.con;
                    // Additional levels of first class: average + CON
                    for (let lvl = 2; lvl <= cc.level; lvl++) {
                        hitPoints += hitDieAvg + modifiers.con;
                    }
                    firstAdventurerClass = false;
                } else {
                    // Multiclass levels: average + CON per level
                    for (let lvl = 1; lvl <= cc.level; lvl++) {
                        hitPoints += hitDieAvg + modifiers.con;
                    }
                }
                
                hitDiceStr.push(`${cc.level}${cd.hitDie}`);
            });
            
            // For pure commoners (level 0), give them 1 HP + CON modifier
            if (hitPoints === 0) {
                hitPoints = Math.max(1, 1 + modifiers.con);
            } else {
                // Ensure minimum 1 HP
                hitPoints = Math.max(1, hitPoints);
            }
            
            // Get saving throws from first (primary) class only
            const primaryClassData = classes[characterClasses[0]?.className] || classData;

            // Backstory - locked or generate new (always generated, checkbox only affects PDF export)
            let backstory;
            if (lockStates.backstory && currentNPC && currentNPC.backstory) {
                backstory = currentNPC.backstory;
            } else {
                backstory = generateBackstory(fullName, selectedRace, selectedOccupation, age, selectedAlignment, selectedAgeCategory, selectedGender, characterClasses);
            }

            // Get race data for display
            const raceData = races[selectedRace];

            // Calculate spells for spellcasting classes
            let spellData = null;
            if (!lockStates.spells || !currentNPC || !currentNPC.spellData) {
                // Check primary class for spellcasting
                const primaryClass = characterClasses[0];
                if (primaryClass) {
                    spellData = calculateSpells(
                        primaryClass.className, 
                        primaryClass.level, 
                        modifiers, 
                        primaryClass.subclass
                    );
                }
            } else {
                spellData = currentNPC.spellData;
            }

            // Generate weapons
            let characterWeapons = null;
            if (!lockStates.weapons || !currentNPC || !currentNPC.weapons) {
                const primaryClassName = characterClasses[0]?.className || 'commoner';
                characterWeapons = getCharacterWeapons(primaryClassName, selectedOccupation);
                
                // Add attack bonus and damage bonus to each weapon
                characterWeapons = characterWeapons.map(weapon => ({
                    ...weapon,
                    attackBonus: calculateAttackBonus(weapon, modifiers, proficiencyBonus, weapon.isProficient),
                    damageBonus: calculateDamageBonus(weapon, modifiers)
                }));
            } else {
                characterWeapons = currentNPC.weapons;
            }

            // Display NPC
            displayNPC({
                name: fullName,
                race: selectedRace,
                npcClass: selectedClass,
                characterClasses: characterClasses,
                occupation: selectedOccupation,
                age: age,
                ageCategory: selectedAgeCategory,
                gender: selectedGender,
                alignment: selectedAlignment,
                abilities: abilities,
                modifiers: modifiers,
                skills: skills,
                equipment: equipment,
                backstory: backstory,
                size: raceData.size,
                speed: raceData.speed,
                hitPoints: hitPoints,
                hitDice: hitDiceStr.join(' + '),
                totalLevel: totalLevel,
                proficiencyBonus: proficiencyBonus,
                hitDie: classData.hitDie,
                savingThrows: primaryClassData.savingThrows || [],
                // New stats
                initiative: modifiers.dex,
                passivePerception: 10 + modifiers.wis + (skills.includes('Perception') ? proficiencyBonus : 0),
                languages: raceData.languages || ['Common'],
                traits: raceData.traits || [],
                senses: raceData.senses || [],
                spellData: spellData,
                weapons: characterWeapons,
                ...calculateAC(characterClasses[0]?.className || 'commoner', modifiers)
            });
        }
        
        // Helper to determine age category from an age value
        function determineAgeCategory(age, race) {
            const raceKey = race.toLowerCase();
            const lifespan = races[raceKey]?.lifespan || 80;
            const maturity = maturityAges[raceKey] || 18;
            
            const adultEnd = maturity + Math.floor((lifespan - maturity) * 0.35);
            const matureEnd = maturity + Math.floor((lifespan - maturity) * 0.70);
            const elderlyStart = Math.floor(lifespan * 0.90);
            const childStart = Math.floor(maturity * 0.25);
            const childEnd = Math.floor(maturity * 0.85);
            
            if (age < childStart) return 'infant';
            if (age < childEnd) return 'child';
            if (age < adultEnd) return 'young-adult';
            if (age < matureEnd) return 'adult';
            if (age < elderlyStart) return 'mature';
            return 'elderly';
        }
        
        // Roll 4d4 drop lowest for commoner stats (lower average than adventurers)
        function rollCommonerScore() {
            const rolls = [
                Math.floor(Math.random() * 4) + 1,
                Math.floor(Math.random() * 4) + 1,
                Math.floor(Math.random() * 4) + 1,
                Math.floor(Math.random() * 4) + 1
            ];
            rolls.sort((a, b) => b - a);
            return rolls[0] + rolls[1] + rolls[2]; // Drop lowest
        }
        
        // Roll 1d4 for infant stats (very low scores)
        function rollInfantScore() {
            return Math.floor(Math.random() * 4) + 1;
        }

        // Race-specific lore for backstory generation (D&D 5e accurate)
        const raceLore = {
            'aarakocra': {
                homeland: 'the high mountain peaks near the Elemental Plane of Air',
                culture: 'values freedom above all else and feels most at home soaring through open skies',
                childhood: 'learning to fly and hunt in the thin mountain air',
                challenge: 'adapting to life among the wingless ground-dwellers',
                tradition: 'the sacred sky-dances of their aerie',
                elder: 'keeper of the ancient wind-songs'
            },
            'aasimar': {
                homeland: 'a family blessed by celestial heritage',
                culture: 'feels the weight of divine purpose guiding their actions',
                childhood: 'experiencing strange celestial visions and dreams',
                challenge: 'living up to the expectations of their divine heritage',
                tradition: 'communion with their celestial guide',
                elder: 'beacon of divine light to those who have lost their way'
            },
            'astral elf': {
                homeland: 'the silvery void of the Astral Sea',
                culture: 'carries the timeless perspective of one born among the stars',
                childhood: 'drifting through the endless silver expanse',
                challenge: 'understanding the urgency of those bound by time',
                tradition: 'the starlight meditations of the Astral realm',
                elder: 'living repository of eons of astral knowledge'
            },
            'autognome': {
                homeland: 'the workshop of a brilliant gnomish inventor',
                culture: 'seeks to understand their purpose and place in the world',
                childhood: 'being calibrated and learning basic functions',
                challenge: 'proving they are more than just a construct',
                tradition: 'the maintenance rituals taught by their creator',
                elder: 'well-maintained automaton with centuries of accumulated experience'
            },
            'bugbear': {
                homeland: 'the shadowy goblinoid territories',
                culture: 'combines surprising stealth with brutal strength',
                childhood: 'learning to move silently despite their bulk',
                challenge: 'overcoming the fearsome reputation of their kind',
                tradition: 'the hunt-stalking techniques passed down through generations',
                elder: 'grizzled veteran of countless ambushes and raids'
            },
            'centaur': {
                homeland: 'the vast open plains and rolling grasslands',
                culture: 'values the freedom of the open run and the bonds of the herd',
                childhood: 'racing across the grasslands with the other foals',
                challenge: 'navigating a world built for two-legged folk',
                tradition: 'the sacred gallop under the full moon',
                elder: 'wise keeper of the herd\'s oral histories'
            },
            'changeling': {
                homeland: 'wherever they chose to make their hidden life',
                culture: 'understands identity as fluid and self-determined',
                childhood: 'learning to control their shapeshifting abilities',
                challenge: 'finding their true self among countless masks',
                tradition: 'the secret gatherings where changelings reveal their true forms',
                elder: 'master of a thousand faces and identities'
            },
            'deep gnome': {
                homeland: 'the hidden cities of the Underdark',
                culture: 'values secrecy, caution, and the treasures of the deep earth',
                childhood: 'learning to move silently through lightless tunnels',
                challenge: 'adjusting to the blinding brightness of the surface',
                tradition: 'the gem-cutting ceremonies of their hidden community',
                elder: 'keeper of the secret paths through the Underdark'
            },
            'dragonborn': {
                homeland: 'the proud dragonborn clans',
                culture: 'carries the honor of their clan and the legacy of dragonkind',
                childhood: 'learning the history and traditions of their draconic ancestors',
                challenge: 'upholding clan honor while forging their own path',
                tradition: 'the sacred recitation of clan lineage',
                elder: 'honored elder whose scales have silvered with age and wisdom'
            },
            'drow': {
                homeland: 'the treacherous cities of the Underdark',
                culture: 'has learned to survive in a society where trust is rare',
                childhood: 'navigating the deadly politics of drow society',
                challenge: 'escaping the shadow of Lolth\'s influence',
                tradition: 'the dangerous rites of drow coming-of-age',
                elder: 'survivor of centuries of Underdark intrigue'
            },
            'duergar': {
                homeland: 'the fortress-cities deep beneath the mountains',
                culture: 'values hard work, discipline, and self-reliance above all',
                childhood: 'toiling in the forges from a young age',
                challenge: 'overcoming the bitterness that defines their people',
                tradition: 'the solemn craft-rites of duergar smithing',
                elder: 'master craftsperson whose creations are legendary'
            },
            'dwarf': {
                homeland: 'the great mountain halls of the dwarven kingdoms',
                culture: 'honors clan traditions and the mastery of stone and steel',
                childhood: 'learning the craft-secrets of their clan',
                challenge: 'living up to the legendary standards of dwarven craftsmanship',
                tradition: 'the sacred smithing rites of their ancestors',
                elder: 'venerated keeper of clan history and tradition'
            },
            'eladrin': {
                homeland: 'the ever-shifting beauty of the Feywild',
                culture: 'experiences emotions with fey intensity, shifting with the seasons',
                childhood: 'dancing through the eternal twilight of the Feywild',
                challenge: 'containing the wild fey magic that surges within',
                tradition: 'the seasonal festivals of the fey courts',
                elder: 'ancient fey who has seen countless seasons turn'
            },
            'elf': {
                homeland: 'the ancient elven forests and hidden realms',
                culture: 'takes the long view, shaped by centuries of elven tradition',
                childhood: 'spending decades in the patient ways of elven learning',
                challenge: 'watching shorter-lived friends age while they remain unchanged',
                tradition: 'the moonlit reveries that connect elves to their ancestors',
                elder: 'living link to elven history stretching back millennia'
            },
            'fairy': {
                homeland: 'the whimsical glades of the Feywild',
                culture: 'approaches life with fey wonder and mischievous delight',
                childhood: 'flitting among the enchanted flowers of the Feywild',
                challenge: 'understanding why the material world takes itself so seriously',
                tradition: 'the moonlight dances and playful tricks of fairy-kind',
                elder: 'ancient sprite whose magic has grown subtle and deep'
            },
            'firbolg': {
                homeland: 'the deep and ancient forests',
                culture: 'serves as a gentle guardian of the natural world',
                childhood: 'learning to speak with the beasts and plants of the forest',
                challenge: 'venturing into the noisy, crowded world beyond the trees',
                tradition: 'the sacred duty of forest stewardship',
                elder: 'wise druid-like guardian the forest itself seems to obey'
            },
            'genasi': {
                homeland: 'a family touched by elemental power',
                culture: 'feels the pull of their elemental heritage in everything they do',
                childhood: 'learning to control the elemental power within',
                challenge: 'finding acceptance despite their otherworldly appearance',
                tradition: 'meditation on their elemental nature',
                elder: 'being of elemental wisdom who has mastered their inner power'
            },
            'giff': {
                homeland: 'the militant hippo-folk society',
                culture: 'appreciates military discipline and the proper use of firearms',
                childhood: 'drilling in formation and learning weapons maintenance',
                challenge: 'finding worthy causes to apply their martial expertise',
                tradition: 'the sacred cleaning and maintenance of weaponry',
                elder: 'decorated veteran of countless military campaigns'
            },
            'githyanki': {
                homeland: 'the fortresses of Tu\'narath in the Astral Plane',
                culture: 'was raised as a warrior against the mind flayer menace',
                childhood: 'training relentlessly in the arts of war',
                challenge: 'questioning the rigid hierarchy of githyanki society',
                tradition: 'the sacred raids against illithid strongholds',
                elder: 'silver-sword wielding veteran of the eternal war'
            },
            'githzerai': {
                homeland: 'the monasteries of Limbo',
                culture: 'has achieved inner calm through rigorous mental discipline',
                childhood: 'mastering the mind through endless meditation',
                challenge: 'maintaining inner peace amid the chaos of the material world',
                tradition: 'the mental exercises that shape reality in Limbo',
                elder: 'master of psionic discipline whose mind is an unassailable fortress'
            },
            'gnome': {
                homeland: 'the busy burrows and workshops of the gnomish community',
                culture: 'approaches life with boundless curiosity and inventive spirit',
                childhood: 'tinkering with contraptions and asking endless questions',
                challenge: 'being taken seriously despite their small stature',
                tradition: 'the great invention festivals of gnomish society',
                elder: 'master inventor with centuries of accumulated knowledge'
            },
            'goblin': {
                homeland: 'the scrappy goblin warrens',
                culture: 'has learned cunning and resourcefulness through necessity',
                childhood: 'scrapping for survival among the chaos of the warren',
                challenge: 'proving their worth beyond the stereotypes of their kind',
                tradition: 'the clever tricks passed down through goblin generations',
                elder: 'cunning survivor who has outlived countless rivals'
            },
            'goliath': {
                homeland: 'the harsh peaks of the highest mountains',
                culture: 'measures worth through personal achievement and fair competition',
                childhood: 'testing themselves against the unforgiving mountain environment',
                challenge: 'finding worthy challenges to prove their strength',
                tradition: 'the competitive trials that determine goliath standing',
                elder: 'legendary champion whose deeds are sung around mountain campfires'
            },
            'grung': {
                homeland: 'the poisonous swamps of the grung tribes',
                culture: 'understands their place in the strict color-based caste system',
                childhood: 'developing their poisonous skin and learning tribal ways',
                challenge: 'the constant need to stay hydrated away from water',
                tradition: 'the ritualistic ceremonies of the grung hierarchy',
                elder: 'revered elder whose wisdom guides the tribe'
            },
            'hadozee': {
                homeland: 'the wildspace-sailing ships of the hadozee',
                culture: 'lives for adventure among the stars and the thrill of wildspace',
                childhood: 'learning to glide between ship rigging in the void',
                challenge: 'staying grounded when the call of wildspace beckons',
                tradition: 'the shipboard traditions of hadozee spacefarers',
                elder: 'veteran spacefarer with tales from a hundred crystal spheres'
            },
            'half-elf': {
                homeland: 'the borderlands between human and elven society',
                culture: 'bridges two worlds while fully belonging to neither',
                childhood: 'navigating between human and elven relatives',
                challenge: 'finding a community that truly accepts all of who they are',
                tradition: 'creating new traditions that honor both heritages',
                elder: 'wise mediator between the human and elven worlds'
            },
            'half-orc': {
                homeland: 'the frontier lands where orc and human territories meet',
                culture: 'channels the strength of their orcish blood toward their own ends',
                childhood: 'learning to harness their fierce inner strength',
                challenge: 'facing prejudice from those who fear their orcish heritage',
                tradition: 'proving themselves through deeds rather than words',
                elder: 'respected warrior whose strength and wisdom are beyond question'
            },
            'halfling': {
                homeland: 'the cozy villages and warm hearths of halfling communities',
                culture: 'cherishes good food, good company, and a comfortable home',
                childhood: 'running barefoot through pastoral halfling lands',
                challenge: 'finding adventure while staying true to halfling values',
                tradition: 'the great feasts and storytelling of halfling gatherings',
                elder: 'beloved elder whose stories and recipes are village treasures'
            },
            'harengon': {
                homeland: 'the ever-changing realms of the Feywild',
                culture: 'lives by luck and quick reflexes, always ready to leap',
                childhood: 'bounding through the Feywild with restless energy',
                challenge: 'sitting still long enough for others to keep up',
                tradition: 'the lucky charms and superstitions of harengon culture',
                elder: 'remarkably fortunate elder who has hopped out of countless dangers'
            },
            'hobgoblin': {
                homeland: 'the disciplined legions of the hobgoblin military',
                culture: 'values martial excellence and strategic thinking above all',
                childhood: 'drilling in formation from the moment they could walk',
                challenge: 'finding purpose outside the rigid hobgoblin hierarchy',
                tradition: 'the military codes of honor that govern hobgoblin society',
                elder: 'strategic mastermind whose tactical knowledge is unparalleled'
            },
            'human': {
                homeland: 'the diverse and ever-expanding human settlements',
                culture: 'embodies the adaptability and ambition of humankind',
                childhood: 'growing up amid the bustling energy of human society',
                challenge: 'making their mark in the brief span of a human life',
                tradition: 'the varied customs of their particular human culture',
                elder: 'respected figure whose lifetime of experience guides the community'
            },
            'kalashtar': {
                homeland: 'a lineage bonded with spirits from the Region of Dreams',
                culture: 'carries a quori spirit that whispers wisdom from the dream realm',
                childhood: 'learning to hear and understand their bonded spirit',
                challenge: 'protecting their spirit from the forces of Dal Quor',
                tradition: 'the meditation practices that strengthen the spirit bond',
                elder: 'serene sage whose spirit bond has deepened over decades'
            },
            'kender': {
                homeland: 'the curious and wandering communities of Krynn',
                culture: 'approaches the world with boundless curiosity and fearlessness',
                childhood: 'exploring every nook and cranny, collecting "found" treasures',
                challenge: 'understanding why others get so upset about "borrowing"',
                tradition: 'the wanderlust that drives kender to explore new places',
                elder: 'legendary wanderer whose tales of adventure span the entire world'
            },
            'kenku': {
                homeland: 'the urban shadows where the cursed kenku gather',
                culture: 'communicates through mimicked sounds and remembered voices',
                childhood: 'collecting sounds and voices to build their vocabulary',
                challenge: 'expressing original thoughts without the gift of true speech',
                tradition: 'the shared sounds that form kenku community identity',
                elder: 'keeper of countless voices and sounds from across the years'
            },
            'kobold': {
                homeland: 'the trap-filled warrens of the kobold tribes',
                culture: 'serves the glory of dragonkind with clever devotion',
                childhood: 'learning to craft traps and honor their draconic masters',
                challenge: 'earning respect despite their small and underestimated stature',
                tradition: 'the dragon-worship ceremonies of kobold society',
                elder: 'cunning trap-master whose ingenious designs are legendary'
            },
            'leonin': {
                homeland: 'the golden prides of the savanna',
                culture: 'carries the fierce pride and loyalty of the leonin people',
                childhood: 'learning to hunt and protect the pride',
                challenge: 'balancing personal honor with duty to the pride',
                tradition: 'the roaring ceremonies that celebrate leonin victories',
                elder: 'silver-maned elder whose roar commands respect'
            },
            'lizardfolk': {
                homeland: 'the swamps and marshlands of their tribal territories',
                culture: 'approaches the world with cold practicality and survival instinct',
                childhood: 'learning to hunt and survive in the harsh swamplands',
                challenge: 'understanding the emotional complexities of warm-blooded folk',
                tradition: 'the practical rituals that ensure tribal survival',
                elder: 'ancient survivor whose practical wisdom has kept the tribe alive'
            },
            'locathah': {
                homeland: 'the underwater communities of the locathah',
                culture: 'values community cooperation above individual achievement',
                childhood: 'swimming with their school from earliest memory',
                challenge: 'adapting to the dry world above the waves',
                tradition: 'the communal gatherings that strengthen locathah bonds',
                elder: 'wise keeper of the school\'s collective memory'
            },
            'loxodon': {
                homeland: 'the close-knit loxodon herds',
                culture: 'values community, tradition, and the wisdom of the ancestors',
                childhood: 'learning from the elders and memorizing family histories',
                challenge: 'balancing tradition with the need for change',
                tradition: 'the memory-sharing rituals that preserve loxodon history',
                elder: 'living library of generations of loxodon wisdom'
            },
            'minotaur': {
                homeland: 'the labyrinthine halls of minotaur civilization',
                culture: 'channels their fierce nature toward honorable goals',
                childhood: 'navigating the winding passages of their home',
                challenge: 'controlling the rage that burns within their blood',
                tradition: 'the maze-running trials that prove minotaur worth',
                elder: 'battle-scarred veteran whose horns have grown mighty with age'
            },
            'orc': {
                homeland: 'the fierce orc tribes of the wild lands',
                culture: 'embraces strength, endurance, and the bonds of the tribe',
                childhood: 'proving themselves through contests of strength and will',
                challenge: 'channeling their fierce nature toward constructive ends',
                tradition: 'the strength-trials that determine orcish standing',
                elder: 'mighty elder whose battle-wisdom is sought by all'
            },
            'owlin': {
                homeland: 'the mysterious reaches of the Feywild',
                culture: 'sees the world with owl-like wisdom and patience',
                childhood: 'learning to fly silently through moonlit forests',
                challenge: 'staying awake during the bright hours of day',
                tradition: 'the nighttime gatherings where owlin share knowledge',
                elder: 'ancient sage whose wide eyes have seen centuries of secrets'
            },
            'plasmoid': {
                homeland: 'the far realms where plasmoids originate',
                culture: 'experiences the world through their unique amorphous form',
                childhood: 'learning to hold a stable shape',
                challenge: 'relating to creatures bound by rigid forms',
                tradition: 'the flowing dances that celebrate plasmoid nature',
                elder: 'elder whose form has stabilized into dignified patterns'
            },
            'satyr': {
                homeland: 'the festive glades of the Feywild',
                culture: 'lives for revelry, music, and the pleasures of life',
                childhood: 'learning music and mischief among the fey',
                challenge: 'taking anything too seriously for too long',
                tradition: 'the wild revels and musical gatherings of satyr-kind',
                elder: 'master musician whose songs can move even the coldest heart'
            },
            'sea elf': {
                homeland: 'the underwater kingdoms of the sea elves',
                culture: 'feels the pull of both the ocean depths and the surface world',
                childhood: 'swimming through coral palaces and sunken ruins',
                challenge: 'spending extended time away from the sea',
                tradition: 'the tidal ceremonies that honor the ocean',
                elder: 'ancient keeper of secrets from the ocean floor'
            },
            'shadar-kai': {
                homeland: 'the gray realm of the Shadowfell',
                culture: 'seeks intense experiences to feel anything at all',
                childhood: 'enduring the numbing gloom of the Shadowfell',
                challenge: 'finding meaning in a world that seems colorless',
                tradition: 'the painful rituals that remind them they are alive',
                elder: 'scarred survivor who has found purpose despite the shadow'
            },
            'shifter': {
                homeland: 'the wild frontiers where civilization meets the beast',
                culture: 'embraces the primal nature that runs in their blood',
                childhood: 'learning to channel their bestial heritage',
                challenge: 'controlling the beast within during times of stress',
                tradition: 'the moonlit rites that honor their lycanthropic ancestors',
                elder: 'wise elder who has achieved harmony with their beast-self'
            },
            'simic hybrid': {
                homeland: 'the biomancy laboratories of the Simic Combine',
                culture: 'sees themselves as an evolution of multiple forms',
                childhood: 'adapting to their enhanced body after the procedure',
                challenge: 'remembering who they were before the changes',
                tradition: 'regular check-ins with Simic researchers',
                elder: 'veteran hybrid whose adaptations have proven remarkably stable'
            },
            'tabaxi': {
                homeland: 'the distant jungles where tabaxi clans roam',
                culture: 'is driven by insatiable curiosity and wanderlust',
                childhood: 'chasing butterflies and collecting stories',
                challenge: 'staying interested once the mystery is solved',
                tradition: 'the story-sharing gatherings of the clan',
                elder: 'legendary collector of tales from across the world'
            },
            'thri-kreen': {
                homeland: 'the arid wastes where thri-kreen hunt in packs',
                culture: 'thinks in practical, communal terms foreign to most humanoids',
                childhood: 'learning to hunt in perfect coordination with the clutch',
                challenge: 'understanding the strange individual focus of other races',
                tradition: 'the silent hunts that bond the clutch together',
                elder: 'ancient hunter whose carapace has hardened with age'
            },
            'tiefling': {
                homeland: 'a lineage marked by infernal heritage',
                culture: 'has learned self-reliance in the face of prejudice',
                childhood: 'dealing with the stares and whispers of the fearful',
                challenge: 'proving their infernal blood does not define their character',
                tradition: 'forging their own path despite the expectations of others',
                elder: 'wise figure who has turned prejudice into strength'
            },
            'tortle': {
                homeland: 'the coastal regions where tortles hatch',
                culture: 'approaches life as a journey of experiences to collect',
                childhood: 'wandering from the nesting beach to see the world',
                challenge: 'feeling the pull to settle as their years advance',
                tradition: 'the return to ancestral beaches to share wisdom',
                elder: 'ancient wanderer whose shell bears the marks of countless journeys'
            },
            'triton': {
                homeland: 'the deep ocean trenches guarded by triton cities',
                culture: 'carries the proud duty of protecting the world from deep-sea threats',
                childhood: 'training to guard against the horrors of the deep',
                challenge: 'understanding that surface-dwellers don\'t know of their sacrifices',
                tradition: 'the solemn oaths of protection sworn by all tritons',
                elder: 'veteran guardian of the deep whose tales of undersea battles are legend'
            },
            'vedalken': {
                homeland: 'the methodical society of the vedalken',
                culture: 'pursues perfection through careful analysis and improvement',
                childhood: 'cataloging flaws and planning improvements',
                challenge: 'accepting that perfection may be unattainable',
                tradition: 'the peer review councils that evaluate vedalken work',
                elder: 'master analyst whose critiques have improved countless endeavors'
            },
            'verdan': {
                homeland: 'the strange circumstances of their recent creation',
                culture: 'is curious about a world they are only beginning to understand',
                childhood: 'rapidly growing and changing in unexpected ways',
                challenge: 'making sense of their mysterious goblinoid origins',
                tradition: 'sharing discoveries with other verdan',
                elder: 'one of the oldest of their young race, full of hard-won wisdom'
            },
            'warforged': {
                homeland: 'the forges where they were created for war',
                culture: 'seeks purpose and meaning beyond their original design',
                childhood: 'being activated and learning their initial functions',
                challenge: 'understanding emotions and finding their place in peace',
                tradition: 'the maintenance rituals that keep them functioning',
                elder: 'ancient construct who has found purpose beyond their original programming'
            },
            'yuan-ti': {
                homeland: 'the serpent kingdoms of yuan-ti civilization',
                culture: 'approaches the world with cold, calculating logic',
                childhood: 'being taught to suppress emotion as weakness',
                challenge: 'understanding why others let feelings guide them',
                tradition: 'the serpent rites that honor their transformation',
                elder: 'cold strategist whose schemes span generations'
            }
        };

        function generateBackstory(name, race, occupation, age, alignment, ageCategory, gender, characterClasses) {
            const pronoun = gender === 'male' ? 'he' : gender === 'female' ? 'she' : 'they';
            const Pronoun = pronoun.charAt(0).toUpperCase() + pronoun.slice(1);
            const possessive = gender === 'male' ? 'his' : gender === 'female' ? 'her' : 'their';
            const Possessive = possessive.charAt(0).toUpperCase() + possessive.slice(1);
            const reflexive = gender === 'non-binary' ? 'themselves' : (gender === 'male' ? 'himself' : 'herself');
            const object = gender === 'non-binary' ? 'them' : (gender === 'male' ? 'him' : 'her');
            const verbS = gender === 'non-binary' ? '' : 's';
            const hasHave = gender === 'non-binary' ? 'have' : 'has';
            
            // Format occupation: replace underscores with spaces and capitalize each word
            const formattedOccupation = occupation.replace(/_/g, ' ').split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase()).join(' ');
            
            const raceKey = race.toLowerCase();
            const lore = raceLore[raceKey] || raceLore['human'];
            const yearWord = age === 1 ? 'year' : 'years';
            
            // Special phrasing for newborns (age 0)
            const agePhrase = age === 0 ? 'this year' : `${age} ${yearWord} ago`;
            const ageDescription = age === 0 ? 'newborn' : `${age} ${yearWord} old`;
            const ageOf = age === 0 ? 'newborn' : `${age} ${yearWord}`;
            const justBorn = age === 0 ? 'recently' : `just ${age} ${yearWord} ago`;
            
            // Check for commoner with adventurer classes (various scenarios)
            const hasCommoner = characterClasses?.some(cc => cc.className === 'commoner');
            const adventurerClasses = characterClasses?.filter(cc => cc.className !== 'commoner') || [];
            const hasAdventurerTraining = hasCommoner && adventurerClasses.length > 0;
            
            // Build adventurer class description and scenario for commoners with training
            let adventurerDescription = '';
            let adventurerScenario = '';
            if (hasAdventurerTraining) {
                const classDescriptions = adventurerClasses.map(cc => {
                    let desc = capitalize(cc.className);
                    if (cc.subclass && subclasses[cc.className]) {
                        const subclassData = subclasses[cc.className];
                        const subclassOption = subclassData.options.find(o => o.id === cc.subclass);
                        if (subclassOption) {
                            desc = subclassOption.name + ' ' + desc;
                        }
                    }
                    return desc;
                });
                adventurerDescription = classDescriptions.join(' and ');
                
                // Random scenario for why a trained adventurer is living as a commoner
                const scenarios = [
                    `a retired ${adventurerDescription} who now lives a quieter life`,
                    `secretly a trained ${adventurerDescription}, hiding ${possessive} abilities from the world`,
                    `a former ${adventurerDescription} in hiding, avoiding those who might recognize ${object}`,
                    `an undercover ${adventurerDescription}, using ${possessive} cover as a ${formattedOccupation} to gather information`,
                    `once a promising ${adventurerDescription}, but trauma has led ${object} to abandon that life`,
                    `a ${adventurerDescription} who left adventuring behind after a personal loss`,
                    `an aspiring ${adventurerDescription}, training in secret while working as a ${formattedOccupation}`,
                    `a ${adventurerDescription} laying low after a job gone wrong`,
                    `a former ${adventurerDescription} who found peace in the simple life of a ${formattedOccupation}`,
                    `secretly a ${adventurerDescription}, waiting for the right moment to reveal ${possessive} true skills`
                ];
                adventurerScenario = randomChoice(scenarios);
            }
            
            // Get subclass backstory hooks from all classes
            let subclassHook = '';
            let allSubclassHooks = [];
            if (characterClasses && characterClasses.length > 0) {
                characterClasses.forEach(cc => {
                    if (cc.subclass && subclasses[cc.className]) {
                        const subclassData = subclasses[cc.className];
                        const subclassOption = subclassData.options.find(o => o.id === cc.subclass);
                        if (subclassOption && subclassOption.backstoryHook) {
                            allSubclassHooks.push(subclassOption.backstoryHook);
                        }
                    }
                });
                // Use primary subclass hook for templates, store all for potential use
                subclassHook = allSubclassHooks[0] || '';
            }
            
            const backstoryTemplates = {
                'infant': [
                    `${name} was born ${justBorn} in ${lore.homeland}. Even at this tender age, ${pronoun} already show${verbS} signs of ${possessive} ${race} heritage. ${Possessive} family watches over ${object} with great love.`,
                    `A ${ageDescription}, ${name} is just beginning life in ${lore.homeland}. The infant's ${race} features are already evident, and ${possessive} family hopes ${pronoun} will grow to embody ${alignment} values.`,
                    `${name} is a ${ageOf} ${race} infant, born into a family from ${lore.homeland}. ${Possessive} parents pray ${pronoun} will grow strong and true.`,
                    `The tiny ${race} known as ${name} came into this world ${agePhrase} in ${lore.homeland}. ${Possessive} future is unwritten, full of possibility and promise.`,
                    `${name}, a ${ageOf} ${race} infant, sleeps peacefully while ${possessive} family tends to ${object}. Born in ${lore.homeland}, ${possessive} journey has only just begun.`
                ],
                'child': [
                    `${name} is a ${age}-year-old ${race} child from ${lore.homeland}. ${Pronoun} spend${verbS} ${possessive} days ${lore.childhood}, while dreaming of becoming a ${formattedOccupation}.`,
                    `Young ${name}, at ${age} ${yearWord} old, is ${lore.childhood}. This curious ${race} child ${lore.culture}, already showing a ${alignment} temperament.`,
                    `At ${age}, ${name} is still ${lore.childhood}. The young ${race} idolizes the local ${formattedOccupation}s and ${lore.culture}.`,
                    `${name} is a ${race} child of ${age} who grew up in ${lore.homeland}. While ${lore.childhood}, ${pronoun} dream${verbS} of one day working as a ${formattedOccupation}.`,
                    `The ${age}-year-old ${race} named ${name} is known for ${possessive} ${alignment} nature. Currently ${lore.childhood}, ${pronoun} show${verbS} promise for a future as a ${formattedOccupation}.`
                ],
                'young-adult': hasAdventurerTraining ? [
                    `${name} is a ${age}-year-old ${race} from ${lore.homeland} who works as a ${formattedOccupation}, while secretly being ${adventurerScenario}. ${Pronoun} ${lore.culture}, balancing ${possessive} ambitions carefully.`,
                    `At ${age}, ${name} appears to be a simple ${formattedOccupation}, but is ${adventurerScenario}. This young ${race} from ${lore.homeland} ${lore.culture}, hiding ${possessive} true potential.`,
                    `${name} is a young ${race} of ${age} ${yearWord}, ${adventurerScenario} while working as a ${formattedOccupation}. ${Possessive} ${alignment} values guide both paths ${pronoun} walk${verbS}.`,
                    `Fresh from ${lore.homeland}, the ${age}-year-old ${name} maintains a cover as a ${formattedOccupation}. In reality, ${pronoun} ${gender === 'non-binary' ? 'are' : 'is'} ${adventurerScenario}, full of untapped potential.`,
                    `${name}, a ${age}-year-old ${race}, lives a double life as ${formattedOccupation} and ${adventurerScenario}. ${Pronoun} ${lore.culture}, but ${possessive} true journey is just beginning.`
                ] : [
                    `${name} is a ${age}-year-old ${race} from ${lore.homeland} who recently began training as a ${formattedOccupation}${subclassHook ? `, ${subclassHook}` : ''}. ${Pronoun} ${lore.culture}, and face${verbS} the challenge of ${lore.challenge}.`,
                    `At ${age}, ${name} has just left ${lore.homeland} to pursue a career as a ${formattedOccupation}. As a young ${race}${subclassHook ? ` ${subclassHook}` : ''} who ${lore.culture}, ${pronoun} approach${verbS === 's' ? 'es' : ''} ${possessive} new life with ${alignment} determination.`,
                    `${name} is a young ${race} of ${age} ${yearWord}, newly apprenticed to a ${formattedOccupation}${subclassHook ? ` ${subclassHook}` : ''}. Having grown up ${lore.childhood}, ${pronoun} now face${verbS} ${lore.challenge}.`,
                    `Fresh from ${lore.homeland}, the ${age}-year-old ${name}${subclassHook ? ` ${subclassHook}` : ''} ${lore.culture}. This young ${race} ${hasHave} chosen the path of a ${formattedOccupation}, bringing ${possessive} ${alignment} values.`,
                    `${name}, a ${age}-year-old ${race}${subclassHook ? ` ${subclassHook}` : ''}, still honors ${lore.tradition} while training as a ${formattedOccupation}. ${Pronoun} ${lore.culture} and ${hasHave} much to prove.`
                ],
                'adult': hasAdventurerTraining ? [
                    `${name} is a ${race} ${formattedOccupation} of ${age} ${yearWord} from ${lore.homeland}, but is also ${adventurerScenario}. ${Pronoun} ${lore.culture}, balancing ${possessive} dual life with ${alignment} integrity.`,
                    `At ${age} ${yearWord} old, ${name} works as a ${formattedOccupation}, though ${pronoun} ${gender === 'non-binary' ? 'are' : 'is'} ${adventurerScenario}. This ${race} from ${lore.homeland} ${lore.culture}, keeping ${possessive} past close to ${possessive} chest.`,
                    `${name}, a ${race} of ${age}, appears to be a simple ${formattedOccupation}. In truth, ${pronoun} ${gender === 'non-binary' ? 'are' : 'is'} ${adventurerScenario}. Few know of ${possessive} ${alignment} convictions or true capabilities.`,
                    `The ${age}-year-old ${race} known as ${name} serves as a ${formattedOccupation} in ${lore.homeland}. However, ${pronoun} ${gender === 'non-binary' ? 'are' : 'is'} ${adventurerScenario}, and ${possessive} skills run far deeper than most realize.`,
                    `${name} lives as a ${formattedOccupation} at ${age}. This ${race} from ${lore.homeland} is ${adventurerScenario}, carrying ${possessive} ${alignment} values quietly while ${lore.culture}.`
                ] : [
                    `${name} is a ${race} ${formattedOccupation} of ${age} ${yearWord} from ${lore.homeland}${subclassHook ? `, ${subclassHook}` : ''}. ${Pronoun} ${lore.culture}, and ${hasHave} learned to navigate ${lore.challenge}. ${Possessive} ${alignment} reputation is well-established.`,
                    `At ${age} ${yearWord} old, ${name} has established ${reflexive} as a capable ${formattedOccupation}${subclassHook ? ` ${subclassHook}` : ''}. This ${race} from ${lore.homeland} ${lore.culture}, while still honoring ${lore.tradition}.`,
                    `${name}, a ${race} of ${age}${subclassHook ? ` ${subclassHook}` : ''}, has spent years honing ${possessive} craft as a ${formattedOccupation}. Despite ${lore.challenge}, ${pronoun} ${hasHave} built a ${alignment} reputation.`,
                    `The ${age}-year-old ${race} known as ${name} is a respected ${formattedOccupation}${subclassHook ? ` ${subclassHook}` : ''}. ${Pronoun} ${lore.culture}, never forgetting ${possessive} roots in ${lore.homeland}.`,
                    `${name} is in the prime of ${possessive} career at ${age}. This ${race} ${formattedOccupation} from ${lore.homeland}${subclassHook ? ` ${subclassHook}` : ''} ${hasHave} overcome ${lore.challenge} through ${possessive} ${alignment} approach to life.`
                ],
                'mature': hasAdventurerTraining ? [
                    `${name} is a seasoned ${race} ${formattedOccupation} of ${age} ${yearWord}, though ${pronoun} ${gender === 'non-binary' ? 'are' : 'is'} ${adventurerScenario}. Originally from ${lore.homeland}, ${pronoun} ${lore.culture}, drawing on both ${possessive} adventuring experience and ${alignment} wisdom.`,
                    `At ${age}, ${name} has seen much in ${possessive} time. On the surface a ${formattedOccupation}, ${pronoun} ${gender === 'non-binary' ? 'are' : 'is'} ${adventurerScenario}. Few suspect the depth of skill this ${race} possesses.`,
                    `${name}, a ${race} of ${age} ${yearWord}, maintains a life as a ${formattedOccupation} while being ${adventurerScenario}. From ${lore.homeland}, ${pronoun} ${lore.culture}, though ${possessive} past holds more than ${pronoun} let${verbS} on.`,
                    `The ${age}-year-old ${race} ${name} appears to be a simple ${formattedOccupation}, but is ${adventurerScenario}. ${Possessive} ${alignment} character guides both aspects of ${possessive} life.`,
                    `${name} has lived ${age} ${yearWord} as both ${formattedOccupation} and ${adventurerScenario}. This ${race} from ${lore.homeland} ${lore.culture}, carrying secrets that few would believe.`
                ] : [
                    `${name} is a seasoned ${race} ${formattedOccupation} of ${age} ${yearWord}${subclassHook ? `, ${subclassHook}` : ''}. Originally from ${lore.homeland}, ${pronoun} ${lore.culture}. Years of ${lore.challenge} have only strengthened ${possessive} ${alignment} convictions.`,
                    `At ${age}, ${name}${subclassHook ? ` ${subclassHook}` : ''} has seen much in ${possessive} time as a ${race} ${formattedOccupation}. ${Pronoun} still honors ${lore.tradition}, while mentoring younger folk with ${possessive} ${alignment} wisdom.`,
                    `${name}, a ${race} of ${age} ${yearWord}${subclassHook ? ` ${subclassHook}` : ''}, has decades of experience as a ${formattedOccupation}. From ${lore.homeland}, ${pronoun} ${lore.culture}. Many seek ${possessive} counsel on important matters.`,
                    `The ${age}-year-old ${race} ${formattedOccupation} ${name}${subclassHook ? ` ${subclassHook}` : ''} has weathered many storms since leaving ${lore.homeland}. ${Possessive} ${alignment} character has been tested by ${lore.challenge} and proven over the years.`,
                    `${name} is a master ${formattedOccupation} at ${age}${subclassHook ? `, ${subclassHook}` : ''}. As a ${race} who ${lore.culture}, ${pronoun} ${hasHave} become a ${lore.elder}, still practicing ${lore.tradition}.`
                ],
                'elderly': hasAdventurerTraining ? [
                    `${name} is a venerable ${race} of ${age} ${yearWord}, living as a ${formattedOccupation} though ${pronoun} ${gender === 'non-binary' ? 'are' : 'is'} ${adventurerScenario}. Now a ${lore.elder}, ${pronoun} guards ${possessive} secrets with ${alignment} wisdom.`,
                    `At ${age}, ${name} has lived many lives - ${formattedOccupation} to most, but ${adventurerScenario} to those who know the truth. This ${race} ${lore.elder} ${lore.culture}, carrying stories few would believe.`,
                    `${name}, an elderly ${race} of ${age}, appears to be a simple ${formattedOccupation}. Yet ${pronoun} ${gender === 'non-binary' ? 'are' : 'is'} ${adventurerScenario}. Even now, ${possessive} skills remain sharp.`,
                    `The ${age}-year-old ${race} ${name} is known locally as a ${formattedOccupation}, but is secretly ${adventurerScenario}. From ${lore.homeland}, this ${lore.elder} keeps ${possessive} true nature hidden.`,
                    `${name} has seen ${age} ${yearWord} come and go, living as ${formattedOccupation} while being ${adventurerScenario}. This ${race} ${lore.elder} ${lore.culture}, ${possessive} past a closely guarded secret.`
                ] : [
                    `${name} is a venerable ${race} of ${age} ${yearWord}, a retired ${formattedOccupation} from ${lore.homeland}. Now a ${lore.elder}, ${pronoun} shares ${possessive} ${alignment} wisdom with the next generation.`,
                    `At ${age}, ${name} has lived a full life as a ${race} ${formattedOccupation}. ${Pronoun} ${lore.culture}, and reflect${verbS} on a lifetime of ${lore.challenge}. ${Possessive} legacy is secure.`,
                    `${name}, an elderly ${race} of ${age}, was once a renowned ${formattedOccupation}. This ${lore.elder} from ${lore.homeland} now spend${verbS} ${possessive} twilight years honoring ${lore.tradition}.`,
                    `The ${age}-year-old ${race} ${name} is a living legend among ${formattedOccupation}s. From ${lore.homeland}, this ${lore.elder} ${hasHave} earned great respect through ${possessive} ${alignment} deeds.`,
                    `${name} has seen ${age} ${yearWord} come and go. This elderly ${race} ${formattedOccupation} is treasured as a ${lore.elder}, ${possessive} stories of ${lore.challenge} inspiring all who listen.`
                ]
            };
            
            const templates = backstoryTemplates[ageCategory] || backstoryTemplates['adult'];
            return randomChoice(templates);
        }

        // Store current NPC data and lock states globally
        let currentNPC = null;
        const lockStates = {
            name: false,
            race: false,
            npcClass: false,
            occupation: false,
            age: false,
            gender: false,
            alignment: false,
            stats: false,
            skills: false,
            equipment: false,
            languages: false,
            backstory: false,
            spells: false,
            weapons: false
        };

        function toggleLock(field) {
            lockStates[field] = !lockStates[field];
            updateLockButton(field);
            updateFormFieldState(field);
        }

        function updateLockButton(field) {
            const btn = document.getElementById(`lock-${field}`);
            if (btn) {
                btn.classList.toggle('locked', lockStates[field]);
                btn.innerHTML = lockStates[field] ? '<i class="fa-solid fa-lock"></i>' : '<i class="fa-solid fa-lock-open"></i>';
                btn.title = lockStates[field] ? 'Click to unlock' : 'Click to lock';
            }
        }

        function updateFormFieldState(field) {
            // Map NPC fields to form element IDs
            const fieldToFormId = {
                'race': 'race',
                'npcClass': 'npcClass',
                'occupation': 'occupation',
                'age': 'age',
                'gender': 'gender',
                'alignment': 'alignment'
            };

            const formId = fieldToFormId[field];
            if (formId) {
                const formGroup = document.getElementById(formId)?.closest('.form-group');
                if (formGroup) {
                    formGroup.classList.toggle('disabled', lockStates[field]);
                }
            }
        }

        function updateAllFormStates() {
            ['race', 'npcClass', 'occupation', 'age', 'gender', 'alignment'].forEach(field => {
                updateFormFieldState(field);
            });
        }

        function regenerateNPC() {
            generateNPC();
        }

        function displayNPC(npc) {
            // Store NPC data globally
            currentNPC = npc;
            
            const resultDiv = document.getElementById('npcResult');
            const placeholder = document.getElementById('placeholder');
            const regenerateBtn = document.getElementById('regenerateBtn');

            placeholder.classList.add('hidden');
            resultDiv.classList.remove('hidden');
            regenerateBtn.style.display = 'flex';

            // Format class name nicely (showing all classes with levels and subclasses)
            // Commoner is always level 0 and doesn't show a level number
            let className;
            if (npc.characterClasses && npc.characterClasses.length > 0) {
                className = npc.characterClasses.map(cc => {
                    const name = cc.className === 'commoner' ? 'Commoner' : capitalize(cc.className);
                    // Show level for adventurer classes, but not for commoner (which is level 0)
                    let displayName = (cc.className !== 'commoner' && (cc.level > 1 || npc.characterClasses.length > 1)) 
                        ? `${name} ${cc.level}` 
                        : name;
                    // Add subclass if present
                    if (cc.subclass && subclasses[cc.className]) {
                        const subclassData = subclasses[cc.className];
                        const subclassOption = subclassData.options.find(o => o.id === cc.subclass);
                        if (subclassOption) {
                            displayName += ` (${subclassOption.name})`;
                        }
                    }
                    return displayName;
                }).join(' / ');
            } else {
                className = npc.npcClass === 'commoner' ? 'Commoner' : capitalize(npc.npcClass);
            }
            const occupationName = npc.occupation.replace(/_/g, ' ').split(' ').map(w => capitalize(w)).join(' ');

            // Helper to create lock button
            const lockBtn = (field) => `
                <button class="lock-btn ${lockStates[field] ? 'locked' : ''}" 
                        id="lock-${field}" 
                        onclick="toggleLock('${field}')"
                        title="${lockStates[field] ? 'Click to unlock' : 'Click to lock'}">
                    ${lockStates[field] ? '<i class="fa-solid fa-lock"></i>' : '<i class="fa-solid fa-lock-open"></i>'}
                </button>
            `;

            let html = `
                <div class="npc-card">
                    <!-- Name Row -->
                    <div class="npc-field-row" style="background: none; padding: 0; margin-bottom: 5px;">
                        <div class="npc-name-section">
                            <div class="npc-name editable" id="editable-name" onclick="editTextField('name', '${npc.name.replace(/'/g, "\\'")}', event)">${npc.name}</div>
                        </div>
                        ${lockBtn('name')}
                    </div>

                    <!-- Race Row -->
                    <div class="npc-field-row">
                        <div class="npc-field-content">
                            <span class="npc-field-label">Race:</span>
                            <span class="npc-field-value editable" id="editable-race" onclick="editSelectField('race', '${npc.race}', getRaceOptions(), event)">${capitalize(npc.race)}</span>
                        </div>
                        ${lockBtn('race')}
                    </div>

                    <!-- Class Row -->
                    <div class="npc-field-row">
                        <div class="npc-field-content">
                            <span class="npc-field-label">Class:</span>
                            <span class="npc-field-value editable" id="editable-npcClass" onclick="editClassField(event)">${className}</span>
                            ${npc.totalLevel > 1 ? `<span class="level-badge">Level ${npc.totalLevel}</span>` : ''}
                        </div>
                        ${lockBtn('npcClass')}
                    </div>

                    ${npc.characterClasses?.some(cc => cc.className === 'commoner') ? `
                    <!-- Occupation Row (for characters with Commoner class) -->
                    <div class="npc-field-row">
                        <div class="npc-field-content">
                            <span class="npc-field-label">Occupation:</span>
                            <span class="npc-field-value editable" id="editable-occupation" onclick="editSelectField('occupation', '${npc.occupation}', getOccupationOptions(), event)">${occupationName}</span>
                        </div>
                        ${lockBtn('occupation')}
                    </div>
                    ` : ''}

                    <!-- Age Row -->
                    <div class="npc-field-row">
                        <div class="npc-field-content">
                            <span class="npc-field-label">Age:</span>
                            <span class="npc-field-value editable" id="editable-age" onclick="editAgeField(event)">${npc.age === 0 ? 'Newborn' : npc.age + ' years old'}</span>
                        </div>
                        ${lockBtn('age')}
                    </div>

                    <!-- Gender Row -->
                    <div class="npc-field-row">
                        <div class="npc-field-content">
                            <span class="npc-field-label">Gender:</span>
                            <span class="npc-field-value editable" id="editable-gender" onclick="editSelectField('gender', '${npc.gender}', getGenderOptions(), event)">${capitalize(npc.gender)}</span>
                        </div>
                        ${lockBtn('gender')}
                    </div>

                    <!-- Alignment Row -->
                    <div class="npc-field-row">
                        <div class="npc-field-content">
                            <span class="npc-field-label">Alignment:</span>
                            <span class="npc-field-value editable" id="editable-alignment" onclick="editSelectField('alignment', '${npc.alignment}', getAlignmentOptions(), event)">${capitalize(npc.alignment)}</span>
                        </div>
                        ${lockBtn('alignment')}
                    </div>

                    <!-- Ability Scores Section with Lock -->
                    <div class="section-header">
                        <div class="section-title" style="border-bottom: none; padding-bottom: 0;"><i class="fa-solid fa-chart-simple"></i> Ability Scores</div>
                        ${lockBtn('stats')}
                    </div>
                    <div style="border-bottom: 2px solid #e9ecef; margin-bottom: 10px;"></div>
                    <div class="stat-grid">
            `;

            Object.keys(npc.abilities).forEach(ability => {
                const isProficient = npc.savingThrows && npc.savingThrows.includes(ability);
                html += `
                    <div class="stat-item" ${isProficient ? 'style="border: 2px solid #58180d;"' : ''}>
                        <div class="stat-label">${abilityNames[ability]}</div>
                        <div class="stat-value editable" id="editable-stat-${ability}" onclick="event.stopPropagation(); editStatField('${ability}')">${npc.abilities[ability]}</div>
                        <div class="stat-modifier">${formatModifier(npc.modifiers[ability])}</div>
                    </div>
                `;
            });

            html += `
                    </div>

                    <!-- Combat Stats Section -->
                    <div class="section-title"><i class="fa-solid fa-shield-halved"></i> Combat Stats</div>
                    <div class="info-item">
                        <span class="info-label">Hit Points:</span><span class="editable" id="editable-hp" onclick="event.stopPropagation(); editHPField()">${npc.hitPoints}</span> ${npc.customHP ? '(Custom)' : (npc.hitDice ? `(${npc.hitDice})` : '')}
                    </div>
                    <div class="info-item">
                        <span class="info-label">Armor Class:</span><span class="editable" id="editable-ac" onclick="event.stopPropagation(); editACField()">${npc.ac}</span> ${npc.customAC ? '(Custom)' : `(${npc.armorName})`}
                    </div>
                    <div class="info-item">
                        <span class="info-label">Initiative:</span>${npc.initiative >= 0 ? '+' : ''}${npc.initiative}
                    </div>
                    <div class="info-item">
                        <span class="info-label">Passive Perception:</span>${npc.passivePerception}
                    </div>
                    ${npc.proficiencyBonus ? `
                    <div class="info-item">
                        <span class="info-label">Proficiency Bonus:</span>+${npc.proficiencyBonus}
                    </div>
                    ` : ''}
            `;
            
            // Saving Throws with actual values
            const savingThrowValues = Object.keys(npc.modifiers).map(ability => {
                const isProficient = npc.savingThrows && npc.savingThrows.includes(ability);
                const value = npc.modifiers[ability] + (isProficient ? npc.proficiencyBonus : 0);
                const prefix = value >= 0 ? '+' : '';
                const profMark = isProficient ? '*' : '';
                return `${abilityNames[ability].substring(0, 3)} ${prefix}${value}${profMark}`;
            });
            
            html += `
                <div class="info-item">
                    <span class="info-label">Saving Throws:</span><span style="font-size: 0.9em;">${savingThrowValues.join(', ')}</span>
                </div>
            `;
            
            // Senses
            if (npc.senses && npc.senses.length > 0) {
                html += `
                    <div class="info-item">
                        <span class="info-label">Senses:</span>${npc.senses.join(', ')}
                    </div>
                `;
            }
            
            // Languages (editable)
            html += `
                <div class="section-header" style="margin-top: 10px;">
                    <div class="info-item" style="flex: 1; margin-bottom: 0;">
                        <span class="info-label">Languages:</span>
                        <span class="editable" style="cursor: pointer;" onclick="event.stopPropagation(); openMultiSelectModal('languages', 'Languages', getAllLanguages(), currentNPC.languages)">${npc.languages && npc.languages.length > 0 ? npc.languages.join(', ') : 'None'}</span>
                    </div>
                    ${lockBtn('languages')}
                </div>
            `;

            // Weapons Section
            html += `
                <div class="section-header" style="margin-top: 15px;">
                    <div class="section-title" style="border-bottom: none; padding-bottom: 0;"><i class="fa-solid fa-khanda"></i> Weapons</div>
                    ${lockBtn('weapons')}
                </div>
                <div class="weapons-list">
            `;
            
            // Show Tiny Fists for infants, Unarmed Strike for others
            const isInfant = npc.ageCategory === 'infant';
            
            if (isInfant) {
                // Tiny Fists for infants - does 0 damage
                html += `
                    <div class="weapon-card" title="The flailing fists of an infant. Adorable but ineffective." style="opacity: 0.85; border-style: dashed;">
                        <div class="weapon-header">
                            <span class="weapon-name"><i class="fa-solid fa-hand" style="margin-right: 5px;"></i>Tiny Fists</span>
                            <span class="weapon-type">Natural</span>
                        </div>
                        <div class="weapon-stats">
                            <div class="weapon-stat">
                                <span class="weapon-stat-label">Attack:</span>
                                <span class="weapon-stat-value">+0</span>
                            </div>
                            <div class="weapon-stat">
                                <span class="weapon-stat-label">Damage:</span>
                                <span class="weapon-stat-value">No Damage</span>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                const unarmedStrike = getUnarmedStrike(
                    npc.characterClasses?.[0]?.className || 'commoner',
                    npc.totalLevel || 1,
                    npc.modifiers,
                    npc.proficiencyBonus || 2
                );
                
                const unarmedAttackSign = unarmedStrike.attackBonus >= 0 ? '+' : '';
                const unarmedDamageSign = unarmedStrike.damageBonus >= 0 ? '+' : '';
                const unarmedDamageBonus = unarmedStrike.damageBonus !== 0 ? ` ${unarmedDamageSign}${unarmedStrike.damageBonus}` : '';
                const unarmedProperties = unarmedStrike.properties && unarmedStrike.properties.length > 0 ? unarmedStrike.properties.join(', ') : '';
                
                html += `
                    <div class="weapon-card" title="${unarmedStrike.description}" style="opacity: 0.85; border-style: dashed;">
                        <div class="weapon-header">
                            <span class="weapon-name"><i class="fa-solid fa-hand-fist" style="margin-right: 5px;"></i>${unarmedStrike.name}</span>
                            <span class="weapon-type">Natural</span>
                        </div>
                        <div class="weapon-stats">
                            <div class="weapon-stat">
                                <span class="weapon-stat-label">Attack:</span>
                                <span class="weapon-stat-value">${unarmedAttackSign}${unarmedStrike.attackBonus}</span>
                            </div>
                            <div class="weapon-stat">
                                <span class="weapon-stat-label">Damage:</span>
                                <span class="weapon-stat-value">${unarmedStrike.damage}${unarmedDamageBonus} ${unarmedStrike.damageType}</span>
                            </div>
                        </div>
                        ${unarmedProperties ? `<div class="weapon-properties">${unarmedProperties}</div>` : ''}
                    </div>
                `;
            }
            
            // Show racial natural weapon if applicable
            const racialWeapon = getRacialNaturalWeapon(npc.race, npc.modifiers);
            if (racialWeapon) {
                // Infants deal only 1 damage with no modifier, others use normal stats
                const racialAttackBonus = isInfant ? 0 : npc.modifiers.str + (npc.proficiencyBonus || 2);
                const racialAttackSign = racialAttackBonus >= 0 ? '+' : '';
                const racialDamage = isInfant ? '1' : racialWeapon.damage;
                const racialDamageSign = racialWeapon.damageBonus >= 0 ? '+' : '';
                const racialDamageBonus = isInfant ? '' : (racialWeapon.damageBonus !== 0 ? ` ${racialDamageSign}${racialWeapon.damageBonus}` : '');
                
                html += `
                    <div class="weapon-card" title="${racialWeapon.description}" style="border-style: dashed; border-color: #8b6914;${isInfant ? ' opacity: 0.85;' : ''}">
                        <div class="weapon-header">
                            <span class="weapon-name"><i class="fa-solid fa-paw" style="margin-right: 5px;"></i>${racialWeapon.name}</span>
                            <span class="weapon-type">Racial</span>
                        </div>
                        <div class="weapon-stats">
                            <div class="weapon-stat">
                                <span class="weapon-stat-label">Attack:</span>
                                <span class="weapon-stat-value">${racialAttackSign}${racialAttackBonus}</span>
                            </div>
                            <div class="weapon-stat">
                                <span class="weapon-stat-label">Damage:</span>
                                <span class="weapon-stat-value">${racialDamage}${racialDamageBonus} ${racialWeapon.damageType}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Then show equipped weapons
            if (npc.weapons && npc.weapons.length > 0) {
                npc.weapons.forEach((weapon, index) => {
                    const modifier = weapon.modifier || 0;
                    const totalAttackBonus = weapon.attackBonus + modifier;
                    const totalDamageBonus = weapon.damageBonus + modifier;
                    const attackSign = totalAttackBonus >= 0 ? '+' : '';
                    const damageSign = totalDamageBonus >= 0 ? '+' : '';
                    const damageBonus = totalDamageBonus !== 0 ? ` ${damageSign}${totalDamageBonus}` : '';
                    const properties = weapon.properties && weapon.properties.length > 0 ? weapon.properties.join(', ') : '';
                    const modifierBadge = modifier > 0 ? `<span class="weapon-modifier-badge">+${modifier}</span>` : '';
                    
                    html += `
                        <div class="weapon-card" title="${weapon.description || ''}">
                            <div class="weapon-header">
                                <span class="weapon-name">${weapon.name}${modifierBadge}</span>
                                <span class="weapon-type">${weapon.type === 'improvised' ? 'Improvised' : (weapon.type === 'custom' ? 'Custom' : (weapon.type === 'natural' ? 'Natural' : (weapon.type + ' ' + weapon.category)))}</span>
                            </div>
                            <div class="weapon-stats">
                                <div class="weapon-stat">
                                    <span class="weapon-stat-label">Attack:</span>
                                    <span class="weapon-stat-value">${attackSign}${totalAttackBonus}</span>
                                </div>
                                <div class="weapon-stat">
                                    <span class="weapon-stat-label">Damage:</span>
                                    <span class="weapon-stat-value">${weapon.damage === '0' || weapon.damage === 'none' || weapon.damageType === 'none' ? 'No Damage' : `${weapon.damage}${damageBonus} ${weapon.damageType}`}</span>
                                </div>
                            </div>
                            ${properties ? `<div class="weapon-properties">${properties}</div>` : ''}
                            <div class="weapon-card-actions">
                                <button class="weapon-action-btn modifier" onclick="event.stopPropagation(); setWeaponModifier(${index})">
                                    <i class="fa-solid fa-wand-magic-sparkles"></i> ${modifier > 0 ? 'Change +' + modifier : 'Add Modifier'}
                                </button>
                                <button class="weapon-action-btn remove" onclick="event.stopPropagation(); removeWeapon(${index})">
                                    <i class="fa-solid fa-trash"></i> Remove
                                </button>
                            </div>
                        </div>
                    `;
                });
            }
            
            html += `
                </div>
                <div class="weapon-add-buttons">
                    <button class="weapon-add-btn" onclick="event.stopPropagation(); openWeaponModal()">
                        <i class="fa-solid fa-plus"></i> Add Weapon
                    </button>
                    <button class="weapon-add-btn" onclick="event.stopPropagation(); openCustomWeaponModal()">
                        <i class="fa-solid fa-hammer"></i> Custom Weapon
                    </button>
                </div>
            `;

            html += `
                    <div class="section-title"><i class="fa-solid fa-person"></i> Physical Traits</div>
                    <div class="info-item">
                        <span class="info-label">Size:</span>${capitalize(npc.size)}
                    </div>
                    <div class="info-item">
                        <span class="info-label">Speed:</span>${npc.speed} feet
                    </div>
            `;
            
            // Racial Traits
            if (npc.traits && npc.traits.length > 0) {
                html += `
                    <div class="section-title"><i class="fa-solid fa-star"></i> Racial Traits</div>
                    <div class="traits-list">
                        ${npc.traits.map(trait => `<span class="trait-tag">${trait}</span>`).join('')}
                    </div>
                `;
            }
            
            // Class Features
            const characterFeatures = getCharacterFeatures(npc.characterClasses || [{ className: npc.npcClass, level: npc.totalLevel || 1 }]);
            if (characterFeatures.length > 0) {
                html += `
                    <div class="section-title"><i class="fa-solid fa-scroll"></i> Class Features</div>
                    <div class="features-list">
                        ${characterFeatures.map(f => `<span class="feature-tag" title="${f.description.replace(/"/g, '&quot;')}">${f.name} <span class="feature-level">(Lv ${f.level})</span></span>`).join('')}
                    </div>
                `;
            }
            
            // Spells Section (only for spellcasters)
            if (npc.spellData) {
                const abilityNames = { str: 'Strength', dex: 'Dexterity', con: 'Constitution', int: 'Intelligence', wis: 'Wisdom', cha: 'Charisma' };
                const spellAbilityName = abilityNames[npc.spellData.ability] || 'Unknown';
                
                html += `
                    <div class="section-header">
                        <div class="section-title" style="border-bottom: none; padding-bottom: 0;"><i class="fa-solid fa-hat-wizard"></i> Spellcasting</div>
                        ${lockBtn('spells')}
                    </div>
                    <div class="spell-stats">
                        <div class="spell-stat"><span class="spell-stat-label">Ability:</span> ${spellAbilityName}</div>
                        <div class="spell-stat"><span class="spell-stat-label">Save DC:</span> ${npc.spellData.saveDC}</div>
                        <div class="spell-stat"><span class="spell-stat-label">Attack:</span> +${npc.spellData.attackBonus}</div>
                    </div>
                `;
                
                // Spell Slots
                const slotLabels = ['1st', '2nd', '3rd', '4th', '5th', '6th', '7th', '8th', '9th'];
                const activeSlots = npc.spellData.spellSlots.map((count, idx) => ({ level: idx + 1, label: slotLabels[idx], count })).filter(s => s.count > 0);
                
                if (activeSlots.length > 0) {
                    html += `
                        <div class="spell-slots-display">
                            ${activeSlots.map(s => `<span class="spell-slot-badge">${s.label}: ${s.count}</span>`).join('')}
                        </div>
                    `;
                }
                
                // Cantrips
                if (npc.spellData.cantrips && npc.spellData.cantrips.length > 0) {
                    html += `
                        <div class="spell-section-title">Cantrips</div>
                        <div class="spells-list editable" onclick="event.stopPropagation(); openSpellModal('cantrips')">
                            ${npc.spellData.cantrips.map(spellId => {
                                const spell = spells[spellId];
                                return spell ? `<span class="spell-tag cantrip" title="${spell.description.substring(0, 200).replace(/"/g, '&quot;')}...">${spell.name}</span>` : '';
                            }).join('')}
                        </div>
                    `;
                }
                
                // Leveled Spells (grouped by level)
                if (npc.spellData.spells && npc.spellData.spells.length > 0) {
                    // Group spells by level
                    const spellsByLevel = {};
                    npc.spellData.spells.forEach(spellId => {
                        const spell = spells[spellId];
                        if (spell) {
                            if (!spellsByLevel[spell.level]) spellsByLevel[spell.level] = [];
                            spellsByLevel[spell.level].push({ id: spellId, ...spell });
                        }
                    });
                    
                    html += `
                        <div class="spell-section-title">Spells Known</div>
                        <div class="spells-list editable" onclick="event.stopPropagation(); openSpellModal('spells')">
                    `;
                    
                    // Sort levels and display
                    Object.keys(spellsByLevel).sort((a, b) => a - b).forEach(level => {
                        spellsByLevel[level].forEach(spell => {
                            html += `<span class="spell-tag level-${spell.level}" title="${spell.description.substring(0, 200).replace(/"/g, '&quot;')}...">${spell.name} <span class="spell-level-label">(${slotLabels[spell.level - 1]})</span></span>`;
                        });
                    });
                    
                    html += `</div>`;
                }
            }
            
            html += `
                    <!-- Skills Section with Lock -->
                    <div class="section-header">
                        <div class="section-title" style="border-bottom: none; padding-bottom: 0;"><i class="fa-solid fa-book"></i> Skill Proficiencies</div>
                        ${lockBtn('skills')}
                    </div>
                    <div style="border-bottom: 2px solid #e9ecef; margin-bottom: 10px;"></div>
                    <div class="skills-list editable" style="padding: 5px; margin: -5px; border-radius: 6px;" onclick="event.stopPropagation(); openMultiSelectModal('skills', 'Skill Proficiencies', getAllSkills(), currentNPC.skills)">
            `;

            const allSkills = [
                'Acrobatics', 'Animal Handling', 'Arcana', 'Athletics', 'Deception', 'History',
                'Insight', 'Intimidation', 'Investigation', 'Medicine', 'Nature', 'Perception',
                'Performance', 'Persuasion', 'Religion', 'Sleight of Hand', 'Stealth', 'Survival'
            ];
            const proficiencyBonus = npc.proficiencyBonus || 2;
            
            allSkills.forEach(skill => {
                const isProficient = npc.skills.includes(skill);
                const ability = skillAbilities[skill] || 'int';
                const abilityMod = npc.modifiers[ability] || 0;
                const skillMod = isProficient ? abilityMod + proficiencyBonus : abilityMod;
                const modStr = skillMod >= 0 ? `+${skillMod}` : `${skillMod}`;
                html += `<span class="skill-tag ${isProficient ? 'proficient' : ''}">${skill} <span class="skill-modifier">(${modStr})</span></span>`;
            });

            html += `
                    </div>

                    <!-- Equipment Section with Lock -->
                    <div class="section-header">
                        <div class="section-title" style="border-bottom: none; padding-bottom: 0;"><i class="fa-solid fa-toolbox"></i> Equipment</div>
                        ${lockBtn('equipment')}
                    </div>
                    <div style="border-bottom: 2px solid #e9ecef; margin-bottom: 10px;"></div>
                    <div class="editable" id="editable-equipment" style="padding: 5px; margin: -5px; border-radius: 6px;" onclick="event.stopPropagation(); openMultiSelectModal('equipment', 'Equipment', getAllEquipment(), currentNPC.equipment)">
            `;

            if (npc.equipment.length > 0) {
                npc.equipment.forEach(item => {
                    html += `<div class="info-item">${item}</div>`;
                });
            } else {
                html += `<div class="info-item" style="color: #6c757d; font-style: italic;">No notable equipment (click to add)</div>`;
            }

            html += `</div>`;

            if (npc.backstory) {
                html += `
                    <!-- Backstory Section with Lock -->
                    <div class="section-header">
                        <div class="section-title" style="border-bottom: none; padding-bottom: 0;"><i class="fa-solid fa-scroll"></i> Backstory</div>
                        ${lockBtn('backstory')}
                    </div>
                    <div style="border-bottom: 2px solid #e9ecef; margin-bottom: 10px;"></div>
                    <div class="info-item editable" id="editable-backstory" onclick="editTextareaField('backstory', currentNPC.backstory, event)">${npc.backstory}</div>
                `;
            }

            // Portrait section
            html += `
                <div class="portrait-section" id="portraitSection">
                    <div class="section-title"><i class="fa-solid fa-image"></i> Character Portrait</div>
                    <div id="portraitContainer" class="portrait-container">
                        <div class="portrait-placeholder" id="portraitPlaceholder">
                            <i class="fa-solid fa-user-circle"></i>
                            <span>Click below to generate a portrait</span>
                        </div>
                        <img id="portraitImage" class="portrait-image" style="display: none;" alt="Character Portrait">
                        <div id="portraitLoading" class="portrait-loading" style="display: none;">
                            <i class="fa-solid fa-spinner fa-spin"></i>
                            <span>Generating portrait...</span>
                        </div>
                    </div>
                    <div class="portrait-actions">
                        <button class="generate-portrait-btn" onclick="generatePortrait()">
                            <i class="fa-solid fa-wand-magic-sparkles"></i> Generate Portrait
                        </button>
                        <button class="view-prompt-btn" onclick="generatePortraitPrompt()">
                            <i class="fa-solid fa-eye"></i> View Prompt
                        </button>
                    </div>
                </div>
                
                <!-- Export Actions -->
                <div class="export-section">
                    <button class="export-pdf-btn" onclick="exportCharacterSheet()">
                        <i class="fa-solid fa-file-pdf"></i> Export Character Sheet
                    </button>
                    <div class="checkbox-group" style="margin-top: 10px; justify-content: center;">
                        <input type="checkbox" id="includeBackstory" checked>
                        <label for="includeBackstory" style="margin: 0;"><i class="fa-solid fa-scroll"></i> Include Backstory in PDF</label>
                    </div>
                </div>
            `;

            html += `</div>`;

            resultDiv.innerHTML = html;
            
            // Update form field states based on locks
            updateAllFormStates();
        }

        function capitalize(str) {
            return str.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
        }

        function showRaceDescription() {
            const raceSelect = document.getElementById('race');
            const descriptionDiv = document.getElementById('raceDescription');
            const selectedRace = raceSelect.value;

            if (selectedRace === 'random' || !selectedRace) {
                descriptionDiv.classList.add('hidden');
                return;
            }

            const raceData = races[selectedRace];
            if (raceData && raceData.description) {
                const raceName = capitalize(selectedRace);
                descriptionDiv.innerHTML = `<strong>${raceName}</strong>${raceData.description}`;
                descriptionDiv.classList.remove('hidden');
            } else {
                descriptionDiv.classList.add('hidden');
            }
        }

        function showClassDescription() {
            const classSelect = document.getElementById('npcClass');
            const descriptionDiv = document.getElementById('classDescription');
            const selectedClass = classSelect.value;

            if (selectedClass === 'random' || !selectedClass) {
                descriptionDiv.classList.add('hidden');
                return;
            }

            const classData = classes[selectedClass];
            if (classData && classData.description) {
                const className = capitalize(selectedClass);
                const hitDie = classData.hitDie || 'd4';
                descriptionDiv.innerHTML = `<strong>${className}</strong> (${hitDie}) - ${classData.description}`;
                descriptionDiv.classList.remove('hidden');
            } else {
                descriptionDiv.classList.add('hidden');
            }
        }

        // Multiclass tracking
        let multiclasses = []; // Array of {class: string, level: number}

        function onClassChange() {
            showClassDescription();
            
            const classSelect = document.getElementById('npcClass');
            const levelSelect = document.getElementById('npcClassLevel');
            const subclassSelect = document.getElementById('npcSubclass');
            const occupationSelect = document.getElementById('occupation');
            const occupationDesc = document.getElementById('occupationDescription');
            const multiclassSection = document.getElementById('multiclassSection');
            const selectedClass = classSelect.value;
            
            const isCommoner = selectedClass === 'commoner';
            const isAdventurer = selectedClass !== 'commoner' && selectedClass !== 'random';
            
            // Show/hide level selector (for adventurers only, commoner is always level 0)
            levelSelect.style.display = isAdventurer ? 'block' : 'none';
            
            // Show multiclass section for both commoners and adventurers (commoners can be retired adventurers)
            multiclassSection.style.display = (isCommoner || isAdventurer) ? 'block' : 'none';
            
            // Show/hide occupation (for commoner only)
            occupationSelect.style.display = isCommoner ? 'block' : 'none';
            if (!isCommoner && occupationDesc) {
                occupationDesc.classList.add('hidden');
            }
            
            // Update subclass options
            updateSubclassOptions();
        }

        function onLevelChange() {
            updateSubclassOptions();
        }

        function updateSubclassOptions() {
            const classSelect = document.getElementById('npcClass');
            const levelSelect = document.getElementById('npcClassLevel');
            const subclassSelect = document.getElementById('npcSubclass');
            
            const selectedClass = classSelect.value;
            const selectedLevel = parseInt(levelSelect.value) || 1;
            
            // Get subclass data for this class
            const subclassData = subclasses[selectedClass];
            
            // Check if subclass is available at this level
            if (!subclassData || selectedLevel < subclassData.level || selectedClass === 'commoner' || selectedClass === 'random') {
                subclassSelect.style.display = 'none';
                return;
            }
            
            // Build subclass options
            let optionsHtml = '<option value="random">Random ' + subclassData.name + '</option>';
            subclassData.options.forEach(opt => {
                optionsHtml += `<option value="${opt.id}">${opt.name} (${opt.source})</option>`;
            });
            
            subclassSelect.innerHTML = optionsHtml;
            subclassSelect.style.display = 'block';
        }

        function addMulticlass() {
            const mainClass = document.getElementById('npcClass').value;
            
            // Get list of available classes (exclude commoner, random, and already selected classes)
            const usedClasses = [mainClass, ...multiclasses.map(m => m.className)];
            const availableClasses = Object.keys(classes).filter(c => 
                c !== 'commoner' && !usedClasses.includes(c)
            );
            
            if (availableClasses.length === 0) {
                alert('No more classes available for multiclassing!');
                return;
            }
            
            // Add a new multiclass with the first available class
            multiclasses.push({
                className: availableClasses[0],
                level: 1
            });
            
            renderMulticlasses();
        }

        function removeMulticlass(index) {
            multiclasses.splice(index, 1);
            renderMulticlasses();
        }

        function updateMulticlass(index, field, value) {
            if (field === 'class') {
                multiclasses[index].className = value;
                // Reset subclass when class changes
                multiclasses[index].subclass = 'random';
                renderMulticlasses(); // Re-render to show/hide subclass dropdown
            } else if (field === 'level') {
                multiclasses[index].level = parseInt(value);
                // Check if subclass should now appear/disappear
                const subclassData = subclasses[multiclasses[index].className];
                if (subclassData && parseInt(value) < subclassData.level) {
                    multiclasses[index].subclass = null;
                }
                renderMulticlasses(); // Re-render to show/hide subclass dropdown
            } else if (field === 'subclass') {
                multiclasses[index].subclass = value;
            }
        }

        function renderMulticlasses() {
            const container = document.getElementById('multiclassContainer');
            const mainClass = document.getElementById('npcClass').value;
            const usedClasses = [mainClass, ...multiclasses.map(m => m.className)];
            
            let html = '';
            
            multiclasses.forEach((mc, index) => {
                // Available classes for this dropdown (current selection + unused classes)
                const availableForThis = Object.keys(classes).filter(c => 
                    c !== 'commoner' && (c === mc.className || !usedClasses.includes(c))
                );
                
                // Check if subclass is available for this class and level
                const subclassData = subclasses[mc.className];
                const showSubclass = subclassData && mc.level >= subclassData.level;
                
                html += `
                    <div class="multiclass-row">
                        <select onchange="updateMulticlass(${index}, 'class', this.value)">
                            ${availableForThis.map(c => `
                                <option value="${c}" ${c === mc.className ? 'selected' : ''}>${capitalize(c)}</option>
                            `).join('')}
                        </select>
                        <select class="level-select" onchange="updateMulticlass(${index}, 'level', this.value)">
                            ${Array.from({length: 20}, (_, i) => i + 1).map(lvl => `
                                <option value="${lvl}" ${lvl === mc.level ? 'selected' : ''}>Lvl ${lvl}</option>
                            `).join('')}
                        </select>
                        <button type="button" class="remove-multiclass-btn" onclick="removeMulticlass(${index})">
                            <i class="fa-solid fa-times"></i>
                        </button>
                        ${showSubclass ? `
                            <select class="subclass-select" onchange="updateMulticlass(${index}, 'subclass', this.value)">
                                <option value="random" ${!mc.subclass || mc.subclass === 'random' ? 'selected' : ''}>Random ${subclassData.name}</option>
                                ${subclassData.options.map(opt => `
                                    <option value="${opt.id}" ${mc.subclass === opt.id ? 'selected' : ''}>${opt.name}</option>
                                `).join('')}
                            </select>
                        ` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function getTotalLevel() {
            const mainLevel = parseInt(document.getElementById('npcClassLevel').value) || 1;
            const multiLevels = multiclasses.reduce((sum, mc) => sum + mc.level, 0);
            return mainLevel + multiLevels;
        }

        function getProficiencyBonus(totalLevel) {
            if (totalLevel <= 4) return 2;
            if (totalLevel <= 8) return 3;
            if (totalLevel <= 12) return 4;
            if (totalLevel <= 16) return 5;
            return 6;
        }

        // Get class features for a character based on their classes and levels
        function getCharacterFeatures(characterClasses) {
            if (!characterClasses || characterClasses.length === 0) return [];
            
            const features = [];
            characterClasses.forEach(cc => {
                const classFeatureList = classFeatures[cc.className] || [];
                classFeatureList.forEach(feature => {
                    if (feature.level <= cc.level) {
                        features.push({
                            ...feature,
                            className: cc.className
                        });
                    }
                });
            });
            
            // Sort by level, then by class name
            features.sort((a, b) => a.level - b.level || a.className.localeCompare(b.className));
            return features;
        }

        function calculateAC(primaryClassName, modifiers) {
            const classData = classes[primaryClassName];
            if (!classData || !classData.armor) {
                return { ac: 10 + modifiers.dex, armorName: 'Unarmored' };
            }
            
            const armor = classData.armor;
            let ac = armor.baseAC;
            let armorName = armor.name;
            
            // Add DEX modifier if applicable
            if (armor.addDex) {
                let dexBonus = modifiers.dex;
                if (armor.maxDex !== null) {
                    dexBonus = Math.min(dexBonus, armor.maxDex);
                }
                ac += dexBonus;
            }
            
            // Handle special unarmored defense calculations
            if (armor.special === 'barbarian') {
                // Barbarian: 10 + DEX + CON
                ac = 10 + modifiers.dex + modifiers.con;
                armorName = 'Unarmored Defense';
            } else if (armor.special === 'monk') {
                // Monk: 10 + DEX + WIS
                ac = 10 + modifiers.dex + modifiers.wis;
                armorName = 'Unarmored Defense';
            }
            
            return { ac, armorName };
        }

        function showOccupationDescription() {
            const occSelect = document.getElementById('occupation');
            const descriptionDiv = document.getElementById('occupationDescription');
            const selectedOcc = occSelect.value;

            if (selectedOcc === 'random' || !selectedOcc) {
                descriptionDiv.classList.add('hidden');
                return;
            }

            const occData = occupations[selectedOcc];
            if (occData && occData.description) {
                const occName = selectedOcc.replace(/_/g, ' ').split(' ').map(w => capitalize(w)).join(' ');
                descriptionDiv.innerHTML = `<strong>${occName}</strong> - ${occData.description}`;
                descriptionDiv.classList.remove('hidden');
            } else {
                descriptionDiv.classList.add('hidden');
            }
        }

        // Show descriptions on page load if values are already selected
        window.addEventListener('DOMContentLoaded', function() {
            showRaceDescription();
            showClassDescription();
            showOccupationDescription();
            onClassChange(); // Set initial state for occupation/subclass visibility
        });

        // ============================================
        // INLINE EDITING FUNCTIONS
        // ============================================

        // Prevent multiple edits at once
        let isEditing = false;

        // Edit text field (Name)
        function editTextField(field, currentValue, event) {
            if (event) event.stopPropagation();
            if (isEditing) return;
            isEditing = true;
            
            const element = document.getElementById(`editable-${field}`);
            if (!element) { isEditing = false; return; }
            
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'inline-edit-input';
            input.value = currentValue;
            
            element.innerHTML = '';
            element.appendChild(input);
            element.classList.remove('editable');
            
            // Use setTimeout to ensure focus happens after DOM update
            setTimeout(() => {
                input.focus();
                input.select();
            }, 10);
            
            let saved = false;
            const saveEdit = () => {
                if (saved) return;
                saved = true;
                const newValue = input.value.trim();
                if (newValue && newValue !== currentValue) {
                    currentNPC[field] = newValue;
                    regenerateBackstoryIfNeeded();
                }
                isEditing = false;
                displayNPC(currentNPC);
            };
            
            // Delay blur handler attachment
            setTimeout(() => {
                input.addEventListener('blur', saveEdit);
            }, 100);
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveEdit();
                } else if (e.key === 'Escape') {
                    saved = true;
                    isEditing = false;
                    displayNPC(currentNPC);
                }
            });
        }

        // Edit age field (number input)
        function editAgeField(event) {
            if (event) event.stopPropagation();
            if (isEditing) return;
            isEditing = true;
            
            const element = document.getElementById('editable-age');
            if (!element || !currentNPC) { isEditing = false; return; }
            
            const input = document.createElement('input');
            input.type = 'number';
            input.className = 'inline-edit-input';
            input.value = currentNPC.age;
            input.min = 0;
            input.max = 10000;
            input.style.width = '100px';
            
            element.innerHTML = '';
            element.appendChild(input);
            element.classList.remove('editable');
            
            setTimeout(() => {
                input.focus();
                input.select();
            }, 10);
            
            let saved = false;
            const saveEdit = () => {
                if (saved) return;
                saved = true;
                const newValue = parseInt(input.value);
                if (!isNaN(newValue) && newValue >= 0) {
                    currentNPC.age = newValue;
                    // Update age category based on new age
                    currentNPC.ageCategory = determineAgeCategory(newValue, currentNPC.race);
                    regenerateBackstoryIfNeeded();
                }
                isEditing = false;
                displayNPC(currentNPC);
            };
            
            setTimeout(() => {
                input.addEventListener('blur', saveEdit);
            }, 100);
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveEdit();
                } else if (e.key === 'Escape') {
                    saved = true;
                    isEditing = false;
                    displayNPC(currentNPC);
                }
            });
        }

        // Edit stat field (Ability Scores)
        function editStatField(ability) {
            if (isEditing) return;
            isEditing = true;
            
            const element = document.getElementById(`editable-stat-${ability}`);
            if (!element || !currentNPC) { isEditing = false; return; }
            
            const currentValue = currentNPC.abilities[ability];
            
            const input = document.createElement('input');
            input.type = 'number';
            input.className = 'inline-edit-input';
            input.value = currentValue;
            input.min = 1;
            input.max = 30;
            input.style.width = '60px';
            input.style.textAlign = 'center';
            input.style.fontSize = '1.3em';
            input.style.fontWeight = 'bold';
            input.style.padding = '6px 4px';
            input.style.MozAppearance = 'textfield';  // Hide spinners in Firefox
            input.classList.add('stat-input');
            
            element.innerHTML = '';
            element.appendChild(input);
            element.classList.remove('editable');
            
            setTimeout(() => {
                input.focus();
                input.select();
            }, 10);
            
            let saved = false;
            const saveEdit = () => {
                if (saved) return;
                saved = true;
                let newValue = parseInt(input.value);
                // Clamp value between 1 and 30
                if (isNaN(newValue) || newValue < 1) newValue = 1;
                if (newValue > 30) newValue = 30;
                
                currentNPC.abilities[ability] = newValue;
                // Recalculate modifier
                currentNPC.modifiers[ability] = Math.floor((newValue - 10) / 2);
                
                // Recalculate HP if CON changed (unless custom HP is set)
                if (ability === 'con' && !currentNPC.customHP) {
                    const classData = classes[currentNPC.npcClass];
                    if (classData) {
                        const hitDieMap = { 'd4': 4, 'd6': 6, 'd8': 8, 'd10': 10, 'd12': 12 };
                        const hitDieMax = hitDieMap[classData.hitDie] || 4;
                        currentNPC.hitPoints = hitDieMax + currentNPC.modifiers.con;
                    }
                }
                
                isEditing = false;
                displayNPC(currentNPC);
            };
            
            setTimeout(() => {
                input.addEventListener('blur', saveEdit);
            }, 100);
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveEdit();
                } else if (e.key === 'Escape') {
                    saved = true;
                    isEditing = false;
                    displayNPC(currentNPC);
                }
            });
        }

        // Edit HP field
        function editHPField() {
            if (isEditing) return;
            isEditing = true;
            
            const element = document.getElementById('editable-hp');
            if (!element || !currentNPC) { isEditing = false; return; }
            
            const currentValue = currentNPC.hitPoints;
            
            const input = document.createElement('input');
            input.type = 'number';
            input.className = 'inline-edit-input';
            input.value = currentValue;
            input.min = 1;
            input.max = 999;
            input.style.width = '60px';
            input.style.textAlign = 'center';
            input.style.MozAppearance = 'textfield';
            input.classList.add('stat-input');
            
            element.innerHTML = '';
            element.appendChild(input);
            element.classList.remove('editable');
            
            setTimeout(() => {
                input.focus();
                input.select();
            }, 10);
            
            let saved = false;
            const saveEdit = () => {
                if (saved) return;
                saved = true;
                let newValue = parseInt(input.value);
                if (isNaN(newValue) || newValue < 1) newValue = 1;
                if (newValue > 999) newValue = 999;
                
                currentNPC.hitPoints = newValue;
                currentNPC.customHP = true; // Mark as custom
                
                isEditing = false;
                displayNPC(currentNPC);
            };
            
            setTimeout(() => {
                input.addEventListener('blur', saveEdit);
            }, 100);
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveEdit();
                } else if (e.key === 'Escape') {
                    saved = true;
                    isEditing = false;
                    displayNPC(currentNPC);
                }
            });
        }

        // Edit AC field
        function editACField() {
            if (isEditing) return;
            isEditing = true;
            
            const element = document.getElementById('editable-ac');
            if (!element || !currentNPC) { isEditing = false; return; }
            
            const currentValue = currentNPC.ac;
            
            const input = document.createElement('input');
            input.type = 'number';
            input.className = 'inline-edit-input';
            input.value = currentValue;
            input.min = 1;
            input.max = 30;
            input.style.width = '60px';
            input.style.textAlign = 'center';
            input.style.MozAppearance = 'textfield';
            input.classList.add('stat-input');
            
            element.innerHTML = '';
            element.appendChild(input);
            element.classList.remove('editable');
            
            setTimeout(() => {
                input.focus();
                input.select();
            }, 10);
            
            let saved = false;
            const saveEdit = () => {
                if (saved) return;
                saved = true;
                let newValue = parseInt(input.value);
                if (isNaN(newValue) || newValue < 1) newValue = 1;
                if (newValue > 30) newValue = 30;
                
                currentNPC.ac = newValue;
                currentNPC.customAC = true; // Mark as custom
                
                isEditing = false;
                displayNPC(currentNPC);
            };
            
            setTimeout(() => {
                input.addEventListener('blur', saveEdit);
            }, 100);
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveEdit();
                } else if (e.key === 'Escape') {
                    saved = true;
                    isEditing = false;
                    displayNPC(currentNPC);
                }
            });
        }

        // Edit class field with multiclass support
        function editClassField(event) {
            if (event) event.stopPropagation();
            if (isEditing) return;
            if (!currentNPC) return;
            isEditing = true;
            
            const element = document.getElementById('editable-npcClass');
            if (!element) { isEditing = false; return; }
            
            // Build the class editor HTML
            const characterClasses = currentNPC.characterClasses || [{ className: currentNPC.npcClass, level: 1 }];
            
            let editorHtml = '<div class="inline-class-editor">';
            
            characterClasses.forEach((cc, index) => {
                const availableClasses = Object.keys(classes).filter(c => c !== 'commoner');
                const subclassData = subclasses[cc.className];
                const showSubclass = subclassData && cc.level >= subclassData.level;
                
                editorHtml += `
                    <div class="inline-class-row" data-index="${index}">
                        <select class="inline-class-select" data-index="${index}">
                            ${index === 0 ? '<option value="commoner">Commoner</option>' : ''}
                            ${availableClasses.map(c => `
                                <option value="${c}" ${c === cc.className ? 'selected' : ''}>${capitalize(c)}</option>
                            `).join('')}
                        </select>
                        <select class="inline-level-select" data-index="${index}">
                            ${Array.from({length: 20}, (_, i) => i + 1).map(lvl => `
                                <option value="${lvl}" ${lvl === cc.level ? 'selected' : ''}>Lvl ${lvl}</option>
                            `).join('')}
                        </select>
                        ${showSubclass ? `
                            <select class="inline-subclass-select" data-index="${index}">
                                ${subclassData.options.map(opt => `
                                    <option value="${opt.id}" ${opt.id === cc.subclass ? 'selected' : ''}>${opt.name}</option>
                                `).join('')}
                            </select>
                        ` : ''}
                        ${index > 0 ? `<button type="button" class="inline-remove-class" data-index="${index}"><i class="fa-solid fa-times"></i></button>` : ''}
                    </div>
                `;
            });
            
            editorHtml += `
                <div class="inline-class-actions">
                    <button type="button" class="inline-add-class"><i class="fa-solid fa-plus"></i> Add Class</button>
                    <button type="button" class="inline-save-class"><i class="fa-solid fa-check"></i> Done</button>
                </div>
            </div>`;
            
            element.innerHTML = editorHtml;
            element.classList.remove('editable');
            
            // Add event listeners
            const editor = element.querySelector('.inline-class-editor');
            
            // Class select changes
            editor.querySelectorAll('.inline-class-select').forEach(select => {
                select.addEventListener('change', (e) => {
                    const idx = parseInt(e.target.dataset.index);
                    const newClassName = e.target.value;
                    currentNPC.characterClasses[idx].className = newClassName;
                    if (idx === 0) currentNPC.npcClass = newClassName;
                    
                    // Reset subclass when class changes and set random if eligible
                    const newSubclassData = subclasses[newClassName];
                    const currentLevel = currentNPC.characterClasses[idx].level;
                    if (newSubclassData && currentLevel >= newSubclassData.level) {
                        currentNPC.characterClasses[idx].subclass = newSubclassData.options[0].id;
                    } else {
                        currentNPC.characterClasses[idx].subclass = null;
                    }
                    
                    // Re-render editor to show/hide subclass
                    recalculateNPCFromClasses();
                    isEditing = false;
                    displayNPC(currentNPC);
                    setTimeout(() => editClassField(null), 50);
                });
            });
            
            // Level select changes
            editor.querySelectorAll('.inline-level-select').forEach(select => {
                select.addEventListener('change', (e) => {
                    const idx = parseInt(e.target.dataset.index);
                    const newLevel = parseInt(e.target.value);
                    const className = currentNPC.characterClasses[idx].className;
                    currentNPC.characterClasses[idx].level = newLevel;
                    
                    // Check if subclass should now be shown/hidden
                    const subclassData = subclasses[className];
                    if (subclassData) {
                        if (newLevel >= subclassData.level && !currentNPC.characterClasses[idx].subclass) {
                            // Reached subclass level, pick first option
                            currentNPC.characterClasses[idx].subclass = subclassData.options[0].id;
                            // Re-render to show subclass
                            recalculateNPCFromClasses();
                            isEditing = false;
                            displayNPC(currentNPC);
                            setTimeout(() => editClassField(null), 50);
                        } else if (newLevel < subclassData.level && currentNPC.characterClasses[idx].subclass) {
                            // Below subclass level, remove it
                            currentNPC.characterClasses[idx].subclass = null;
                            recalculateNPCFromClasses();
                            isEditing = false;
                            displayNPC(currentNPC);
                            setTimeout(() => editClassField(null), 50);
                        }
                    }
                });
            });
            
            // Subclass select changes
            editor.querySelectorAll('.inline-subclass-select').forEach(select => {
                select.addEventListener('change', (e) => {
                    const idx = parseInt(e.target.dataset.index);
                    currentNPC.characterClasses[idx].subclass = e.target.value;
                });
            });
            
            // Remove class buttons
            editor.querySelectorAll('.inline-remove-class').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const idx = parseInt(e.target.closest('.inline-remove-class').dataset.index);
                    currentNPC.characterClasses.splice(idx, 1);
                    recalculateNPCFromClasses();
                    isEditing = false;
                    displayNPC(currentNPC);
                    // Re-open editor
                    setTimeout(() => editClassField(null), 50);
                });
            });
            
            // Add class button
            editor.querySelector('.inline-add-class').addEventListener('click', () => {
                const usedClasses = currentNPC.characterClasses.map(cc => cc.className);
                const availableClasses = Object.keys(classes).filter(c => 
                    c !== 'commoner' && !usedClasses.includes(c)
                );
                if (availableClasses.length > 0) {
                    const newClass = availableClasses[0];
                    const newSubclassData = subclasses[newClass];
                    // New multiclass starts at level 1, check if subclass available at level 1
                    const newSubclass = (newSubclassData && newSubclassData.level <= 1) ? newSubclassData.options[0].id : null;
                    currentNPC.characterClasses.push({ className: newClass, level: 1, subclass: newSubclass });
                    recalculateNPCFromClasses();
                    isEditing = false;
                    displayNPC(currentNPC);
                    setTimeout(() => editClassField(null), 50);
                }
            });
            
            // Done button
            const doneBtn = editor.querySelector('.inline-save-class');
            if (doneBtn) {
                doneBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    recalculateNPCFromClasses();
                    isEditing = false;
                    displayNPC(currentNPC);
                });
            }
        }

        function recalculateNPCFromClasses() {
            if (!currentNPC || !currentNPC.characterClasses) return;
            
            const characterClasses = currentNPC.characterClasses;
            currentNPC.npcClass = characterClasses[0]?.className || 'commoner';
            
            // Recalculate total level (commoner is level 0, doesn't count)
            currentNPC.totalLevel = characterClasses.reduce((sum, cc) => cc.className === 'commoner' ? sum : sum + cc.level, 0) || 1;
            
            // Recalculate proficiency bonus
            currentNPC.proficiencyBonus = getProficiencyBonus(currentNPC.totalLevel);
            
            // Recalculate HP (level 0 classes like commoner don't contribute)
            const hitDieMap = { 'd4': 4, 'd6': 6, 'd8': 8, 'd10': 10, 'd12': 12 };
            let hitPoints = 0;
            let hitDiceStr = [];
            let firstAdventurerClass = true;
            
            characterClasses.forEach((cc, index) => {
                // Skip level 0 classes (like commoner)
                if (cc.level <= 0) return;
                
                const cd = classes[cc.className];
                if (!cd) return;
                const hitDieMax = hitDieMap[cd.hitDie] || 4;
                const hitDieAvg = Math.floor(hitDieMax / 2) + 1;
                
                if (firstAdventurerClass) {
                    hitPoints += hitDieMax + currentNPC.modifiers.con;
                    for (let lvl = 2; lvl <= cc.level; lvl++) {
                        hitPoints += hitDieAvg + currentNPC.modifiers.con;
                    }
                    firstAdventurerClass = false;
                } else {
                    for (let lvl = 1; lvl <= cc.level; lvl++) {
                        hitPoints += hitDieAvg + currentNPC.modifiers.con;
                    }
                }
                
                hitDiceStr.push(`${cc.level}${cd.hitDie}`);
            });
            
            // Only update HP if not custom
            if (!currentNPC.customHP) {
                // For pure commoners (level 0), give them 1 HP + CON modifier
                if (hitPoints === 0) {
                    currentNPC.hitPoints = Math.max(1, 1 + currentNPC.modifiers.con);
                    currentNPC.hitDice = '';
                } else {
                    currentNPC.hitPoints = Math.max(1, hitPoints);
                    currentNPC.hitDice = hitDiceStr.join(' + ');
                }
            }
            
            // Update saving throws from primary class
            const primaryClassData = classes[characterClasses[0]?.className];
            currentNPC.savingThrows = primaryClassData?.savingThrows || [];
            
            // Recalculate AC based on primary class (only if not custom)
            if (!currentNPC.customAC) {
                const acData = calculateAC(characterClasses[0]?.className || 'commoner', currentNPC.modifiers);
                currentNPC.ac = acData.ac;
                currentNPC.armorName = acData.armorName;
            }
            
            // Combine skills from all classes
            let allClassSkills = [];
            characterClasses.forEach(cc => {
                const cd = classes[cc.className];
                if (cd && cd.skills) {
                    allClassSkills = [...allClassSkills, ...cd.skills];
                }
            });
            const occData = occupations[currentNPC.occupation];
            const occSkills = occData?.skills || [];
            currentNPC.skills = [...new Set([...allClassSkills, ...occSkills])];
            
            // Recalculate passive perception
            currentNPC.passivePerception = 10 + currentNPC.modifiers.wis + (currentNPC.skills.includes('Perception') ? currentNPC.proficiencyBonus : 0);
            
            // Regenerate backstory if not locked
            regenerateBackstoryIfNeeded();
        }

        // Edit textarea field (Backstory)
        function editTextareaField(field, currentValue, event) {
            if (event) event.stopPropagation();
            if (isEditing) return;
            isEditing = true;
            
            const element = document.getElementById(`editable-${field}`);
            if (!element) { isEditing = false; return; }
            
            const textarea = document.createElement('textarea');
            textarea.className = 'inline-edit-textarea';
            textarea.value = currentValue;
            
            element.innerHTML = '';
            element.appendChild(textarea);
            element.classList.remove('editable');
            
            setTimeout(() => {
                textarea.focus();
            }, 10);
            
            let saved = false;
            const saveEdit = () => {
                if (saved) return;
                saved = true;
                const newValue = textarea.value.trim();
                if (newValue) {
                    currentNPC[field] = newValue;
                }
                isEditing = false;
                displayNPC(currentNPC);
            };
            
            setTimeout(() => {
                textarea.addEventListener('blur', saveEdit);
            }, 100);
            
            textarea.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    saved = true;
                    isEditing = false;
                    displayNPC(currentNPC);
                }
            });
        }

        // Edit single-select field (Race, Class, Occupation, Gender, Alignment)
        function editSelectField(field, currentValue, options, event) {
            if (event) event.stopPropagation();
            if (isEditing) return;
            isEditing = true;
            
            const element = document.getElementById(`editable-${field}`);
            if (!element) { isEditing = false; return; }
            
            const select = document.createElement('select');
            select.className = 'inline-edit-select';
            
            options.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt.value;
                option.textContent = opt.label;
                if (opt.value === currentValue) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
            
            element.innerHTML = '';
            element.appendChild(select);
            element.classList.remove('editable');
            
            const finishEdit = () => {
                if (!isEditing) return;
                // Save the current value
                const newValue = select.value;
                if (newValue !== currentValue) {
                    updateNPCField(field, newValue);
                }
                isEditing = false;
                displayNPC(currentNPC);
            };
            
            // Only close on blur (when clicking outside)
            select.addEventListener('blur', finishEdit);
            
            select.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    isEditing = false;
                    displayNPC(currentNPC);
                } else if (e.key === 'Enter') {
                    finishEdit();
                }
            });
            
            // Focus the select
            select.focus();
        }

        // Update NPC field with recalculations if needed
        function updateNPCField(field, newValue) {
            currentNPC[field] = newValue;
            
            // Recalculate dependent fields
            if (field === 'race') {
                const raceData = races[newValue];
                if (raceData) {
                    currentNPC.size = raceData.size;
                    currentNPC.speed = raceData.speed;
                }
            }
            
            if (field === 'npcClass') {
                const classData = classes[newValue];
                if (classData) {
                    currentNPC.hitDie = classData.hitDie;
                    currentNPC.savingThrows = classData.savingThrows || [];
                    // Recalculate HP
                    const hitDieMap = { 'd4': 4, 'd6': 6, 'd8': 8, 'd10': 10, 'd12': 12 };
                    const hitDieMax = hitDieMap[classData.hitDie] || 4;
                    currentNPC.hitPoints = hitDieMax + currentNPC.modifiers.con;
                }
            }
            
            if (field === 'occupation') {
                const occData = occupations[newValue];
                if (occData && !lockStates.equipment) {
                    currentNPC.equipment = occData.equipment || [];
                }
            }
            
            // Regenerate backstory if not locked
            regenerateBackstoryIfNeeded();
        }
        
        // Regenerate backstory if not locked
        function regenerateBackstoryIfNeeded() {
            if (!currentNPC || lockStates.backstory) return;
            
            currentNPC.backstory = generateBackstory(
                currentNPC.name,
                currentNPC.race,
                currentNPC.occupation,
                currentNPC.age,
                currentNPC.alignment,
                currentNPC.ageCategory,
                currentNPC.gender,
                currentNPC.characterClasses
            );
        }

        // Get options for select fields
        function getRaceOptions() {
            return Object.keys(races).map(r => ({
                value: r,
                label: capitalize(r)
            })).sort((a, b) => a.label.localeCompare(b.label));
        }

        function getClassOptions() {
            return Object.keys(classes).map(c => ({
                value: c,
                label: capitalize(c)
            })).sort((a, b) => a.label.localeCompare(b.label));
        }

        function getOccupationOptions() {
            // Filter out auto-assigned occupations (infant, adventurer)
            return Object.keys(occupations)
                .filter(o => o !== 'infant' && o !== 'adventurer')
                .map(o => ({
                    value: o,
                    label: o.replace(/_/g, ' ').split(' ').map(w => capitalize(w)).join(' ')
                })).sort((a, b) => a.label.localeCompare(b.label));
        }

        function getGenderOptions() {
            return [
                { value: 'male', label: 'Male' },
                { value: 'female', label: 'Female' },
                { value: 'non-binary', label: 'Non-Binary' }
            ];
        }

        function getAlignmentOptions() {
            return alignments.map(a => ({
                value: a,
                label: capitalize(a)
            }));
        }

        // ============================================
        // MODAL FUNCTIONS FOR MULTI-SELECT
        // ============================================

        let currentModalField = null;
        let currentModalSelections = [];
        let currentMaxSkills = 0;
        let currentLockedSkills = [];

        // Get skills that are locked (granted by race/class and cannot be unselected)
        function getLockedSkills() {
            if (!currentNPC) return [];
            
            let locked = [];
            
            // Add class skills (from all classes)
            if (currentNPC.characterClasses) {
                currentNPC.characterClasses.forEach(cc => {
                    const classData = classes[cc.className];
                    if (classData && classData.skills) {
                        locked = [...locked, ...classData.skills];
                    }
                });
            }
            
            // Add racial trait skills (only traits that grant SPECIFIC skills, not choices)
            const raceData = races[currentNPC.race];
            if (raceData && raceData.traits) {
                raceData.traits.forEach(trait => {
                    // Keen Senses (Elf variants)  Perception
                    if (trait.includes('Keen Senses')) {
                        locked.push('Perception');
                    }
                    // Menacing (Half-Orc)  Intimidation
                    if (trait.includes('Menacing')) {
                        locked.push('Intimidation');
                    }
                    // Kender Ace  Sleight of Hand
                    if (trait.includes('Kender Ace')) {
                        locked.push('Sleight of Hand');
                    }
                    // Silent Feathers (Owlin)  Stealth
                    if (trait.includes('Silent Feathers')) {
                        locked.push('Stealth');
                    }
                    // Cat's Talent (Tabaxi)  Perception + Stealth
                    if (trait.includes('Cat\'s Talent')) {
                        locked.push('Perception', 'Stealth');
                    }
                    // Observant & Athletic (Locathah)  Athletics + Perception
                    if (trait.includes('Observant & Athletic')) {
                        locked.push('Athletics', 'Perception');
                    }
                    // Reveler (Satyr)  Performance + Persuasion
                    if (trait.includes('Reveler')) {
                        locked.push('Performance', 'Persuasion');
                    }
                    // Note: Hunter's Instincts, Primal Intuition, Kenku Training, Skill Versatility, 
                    // Extra Skill, Specialized Design grant CHOICES, so they're not locked to specific skills
                });
            }
            
            // Add occupation skills
            const occData = occupations[currentNPC.occupation];
            if (occData && occData.skills) {
                locked = [...locked, ...occData.skills];
            }
            
            return [...new Set(locked)]; // Remove duplicates
        }

        // Calculate maximum allowed skill proficiencies
        function getMaxSkillProficiencies() {
            if (!currentNPC || !currentNPC.characterClasses) return 2;
            
            let maxSkills = 0;
            
            // Get skill choices from primary class only (first in list)
            const primaryClass = currentNPC.characterClasses[0];
            if (primaryClass && classes[primaryClass.className]) {
                maxSkills = classes[primaryClass.className].skillChoices || 2;
            }
            
            // Add racial skill bonuses based on traits
            const raceData = races[currentNPC.race];
            if (raceData && raceData.traits) {
                raceData.traits.forEach(trait => {
                    // Traits that grant 2 skill proficiencies
                    if (trait.includes('Skill Versatility') ||     // Half-Elf: 2 skills of choice
                        trait.includes('Kenku Training') ||        // Kenku: 2 from Acrobatics/Deception/Stealth/Sleight of Hand
                        trait.includes('Cat\'s Talent') ||         // Tabaxi: Perception + Stealth
                        trait.includes('Hunter\'s Instincts') ||   // Leonin: choice from Athletics/Intimidation/Perception/Survival
                        trait.includes('Primal Intuition') ||      // Orc: 2 from Animal Handling/Insight/Intimidation/Medicine/Nature/Perception/Survival
                        trait.includes('Observant & Athletic') ||  // Locathah: Athletics + Perception
                        trait.includes('Reveler')) {               // Satyr: Performance + Persuasion
                        maxSkills += 2;
                    }
                    // Traits that grant 1 skill proficiency
                    else if (trait.includes('Keen Senses') ||      // Elf/variants: Perception
                        trait.includes('Menacing') ||              // Half-Orc: Intimidation
                        trait.includes('Kender Ace') ||            // Kender: Sleight of Hand
                        trait.includes('Silent Feathers') ||       // Owlin: Stealth
                        trait.includes('Extra Skill') ||           // Human: 1 skill of choice
                        trait.includes('Specialized Design')) {    // Warforged/Autognome: 1 skill of choice
                        maxSkills += 1;
                    }
                });
            }
            
            return maxSkills;
        }

        // Update the skill count display
        function updateSkillCountDisplay() {
            const warningDiv = document.getElementById('skillCountWarning');
            const countText = document.getElementById('skillCountText');
            
            if (currentModalField !== 'skills' || !warningDiv) {
                warningDiv.style.display = 'none';
                return;
            }
            
            const selected = currentModalSelections.length;
            const locked = currentLockedSkills.length;
            const max = currentMaxSkills;
            
            warningDiv.style.display = 'flex';
            
            if (selected <= max) {
                warningDiv.className = 'skill-count-warning ok';
                const lockedNote = locked > 0 ? ` (${locked} from race/class/occupation)` : '';
                countText.innerHTML = `<i class="fa-solid fa-circle-check"></i> ${selected} of ${max} proficiencies selected${lockedNote}`;
            } else {
                warningDiv.className = 'skill-count-warning error';
                const lockedNote = locked > 0 ? ` (${locked} locked)` : '';
                countText.innerHTML = `<i class="fa-solid fa-triangle-exclamation"></i> ${selected} selected  exceeds limit of ${max}${lockedNote}`;
            }
        }

        // Spell Modal Variables
        let currentSpellModalType = null; // 'cantrips' or 'spells'
        let currentSpellSelections = [];

        function openSpellModal(type) {
            if (!currentNPC || !currentNPC.spellData) return;
            
            currentSpellModalType = type;
            const isCantrips = type === 'cantrips';
            
            // Get current selections
            currentSpellSelections = isCantrips ? [...currentNPC.spellData.cantrips] : [...currentNPC.spellData.spells];
            
            // Get primary class for spell list
            const primaryClass = currentNPC.characterClasses[0];
            let spellClassName = primaryClass.className;
            
            // Handle subclass spellcasters
            if (primaryClass.subclass === 'eldritch-knight') {
                spellClassName = 'wizard';
            } else if (primaryClass.subclass === 'arcane-trickster') {
                spellClassName = 'wizard';
            }
            
            // Get available spells for this class
            const maxLevel = currentNPC.spellData.maxSpellLevel;
            const availableSpells = Object.keys(spells).filter(spellId => {
                const spell = spells[spellId];
                if (!spell.classes.includes(spellClassName)) return false;
                if (isCantrips) return spell.level === 0;
                return spell.level > 0 && spell.level <= maxLevel;
            }).sort((a, b) => {
                const spellA = spells[a];
                const spellB = spells[b];
                if (spellA.level !== spellB.level) return spellA.level - spellB.level;
                return spellA.name.localeCompare(spellB.name);
            });
            
            const modal = document.getElementById('spellSelectModal');
            const modalTitle = document.getElementById('spellModalTitle');
            const modalOptions = document.getElementById('spellModalOptions');
            const maxCount = isCantrips ? currentNPC.spellData.cantripsKnown : currentNPC.spellData.spellsKnownCount;
            
            modalTitle.innerHTML = `<i class="fa-solid fa-hat-wizard"></i> Edit ${isCantrips ? 'Cantrips' : 'Spells'} (${currentSpellSelections.length}/${maxCount})`;
            
            // Build options HTML grouped by level
            let optionsHtml = '';
            const slotLabels = ['Cantrip', '1st', '2nd', '3rd', '4th', '5th', '6th', '7th', '8th', '9th'];
            let currentLevel = -1;
            
            availableSpells.forEach(spellId => {
                const spell = spells[spellId];
                if (spell.level !== currentLevel) {
                    currentLevel = spell.level;
                    optionsHtml += `<div class="spell-modal-level-header">${slotLabels[currentLevel]} Level</div>`;
                }
                
                const isSelected = currentSpellSelections.includes(spellId);
                optionsHtml += `
                    <div class="modal-option ${isSelected ? 'selected' : ''}" onclick="toggleSpellOption(this, '${spellId}')" title="${spell.description.substring(0, 300).replace(/"/g, '&quot;')}...">
                        <span class="modal-option-checkbox"></span>
                        <span>${spell.name}</span>
                        <span class="spell-school">${spell.school}</span>
                    </div>
                `;
            });
            
            modalOptions.innerHTML = optionsHtml;
            modal.classList.add('active');
            updateSpellModalCount();
        }

        function toggleSpellOption(element, spellId) {
            element.classList.toggle('selected');
            
            if (element.classList.contains('selected')) {
                if (!currentSpellSelections.includes(spellId)) {
                    currentSpellSelections.push(spellId);
                }
            } else {
                currentSpellSelections = currentSpellSelections.filter(s => s !== spellId);
            }
            
            updateSpellModalCount();
        }

        function updateSpellModalCount() {
            const isCantrips = currentSpellModalType === 'cantrips';
            const maxCount = isCantrips ? currentNPC.spellData.cantripsKnown : currentNPC.spellData.spellsKnownCount;
            const modalTitle = document.getElementById('spellModalTitle');
            const count = currentSpellSelections.length;
            
            let statusClass = count <= maxCount ? 'ok' : 'over';
            modalTitle.innerHTML = `<i class="fa-solid fa-hat-wizard"></i> Edit ${isCantrips ? 'Cantrips' : 'Spells'} <span class="spell-count-${statusClass}">(${count}/${maxCount})</span>`;
        }

        function closeSpellModal() {
            const modal = document.getElementById('spellSelectModal');
            modal.classList.remove('active');
            currentSpellModalType = null;
            currentSpellSelections = [];
        }

        function saveSpellSelections() {
            if (currentSpellModalType && currentNPC && currentNPC.spellData) {
                if (currentSpellModalType === 'cantrips') {
                    currentNPC.spellData.cantrips = [...currentSpellSelections];
                } else {
                    currentNPC.spellData.spells = [...currentSpellSelections];
                }
                displayNPC(currentNPC);
            }
            closeSpellModal();
        }

        // ============================================
        // WEAPON MODAL FUNCTIONS
        // ============================================

        let selectedWeaponId = null;
        let currentWeaponModifierIndex = null;

        function openWeaponModal() {
            if (!currentNPC) return;
            
            selectedWeaponId = null;
            document.getElementById('weaponSearchInput').value = '';
            document.getElementById('weaponTypeFilter').value = 'all';
            document.getElementById('weaponCategoryFilter').value = 'all';
            document.getElementById('weaponModifierSelect').value = '0';
            
            renderWeaponList();
            
            const modal = document.getElementById('weaponSelectModal');
            modal.classList.add('active');
        }

        function renderWeaponList() {
            const searchTerm = document.getElementById('weaponSearchInput').value.toLowerCase();
            const typeFilter = document.getElementById('weaponTypeFilter').value;
            const categoryFilter = document.getElementById('weaponCategoryFilter').value;
            
            const container = document.getElementById('weaponModalOptions');
            
            // Filter weapons
            const filteredWeapons = Object.keys(weapons).filter(weaponId => {
                const weapon = weapons[weaponId];
                
                // Search filter
                if (searchTerm && !weapon.name.toLowerCase().includes(searchTerm)) return false;
                
                // Type filter
                if (typeFilter !== 'all' && weapon.type !== typeFilter) return false;
                
                // Category filter
                if (categoryFilter !== 'all' && weapon.category !== categoryFilter) return false;
                
                return true;
            }).sort((a, b) => {
                const weaponA = weapons[a];
                const weaponB = weapons[b];
                // Sort by type, then category, then name
                if (weaponA.type !== weaponB.type) return weaponA.type.localeCompare(weaponB.type);
                if (weaponA.category !== weaponB.category) return weaponA.category.localeCompare(weaponB.category);
                return weaponA.name.localeCompare(weaponB.name);
            });
            
            if (filteredWeapons.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #6c757d; padding: 20px;">No weapons match your filters</div>';
                return;
            }
            
            let html = '';
            filteredWeapons.forEach(weaponId => {
                const weapon = weapons[weaponId];
                const isSelected = selectedWeaponId === weaponId;
                const isProficient = currentNPC ? isWeaponProficient(currentNPC.characterClasses?.[0]?.className || 'commoner', weaponId) : false;
                const profBadge = isProficient ? '<span style="color: #28a745; font-size: 0.75em; margin-left: 5px;">(Proficient)</span>' : '';
                
                html += `
                    <div class="weapon-modal-item ${isSelected ? 'selected' : ''}" onclick="selectWeaponInModal('${weaponId}')">
                        <div class="weapon-modal-item-info">
                            <div class="weapon-modal-item-name">${weapon.name}${profBadge}</div>
                            <div class="weapon-modal-item-details">${capitalize(weapon.type)} ${weapon.category}  ${weapon.properties.length > 0 ? weapon.properties.join(', ') : 'No special properties'}</div>
                        </div>
                        <div class="weapon-modal-item-stats">
                            <div>${weapon.damage === '0' || weapon.damage === 'none' || weapon.damageType === 'none' ? '<strong>No Damage</strong>' : `<strong>${weapon.damage}</strong> ${weapon.damageType}`}</div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function filterWeaponList() {
            renderWeaponList();
        }

        function selectWeaponInModal(weaponId) {
            selectedWeaponId = weaponId;
            renderWeaponList();
        }

        function addSelectedWeapon() {
            if (!selectedWeaponId || !currentNPC) {
                alert('Please select a weapon first');
                return;
            }
            
            const weapon = weapons[selectedWeaponId];
            const modifier = parseInt(document.getElementById('weaponModifierSelect').value) || 0;
            const profBonus = currentNPC.proficiencyBonus || 2;
            const isProficient = isWeaponProficient(currentNPC.characterClasses?.[0]?.className || 'commoner', selectedWeaponId);
            
            const newWeapon = {
                ...weapon,
                id: selectedWeaponId,
                isProficient: isProficient,
                modifier: modifier,
                attackBonus: calculateAttackBonus(weapon, currentNPC.modifiers, profBonus, isProficient),
                damageBonus: calculateDamageBonus(weapon, currentNPC.modifiers)
            };
            
            if (!currentNPC.weapons) currentNPC.weapons = [];
            currentNPC.weapons.push(newWeapon);
            
            closeWeaponModal();
            displayNPC(currentNPC);
        }

        function closeWeaponModal() {
            const modal = document.getElementById('weaponSelectModal');
            modal.classList.remove('active');
            selectedWeaponId = null;
        }

        // Custom Weapon Modal
        function openCustomWeaponModal() {
            if (!currentNPC) return;
            
            // Reset form
            document.getElementById('customWeaponName').value = '';
            document.getElementById('customWeaponDamage').value = '';
            document.getElementById('customWeaponDamageType').value = 'slashing';
            document.getElementById('customWeaponCategory').value = 'melee';
            document.getElementById('customWeaponAbility').value = 'str';
            document.getElementById('customWeaponModifier').value = '0';
            document.getElementById('customWeaponProperties').value = '';
            document.getElementById('customWeaponDescription').value = '';
            
            const modal = document.getElementById('customWeaponModal');
            modal.classList.add('active');
        }

        function closeCustomWeaponModal() {
            const modal = document.getElementById('customWeaponModal');
            modal.classList.remove('active');
        }

        function addCustomWeapon() {
            const name = document.getElementById('customWeaponName').value.trim();
            const damage = document.getElementById('customWeaponDamage').value.trim();
            const damageType = document.getElementById('customWeaponDamageType').value;
            const category = document.getElementById('customWeaponCategory').value;
            const ability = document.getElementById('customWeaponAbility').value;
            const modifier = parseInt(document.getElementById('customWeaponModifier').value) || 0;
            const propertiesStr = document.getElementById('customWeaponProperties').value.trim();
            const description = document.getElementById('customWeaponDescription').value.trim();
            
            if (!name || !damage) {
                alert('Please enter at least a weapon name and damage');
                return;
            }
            
            const properties = propertiesStr ? propertiesStr.split(',').map(p => p.trim()).filter(p => p) : [];
            if (ability === 'finesse' && !properties.includes('finesse')) {
                properties.push('finesse');
            }
            
            const profBonus = currentNPC.proficiencyBonus || 2;
            
            // Calculate attack bonus based on ability
            let attackBonus;
            if (ability === 'finesse') {
                attackBonus = Math.max(currentNPC.modifiers.str, currentNPC.modifiers.dex) + profBonus;
            } else if (ability === 'dex' || category === 'ranged') {
                attackBonus = currentNPC.modifiers.dex + profBonus;
            } else {
                attackBonus = currentNPC.modifiers.str + profBonus;
            }
            
            // Calculate damage bonus
            let damageBonus;
            if (ability === 'finesse') {
                damageBonus = Math.max(currentNPC.modifiers.str, currentNPC.modifiers.dex);
            } else if (ability === 'dex' || category === 'ranged') {
                damageBonus = currentNPC.modifiers.dex;
            } else {
                damageBonus = currentNPC.modifiers.str;
            }
            
            const newWeapon = {
                id: 'custom-' + Date.now(),
                name: name,
                type: 'custom',
                category: category,
                damage: damage,
                damageType: damageType,
                properties: properties,
                description: description || 'A custom weapon.',
                isProficient: true,
                modifier: modifier,
                attackBonus: attackBonus,
                damageBonus: damageBonus
            };
            
            if (!currentNPC.weapons) currentNPC.weapons = [];
            currentNPC.weapons.push(newWeapon);
            
            closeCustomWeaponModal();
            displayNPC(currentNPC);
        }

        // Weapon Modifier Modal
        function setWeaponModifier(index) {
            if (!currentNPC || !currentNPC.weapons || !currentNPC.weapons[index]) return;
            
            currentWeaponModifierIndex = index;
            const weapon = currentNPC.weapons[index];
            
            document.getElementById('weaponModifierName').textContent = weapon.name;
            document.getElementById('weaponModifierValue').value = weapon.modifier || 0;
            
            const modal = document.getElementById('weaponModifierModal');
            modal.classList.add('active');
        }

        function closeWeaponModifierModal() {
            const modal = document.getElementById('weaponModifierModal');
            modal.classList.remove('active');
            currentWeaponModifierIndex = null;
        }

        function saveWeaponModifier() {
            if (currentWeaponModifierIndex === null || !currentNPC || !currentNPC.weapons) return;
            
            const modifier = parseInt(document.getElementById('weaponModifierValue').value) || 0;
            currentNPC.weapons[currentWeaponModifierIndex].modifier = modifier;
            
            closeWeaponModifierModal();
            displayNPC(currentNPC);
        }

        // Remove Weapon
        function removeWeapon(index) {
            if (!currentNPC || !currentNPC.weapons) return;
            
            currentNPC.weapons.splice(index, 1);
            displayNPC(currentNPC);
        }

        function openMultiSelectModal(field, title, options, currentSelections) {
            currentModalField = field;
            currentModalSelections = [...currentSelections];
            currentMaxSkills = getMaxSkillProficiencies();
            currentLockedSkills = field === 'skills' ? getLockedSkills() : [];
            
            // Ensure locked skills are always selected
            currentLockedSkills.forEach(skill => {
                if (!currentModalSelections.includes(skill)) {
                    currentModalSelections.push(skill);
                }
            });
            
            const modal = document.getElementById('multiSelectModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalOptions = document.getElementById('modalOptions');
            
            const iconMap = { skills: 'book', equipment: 'toolbox', languages: 'language' };
            const icon = iconMap[field] || 'list';
            modalTitle.innerHTML = `<i class="fa-solid fa-${icon}"></i> Edit ${title}`;
            
            // Build options HTML
            let optionsHtml = '';
            options.forEach(opt => {
                const isSelected = currentModalSelections.includes(opt);
                const isLocked = currentLockedSkills.includes(opt);
                const lockedClass = isLocked ? 'locked' : '';
                const lockedIcon = isLocked ? '<i class="fa-solid fa-lock" title="Granted by race/class"></i>' : '';
                
                optionsHtml += `
                    <div class="modal-option ${isSelected ? 'selected' : ''} ${lockedClass}" onclick="toggleModalOption(this, '${opt.replace(/'/g, "\\'")}')">
                        <span class="modal-option-checkbox"></span>
                        <span>${opt}</span>
                        ${lockedIcon}
                    </div>
                `;
            });
            
            modalOptions.innerHTML = optionsHtml;
            
            // Hide custom input for skills, show for equipment and languages
            const customInputSection = document.querySelector('.modal-custom-input');
            if (customInputSection) {
                customInputSection.style.display = field === 'skills' ? 'none' : 'flex';
            }
            
            // Update skill count display
            updateSkillCountDisplay();
            
            modal.classList.add('active');
        }

        function toggleModalOption(element, value) {
            // Don't allow toggling locked skills
            if (element.classList.contains('locked')) {
                return;
            }
            
            element.classList.toggle('selected');
            
            if (element.classList.contains('selected')) {
                if (!currentModalSelections.includes(value)) {
                    currentModalSelections.push(value);
                }
            } else {
                currentModalSelections = currentModalSelections.filter(s => s !== value);
            }
            
            // Update skill count if we're editing skills
            updateSkillCountDisplay();
        }

        function closeModal() {
            const modal = document.getElementById('multiSelectModal');
            modal.classList.remove('active');
            currentModalField = null;
            currentModalSelections = [];
            currentMaxSkills = 0;
            currentLockedSkills = [];
            
            // Hide skill count warning
            const warningDiv = document.getElementById('skillCountWarning');
            if (warningDiv) {
                warningDiv.style.display = 'none';
            }
        }

        function saveModalSelections() {
            if (currentModalField && currentNPC) {
                currentNPC[currentModalField] = [...currentModalSelections];
                displayNPC(currentNPC);
            }
            closeModal();
        }

        function addCustomItem() {
            const input = document.getElementById('customItemInput');
            const value = input.value.trim();
            
            if (value && !currentModalSelections.includes(value)) {
                currentModalSelections.push(value);
                
                // Add new option to the list
                const modalOptions = document.getElementById('modalOptions');
                const newOption = document.createElement('div');
                newOption.className = 'modal-option selected';
                newOption.onclick = function() { toggleModalOption(this, value); };
                newOption.innerHTML = `
                    <span class="modal-option-checkbox"></span>
                    <span>${value}</span>
                `;
                modalOptions.appendChild(newOption);
                
                input.value = '';
            }
        }

        // Get all available skills
        function getAllSkills() {
            const skills = new Set();
            // Standard D&D 5e skills
            const standardSkills = [
                'Acrobatics', 'Animal Handling', 'Arcana', 'Athletics', 'Deception',
                'History', 'Insight', 'Intimidation', 'Investigation', 'Medicine',
                'Nature', 'Perception', 'Performance', 'Persuasion', 'Religion',
                'Sleight of Hand', 'Stealth', 'Survival'
            ];
            standardSkills.forEach(s => skills.add(s));
            
            // Add skills from classes and occupations
            Object.values(classes).forEach(c => {
                if (c.skills) c.skills.forEach(s => skills.add(s));
            });
            Object.values(occupations).forEach(o => {
                if (o.skills) o.skills.forEach(s => skills.add(s));
            });
            
            return Array.from(skills).sort();
        }

        // Get all available languages
        function getAllLanguages() {
            return [
                // Standard Languages
                'Common', 'Dwarvish', 'Elvish', 'Giant', 'Gnomish', 'Goblin', 'Halfling', 'Orc',
                // Exotic Languages
                'Abyssal', 'Celestial', 'Draconic', 'Deep Speech', 'Infernal', 'Primordial', 'Sylvan', 'Undercommon',
                // Primordial Dialects
                'Aquan', 'Auran', 'Ignan', 'Terran',
                // Rare/Unusual Languages
                'Aarakocra', 'Druidic', 'Gith', 'Grung', 'Leonin', 'Loxodon', 'Minotaur', 'Quori', 'Thri-kreen', 'Vedalken'
            ].sort();
        }

        // Get all available equipment
        function getAllEquipment() {
            const equipment = new Set();
            
            // Add equipment from occupations
            Object.values(occupations).forEach(o => {
                if (o.equipment) o.equipment.forEach(e => equipment.add(e));
            });
            
            // Add some common items
            const commonItems = [
                'Backpack', 'Bedroll', 'Tinderbox', 'Torch', 'Rations (1 day)',
                'Waterskin', 'Rope (50 feet)', 'Dagger', 'Quarterstaff',
                'Clothes (common)', 'Clothes (traveler\'s)', 'Pouch'
            ];
            commonItems.forEach(e => equipment.add(e));
            
            return Array.from(equipment).sort();
        }

        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            const modal = document.getElementById('multiSelectModal');
            if (e.target === modal) {
                closeModal();
            }
            const promptModal = document.getElementById('portraitPromptModal');
            if (e.target === promptModal) {
                closePromptModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
                closePromptModal();
            }
        });

        // ============================================
        // PORTRAIT GENERATOR (Pollinations.ai)
        // ============================================

        function generatePortrait() {
            if (!currentNPC) return;

            const prompt = buildPortraitPrompt(currentNPC);
            const encodedPrompt = encodeURIComponent(prompt);
            
            // Pollinations.ai URL with parameters for quality
            const imageUrl = `https://image.pollinations.ai/prompt/${encodedPrompt}?width=512&height=512&nologo=true`;
            
            // Show loading state
            const placeholder = document.getElementById('portraitPlaceholder');
            const loading = document.getElementById('portraitLoading');
            const image = document.getElementById('portraitImage');
            const btn = document.querySelector('.generate-portrait-btn');
            
            if (placeholder) placeholder.style.display = 'none';
            if (loading) loading.style.display = 'flex';
            if (image) image.style.display = 'none';
            if (btn) btn.disabled = true;
            
            // Create new image to load
            const newImage = new Image();
            newImage.onload = function() {
                if (image) {
                    image.src = imageUrl;
                    image.style.display = 'block';
                }
                if (loading) loading.style.display = 'none';
                if (btn) btn.disabled = false;
            };
            newImage.onerror = function() {
                if (loading) loading.style.display = 'none';
                if (placeholder) {
                    placeholder.style.display = 'flex';
                    placeholder.innerHTML = `
                        <i class="fa-solid fa-exclamation-triangle"></i>
                        <span>Failed to generate. Try again.</span>
                    `;
                }
                if (btn) btn.disabled = false;
            };
            newImage.src = imageUrl;
        }

        function buildPortraitPrompt(npc) {
            const className = npc.npcClass === 'commoner' ? 'commoner' : npc.npcClass;
            const occupationName = npc.occupation.replace(/_/g, ' ');
            
            // Determine age description
            let ageDesc = '';
            if (npc.age < 5) ageDesc = 'infant';
            else if (npc.age < 15) ageDesc = 'young child';
            else if (npc.age < 25) ageDesc = 'young adult';
            else if (npc.age < 50) ageDesc = 'adult';
            else if (npc.age < 80) ageDesc = 'middle-aged';
            else ageDesc = 'elderly';

            // Get race-specific features
            const raceFeatures = getRaceVisualFeatures(npc.race);
            
            // Build the prompt
            let prompt = `Fantasy portrait of a ${ageDesc} ${npc.gender} ${npc.race} ${occupationName}`;
            
            if (className !== 'commoner') {
                prompt += ` and ${className}`;
            }
            
            prompt += `. ${raceFeatures}`;
            
            // Add alignment-based expression/demeanor
            const alignmentVibes = getAlignmentVisuals(npc.alignment);
            prompt += ` ${alignmentVibes}`;
            
            // Add occupation-based attire
            const attireHints = extractBackstoryVisuals(npc.backstory || '', npc.race, occupationName);
            if (attireHints) {
                prompt += ` ${attireHints}`;
            }

            // Art style
            prompt += ` Detailed fantasy art, dramatic lighting, character portrait, Dungeons and Dragons style, digital painting.`;

            return prompt;
        }

        // ============================================
        // PORTRAIT PROMPT VIEWER
        // ============================================

        function generatePortraitPrompt() {
            if (!currentNPC) return;

            const prompt = buildPortraitPrompt(currentNPC);

            // Show the modal with the prompt
            const modal = document.getElementById('portraitPromptModal');
            const textarea = document.getElementById('portraitPromptText');
            textarea.value = prompt;
            modal.classList.add('active');
            
            // Reset copy button state
            const copyBtn = document.getElementById('copyPromptBtn');
            copyBtn.classList.remove('copied');
            copyBtn.innerHTML = '<i class="fa-solid fa-copy"></i> Copy to Clipboard';
        }

        function getRaceVisualFeatures(race) {
            const features = {
                'human': 'Human with varied features.',
                'elf': 'Elegant elven features with pointed ears and graceful build.',
                'high elf': 'High elf with refined features, pointed ears, and an air of arcane nobility.',
                'wood elf': 'Wood elf with earthy skin tones, pointed ears, and wild, natural appearance.',
                'dark elf': 'Drow with dark purple-black skin, white hair, and piercing red eyes.',
                'dwarf': 'Stout dwarven build with thick beard and sturdy features.',
                'hill dwarf': 'Hill dwarf with ruddy complexion, thick beard, and keen eyes.',
                'mountain dwarf': 'Mountain dwarf with powerful build, braided beard, and stern expression.',
                'halfling': 'Small halfling with cheerful features and curly hair.',
                'lightfoot halfling': 'Nimble lightfoot halfling with quick eyes and friendly smile.',
                'stout halfling': 'Sturdy stout halfling with rosy cheeks and determined expression.',
                'gnome': 'Small gnome with large eyes, pointed ears, and curious expression.',
                'forest gnome': 'Forest gnome with earthy tones, large eyes, and connection to nature.',
                'rock gnome': 'Rock gnome with clever eyes, wild hair, and inventive spark.',
                'half-elf': 'Half-elf combining human and elven features with slightly pointed ears.',
                'half-orc': 'Half-orc with grayish-green skin, prominent jaw, and tusks.',
                'tiefling': 'Tiefling with reddish skin, horns, and a long tail. Infernal heritage visible.',
                'dragonborn': 'Dragonborn with scaled skin, draconic features, and proud bearing.',
                'aasimar': 'Aasimar with celestial beauty, glowing eyes, and ethereal presence.',
                'goliath': 'Massive goliath with gray skin, bald head, and tribal markings.',
                'firbolg': 'Tall firbolg with bovine-like features, large nose, and gentle eyes.',
                'kenku': 'Kenku with black feathered body, beak, and corvid features.',
                'lizardfolk': 'Lizardfolk with scaled green skin, reptilian features, and cold eyes.',
                'tabaxi': 'Tabaxi with feline features, fur patterns, and cat-like eyes.',
                'tortle': 'Tortle with shell on back, reptilian features, and wise eyes.',
                'aarakocra': 'Aarakocra with bird-like features, feathered body, and wings.',
                'genasi': 'Genasi with elemental features reflecting their heritage.',
                'warforged': 'Warforged with mechanical body, glowing eyes, and constructed appearance.',
                'changeling': 'Changeling with pale features and slightly unsettling androgynous appearance.',
                'kalashtar': 'Kalashtar with serene human-like features and distant, dreamlike gaze.',
                'shifter': 'Shifter with bestial features, sharp teeth, and animalistic traits.',
                'yuan-ti': 'Yuan-ti with snake-like features, scales, and serpentine eyes.',
                'triton': 'Triton with blue-green skin, webbed fingers, and aquatic features.',
                'bugbear': 'Bugbear with hulking furry body, pointed ears, and menacing presence.',
                'goblin': 'Small goblin with green skin, pointed ears, and sharp features.',
                'hobgoblin': 'Hobgoblin with orange-red skin, military bearing, and disciplined expression.',
                'kobold': 'Small kobold with reptilian features, scales, and dragon-like appearance.',
                'orc': 'Full orc with green skin, tusks, and powerful savage features.',
                'centaur': 'Centaur with human upper body and horse lower body.',
                'minotaur': 'Minotaur with bull head, horns, and powerful humanoid body.',
                'satyr': 'Satyr with goat legs, small horns, and mischievous features.',
                'fairy': 'Tiny fairy with delicate features, gossamer wings, and ethereal glow.',
                'harengon': 'Harengon with rabbit-like features, long ears, and alert expression.',
                'owlin': 'Owlin with owl-like features, feathers, and large wise eyes.'
            };
            return features[race.toLowerCase()] || `${capitalize(race)} with distinctive racial features.`;
        }

        function getAlignmentVisuals(alignment) {
            const visuals = {
                'lawful good': 'Noble and righteous bearing, warm and trustworthy expression.',
                'neutral good': 'Kind and approachable demeanor, gentle eyes.',
                'chaotic good': 'Free-spirited expression with a hint of mischief, warm smile.',
                'lawful neutral': 'Disciplined and composed expression, measuring gaze.',
                'true neutral': 'Balanced and calm expression, observant eyes.',
                'chaotic neutral': 'Unpredictable glint in eyes, carefree expression.',
                'lawful evil': 'Cold calculating expression, cruel sophistication.',
                'neutral evil': 'Selfish and cunning expression, untrustworthy eyes.',
                'chaotic evil': 'Wild and dangerous expression, hint of madness.'
            };
            return visuals[alignment] || 'Neutral expression.';
        }

        function extractBackstoryVisuals(backstory, race, occupation) {
            let hints = [];
            
            // Look for clothing/equipment hints based on occupation
            if (occupation.includes('blacksmith') || occupation.includes('smith')) {
                hints.push('Wearing a leather apron, muscular arms.');
            } else if (occupation.includes('merchant') || occupation.includes('trader')) {
                hints.push('Well-dressed in merchant attire, calculating expression.');
            } else if (occupation.includes('guard') || occupation.includes('soldier')) {
                hints.push('Wearing armor or uniform, vigilant stance.');
            } else if (occupation.includes('priest') || occupation.includes('cleric')) {
                hints.push('Wearing religious vestments, holy symbol visible.');
            } else if (occupation.includes('mage') || occupation.includes('wizard')) {
                hints.push('Wearing robes, arcane symbols, mystical presence.');
            } else if (occupation.includes('thief') || occupation.includes('rogue')) {
                hints.push('Hooded cloak, shadowy appearance, alert eyes.');
            } else if (occupation.includes('farmer') || occupation.includes('laborer')) {
                hints.push('Simple working clothes, weathered hands.');
            } else if (occupation.includes('noble') || occupation.includes('aristocrat')) {
                hints.push('Fine clothing, jewelry, aristocratic bearing.');
            } else if (occupation.includes('innkeeper') || occupation.includes('tavern')) {
                hints.push('Friendly tavern attire, welcoming demeanor.');
            } else if (occupation.includes('baker') || occupation.includes('cook')) {
                hints.push('Flour-dusted apron, warm friendly expression.');
            } else if (occupation.includes('healer') || occupation.includes('herbalist')) {
                hints.push('Carrying herbs or medical supplies, caring expression.');
            } else if (occupation.includes('hunter') || occupation.includes('ranger')) {
                hints.push('Woodland attire, bow or hunting gear, keen eyes.');
            } else if (occupation.includes('sailor') || occupation.includes('fisher')) {
                hints.push('Maritime clothing, weathered by sea and sun.');
            } else if (occupation.includes('entertainer') || occupation.includes('bard')) {
                hints.push('Colorful performer attire, charismatic presence.');
            } else if (occupation.includes('scholar') || occupation.includes('scribe')) {
                hints.push('Scholarly robes, spectacles, books or scrolls.');
            }
            
            return hints.join(' ');
        }

        function closePromptModal() {
            const modal = document.getElementById('portraitPromptModal');
            modal.classList.remove('active');
        }

        function copyPromptToClipboard() {
            const textarea = document.getElementById('portraitPromptText');
            const copyBtn = document.getElementById('copyPromptBtn');
            
            navigator.clipboard.writeText(textarea.value).then(() => {
                copyBtn.classList.add('copied');
                copyBtn.innerHTML = '<i class="fa-solid fa-check"></i> Copied!';
                
                setTimeout(() => {
                    copyBtn.classList.remove('copied');
                    copyBtn.innerHTML = '<i class="fa-solid fa-copy"></i> Copy to Clipboard';
                }, 2000);
            }).catch(err => {
                // Fallback for older browsers
                textarea.select();
                document.execCommand('copy');
                copyBtn.classList.add('copied');
                copyBtn.innerHTML = '<i class="fa-solid fa-check"></i> Copied!';
                
                setTimeout(() => {
                    copyBtn.classList.remove('copied');
                    copyBtn.innerHTML = '<i class="fa-solid fa-copy"></i> Copy to Clipboard';
                }, 2000);
            });
        }

        // Export Character Sheet to PDF (opens printable view)
        function exportCharacterSheet() {
            if (!currentNPC) return;
            
            const npc = currentNPC;
            const profBonus = npc.proficiencyBonus || 2;
            
            // Calculate saving throw values
            const savingThrows = Object.keys(npc.modifiers).map(ability => {
                const isProficient = npc.savingThrows && npc.savingThrows.includes(ability);
                const value = npc.modifiers[ability] + (isProficient ? profBonus : 0);
                const prefix = value >= 0 ? '+' : '';
                const profMark = isProficient ? ' *' : '';
                return `<tr><td>${abilityNames[ability]}</td><td style="text-align:right; width: 30px;">${prefix}${value}</td><td style="width: 10px;">${profMark}</td></tr>`;
            }).join('');
            
            // Calculate all skill values
            const allSkills = [
                'Acrobatics', 'Animal Handling', 'Arcana', 'Athletics', 'Deception', 'History',
                'Insight', 'Intimidation', 'Investigation', 'Medicine', 'Nature', 'Perception',
                'Performance', 'Persuasion', 'Religion', 'Sleight of Hand', 'Stealth', 'Survival'
            ];
            
            const skillRows = allSkills.map(skill => {
                const isProficient = npc.skills.includes(skill);
                const ability = skillAbilities[skill] || 'int';
                const abilityMod = npc.modifiers[ability] || 0;
                const skillMod = isProficient ? abilityMod + profBonus : abilityMod;
                const modStr = skillMod >= 0 ? `+${skillMod}` : `${skillMod}`;
                const profMark = isProficient ? '*' : '';
                return `<tr><td>${skill} (${ability.toUpperCase()})</td><td style="text-align:right; width: 30px;">${modStr}</td><td style="width: 10px;">${profMark}</td></tr>`;
            }).join('');
            
            // Build trait descriptions HTML
            const traitsHtml = npc.traits && npc.traits.length > 0 ? npc.traits.map(trait => {
                const description = traitDescriptions[trait] || 'No description available.';
                return `<div class="trait-block"><strong>${trait}.</strong> ${description}</div>`;
            }).join('') : '<p>None</p>';
            
            // Get portrait if available
            const portraitImg = document.getElementById('portraitImage');
            const hasPortrait = portraitImg && portraitImg.style.display !== 'none' && portraitImg.src;
            const portraitHtml = hasPortrait ? 
                `<img src="${portraitImg.src}" style="max-width: 200px; max-height: 200px; border-radius: 8px; margin-bottom: 15px;">` : '';
            
            // Build multiclass display with subclasses (commoner doesn't show level since it's 0)
            const classDisplay = npc.characterClasses && npc.characterClasses.length > 0 ?
                npc.characterClasses.map(c => {
                    // Commoner is level 0, so don't show level number
                    let display = c.className === 'commoner' 
                        ? 'Commoner' 
                        : `${capitalize(c.className)} ${c.level}`;
                    if (c.subclass && subclasses[c.className]) {
                        const subclassData = subclasses[c.className];
                        const subclassOption = subclassData.options.find(o => o.id === c.subclass);
                        if (subclassOption) display += ` (${subclassOption.name})`;
                    }
                    return display;
                }).join(' / ') :
                capitalize(npc.npcClass);
            
            // Create printable HTML
            const printHtml = `
<!DOCTYPE html>
<html>
<head>
    <title>${npc.name} - Character Sheet</title>
    <link href="https://db.onlinewebfonts.com/c/c391b9f3d65d9f9e311c80d964b696e1?family=Nodesto+Caps+Condensed" rel="stylesheet">
    <link href="https://db.onlinewebfonts.com/c/b9b59f3d31d975e265c5ed4c5433326f?family=Bookinsanity" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Bookinsanity', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 11pt;
            line-height: 1.4;
            color: #333;
            padding: 20px;
            max-width: 8.5in;
            margin: 0 auto;
        }
        h1 { font-family: 'Nodesto Caps Condensed', serif; font-size: 28pt; margin-bottom: 5px; color: #58180d; border-bottom: 3px solid #c9ad6a; padding-bottom: 5px; letter-spacing: 2px; }
        h2 { font-family: 'Nodesto Caps Condensed', serif; font-size: 16pt; margin: 15px 0 8px 0; color: #58180d; border-bottom: 2px solid #c9ad6a; padding-bottom: 3px; letter-spacing: 1px; }
        h3 { font-family: 'Nodesto Caps Condensed', serif; font-size: 13pt; margin: 10px 0 5px 0; color: #58180d; }
        .header-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        .header-info { flex: 1; }
        .header-portrait { text-align: right; }
        .subtitle { font-size: 12pt; color: #58180d; margin-bottom: 10px; font-style: italic; }
        .columns { display: flex; gap: 20px; }
        .column { flex: 1; }
        .stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
        .stat-box { border: 2px solid #58180d; border-radius: 8px; padding: 8px; text-align: center; background: #fdf1dc; }
        .stat-box.proficient { border-color: #28a745; background: #f0fff0; }
        .stat-name { font-family: 'Nodesto Caps Condensed', serif; font-size: 10pt; font-weight: bold; color: #58180d; text-transform: uppercase; letter-spacing: 1px; }
        .stat-score { font-size: 18pt; font-weight: bold; color: #58180d; }
        .stat-mod { font-size: 11pt; color: #58180d; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 10px; font-size: 10pt; }
        table td { padding: 3px 6px; border-bottom: 1px solid #eee; }
        table tr:last-child td { border-bottom: none; }
        .combat-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 15px; }
        .combat-box { border: 2px solid #58180d; border-radius: 8px; padding: 10px; text-align: center; background: #e0c9a0; }
        .combat-label { font-family: 'Nodesto Caps Condensed', serif; font-size: 9pt; font-weight: bold; color: #58180d; text-transform: uppercase; letter-spacing: 1px; }
        .combat-value { font-size: 16pt; font-weight: bold; color: #58180d; }
        .trait-block { margin-bottom: 8px; text-align: justify; }
        .trait-block strong { font-family: 'Nodesto Caps Condensed', serif; color: #58180d; }
        .backstory { text-align: justify; background: #fdf1dc; padding: 10px; border-radius: 8px; font-style: italic; border: 1px solid #c9ad6a; }
        .info-row { margin-bottom: 5px; }
        .info-label { font-weight: bold; color: #58180d; }
        .equipment-list { padding-left: 20px; }
        .proficient-note { font-size: 9pt; color: #666; margin-top: 5px; font-style: italic; }
        @media print {
            body { padding: 0; }
            @page { margin: 0.5in; }
        }
    </style>
</head>
<body>
    <div class="header-row">
        <div class="header-info">
            <h1>${npc.name}</h1>
            <div class="subtitle">
                ${capitalize(npc.gender)} ${capitalize(npc.race)} ${classDisplay} | Level ${npc.totalLevel || 1}<br>
                ${npc.characterClasses?.some(cc => cc.className === 'commoner') ? capitalize(npc.occupation) + ' | ' : ''}${capitalize(npc.alignment)}
            </div>
        </div>
        <div class="header-portrait">
            ${portraitHtml}
        </div>
    </div>

    <div class="columns">
        <div class="column">
            <h2>Ability Scores</h2>
            <div class="stat-grid">
                ${Object.keys(npc.abilities).map(ability => {
                    const isProficient = npc.savingThrows && npc.savingThrows.includes(ability);
                    return `
                    <div class="stat-box ${isProficient ? 'proficient' : ''}">
                        <div class="stat-name">${abilityNames[ability]}</div>
                        <div class="stat-score">${npc.abilities[ability]}</div>
                        <div class="stat-mod">${formatModifier(npc.modifiers[ability])}</div>
                    </div>`;
                }).join('')}
            </div>

            <h2>Combat</h2>
            <div class="combat-stats">
                <div class="combat-box">
                    <div class="combat-label">HP</div>
                    <div class="combat-value">${npc.hitPoints}</div>
                </div>
                <div class="combat-box">
                    <div class="combat-label">AC</div>
                    <div class="combat-value">${npc.ac}</div>
                </div>
                <div class="combat-box">
                    <div class="combat-label">Initiative</div>
                    <div class="combat-value">${npc.initiative >= 0 ? '+' : ''}${npc.initiative}</div>
                </div>
                <div class="combat-box">
                    <div class="combat-label">Prof. Bonus</div>
                    <div class="combat-value">+${profBonus}</div>
                </div>
            </div>
            <div class="info-row"><span class="info-label">Hit Dice:</span> ${npc.hitDice || npc.hitDie}</div>
            <div class="info-row"><span class="info-label">Armor:</span> ${npc.armorName}</div>
            <div class="info-row"><span class="info-label">Speed:</span> ${npc.speed} ft</div>
            <div class="info-row"><span class="info-label">Passive Perception:</span> ${npc.passivePerception}</div>

            <h2>Saving Throws</h2>
            <table>${savingThrows}</table>
            <div class="proficient-note">* = proficient</div>

            <h2>Senses</h2>
            <p>${npc.senses && npc.senses.length > 0 ? npc.senses.join(', ') : 'None'}</p>

            <h2>Languages</h2>
            <p>${npc.languages && npc.languages.length > 0 ? npc.languages.join(', ') : 'Common'}</p>
        </div>

        <div class="column">
            <h2>Skills</h2>
            <table>${skillRows}</table>
            <div class="proficient-note">* = proficient</div>

            <h2>Weapons</h2>
            ${(() => {
                const isInfant = npc.ageCategory === 'infant';
                let weaponRows = '';
                
                // Show Tiny Fists for infants, Unarmed Strike for others
                if (isInfant) {
                    weaponRows = '<tr style="background: #f0e6d2;"><td style="padding: 5px; border: 1px solid #c9ad6a;"><strong>Tiny Fists</strong><br><span style="font-size: 0.8em; color: #6c757d;">Natural</span></td><td style="padding: 5px; text-align: center; border: 1px solid #c9ad6a;">+0</td><td style="padding: 5px; text-align: center; border: 1px solid #c9ad6a;">No Damage</td><td style="padding: 5px; border: 1px solid #c9ad6a; font-size: 0.85em;"></td></tr>';
                } else {
                    const unarmed = getUnarmedStrike(
                        npc.characterClasses?.[0]?.className || 'commoner',
                        npc.totalLevel || 1,
                        npc.modifiers,
                        npc.proficiencyBonus || 2
                    );
                    const unarmedAttackSign = unarmed.attackBonus >= 0 ? '+' : '';
                    const unarmedDamageSign = unarmed.damageBonus >= 0 ? '+' : '';
                    const unarmedDamageBonus = unarmed.damageBonus !== 0 ? ' ' + unarmedDamageSign + unarmed.damageBonus : '';
                    const unarmedProps = unarmed.properties && unarmed.properties.length > 0 ? unarmed.properties.join(', ') : '';
                    
                    weaponRows = '<tr style="background: #f0e6d2;"><td style="padding: 5px; border: 1px solid #c9ad6a;"><strong>Unarmed Strike</strong><br><span style="font-size: 0.8em; color: #6c757d;">Natural</span></td><td style="padding: 5px; text-align: center; border: 1px solid #c9ad6a;">' + unarmedAttackSign + unarmed.attackBonus + '</td><td style="padding: 5px; text-align: center; border: 1px solid #c9ad6a;">' + unarmed.damage + unarmedDamageBonus + ' ' + unarmed.damageType + '</td><td style="padding: 5px; border: 1px solid #c9ad6a; font-size: 0.85em;">' + unarmedProps + '</td></tr>';
                }
                
                // Add racial natural weapon if applicable
                const racialWeapon = getRacialNaturalWeapon(npc.race, npc.modifiers);
                if (racialWeapon) {
                    // Infants deal only 1 damage with no modifier
                    const racialAttackBonus = isInfant ? 0 : npc.modifiers.str + (npc.proficiencyBonus || 2);
                    const racialAttackSign = racialAttackBonus >= 0 ? '+' : '';
                    const racialDamage = isInfant ? '1' : racialWeapon.damage;
                    const racialDamageSign = racialWeapon.damageBonus >= 0 ? '+' : '';
                    const racialDamageBonus = isInfant ? '' : (racialWeapon.damageBonus !== 0 ? ' ' + racialDamageSign + racialWeapon.damageBonus : '');
                    weaponRows += '<tr style="background: #f5ecd4;"><td style="padding: 5px; border: 1px solid #c9ad6a;"><strong>' + racialWeapon.name + '</strong><br><span style="font-size: 0.8em; color: #8b6914;">Racial</span></td><td style="padding: 5px; text-align: center; border: 1px solid #c9ad6a;">' + racialAttackSign + racialAttackBonus + '</td><td style="padding: 5px; text-align: center; border: 1px solid #c9ad6a;">' + racialDamage + racialDamageBonus + ' ' + racialWeapon.damageType + '</td><td style="padding: 5px; border: 1px solid #c9ad6a; font-size: 0.85em;"></td></tr>';
                }
                
                if (npc.weapons && npc.weapons.length > 0) {
                    weaponRows += npc.weapons.map(weapon => {
                        const modifier = weapon.modifier || 0;
                        const totalAttack = weapon.attackBonus + modifier;
                        const totalDamage = weapon.damageBonus + modifier;
                        const attackSign = totalAttack >= 0 ? '+' : '';
                        const damageSign = totalDamage >= 0 ? '+' : '';
                        const damageBonus = totalDamage !== 0 ? ' ' + damageSign + totalDamage : '';
                        const properties = weapon.properties && weapon.properties.length > 0 ? weapon.properties.join(', ') : '';
                        const modifierText = modifier > 0 ? ' <span style="color: #28a745; font-weight: bold;">+' + modifier + '</span>' : '';
                        const typeText = weapon.type === 'improvised' ? 'Improvised' : (weapon.type === 'custom' ? 'Custom' : (weapon.type === 'natural' ? 'Natural' : weapon.type + ' ' + weapon.category));
                        const damageDisplay = (weapon.damage === '0' || weapon.damage === 'none' || weapon.damageType === 'none') ? 'No Damage' : weapon.damage + damageBonus + ' ' + weapon.damageType;
                        return '<tr style="background: #fdf1dc;"><td style="padding: 5px; border: 1px solid #c9ad6a;"><strong>' + weapon.name + modifierText + '</strong><br><span style="font-size: 0.8em; color: #6c757d;">' + typeText + '</span></td><td style="padding: 5px; text-align: center; border: 1px solid #c9ad6a;">' + attackSign + totalAttack + '</td><td style="padding: 5px; text-align: center; border: 1px solid #c9ad6a;">' + damageDisplay + '</td><td style="padding: 5px; border: 1px solid #c9ad6a; font-size: 0.85em;">' + properties + '</td></tr>';
                    }).join('');
                }
                
                return '<table style="width: 100%; border-collapse: collapse; margin-bottom: 10px;"><thead><tr style="background: #c9ad6a; color: #3e0c02;"><th style="padding: 5px; text-align: left; border: 1px solid #a08050;">Weapon</th><th style="padding: 5px; text-align: center; border: 1px solid #a08050;">Attack</th><th style="padding: 5px; text-align: center; border: 1px solid #a08050;">Damage</th><th style="padding: 5px; text-align: left; border: 1px solid #a08050;">Properties</th></tr></thead><tbody>' + weaponRows + '</tbody></table>';
            })()}

            <h2>Equipment</h2>
            <ul class="equipment-list">
                ${npc.equipment.map(item => `<li>${item}</li>`).join('')}
            </ul>

            <h2>Physical Traits</h2>
            <div class="info-row"><span class="info-label">Age:</span> ${npc.age === 0 ? 'Newborn' : npc.age + ' years (' + capitalize(npc.ageCategory) + ')'}</div>
            <div class="info-row"><span class="info-label">Size:</span> ${capitalize(npc.size)}</div>
        </div>
    </div>

    <h2>Racial Traits</h2>
    ${traitsHtml}

    <h2>Class Features</h2>
    ${(() => {
        const features = getCharacterFeatures(npc.characterClasses || [{ className: npc.npcClass, level: npc.totalLevel || 1 }]);
        if (features.length === 0) return '<p>None</p>';
        return features.map(f => `<div class="trait-block"><strong>${f.name} (Level ${f.level} ${capitalize(f.className)}).</strong> ${f.description}</div>`).join('');
    })()}

    ${npc.spellData ? `
    <h2>Spellcasting</h2>
    <div class="spellcasting-header" style="margin-bottom: 15px; padding: 10px; background: #fdf1dc; border-radius: 5px; border: 1px solid #c9ad6a;">
        <div><strong>Spellcasting Ability:</strong> ${({str:'Strength',dex:'Dexterity',con:'Constitution',int:'Intelligence',wis:'Wisdom',cha:'Charisma'})[npc.spellData.ability]} (+${npc.spellData.abilityMod})</div>
        <div><strong>Spell Save DC:</strong> ${npc.spellData.saveDC} | <strong>Spell Attack Bonus:</strong> +${npc.spellData.attackBonus}</div>
        ${(() => {
            const slotLabels = ['1st', '2nd', '3rd', '4th', '5th', '6th', '7th', '8th', '9th'];
            const activeSlots = npc.spellData.spellSlots.map((count, idx) => ({ label: slotLabels[idx], count })).filter(s => s.count > 0);
            if (activeSlots.length === 0) return '';
            return '<div style="margin-top: 5px;"><strong>Spell Slots:</strong> ' + activeSlots.map(s => s.label + ': ' + s.count).join(' | ') + '</div>';
        })()}
    </div>
    
    ${npc.spellData.cantrips && npc.spellData.cantrips.length > 0 ? `
    <h3 style="color: #58180d; border-bottom: 1px solid #c9ad6a; padding-bottom: 5px;">Cantrips</h3>
    ${npc.spellData.cantrips.map(spellId => {
        const spell = spells[spellId];
        if (!spell) return '';
        const components = [];
        if (spell.components.v) components.push('V');
        if (spell.components.s) components.push('S');
        if (spell.components.m) components.push('M (' + spell.components.m + ')');
        return '<div class="trait-block"><strong>' + spell.name + '</strong> <em style="color: #6c757d;">(' + spell.school + ' cantrip)</em><br>' +
            '<span style="font-size: 0.9em; color: #495057;"><strong>Casting Time:</strong> ' + spell.castingTime + ' | <strong>Range:</strong> ' + spell.range + ' | <strong>Components:</strong> ' + components.join(', ') + ' | <strong>Duration:</strong> ' + spell.duration + '</span><br>' +
            spell.description + '</div>';
    }).join('')}
    ` : ''}
    
    ${npc.spellData.spells && npc.spellData.spells.length > 0 ? `
    ${(() => {
        const slotLabels = ['', '1st Level', '2nd Level', '3rd Level', '4th Level', '5th Level', '6th Level', '7th Level', '8th Level', '9th Level'];
        const spellsByLevel = {};
        npc.spellData.spells.forEach(spellId => {
            const spell = spells[spellId];
            if (spell) {
                if (!spellsByLevel[spell.level]) spellsByLevel[spell.level] = [];
                spellsByLevel[spell.level].push({ id: spellId, ...spell });
            }
        });
        
        let html = '';
        Object.keys(spellsByLevel).sort((a, b) => a - b).forEach(level => {
            html += '<h3 style="color: #58180d; border-bottom: 1px solid #c9ad6a; padding-bottom: 5px;">' + slotLabels[level] + ' Spells</h3>';
            spellsByLevel[level].forEach(spell => {
                const components = [];
                if (spell.components.v) components.push('V');
                if (spell.components.s) components.push('S');
                if (spell.components.m) components.push('M (' + spell.components.m + ')');
                html += '<div class="trait-block"><strong>' + spell.name + '</strong> <em style="color: #6c757d;">(' + spell.school + ')</em><br>' +
                    '<span style="font-size: 0.9em; color: #495057;"><strong>Casting Time:</strong> ' + spell.castingTime + ' | <strong>Range:</strong> ' + spell.range + ' | <strong>Components:</strong> ' + components.join(', ') + ' | <strong>Duration:</strong> ' + spell.duration + (spell.concentration ? ' (C)' : '') + '</span><br>' +
                    spell.description + '</div>';
            });
        });
        return html;
    })()}
    ` : ''}
    ` : ''}

    ${document.getElementById('includeBackstory')?.checked ? `
    <h2>Backstory</h2>
    <div class="backstory">${npc.backstory}</div>
    ` : ''}

    <scr` + `ipt>
        // Auto-print when opened
        window.onload = function() {
            window.print();
        };
    <\/script>
</body>
</html>`;

            // Open in new window for printing
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printHtml);
            printWindow.document.close();
        }
    </script>

    <!-- Multi-Select Modal -->
    <div id="multiSelectModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Edit</h3>
                <button class="modal-close" onclick="closeModal()">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div id="skillCountWarning" class="skill-count-warning" style="display: none;">
                <span id="skillCountText"></span>
            </div>
            <div class="modal-body">
                <div id="modalOptions"></div>
                <div class="modal-custom-input">
                    <input type="text" id="customItemInput" placeholder="Add custom item...">
                    <button onclick="addCustomItem()">
                        <i class="fa-solid fa-plus"></i> Add
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="closeModal()">Cancel</button>
                <button class="modal-btn modal-btn-save" onclick="saveModalSelections()">
                    <i class="fa-solid fa-check"></i> Save
                </button>
            </div>
        </div>
    </div>

    <!-- Spell Select Modal -->
    <div id="spellSelectModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title" id="spellModalTitle">Edit Spells</h3>
                <button class="modal-close" onclick="closeSpellModal()">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="modal-body" style="max-height: 60vh; overflow-y: auto;">
                <div id="spellModalOptions"></div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="closeSpellModal()">Cancel</button>
                <button class="modal-btn modal-btn-save" onclick="saveSpellSelections()">
                    <i class="fa-solid fa-check"></i> Save
                </button>
            </div>
        </div>
    </div>

    <!-- Weapon Select Modal -->
    <div id="weaponSelectModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 650px;">
            <div class="modal-header">
                <h3 class="modal-title" id="weaponModalTitle"><i class="fa-solid fa-khanda"></i> Add Weapon</h3>
                <button class="modal-close" onclick="closeWeaponModal()">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="weapon-modal-filters">
                    <input type="text" id="weaponSearchInput" class="weapon-modal-filter weapon-modal-search" placeholder="Search weapons..." oninput="filterWeaponList()">
                    <select id="weaponTypeFilter" class="weapon-modal-filter" onchange="filterWeaponList()">
                        <option value="all">All Types</option>
                        <option value="simple">Simple</option>
                        <option value="martial">Martial</option>
                    </select>
                    <select id="weaponCategoryFilter" class="weapon-modal-filter" onchange="filterWeaponList()">
                        <option value="all">All Categories</option>
                        <option value="melee">Melee</option>
                        <option value="ranged">Ranged</option>
                    </select>
                    <select id="weaponModifierSelect" class="weapon-modal-filter">
                        <option value="0">No Modifier</option>
                        <option value="1">+1</option>
                        <option value="2">+2</option>
                        <option value="3">+3</option>
                    </select>
                </div>
                <div id="weaponModalOptions" style="max-height: 45vh; overflow-y: auto;"></div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="closeWeaponModal()">Cancel</button>
                <button class="modal-btn modal-btn-save" onclick="addSelectedWeapon()">
                    <i class="fa-solid fa-plus"></i> Add Weapon
                </button>
            </div>
        </div>
    </div>

    <!-- Custom Weapon Modal -->
    <div id="customWeaponModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fa-solid fa-hammer"></i> Create Custom Weapon</h3>
                <button class="modal-close" onclick="closeCustomWeaponModal()">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="custom-weapon-form">
                    <div class="custom-weapon-row">
                        <div class="custom-weapon-field" style="flex: 2;">
                            <label>Weapon Name *</label>
                            <input type="text" id="customWeaponName" placeholder="e.g., Dragon Fang Sword">
                        </div>
                        <div class="custom-weapon-field">
                            <label>Modifier</label>
                            <select id="customWeaponModifier">
                                <option value="0">None</option>
                                <option value="1">+1</option>
                                <option value="2">+2</option>
                                <option value="3">+3</option>
                            </select>
                        </div>
                    </div>
                    <div class="custom-weapon-row">
                        <div class="custom-weapon-field">
                            <label>Damage *</label>
                            <input type="text" id="customWeaponDamage" placeholder="e.g., 1d8">
                        </div>
                        <div class="custom-weapon-field">
                            <label>Damage Type *</label>
                            <select id="customWeaponDamageType">
                                <option value="slashing">Slashing</option>
                                <option value="piercing">Piercing</option>
                                <option value="bludgeoning">Bludgeoning</option>
                                <option value="fire">Fire</option>
                                <option value="cold">Cold</option>
                                <option value="lightning">Lightning</option>
                                <option value="thunder">Thunder</option>
                                <option value="acid">Acid</option>
                                <option value="poison">Poison</option>
                                <option value="necrotic">Necrotic</option>
                                <option value="radiant">Radiant</option>
                                <option value="force">Force</option>
                                <option value="psychic">Psychic</option>
                            </select>
                        </div>
                    </div>
                    <div class="custom-weapon-row">
                        <div class="custom-weapon-field">
                            <label>Category</label>
                            <select id="customWeaponCategory">
                                <option value="melee">Melee</option>
                                <option value="ranged">Ranged</option>
                            </select>
                        </div>
                        <div class="custom-weapon-field">
                            <label>Ability</label>
                            <select id="customWeaponAbility">
                                <option value="str">Strength</option>
                                <option value="dex">Dexterity</option>
                                <option value="finesse">Finesse (STR or DEX)</option>
                            </select>
                        </div>
                    </div>
                    <div class="custom-weapon-row">
                        <div class="custom-weapon-field" style="flex: 1;">
                            <label>Properties (comma-separated)</label>
                            <input type="text" id="customWeaponProperties" placeholder="e.g., light, finesse, thrown (20/60)">
                        </div>
                    </div>
                    <div class="custom-weapon-row">
                        <div class="custom-weapon-field" style="flex: 1;">
                            <label>Description (optional)</label>
                            <input type="text" id="customWeaponDescription" placeholder="A legendary blade forged in dragon fire...">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="closeCustomWeaponModal()">Cancel</button>
                <button class="modal-btn modal-btn-save" onclick="addCustomWeapon()">
                    <i class="fa-solid fa-plus"></i> Create Weapon
                </button>
            </div>
        </div>
    </div>

    <!-- Weapon Modifier Modal -->
    <div id="weaponModifierModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 350px;">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fa-solid fa-wand-magic-sparkles"></i> Set Modifier</h3>
                <button class="modal-close" onclick="closeWeaponModifierModal()">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="modal-body" style="text-align: center; padding: 20px;">
                <p id="weaponModifierName" style="font-weight: 600; margin-bottom: 15px;"></p>
                <select id="weaponModifierValue" style="padding: 10px 20px; font-size: 1.1em; border-radius: 6px; border: 2px solid #c9ad6a;">
                    <option value="0">No Modifier</option>
                    <option value="1">+1</option>
                    <option value="2">+2</option>
                    <option value="3">+3</option>
                </select>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="closeWeaponModifierModal()">Cancel</button>
                <button class="modal-btn modal-btn-save" onclick="saveWeaponModifier()">
                    <i class="fa-solid fa-check"></i> Save
                </button>
            </div>
        </div>
    </div>

    <!-- Portrait Prompt Modal -->
    <div id="portraitPromptModal" class="prompt-modal-overlay">
        <div class="prompt-modal-content">
            <div class="prompt-modal-header">
                <h3><i class="fa-solid fa-image"></i> Portrait Prompt</h3>
                <button class="prompt-modal-close" onclick="closePromptModal()">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="prompt-modal-body">
                <p style="margin-top: 0; color: #6c757d; font-size: 0.9em;">
                    Copy this prompt and paste it into your preferred AI image generator (DALL-E, Midjourney, Stable Diffusion, etc.)
                </p>
                <textarea id="portraitPromptText" class="prompt-textarea" readonly></textarea>
                <div class="prompt-modal-actions">
                    <button class="copy-prompt-btn" id="copyPromptBtn" onclick="copyPromptToClipboard()">
                        <i class="fa-solid fa-copy"></i> Copy to Clipboard
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>